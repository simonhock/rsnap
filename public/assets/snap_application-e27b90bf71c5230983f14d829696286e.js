function nop(){return null}function localize(t){return t}function isNil(t){return void 0===t||null===t}function contains(t,e){return t.some(function(t){return t===e})}function detect(t,e){var o,i=t.length;for(o=0;i>o;o+=1)if(e.call(null,t[o]))return t[o];return null}function sizeOf(t){var e,o=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o+=1);return o}function isString(t){return"string"==typeof t||t instanceof String}function isObject(t){return null!==t&&("object"==typeof t||t instanceof Object)}function radians(t){return t*Math.PI/180}function degrees(t){return 180*t/Math.PI}function fontHeight(t){var e=Math.max(t,MorphicPreferences.minimumFontHeight);return 1.2*e}function newCanvas(t){var e,o;return o=t||{x:0,y:0},e=document.createElement("canvas"),e.width=o.x,e.height=o.y,e}function getMinimumFontHeight(){var t,e,o,i,r,n="I",s=50,a=document.createElement("canvas");for(a.width=s,a.height=s,t=a.getContext("2d"),t.font="1px serif",e=t.measureText(n).width,t.fillStyle="black",t.textBaseline="bottom",t.fillText(n,0,s),r=0;s>r;r+=1)for(i=0;e>i;i+=1)if(o=t.getImageData(i,r,1,1),0!==o.data[3])return s-r+1;return 0}function getBlurredShadowSupport(){var t,e,o;return t=document.createElement("canvas"),t.width=10,t.height=10,o=t.getContext("2d"),o.fillStyle="rgb(255, 0, 0)",o.beginPath(),o.arc(5,5,5,0,2*Math.PI,!0),o.closePath(),o.fill(),e=document.createElement("canvas"),e.width=10,e.height=10,o=e.getContext("2d"),o.shadowBlur=10,o.shadowColor="rgba(0, 0, 255, 1)",o.drawImage(t,0,0),o.getImageData(0,0,1,1).data[3]?!0:!1}function getDocumentPositionOf(t){var e,o;if(null===t)return{x:0,y:0};for(e={x:t.offsetLeft,y:t.offsetTop},o=t.offsetParent;null!==o;)e.x+=o.offsetLeft,e.y+=o.offsetTop,o!==document.body&&o!==document.documentElement&&(e.x-=o.scrollLeft,e.y-=o.scrollTop),o=o.offsetParent;return e}function clone(t){if("object"==typeof t){var e=function(){nop()};return e.prototype=t,new e}return t}function copy(t){var e,o,i;if("object"!=typeof t)return t;if(e=t.valueOf(),t!==e)return new t.constructor(e);if(t instanceof t.constructor&&t.constructor!==Object){o=clone(t.constructor.prototype);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])}else{o={};for(i in t)o[i]||(o[i]=t[i])}return o}function Color(t,e,o,i){this.r=t||0,this.g=e||0,this.b=o||0,this.a=i||(0===i?0:1)}function Point(t,e){this.x=t||0,this.y=e||0}function Rectangle(t,e,o,i){this.init(new Point(t||0,e||0),new Point(o||0,i||0))}function Node(t,e){this.init(t||null,e||[])}function Morph(){this.init()}function ShadowMorph(){this.init()}function HandleMorph(t,e,o,i,r,n){this.init(t,e,o,i,r,n)}function PenMorph(){this.init()}function ColorPaletteMorph(t,e){this.init(t||null,e||new Point(80,50))}function GrayPaletteMorph(t,e){this.init(t||null,e||new Point(80,10))}function ColorPickerMorph(t){this.init(t||new Color(255,255,255))}function BlinkerMorph(t){this.init(t)}function CursorMorph(t){this.init(t)}function BoxMorph(t,e,o){this.init(t,e,o)}function SpeechBubbleMorph(t,e,o,i,r,n,s){this.init(t,e,o,i,r,n,s)}function CircleBoxMorph(t){this.init(t||"vertical")}function SliderButtonMorph(t){this.init(t)}function SliderMorph(t,e,o,i,r,n){this.init(t||1,e||100,o||50,i||10,r||"vertical",n)}function MouseSensorMorph(t,e,o){this.init(t,e,o)}function InspectorMorph(t){this.init(t)}function MenuMorph(t,e,o,i){this.init(t,e,o,i)}function StringMorph(t,e,o,i,r,n,s,a,h,l){this.init(t,e,o,i,r,n,s,a,h,l)}function TextMorph(t,e,o,i,r,n,s,a,h,l){this.init(t,e,o,i,r,n,s,a,h,l)}function TriggerMorph(t,e,o,i,r,n,s,a,h,l,p){this.init(t,e,o,i,r,n,s,a,h,l,p)}function MenuItemMorph(t,e,o,i,r,n,s,a,h,l,p){this.init(t,e,o,i,r,n,s,a,h,l,p)}function FrameMorph(t){this.init(t)}function ScrollFrameMorph(t,e,o){this.init(t,e,o)}function ListMorph(t,e,o,i){this.init(t||[],e||function(t){return isString(t)?t:t.toSource?t.toSource():t.toString()},o||[],i)}function StringFieldMorph(t,e,o,i,r,n,s){this.init(t||"",e||100,o||12,i||"sans-serif",r||!1,n||!1,s)}function BouncerMorph(){this.init()}function HandMorph(t){this.init(t)}function WorldMorph(t,e){this.init(t,e)}function localize(t){return SnapTranslator.translate(t)}function Localizer(t,e){this.language=t||"en",this.dict=e||{}}function PushButtonMorph(t,e,o,i,r,n){this.init(t,e,o,i,r,n)}function ToggleButtonMorph(t,e,o,i,r,n,s,a,h,l,p){this.init(t,e,o,i,r,n,s,a,h,l,p)}function TabMorph(t,e,o,i,r,n,s){this.init(t,e,o,i,r,n,s)}function ToggleMorph(t,e,o,i,r,n,s,a,h,l){this.init(t,e,o,i,r,n,s,a,h,l)}function ToggleElementMorph(t,e,o,i,r,n,s,a){this.init(t,e,o,i,r,n,s,a)}function DialogBoxMorph(t,e,o){this.init(t,e,o)}function AlignmentMorph(t,e){this.init(t,e)}function InputFieldMorph(t,e,o,i){this.init(t,e,o,i)}function SyntaxElementMorph(){this.init()}function BlockMorph(){this.init()}function CommandBlockMorph(){this.init()}function HatBlockMorph(){this.init()}function ReporterBlockMorph(t){this.init(t)}function RingMorph(){this.init()}function ScriptsMorph(t){this.init(t)}function ArgMorph(t){this.init(t)}function CommandSlotMorph(){this.init()}function RingCommandSlotMorph(){this.init()}function CSlotMorph(){this.init()}function InputSlotMorph(t,e,o,i){this.init(t,e,o,i)}function TemplateSlotMorph(t){this.init(t)}function BooleanSlotMorph(){this.init()}function ArrowMorph(t,e,o,i){this.init(t,e,o,i)}function TextSlotMorph(t,e,o,i){this.init(t,e,o,i)}function SymbolMorph(t,e,o,i,r){this.init(t,e,o,i,r)}function ColorSlotMorph(t){this.init(t)}function BlockHighlightMorph(){this.init()}function MultiArgMorph(t,e,o,i,r,n,s,a,h){this.init(t,e,o,i,r,n,s,a,h)}function ArgLabelMorph(t,e){this.init(t,e)}function FunctionSlotMorph(t){this.init(t)}function ReporterSlotMorph(t){this.init(t)}function RingReporterSlotMorph(t){this.init(t)}function CommentMorph(t){this.init(t)}function snapEquals(t,e){if(t instanceof List||e instanceof List)return t instanceof List&&e instanceof List?t.equalTo(e):!1;var o=+t,i=+e,r=[!0,!1,""];return(isNaN(o)||isNaN(i)||[t,e].some(function(t){return contains(r,t)||isString(t)&&t.indexOf(" ")>-1}))&&(o=t,i=e),isString(o)&&isString(i)?o.toLowerCase()===i.toLowerCase():o===i}function ThreadManager(){function t(t,e){for(var o="",i=t;i>0;--i)o+=e[Math.round(Math.random()*(e.length-1))];return o}this.processes=[],this.finishedMessage=t(10,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")}function Process(t){this.topBlock=t||null,this.readyToYield=!1,this.readyToTerminate=!1,this.isDead=!1,this.errorFlag=!1,this.context=null,this.homeContext=new Context,this.lastYield=Date.now(),this.isAtomic=!1,this.prompter=null,this.httpRequest=null,this.isPaused=!1,this.pauseOffset=null,this.frameCount=0,t&&(this.homeContext.receiver=t.receiver(),this.homeContext.variables.parentFrame=this.homeContext.receiver.variables,this.context=new Context(null,t.blockSequence(),this.homeContext),this.pushContext("doYield"))}function Context(t,e,o,i){this.outerContext=o||null,this.parentContext=t||null,this.expression=e||null,this.receiver=i||null,this.variables=new VariableFrame,this.outerContext&&(this.variables.parentFrame=this.outerContext.variables,this.receiver=this.outerContext.receiver),this.upvars=null,this.inputs=[],this.pc=0,this.startTime=null,this.activeAudio=null,this.activeNote=null,this.isLambda=!1,this.isImplicitLambda=!1,this.isCustomBlock=!1,this.emptySlots=0}function VariableFrame(t,e){this.vars={},this.parentFrame=t||null,this.owner=e||null}function UpvarReference(t){this.vars={},this.parentFrame=t||null}function SpriteMorph(t){this.init(t)}function SpriteHighlightMorph(){this.init()}function StageMorph(t){this.init(t)}function SpriteBubbleMorph(t,e,o,i){this.init(t,e,o,i)}function Costume(t,e,o){this.contents=t||newCanvas(),this.shrinkToFit(this.maxExtent),this.name=e||null,this.rotationCenter=o||this.center(),this.version=Date.now(),this.loaded=null}function SVG_Costume(t,e,o){this.contents=t,this.shrinkToFit(this.maxExtent),this.name=e||null,this.rotationCenter=o||this.center(),this.version=Date.now(),this.loaded=null}function CostumeEditorMorph(t){this.init(t)}function Sound(t,e){this.audio=t,this.name=e||"Sound"}function Note(t){this.pitch=0===t?0:t||69,this.setupContext(),this.oscillator=null}function CellMorph(t,e,o,i){this.init(t,e,o,i)}function WatcherMorph(t,e,o,i,r){this.init(t,e,o,i,r)}function StagePrompterMorph(t){this.init(t)}function IDE_Morph(t){this.init(t)}function ProjectDialogMorph(t,e){this.init(t,e)}function SpriteIconMorph(t,e){this.init(t,e)}function CostumeIconMorph(t,e){this.init(t,e)}function TurtleIconMorph(t,e){this.init(t,e)}function WardrobeMorph(t,e){this.init(t,e)}function SoundIconMorph(t,e){this.init(t,e)}function JukeboxMorph(t,e){this.init(t,e)}function PaintEditorMorph(){this.init()}function PaintColorPickerMorph(t,e){this.init(t,e)}function PaintCanvasMorph(t){this.init(t)}function List(t){this.contents=t||[],this.first=null,this.rest=null,this.isLinked=!1,this.lastChanged=Date.now()}function ListWatcherMorph(t,e){this.init(t,e)}function CustomBlockDefinition(t,e){this.body=null,this.scripts=[],this.category=null,this.isGlobal=!1,this.type="command",this.spec=t||"",this.declarations={},this.comment=null,this.codeMapping=null,this.codeHeader=null,this.receiver=e||null}function CustomCommandBlockMorph(t,e){this.init(t,e)}function CustomReporterBlockMorph(t,e,o){this.init(t,e,o)}function JaggedBlockMorph(t){this.init(t)}function BlockDialogMorph(t,e,o){this.init(t,e,o)}function BlockEditorMorph(t,e){this.init(t,e)}function PrototypeHatBlockMorph(t){this.init(t)}function BlockLabelFragment(t){this.labelString=t||"",this.type="%s",this.defaultValue="",this.options="",this.isReadOnly=!1,this.isDeleted=!1}function BlockLabelFragmentMorph(t){this.init(t)}function BlockLabelPlaceHolderMorph(){this.init()}function BlockInputFragmentMorph(t){this.init(t)}function InputSlotDialogMorph(t,e,o,i,r){this.init(t,e,o,i,r)}function VariableDialogMorph(t,e,o){this.init(t,e,o)}function BlockExportDialogMorph(t,e){this.init(t,e)}function BlockImportDialogMorph(t,e,o){this.init(t,e,o)}function ReadStream(t){this.contents=t||"",this.index=0}function XML_Element(t,e,o){this.init(t,e,o)}function XML_Serializer(){this.contents=[],this.media=[],this.isCollectingMedia=!1}function SnapSerializer(){this.init()}function Cloud(t){this.username=null,this.password=null,this.url=t,this.session=null,this.api={}}(function(){var t,e,o;t=function(t){var e;e=window.onload,window.onload="function"!=typeof window.onload?t:function(){e&&e(),t()}},window.addLoadEvent=t,o=function(t,e){var o,i;null==e&&(e=!1);try{if(i=new XMLHttpRequest,i.open("GET",t,e),i.send(),200===i.status)return i.responseText;throw new Error("unable to retrieve "+t)}catch(r){return o=r}},window.getURL=o,e=function(t){return"undefined"==typeof window.assetsUrl&&(window.assetsUrl=JSON.parse(o("/snap_assets.json"))),window.assetsUrl[t]},window.getAsset=e}).call(this);var morphicVersion="2014-February-03",modules={},useBlurredShadows=getBlurredShadowSupport(),standardSettings={minimumFontHeight:getMinimumFontHeight(),globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:12,bubbleHelpFontSize:10,prompterFontName:"sans-serif",prompterFontSize:12,prompterSliderSize:10,handleSize:15,scrollBarSize:12,mouseScrollAmount:40,useSliderForInput:!1,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1},touchScreenSettings={minimumFontHeight:standardSettings.minimumFontHeight,globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:24,bubbleHelpFontSize:18,prompterFontName:"sans-serif",prompterFontSize:24,prompterSliderSize:20,handleSize:26,scrollBarSize:24,mouseScrollAmount:40,useSliderForInput:!0,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1},MorphicPreferences=standardSettings;Color.prototype.toString=function(){return"rgba("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+","+this.a+")"},Color.prototype.copy=function(){return new Color(this.r,this.g,this.b,this.a)},Color.prototype.eq=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},Color.prototype.hsv=function(){var t,e,o,i,r,n,s=this.r/255,a=this.g/255,h=this.b/255;if(t=Math.max(s,a,h),e=Math.min(s,a,h),o=t,i=t,r=t,n=t-e,i=0===t?0:n/t,t===e)o=0;else{switch(t){case s:o=(a-h)/n+(h>a?6:0);break;case a:o=(h-s)/n+2;break;case h:o=(s-a)/n+4}o/=6}return[o,i,r]},Color.prototype.set_hsv=function(t,e,o){var i,r,n,s,a;switch(i=Math.floor(6*t),r=6*t-i,n=o*(1-e),s=o*(1-r*e),a=o*(1-(1-r)*e),i%6){case 0:this.r=o,this.g=a,this.b=n;break;case 1:this.r=s,this.g=o,this.b=n;break;case 2:this.r=n,this.g=o,this.b=a;break;case 3:this.r=n,this.g=s,this.b=o;break;case 4:this.r=a,this.g=n,this.b=o;break;case 5:this.r=o,this.g=n,this.b=s}this.r*=255,this.g*=255,this.b*=255},Color.prototype.mixed=function(t,e){var o=Math.min(Math.max(t,0),1),i=1-o;return new Color(this.r*o+e.r*i,this.g*o+e.g*i,this.b*o+e.b*i)},Color.prototype.darker=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(0,0,0))},Color.prototype.lighter=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(255,255,255))},Color.prototype.dansDarker=function(){var t=this.hsv(),e=new Color,o=Math.max(t[2]-.16,0);return e.set_hsv(t[0],t[1],o),e},Point.prototype.toString=function(){return Math.round(this.x.toString())+"@"+Math.round(this.y.toString())},Point.prototype.copy=function(){return new Point(this.x,this.y)},Point.prototype.eq=function(t){return this.x===t.x&&this.y===t.y},Point.prototype.lt=function(t){return this.x<t.x&&this.y<t.y},Point.prototype.gt=function(t){return this.x>t.x&&this.y>t.y},Point.prototype.ge=function(t){return this.x>=t.x&&this.y>=t.y},Point.prototype.le=function(t){return this.x<=t.x&&this.y<=t.y},Point.prototype.max=function(t){return new Point(Math.max(this.x,t.x),Math.max(this.y,t.y))},Point.prototype.min=function(t){return new Point(Math.min(this.x,t.x),Math.min(this.y,t.y))},Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))},Point.prototype.abs=function(){return new Point(Math.abs(this.x),Math.abs(this.y))},Point.prototype.neg=function(){return new Point(-this.x,-this.y)},Point.prototype.mirror=function(){return new Point(this.y,this.x)},Point.prototype.floor=function(){return new Point(Math.max(Math.floor(this.x),0),Math.max(Math.floor(this.y),0))},Point.prototype.ceil=function(){return new Point(Math.ceil(this.x),Math.ceil(this.y))},Point.prototype.add=function(t){return t instanceof Point?new Point(this.x+t.x,this.y+t.y):new Point(this.x+t,this.y+t)},Point.prototype.subtract=function(t){return t instanceof Point?new Point(this.x-t.x,this.y-t.y):new Point(this.x-t,this.y-t)},Point.prototype.multiplyBy=function(t){return t instanceof Point?new Point(this.x*t.x,this.y*t.y):new Point(this.x*t,this.y*t)},Point.prototype.divideBy=function(t){return t instanceof Point?new Point(this.x/t.x,this.y/t.y):new Point(this.x/t,this.y/t)},Point.prototype.floorDivideBy=function(t){return t instanceof Point?new Point(Math.floor(this.x/t.x),Math.floor(this.y/t.y)):new Point(Math.floor(this.x/t),Math.floor(this.y/t))},Point.prototype.r=function(){var t=this.multiplyBy(this);return Math.sqrt(t.x+t.y)},Point.prototype.degrees=function(){var t,e;return 0===this.x?this.y>=0?90:270:(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?degrees(e):360+degrees(e):180+degrees(e))},Point.prototype.theta=function(){var t,e;return 0===this.x?radians(this.y>=0?90:270):(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?e:radians(360)+e:radians(180)+e)},Point.prototype.crossProduct=function(t){return this.multiplyBy(t.mirror())},Point.prototype.distanceTo=function(t){return t.subtract(this).r()},Point.prototype.rotate=function(t,e){var o=this.subtract(e);return"right"===t?new Point(-o.y,o.y).add(e):"left"===t?new Point(o.y,-o.y).add(e):e.subtract(o)},Point.prototype.flip=function(t,e){return"vertical"===t?new Point(this.x,2*e.y-this.y):new Point(2*e.x-this.x,this.y)},Point.prototype.distanceAngle=function(t,e){var o,i,r=e;return r>270?r-=360:-270>r&&(r+=360),r>=-90&&90>=r?(o=Math.sin(radians(r))*t,i=Math.sqrt(t*t-o*o),new Point(o+this.x,this.y-i)):(o=Math.sin(radians(180-r))*t,i=Math.sqrt(t*t-o*o),new Point(o+this.x,this.y+i))},Point.prototype.scaleBy=function(t){return this.multiplyBy(t)},Point.prototype.translateBy=function(t){return this.add(t)},Point.prototype.rotateBy=function(t,e){var o=e||new Point(0,0),i=this.subtract(o),r=i.r(),n=t-i.theta();return new Point(o.x+r*Math.cos(n),o.y-r*Math.sin(n))},Point.prototype.asArray=function(){return[this.x,this.y]},Rectangle.prototype.init=function(t,e){this.origin=t,this.corner=e},Rectangle.prototype.toString=function(){return"["+this.origin.toString()+" | "+this.extent().toString()+"]"},Rectangle.prototype.copy=function(){return new Rectangle(this.left(),this.top(),this.right(),this.bottom())},Point.prototype.corner=function(t){return new Rectangle(this.x,this.y,t.x,t.y)},Point.prototype.rectangle=function(t){var e,o;return e=this.min(t),o=this.max(t),new Rectangle(e.x,e.y,o.x,o.y)},Point.prototype.extent=function(t){var e=this.add(t);return new Rectangle(this.x,this.y,e.x,e.y)},Rectangle.prototype.setTo=function(t,e,o,i){this.origin=new Point(t||(0===t?0:this.left()),e||(0===e?0:this.top())),this.corner=new Point(o||(0===o?0:this.right()),i||(0===i?0:this.bottom()))},Rectangle.prototype.area=function(){var t=this.width();return 0>t?0:Math.max(t*this.height(),0)},Rectangle.prototype.bottom=function(){return this.corner.y},Rectangle.prototype.bottomCenter=function(){return new Point(this.center().x,this.bottom())},Rectangle.prototype.bottomLeft=function(){return new Point(this.origin.x,this.corner.y)},Rectangle.prototype.bottomRight=function(){return this.corner.copy()},Rectangle.prototype.boundingBox=function(){return this},Rectangle.prototype.center=function(){return this.origin.add(this.corner.subtract(this.origin).floorDivideBy(2))},Rectangle.prototype.corners=function(){return[this.origin,this.bottomLeft(),this.corner,this.topRight()]},Rectangle.prototype.extent=function(){return this.corner.subtract(this.origin)},Rectangle.prototype.height=function(){return this.corner.y-this.origin.y},Rectangle.prototype.left=function(){return this.origin.x},Rectangle.prototype.leftCenter=function(){return new Point(this.left(),this.center().y)},Rectangle.prototype.right=function(){return this.corner.x},Rectangle.prototype.rightCenter=function(){return new Point(this.right(),this.center().y)},Rectangle.prototype.top=function(){return this.origin.y},Rectangle.prototype.topCenter=function(){return new Point(this.center().x,this.top())},Rectangle.prototype.topLeft=function(){return this.origin},Rectangle.prototype.topRight=function(){return new Point(this.corner.x,this.origin.y)},Rectangle.prototype.width=function(){return this.corner.x-this.origin.x},Rectangle.prototype.position=function(){return this.origin},Rectangle.prototype.eq=function(t){return this.origin.eq(t.origin)&&this.corner.eq(t.corner)},Rectangle.prototype.abs=function(){var t,e;return t=this.origin.abs(),e=this.corner.max(t),t.corner(e)},Rectangle.prototype.insetBy=function(t){var e=new Rectangle;return e.origin=this.origin.add(t),e.corner=this.corner.subtract(t),e},Rectangle.prototype.expandBy=function(t){var e=new Rectangle;return e.origin=this.origin.subtract(t),e.corner=this.corner.add(t),e},Rectangle.prototype.growBy=function(t){var e=new Rectangle;return e.origin=this.origin.copy(),e.corner=this.corner.add(t),e},Rectangle.prototype.intersect=function(t){var e=new Rectangle;return e.origin=this.origin.max(t.origin),e.corner=this.corner.min(t.corner),e},Rectangle.prototype.merge=function(t){var e=new Rectangle;return e.origin=this.origin.min(t.origin),e.corner=this.corner.max(t.corner),e},Rectangle.prototype.mergeWith=function(t){this.origin=this.origin.min(t.origin),this.corner=this.corner.max(t.corner)},Rectangle.prototype.round=function(){return this.origin.round().corner(this.corner.round())},Rectangle.prototype.spread=function(){return this.origin.floor().corner(this.corner.ceil())},Rectangle.prototype.amountToTranslateWithin=function(t){var e=0,o=0;return this.right()>t.right()&&(e=t.right()-this.right()),this.bottom()>t.bottom()&&(o=t.bottom()-this.bottom()),this.left()+e<t.left()&&(e=t.left()-this.left()),this.top()+o<t.top()&&(o=t.top()-this.top()),new Point(e,o)},Rectangle.prototype.containsPoint=function(t){return this.origin.le(t)&&t.lt(this.corner)},Rectangle.prototype.containsRectangle=function(t){return t.origin.gt(this.origin)&&t.corner.lt(this.corner)},Rectangle.prototype.intersects=function(t){var e=t.origin,o=t.corner;return o.x>=this.origin.x&&o.y>=this.origin.y&&e.x<=this.corner.x&&e.y<=this.corner.y},Rectangle.prototype.isNearTo=function(t,e){var o=t.origin,i=t.corner,r=e||0;return i.x+r>=this.origin.x&&i.y+r>=this.origin.y&&o.x-r<=this.corner.x&&o.y-r<=this.corner.y},Rectangle.prototype.scaleBy=function(t){var e=this.origin.multiplyBy(t),o=this.corner.multiplyBy(t);return new Rectangle(e.x,e.y,o.x,o.y)},Rectangle.prototype.translateBy=function(t){var e=this.origin.add(t),o=this.corner.add(t);return new Rectangle(e.x,e.y,o.x,o.y)},Rectangle.prototype.asArray=function(){return[this.left(),this.top(),this.right(),this.bottom()]},Rectangle.prototype.asArray_xywh=function(){return[this.left(),this.top(),this.width(),this.height()]},Node.prototype.init=function(t,e){this.parent=t||null,this.children=e||[]},Node.prototype.toString=function(){return"a Node["+this.children.length.toString()+"]"},Node.prototype.addChild=function(t){this.children.push(t),t.parent=this},Node.prototype.addChildFirst=function(t){this.children.splice(0,null,t),t.parent=this},Node.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)},Node.prototype.root=function(){return null===this.parent?this:this.parent.root()},Node.prototype.depth=function(){return null===this.parent?0:this.parent.depth()+1},Node.prototype.allChildren=function(){var t=[this];return this.children.forEach(function(e){t=t.concat(e.allChildren())}),t},Node.prototype.forAllChildren=function(t){this.children.length>0&&this.children.forEach(function(e){e.forAllChildren(t)}),t.call(null,this)},Node.prototype.allLeafs=function(){var t=[];return this.allChildren().forEach(function(e){0===e.children.length&&t.push(e)}),t},Node.prototype.allParents=function(){var t=[this];return null!==this.parent&&(t=t.concat(this.parent.allParents())),t},Node.prototype.siblings=function(){var t=this;return null===this.parent?[]:this.parent.children.filter(function(e){return e!==t})},Node.prototype.parentThatIsA=function(t){return this instanceof t?this:this.parent?this.parent.parentThatIsA(t):null},Node.prototype.parentThatIsAnyOf=function(t){var e=!1,o=this;return t.forEach(function(t){return o.constructor===t?void(e=!0):void 0}),e?this:this.parent?this.parent.parentThatIsAnyOf(t):null};var Morph,WorldMorph,HandMorph,ShadowMorph,FrameMorph,MenuMorph,HandleMorph,StringFieldMorph,ColorPickerMorph,SliderMorph,ScrollFrameMorph,InspectorMorph,StringMorph,TextMorph;Morph.prototype=new Node,Morph.prototype.constructor=Morph,Morph.uber=Node.prototype,Morph.prototype.trackChanges=!0,Morph.prototype.shadowBlur=4,Morph.prototype.init=function(){Morph.uber.init.call(this),this.isMorph=!0,this.bounds=new Rectangle(0,0,50,40),this.color=new Color(80,80,80),this.texture=null,this.cachedTexture=null,this.alpha=1,this.isVisible=!0,this.isDraggable=!1,this.isTemplate=!1,this.acceptsDrops=!1,this.noticesTransparentClick=!1,this.drawNew(),this.fps=0,this.customContextMenu=null,this.lastTime=Date.now(),this.onNextStep=null},Morph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+" "+this.children.length.toString()+" "+this.bounds},Morph.prototype.destroy=function(){null!==this.parent&&(this.fullChanged(),this.parent.removeChild(this))},Morph.prototype.stepFrame=function(){if(!this.step)return null;var t,e,o,i;t=Date.now(),e=t-this.lastTime,o=this.fps>0?1e3/this.fps-e:0,1>o&&(this.lastTime=t,this.onNextStep&&(i=this.onNextStep,this.onNextStep=null,i.call(this)),this.step(),this.children.forEach(function(t){t.stepFrame()}))},Morph.prototype.nextSteps=function(t){var e=t||[],o=e.shift(),i=this;o&&(this.onNextStep=function(){o.call(i),i.nextSteps(e)})},Morph.prototype.step=function(){nop()},Morph.prototype.left=function(){return this.bounds.left()},Morph.prototype.right=function(){return this.bounds.right()},Morph.prototype.top=function(){return this.bounds.top()},Morph.prototype.bottom=function(){return this.bounds.bottom()},Morph.prototype.center=function(){return this.bounds.center()},Morph.prototype.bottomCenter=function(){return this.bounds.bottomCenter()},Morph.prototype.bottomLeft=function(){return this.bounds.bottomLeft()},Morph.prototype.bottomRight=function(){return this.bounds.bottomRight()},Morph.prototype.boundingBox=function(){return this.bounds},Morph.prototype.corners=function(){return this.bounds.corners()},Morph.prototype.leftCenter=function(){return this.bounds.leftCenter()},Morph.prototype.rightCenter=function(){return this.bounds.rightCenter()},Morph.prototype.topCenter=function(){return this.bounds.topCenter()},Morph.prototype.topLeft=function(){return this.bounds.topLeft()},Morph.prototype.topRight=function(){return this.bounds.topRight()},Morph.prototype.position=function(){return this.bounds.origin},Morph.prototype.extent=function(){return this.bounds.extent()},Morph.prototype.width=function(){return this.bounds.width()},Morph.prototype.height=function(){return this.bounds.height()},Morph.prototype.fullBounds=function(){var t;return t=this.bounds,this.children.forEach(function(e){e.isVisible&&(t=t.merge(e.fullBounds()))}),t},Morph.prototype.fullBoundsNoShadow=function(){var t;return t=this.bounds,this.children.forEach(function(e){e instanceof ShadowMorph||!e.isVisible||(t=t.merge(e.fullBounds()))}),t},Morph.prototype.visibleBounds=function(){var t=this.bounds,e=this.allParents().filter(function(t){return t instanceof FrameMorph});return e.forEach(function(e){t=t.intersect(e.bounds)}),t},Morph.prototype.moveBy=function(t){this.changed(),this.bounds=this.bounds.translateBy(t),this.children.forEach(function(e){e.moveBy(t)}),this.changed()},Morph.prototype.silentMoveBy=function(t){this.bounds=this.bounds.translateBy(t),this.children.forEach(function(e){e.silentMoveBy(t)})},Morph.prototype.setPosition=function(t){var e=t.subtract(this.topLeft());(0!==e.x||0!==e.y)&&this.moveBy(e)},Morph.prototype.silentSetPosition=function(t){var e=t.subtract(this.topLeft());(0!==e.x||0!==e.y)&&this.silentMoveBy(e)},Morph.prototype.setLeft=function(t){this.setPosition(new Point(t,this.top()))},Morph.prototype.setRight=function(t){this.setPosition(new Point(t-this.width(),this.top()))},Morph.prototype.setTop=function(t){this.setPosition(new Point(this.left(),t))},Morph.prototype.setBottom=function(t){this.setPosition(new Point(this.left(),t-this.height()))},Morph.prototype.setCenter=function(t){this.setPosition(t.subtract(this.extent().floorDivideBy(2)))},Morph.prototype.setFullCenter=function(t){this.setPosition(t.subtract(this.fullBounds().extent().floorDivideBy(2)))},Morph.prototype.keepWithin=function(t){var e,o,i,r;e=this.fullBounds().left()-t.left(),0>e&&this.moveBy(new Point(-e,0)),o=this.fullBounds().right()-t.right(),o>0&&this.moveBy(new Point(-o,0)),i=this.fullBounds().top()-t.top(),0>i&&this.moveBy(new Point(0,-i)),r=this.fullBounds().bottom()-t.bottom(),r>0&&this.moveBy(new Point(0,-r))},Morph.prototype.setExtent=function(t){t.eq(this.extent())||(this.changed(),this.silentSetExtent(t),this.changed(),this.drawNew())},Morph.prototype.silentSetExtent=function(t){var e,o,i;e=t.round(),o=Math.max(e.x,0),i=Math.max(e.y,0),this.bounds.corner=new Point(this.bounds.origin.x+o,this.bounds.origin.y+i)},Morph.prototype.setWidth=function(t){this.setExtent(new Point(t||0,this.height()))},Morph.prototype.silentSetWidth=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.origin.x+e,this.bounds.corner.y)},Morph.prototype.setHeight=function(t){this.setExtent(new Point(this.width(),t||0))},Morph.prototype.silentSetHeight=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.corner.x,this.bounds.origin.y+e)},Morph.prototype.setColor=function(t){t&&(this.color.eq(t)||(this.color=t,this.changed(),this.drawNew()))},Morph.prototype.drawNew=function(){this.image=newCanvas(this.extent());var t=this.image.getContext("2d");t.fillStyle=this.color.toString(),t.fillRect(0,0,this.width(),this.height()),this.cachedTexture?this.drawCachedTexture():this.texture&&this.drawTexture(this.texture)},Morph.prototype.drawTexture=function(t){var e=this;this.cachedTexture=new Image,this.cachedTexture.onload=function(){e.drawCachedTexture()},this.cachedTexture.src=this.texture=t},Morph.prototype.drawCachedTexture=function(){var t,e,o=this.cachedTexture,i=Math.floor(this.image.width/o.width),r=Math.floor(this.image.height/o.height),n=this.image.getContext("2d");for(e=0;r>=e;e+=1)for(t=0;i>=t;t+=1)n.drawImage(o,t*o.width,e*o.height);this.changed()},Morph.prototype.drawOn=function(t,e){var o,i,r,n,s,a,h,l,p;if(!this.isVisible)return null;if(o=e||this.bounds(),i=o.intersect(this.bounds).round(),i.extent().gt(new Point(0,0))){if(r=this.position().neg(),n=i.copy().translateBy(r).round(),s=t.getContext("2d"),s.globalAlpha=this.alpha,l=n.left(),p=n.top(),a=Math.min(n.width(),this.image.width-l),h=Math.min(n.height(),this.image.height-p),1>a||1>h)return null;s.drawImage(this.image,n.left(),n.top(),a,h,i.left(),i.top(),a,h)}},Morph.prototype.fullDrawOn=function(t,e){var o;return this.isVisible?(o=e||this.fullBounds(),this.drawOn(t,o),void this.children.forEach(function(e){e.fullDrawOn(t,o)})):null},Morph.prototype.hide=function(){this.isVisible=!1,this.changed(),this.children.forEach(function(t){t.hide()})},Morph.prototype.show=function(){this.isVisible=!0,this.changed(),this.children.forEach(function(t){t.show()})},Morph.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible,this.changed(),this.children.forEach(function(t){t.toggleVisibility()})},Morph.prototype.fullImageClassic=function(){var t=this.fullBounds(),e=newCanvas(t.extent()),o=e.getContext("2d");return o.translate(-this.bounds.origin.x,-this.bounds.origin.y),this.fullDrawOn(e,t),e.globalAlpha=this.alpha,e},Morph.prototype.fullImage=function(){var t,e,o;return t=newCanvas(this.fullBounds().extent()),e=t.getContext("2d"),o=this.fullBounds(),this.allChildren().forEach(function(t){t.isVisible&&(e.globalAlpha=t.alpha,t.image.width&&t.image.height&&e.drawImage(t.image,t.bounds.origin.x-o.origin.x,t.bounds.origin.y-o.origin.y))}),t},Morph.prototype.shadowImage=function(t,e){var o,i,r,n,s,a=t||new Point(7,7),h=e||new Color(0,0,0);return o=this.fullBounds().extent(),i=this.fullImage(),r=newCanvas(o),s=r.getContext("2d"),s.drawImage(i,0,0),s.globalCompositeOperation="destination-out",s.drawImage(i,-a.x,-a.y),n=newCanvas(o),s=n.getContext("2d"),s.drawImage(r,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=h.toString(),s.fillRect(0,0,o.x,o.y),n},Morph.prototype.shadowImageBlurred=function(t,e){var o,i,r,n,s=t||new Point(7,7),a=this.shadowBlur,h=e||new Color(0,0,0);return o=this.fullBounds().extent().add(2*a),i=this.fullImage(),r=newCanvas(o),n=r.getContext("2d"),n.shadowOffsetX=s.x,n.shadowOffsetY=s.y,n.shadowBlur=a,n.shadowColor=h.toString(),n.drawImage(i,a-s.x,a-s.y),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.globalCompositeOperation="destination-out",n.drawImage(i,a-s.x,a-s.y),r},Morph.prototype.shadow=function(t,e,o){var i=new ShadowMorph,r=t||new Point(7,7),n=e||(0===e?0:.2),s=this.fullBounds();return i.setExtent(s.extent().add(2*this.shadowBlur)),useBlurredShadows&&!MorphicPreferences.isFlat?(i.image=this.shadowImageBlurred(r,o),i.alpha=n,i.setPosition(s.origin.add(r).subtract(this.shadowBlur))):(i.image=this.shadowImage(r,o),i.alpha=n,i.setPosition(s.origin.add(r))),i},Morph.prototype.addShadow=function(t,e,o){var i,r=t||new Point(7,7),n=e||(0===e?0:.2);return i=this.shadow(r,n,o),this.addBack(i),this.fullChanged(),i},Morph.prototype.getShadow=function(){var t;return t=this.children.slice(0).reverse().filter(function(t){return t instanceof ShadowMorph}),0!==t.length?t[0]:null},Morph.prototype.removeShadow=function(){var t=this.getShadow();null!==t&&(this.fullChanged(),this.removeChild(t))},Morph.prototype.penTrails=function(){return this.image},Morph.prototype.changed=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread())}this.parent&&this.parent.childChanged(this)},Morph.prototype.fullChanged=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.fullBounds().spread())}},Morph.prototype.childChanged=function(){this.parent&&this.parent.childChanged(this)
},Morph.prototype.world=function(){var t=this.root();return t instanceof WorldMorph?t:t instanceof HandMorph?t.world:null},Morph.prototype.add=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChild(t)},Morph.prototype.addBack=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChildFirst(t)},Morph.prototype.topMorphSuchThat=function(t){var e;return t.call(null,this)?(e=detect(this.children.slice(0).reverse(),t),e?e.topMorphSuchThat(t):this):null},Morph.prototype.morphAt=function(t){var e=this.allChildren().slice(0).reverse(),o=null;return e.forEach(function(e){e.fullBounds().containsPoint(t)&&null===o&&(o=e)}),o},Morph.prototype.overlappedMorphs=function(){var t,e=this.world(),o=this.fullBounds(),i=this,r=this.allParents(),n=this.allChildren();return t=e.allChildren(),t.filter(function(t){return t.isVisible&&t!==i&&t!==e&&!contains(r,t)&&!contains(n,t)&&t.fullBounds().intersects(o)})},Morph.prototype.getPixelColor=function(t){var e,o,i;return e=t.subtract(this.bounds.origin),o=this.image.getContext("2d"),i=o.getImageData(e.x,e.y,1,1),new Color(i.data[0],i.data[1],i.data[2],i.data[3])},Morph.prototype.isTransparentAt=function(t){var e,o,i;return this.bounds.containsPoint(t)?this.texture?!1:(e=t.subtract(this.bounds.origin),o=this.image.getContext("2d"),i=o.getImageData(Math.floor(e.x),Math.floor(e.y),1,1),0===i.data[3]):!1},Morph.prototype.copy=function(){var t=copy(this);return t.parent=null,t.children=[],t.bounds=this.bounds.copy(),t},Morph.prototype.fullCopy=function(){var t,e={};return t=this.copyRecordingReferences(e),t.forAllChildren(function(t){t.updateReferences(e)}),t},Morph.prototype.copyRecordingReferences=function(t){var e=this.copy();return t[this]=e,this.children.forEach(function(o){e.add(o.copyRecordingReferences(t))}),e},Morph.prototype.updateReferences=function(t){var e;for(e in this)this[e]&&this[e].isMorph&&t[e]&&(this[e]=t[e])},Morph.prototype.rootForGrab=function(){return this instanceof ShadowMorph?this.parent.rootForGrab():this.parent instanceof ScrollFrameMorph?this.parent:null===this.parent||this.parent instanceof WorldMorph||this.parent instanceof FrameMorph||this.isDraggable===!0?this:this.parent.rootForGrab()},Morph.prototype.wantsDropOf=function(t){return t instanceof HandleMorph||t instanceof MenuMorph||t instanceof InspectorMorph?!1:this.acceptsDrops},Morph.prototype.pickUp=function(t){var e=t||this.world();this.setPosition(e.hand.position().subtract(this.extent().floorDivideBy(2))),e.hand.grab(this)},Morph.prototype.isPickedUp=function(){return null!==this.parentThatIsA(HandMorph)},Morph.prototype.situation=function(){return this.parent?{origin:this.parent,position:this.position().subtract(this.parent.position())}:null},Morph.prototype.slideBackTo=function(t,e){var o=e||5,i=t.origin.position().add(t.position),r=-(this.left()-i.x)/o,n=-(this.top()-i.y)/o,s=0,a=this.step,h=this.fps,l=this;this.fps=0,this.step=function(){l.fullChanged(),l.silentMoveBy(new Point(r,n)),l.fullChanged(),s+=1,s===o&&(t.origin.add(l),t.origin.reactToDropOf&&t.origin.reactToDropOf(l),l.step=a,l.fps=h)}},Morph.prototype.nop=function(){nop()},Morph.prototype.resize=function(){this.world().activeHandle=new HandleMorph(this)},Morph.prototype.move=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,"move")},Morph.prototype.hint=function(t){var e,o;o=t,t?t.toString&&(o=t.toString()):o="NULL",e=new MenuMorph(this,o),e.isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.inform=function(t){var e,o;o=t,t?t.toString&&(o=t.toString()):o="NULL",e=new MenuMorph(this,o),e.addItem("Ok"),e.isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.prompt=function(t,e,o,i,r,n,s,a){var h,l,p,c;s&&(c=!0),h=new MenuMorph(e||null,t||"",o||null),l=new StringFieldMorph(i||"",r||100,MorphicPreferences.prompterFontSize,MorphicPreferences.prompterFontName,!1,!1,c),h.items.push(l),(s||MorphicPreferences.useSliderForInput)&&(p=new SliderMorph(n||0,s,parseFloat(i),Math.floor((s-n)/4),"horizontal"),p.alpha=1,p.color=new Color(225,225,225),p.button.color=h.borderColor,p.button.highlightColor=p.button.color.copy(),p.button.highlightColor.b+=100,p.button.pressColor=p.button.color.copy(),p.button.pressColor.b+=150,p.setHeight(MorphicPreferences.prompterSliderSize),p.action=a?function(t){l.changed(),l.text.text=Math.round(t).toString(),l.text.drawNew(),l.text.changed(),l.text.edit()}:function(t){l.changed(),l.text.text=t.toString(),l.text.drawNew(),l.text.changed()},h.items.push(p)),h.addLine(2),h.addItem("Ok",function(){return l.string()}),h.addItem("Cancel",function(){return null}),h.isDraggable=!0,h.popUpAtHand(this.world()),l.text.edit()},Morph.prototype.pickColor=function(t,e,o,i){var r,n;r=new MenuMorph(e||null,t||"",o||null),n=new ColorPickerMorph(i),r.items.push(n),r.addLine(2),r.addItem("Ok",function(){return n.getChoice()}),r.addItem("Cancel",function(){return null}),r.isDraggable=!0,r.popUpAtHand(this.world())},Morph.prototype.inspect=function(t){var e,o=this.world instanceof Function?this.world():this.root()||this.world,i=this;t&&(i=t),e=new InspectorMorph(i),e.setPosition(o.hand.position()),e.keepWithin(o),o.add(e),e.changed()},Morph.prototype.contextMenu=function(){var t;return this.customContextMenu?this.customContextMenu:(t=this.world instanceof Function?this.world():this.world,t&&t.isDevMode?this.parent===t?this.developersMenu():this.hierarchyMenu():this.userMenu()||this.parent&&this.parent.userMenu())},Morph.prototype.hierarchyMenu=function(){var t=this.allParents(),e=this.world instanceof Function?this.world():this.world,o=new MenuMorph(this,null);return t.forEach(function(t){t.developersMenu&&t!==e&&o.addItem(t.toString().slice(0,50),function(){t.developersMenu().popUpAtHand(e)})}),o},Morph.prototype.developersMenu=function(){var t=this.world instanceof Function?this.world():this.world,e=this.userMenu()||this.parent&&this.parent.userMenu(),o=new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]);return e&&(o.addItem("user features...",function(){e.popUpAtHand(t)}),o.addLine()),o.addItem("color...",function(){this.pickColor(o.title+"\ncolor:",this.setColor,this,this.color)},"choose another color \nfor this morph"),o.addItem("transparency...",function(){this.prompt(o.title+"\nalpha\nvalue:",this.setAlphaScaled,this,(100*this.alpha).toString(),null,1,100,!0)},"set this morph's\nalpha value"),o.addItem("resize...","resize","show a handle\nwhich can be dragged\nto change this morph's extent"),o.addLine(),o.addItem("duplicate",function(){this.fullCopy().pickUp(this.world())},"make a copy\nand pick it up"),o.addItem("pick up","pickUp","disattach and put \ninto the hand"),o.addItem("attach...","attach","stick this morph\nto another one"),o.addItem("move...","move","show a handle\nwhich can be dragged\nto move this morph"),o.addItem("inspect...","inspect","open a window\non all properties"),o.addItem("pic...",function(){window.open(this.fullImageClassic().toDataURL())},"open a new window\nwith a picture of this morph"),o.addLine(),this.isDraggable?o.addItem("lock","toggleIsDraggable","make this morph\nunmovable"):o.addItem("unlock","toggleIsDraggable","make this morph\nmovable"),o.addItem("hide","hide"),o.addItem("delete","destroy"),this instanceof WorldMorph||(o.addLine(),o.addItem("World...",function(){t.contextMenu().popUpAtHand(t)},"show the\nWorld's menu")),o},Morph.prototype.userMenu=function(){return null},Morph.prototype.setAlphaScaled=function(t){var e,o;"number"==typeof t?(o=t/100,this.alpha=Math.min(Math.max(o,.1),1)):(e=parseFloat(t),isNaN(e)||(o=e/100,this.alpha=Math.min(Math.max(o,.1),1))),this.changed()},Morph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose new parent:"),o=this;t.forEach(function(t){e.addItem(t.toString().slice(0,50),function(){t.add(o),o.isDraggable=!1})}),t.length>0&&e.popUpAtHand(this.world())},Morph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable},Morph.prototype.colorSetters=function(){return["color"]},Morph.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled"]},Morph.prototype.allEntryFields=function(){return this.allChildren().filter(function(t){return t.isEditable&&(t instanceof StringMorph||t instanceof TextMorph)})},Morph.prototype.nextEntryField=function(t){var e=this.allEntryFields(),o=e.indexOf(t);return-1!==o&&e.length>o+1?e[o+1]:e[0]},Morph.prototype.previousEntryField=function(t){var e=this.allEntryFields(),o=e.indexOf(t);return-1!==o?o>0?e[o-1]:e[e.length-1]:e[0]},Morph.prototype.tab=function(t){this.nextTab?this.nextTab(t):this.parent&&this.parent.tab(t)},Morph.prototype.backTab=function(t){this.previousTab?this.previousTab(t):this.parent&&this.parent.backTab(t)},Morph.prototype.escalateEvent=function(t,e){for(var o=this.parent;!o[t]&&null!==o.parent;)o=o.parent;o[t]&&o[t](e)},Morph.prototype.evaluateString=function(code){var result;try{result=eval(code),this.drawNew(),this.changed()}catch(err){this.inform(err)}return result},Morph.prototype.isTouching=function(t){var e=this.overlappingImage(t),o=e.getContext("2d").getImageData(1,1,e.width,e.height).data;return null!==detect(o,function(t){return 0!==t})},Morph.prototype.overlappingImage=function(t){var e=this.fullBounds(),o=t.fullBounds(),i=e.intersect(o),r=newCanvas(i.extent()),n=r.getContext("2d");return i.width()<1||i.height()<1?newCanvas(new Point(1,1)):(n.drawImage(this.fullImage(),i.origin.x-e.origin.x,i.origin.y-e.origin.y),n.globalCompositeOperation="source-in",n.drawImage(t.fullImage(),o.origin.x-i.origin.x,o.origin.y-i.origin.y),r)},ShadowMorph.prototype=new Morph,ShadowMorph.prototype.constructor=ShadowMorph,ShadowMorph.uber=Morph.prototype,HandleMorph.prototype=new Morph,HandleMorph.prototype.constructor=HandleMorph,HandleMorph.uber=Morph.prototype,HandleMorph.prototype.init=function(t,e,o,i,r,n){var s=MorphicPreferences.handleSize;this.target=t||null,this.minExtent=new Point(e||0,o||0),this.inset=new Point(i||0,r||i||0),this.type=n||"resize",HandleMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isDraggable=!1,this.noticesTransparentClick=!0,this.setExtent(new Point(s,s))},HandleMorph.prototype.drawNew=function(){this.normalImage=newCanvas(this.extent()),this.highlightImage=newCanvas(this.extent()),this.drawOnCanvas(this.normalImage,this.color,new Color(100,100,100)),this.drawOnCanvas(this.highlightImage,new Color(100,100,255),new Color(255,255,255)),this.image=this.normalImage,this.target&&(this.setPosition(this.target.bottomRight().subtract(this.extent().add(this.inset))),this.target.add(this),this.target.changed())},HandleMorph.prototype.drawOnCanvas=function(t,e,o){var i,r,n,s,a,h=t.getContext("2d");if(h.lineWidth=1,h.lineCap="round",h.strokeStyle=e.toString(),"move"===this.type)for(i=this.bottomLeft().subtract(this.position()),r=i.copy(),n=this.topRight().subtract(this.position()),s=n.copy(),a=0;a<=this.height();a+=6)r.y=i.y-a,s.y=n.y-a,h.beginPath(),h.moveTo(r.x,r.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke();for(i=this.bottomLeft().subtract(this.position()),r=i.copy(),n=this.topRight().subtract(this.position()),s=n.copy(),a=0;a<=this.width();a+=6)r.x=i.x+a,s.x=n.x+a,h.beginPath(),h.moveTo(r.x,r.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke();if(h.strokeStyle=o.toString(),"move"===this.type)for(i=this.bottomLeft().subtract(this.position()),r=i.copy(),n=this.topRight().subtract(this.position()),s=n.copy(),a=-2;a<=this.height();a+=6)r.y=i.y-a,s.y=n.y-a,h.beginPath(),h.moveTo(r.x,r.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke();for(i=this.bottomLeft().subtract(this.position()),r=i.copy(),n=this.topRight().subtract(this.position()),s=n.copy(),a=2;a<=this.width();a+=6)r.x=i.x+a,s.x=n.x+a,h.beginPath(),h.moveTo(r.x,r.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke()},HandleMorph.prototype.step=null,HandleMorph.prototype.mouseDownLeft=function(t){var e=this.root(),o=t.subtract(this.bounds.origin),i=this;return this.target?(this.step=function(){var t,r;e.hand.mouseButton?(t=e.hand.bounds.origin.copy().subtract(o),"resize"===this.type?(r=t.add(i.extent().add(i.inset)).subtract(i.target.bounds.origin),r=r.max(i.minExtent),i.target.setExtent(r),i.setPosition(i.target.bottomRight().subtract(i.extent().add(i.inset)))):i.target.setPosition(t.subtract(this.target.extent()).add(this.extent()))):this.step=null},void(this.target.step||(this.target.step=function(){nop()}))):null},HandleMorph.prototype.rootForGrab=function(){return this},HandleMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},HandleMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},HandleMorph.prototype.copyRecordingReferences=function(t){var e=HandleMorph.uber.copyRecordingReferences.call(this,t);return e.target&&t[this.target]&&(e.target=t[this.target]),e},HandleMorph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),o=this;t.forEach(function(t){e.addItem(t.toString().slice(0,50),function(){o.isDraggable=!1,o.target=t,o.drawNew(),o.noticesTransparentClick=!0})}),t.length>0&&e.popUpAtHand(this.world())};var PenMorph;PenMorph.prototype=new Morph,PenMorph.prototype.constructor=PenMorph,PenMorph.uber=Morph.prototype,PenMorph.prototype.init=function(){var t=4*MorphicPreferences.handleSize;this.isWarped=!1,this.heading=0,this.isDown=!0,this.size=1,this.wantsRedraw=!1,this.penPoint="tip",HandleMorph.uber.init.call(this),this.setExtent(new Point(t,t))},PenMorph.prototype.changed=function(){if(this.isWarped===!1){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread()),this.parent&&this.parent.childChanged(this)}},PenMorph.prototype.drawNew=function(t){var e,o,i,r,n,s,a=t||this.heading;return this.isWarped?void(this.wantsRedraw=!0):(this.image=newCanvas(this.extent()),e=this.image.getContext("2d"),s=this.width()/2,o=this.center().subtract(this.bounds.origin),"tip"===this.penPoint?(i=o.distanceAngle(.75*s,a-180),r=o.distanceAngle(s,a+195),n=o.distanceAngle(s,a-195)):(i=o.distanceAngle(.75*s,a),r=o.distanceAngle(.33*s,a+230),n=o.distanceAngle(.33*s,a-230)),e.fillStyle=this.color.toString(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(r.x,r.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.strokeStyle="white",e.lineWidth=3,e.stroke(),e.strokeStyle="black",e.lineWidth=1,e.stroke(),void e.fill())},PenMorph.prototype.setHeading=function(t){this.heading=parseFloat(t)%360,this.drawNew(),this.changed()},PenMorph.prototype.drawLine=function(t,e){var o=this.parent.penTrails().getContext("2d"),i=t.subtract(this.parent.bounds.origin),r=e.subtract(this.parent.bounds.origin);this.isDown&&(o.lineWidth=this.size,o.strokeStyle=this.color.toString(),o.lineCap="round",o.lineJoin="round",o.beginPath(),o.moveTo(i.x,i.y),o.lineTo(r.x,r.y),o.stroke(),this.isWarped===!1&&this.world().broken.push(t.rectangle(e).expandBy(Math.max(this.size/2,1)).intersect(this.parent.visibleBounds()).spread()))},PenMorph.prototype.turn=function(t){this.setHeading(this.heading+parseFloat(t))},PenMorph.prototype.forward=function(t){var e,o=this.center(),i=parseFloat(t);e=i>=0?this.position().distanceAngle(i,this.heading):this.position().distanceAngle(Math.abs(i),this.heading-180),this.setPosition(e),this.drawLine(o,this.center())},PenMorph.prototype.down=function(){this.isDown=!0},PenMorph.prototype.up=function(){this.isDown=!1},PenMorph.prototype.clear=function(){this.parent.drawNew(),this.parent.changed()},PenMorph.prototype.startWarp=function(){this.wantsRedraw=!1,this.isWarped=!0},PenMorph.prototype.endWarp=function(){this.isWarped=!1,this.wantsRedraw&&(this.drawNew(),this.wantsRedraw=!1),this.parent.changed()},PenMorph.prototype.warp=function(t){this.startWarp(),t.call(this),this.endWarp()},PenMorph.prototype.warpOp=function(t,e){this.startWarp(),this[t].apply(this,e),this.endWarp()},PenMorph.prototype.warpSierpinski=function(t,e){this.warpOp("sierpinski",[t,e])},PenMorph.prototype.sierpinski=function(t,e){var o;if(t>e)for(o=0;3>o;o+=1)this.sierpinski(.5*t,e),this.turn(120),this.forward(t)},PenMorph.prototype.warpTree=function(t,e,o){this.warpOp("tree",[t,e,o])},PenMorph.prototype.tree=function(t,e,o){t>0&&(this.size=t,this.forward(e),this.turn(o),this.tree(t-1,.75*e,o),this.turn(-2*o),this.tree(t-1,.75*e,o),this.turn(o),this.forward(-e))};var ColorPaletteMorph;ColorPaletteMorph.prototype=new Morph,ColorPaletteMorph.prototype.constructor=ColorPaletteMorph,ColorPaletteMorph.uber=Morph.prototype,ColorPaletteMorph.prototype.init=function(t,e){ColorPaletteMorph.uber.init.call(this),this.target=t,this.targetSetter="color",this.silentSetExtent(e),this.choice=null,this.drawNew()},ColorPaletteMorph.prototype.drawNew=function(){var t,e,o,i,r,n;for(e=this.extent(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.choice=new Color,o=0;o<=e.x;o+=1)for(r=360*o/e.x,i=0;i<=e.y;i+=1)n=100-i/e.y*100,t.fillStyle="hsl("+r+",100%,"+n+"%)",t.fillRect(o,i,1,1)},ColorPaletteMorph.prototype.mouseMove=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.mouseDownLeft=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.updateTarget=function(){this.target instanceof Morph&&null!==this.choice&&(this.target[this.targetSetter]instanceof Function?this.target[this.targetSetter](this.choice):(this.target[this.targetSetter]=this.choice,this.target.drawNew(),this.target.changed()))},ColorPaletteMorph.prototype.copyRecordingReferences=function(t){var e=ColorPaletteMorph.uber.copyRecordingReferences.call(this,t);return e.target&&t[this.target]&&(e.target=t[this.target]),e},ColorPaletteMorph.prototype.developersMenu=function(){var t=ColorPaletteMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set target","setTarget","choose another morph\nwhose color property\n will be controlled by this one"),t},ColorPaletteMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),o=this;t.push(this.world()),t.forEach(function(t){e.addItem(t.toString().slice(0,50),function(){o.target=t,o.setTargetSetter()})}),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},ColorPaletteMorph.prototype.setTargetSetter=function(){var t=this.target.colorSetters(),e=new MenuMorph(this,"choose target property:"),o=this;t.forEach(function(t){e.addItem(t,function(){o.targetSetter=t})}),1===t.length?this.targetSetter=t[0]:t.length>0&&e.popUpAtHand(this.world())};var GrayPaletteMorph;GrayPaletteMorph.prototype=new ColorPaletteMorph,GrayPaletteMorph.prototype.constructor=GrayPaletteMorph,GrayPaletteMorph.uber=ColorPaletteMorph.prototype,GrayPaletteMorph.prototype.drawNew=function(){var t,e,o;e=this.extent(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.choice=new Color,o=t.createLinearGradient(0,0,e.x,e.y),o.addColorStop(0,"black"),o.addColorStop(1,"white"),t.fillStyle=o,t.fillRect(0,0,e.x,e.y)},ColorPickerMorph.prototype=new Morph,ColorPickerMorph.prototype.constructor=ColorPickerMorph,ColorPickerMorph.uber=Morph.prototype,ColorPickerMorph.prototype.init=function(t){this.choice=t,ColorPickerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.silentSetExtent(new Point(80,80)),this.drawNew()},ColorPickerMorph.prototype.drawNew=function(){ColorPickerMorph.uber.drawNew.call(this),this.buildSubmorphs()},ColorPickerMorph.prototype.buildSubmorphs=function(){var t,e,o,i;this.children.forEach(function(t){t.destroy()}),this.children=[],this.feedback=new Morph,this.feedback.color=this.choice,this.feedback.setExtent(new Point(20,20)),t=new ColorPaletteMorph(this.feedback,new Point(this.width(),50)),e=new GrayPaletteMorph(this.feedback,new Point(this.width(),5)),t.setPosition(this.bounds.origin),this.add(t),e.setPosition(t.bottomLeft()),this.add(e),o=e.left()+Math.floor((e.width()-this.feedback.width())/2),i=e.bottom()+Math.floor((this.bottom()-e.bottom()-this.feedback.height())/2),this.feedback.setPosition(new Point(o,i)),this.add(this.feedback)},ColorPickerMorph.prototype.getChoice=function(){return this.feedback.color},ColorPickerMorph.prototype.rootForGrab=function(){return this};var BlinkerMorph;BlinkerMorph.prototype=new Morph,BlinkerMorph.prototype.constructor=BlinkerMorph,BlinkerMorph.uber=Morph.prototype,BlinkerMorph.prototype.init=function(t){BlinkerMorph.uber.init.call(this),this.color=new Color(0,0,0),this.fps=t||2,this.drawNew()},BlinkerMorph.prototype.step=function(){this.toggleVisibility()};var CursorMorph;CursorMorph.prototype=new BlinkerMorph,CursorMorph.prototype.constructor=CursorMorph,CursorMorph.uber=BlinkerMorph.prototype,CursorMorph.prototype.viewPadding=1,CursorMorph.prototype.init=function(t){var e;this.keyDownEventUsed=!1,this.target=t,this.originalContents=this.target.text,this.originalAlignment=this.target.alignment,this.slot=this.target.text.length,CursorMorph.uber.init.call(this),e=fontHeight(this.target.fontSize),this.setExtent(new Point(Math.max(Math.floor(e/20),1),e)),this.drawNew(),this.image.getContext("2d").font=this.target.font(),this.target instanceof TextMorph&&"left"!==this.target.alignment&&this.target.setAlignmentToLeft(),this.gotoSlot(this.slot)},CursorMorph.prototype.processKeyPress=function(t){return this.keyDownEventUsed?(this.keyDownEventUsed=!1,null):40===t.keyCode||40===t.charCode?(this.insert("("),null):37===t.keyCode||37===t.charCode?(this.insert("%"),null):(t.keyCode?t.ctrlKey?this.ctrl(t.keyCode):t.metaKey?this.cmd(t.keyCode):this.insert(String.fromCharCode(t.keyCode),t.shiftKey):t.charCode&&(t.ctrlKey?this.ctrl(t.charCode):t.metaKey?this.cmd(t.keyCode):this.insert(String.fromCharCode(t.charCode),t.shiftKey)),void this.target.escalateEvent("reactToKeystroke",t))},CursorMorph.prototype.processKeyDown=function(t){var e=t.shiftKey;if(this.keyDownEventUsed=!1,t.ctrlKey)return this.ctrl(t.keyCode),void this.target.escalateEvent("reactToKeystroke",t);if(t.metaKey)return this.cmd(t.keyCode),void this.target.escalateEvent("reactToKeystroke",t);switch(t.keyCode){case 37:this.goLeft(e),this.keyDownEventUsed=!0;break;case 39:this.goRight(e),this.keyDownEventUsed=!0;break;case 38:this.goUp(e),this.keyDownEventUsed=!0;break;case 40:this.goDown(e),this.keyDownEventUsed=!0;break;case 36:this.goHome(e),this.keyDownEventUsed=!0;break;case 35:this.goEnd(e),this.keyDownEventUsed=!0;break;case 46:this.deleteRight(),this.keyDownEventUsed=!0;break;case 8:this.deleteLeft(),this.keyDownEventUsed=!0;break;case 13:this.target instanceof StringMorph?this.accept():this.insert("\n"),this.keyDownEventUsed=!0;break;case 27:this.cancel(),this.keyDownEventUsed=!0;break;default:nop()}this.target.escalateEvent("reactToKeystroke",t)},CursorMorph.prototype.gotoSlot=function(t){var e,o,i=this.target.text.length,r=this.target.slotPosition(t);this.slot=0>t?0:t>i?i:t,this.parent&&this.target.isScrollable&&(e=this.parent.right()-this.viewPadding,o=this.parent.left()+this.viewPadding,r.x>e&&(this.target.setLeft(this.target.left()+e-r.x),r.x=e),r.x<o&&(o=Math.min(this.parent.left(),o),this.target.setLeft(this.target.left()+o-r.x),r.x=o),this.target.right()<e&&e-this.target.width()<o&&(r.x+=e-this.target.right(),this.target.setRight(e))),this.show(),this.setPosition(r),this.parent&&this.parent.parent instanceof ScrollFrameMorph&&this.target.isScrollable&&this.parent.parent.scrollCursorIntoView(this)},CursorMorph.prototype.goLeft=function(t){this.updateSelection(t),this.gotoSlot(this.slot-1),this.updateSelection(t)},CursorMorph.prototype.goRight=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot+(e||1)),this.updateSelection(t)},CursorMorph.prototype.goUp=function(t){this.updateSelection(t),this.gotoSlot(this.target.upFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goDown=function(t){this.updateSelection(t),this.gotoSlot(this.target.downFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goHome=function(t){this.updateSelection(t),this.gotoSlot(this.target.startOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goEnd=function(t){this.updateSelection(t),this.gotoSlot(this.target.endOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.gotoPos=function(t){this.gotoSlot(this.target.slotAt(t)),this.show()},CursorMorph.prototype.updateSelection=function(t){t?this.target.endMark||this.target.startMark?this.target.endMark!==this.slot&&(this.target.endMark=this.slot,this.target.drawNew(),this.target.changed()):(this.target.startMark=this.slot,this.target.endMark=this.slot):this.target.clearSelection()},CursorMorph.prototype.accept=function(){var t=this.root();t&&t.stopEditing(),this.escalateEvent("accept",null)},CursorMorph.prototype.cancel=function(){var t=this.root();this.undo(),t&&t.stopEditing(),this.escalateEvent("cancel",null)},CursorMorph.prototype.undo=function(){this.target.text=this.originalContents,this.target.changed(),this.target.drawNew(),this.target.changed(),this.gotoSlot(0)},CursorMorph.prototype.insert=function(t,e){var o;return"	"===t?(this.target.escalateEvent("reactToEdit",this.target),e?this.target.backTab(this.target):this.target.tab(this.target)):void(this.target.isNumeric&&isNaN(parseFloat(t))&&!contains(["-","."],t)||(""!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()),o=this.target.text,o=o.slice(0,this.slot)+t+o.slice(this.slot),this.target.text=o,this.target.drawNew(),this.target.changed(),this.goRight(!1,t.length)))},CursorMorph.prototype.ctrl=function(t){97===t||65===t?this.target.selectAll():90===t?this.undo():123===t?this.insert("{"):125===t?this.insert("}"):91===t?this.insert("["):93===t?this.insert("]"):64===t&&this.insert("@")},CursorMorph.prototype.cmd=function(t){65===t?this.target.selectAll():90===t&&this.undo()},CursorMorph.prototype.deleteRight=function(){var t;""!==this.target.selection()?(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()):(t=this.target.text,this.target.changed(),t=t.slice(0,this.slot)+t.slice(this.slot+1),this.target.text=t,this.target.drawNew())},CursorMorph.prototype.deleteLeft=function(){var t;return this.target.selection()?(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()):(t=this.target.text,this.target.changed(),this.target.text=t.substring(0,this.slot-1)+t.substr(this.slot),this.target.drawNew(),void this.goLeft())},CursorMorph.prototype.destroy=function(){this.target.alignment!==this.originalAlignment&&(this.target.alignment=this.originalAlignment,this.target.drawNew(),this.target.changed()),CursorMorph.uber.destroy.call(this)},CursorMorph.prototype.inspectKeyEvent=function(t){this.inform("Key pressed: "+String.fromCharCode(t.charCode)+"\n------------------------\ncharCode: "+t.charCode.toString()+"\nkeyCode: "+t.keyCode.toString()+"\nshiftKey: "+t.shiftKey.toString()+"\naltKey: "+t.altKey.toString()+"\nctrlKey: "+t.ctrlKey.toString()+"\ncmdKey: "+t.metaKey.toString())};var BoxMorph;BoxMorph.prototype=new Morph,BoxMorph.prototype.constructor=BoxMorph,BoxMorph.uber=Morph.prototype,BoxMorph.prototype.init=function(t,e,o){this.edge=t||4,this.border=e||(0===e?0:2),this.borderColor=o||new Color,BoxMorph.uber.init.call(this)},BoxMorph.prototype.drawNew=function(){var t;return this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),0===this.edge&&0===this.border?(BoxMorph.uber.drawNew.call(this),null):(t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),void(this.border>0&&(t.lineWidth=this.border,t.strokeStyle=this.borderColor.toString(),t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke())))},BoxMorph.prototype.outlinePath=function(t,e,o){var i=e+o,r=this.width(),n=this.height();t.arc(i,i,e,radians(-180),radians(-90),!1),t.arc(r-i,i,e,radians(-90),radians(-0),!1),t.arc(r-i,n-i,e,radians(0),radians(90),!1),t.arc(i,n-i,e,radians(90),radians(180),!1)},BoxMorph.prototype.developersMenu=function(){var t=BoxMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("border width...",function(){this.prompt(t.title+"\nborder\nwidth:",this.setBorderWidth,this,this.border.toString(),null,0,100,!0)},"set the border's\nline size"),t.addItem("border color...",function(){this.pickColor(t.title+"\nborder color:",this.setBorderColor,this,this.borderColor)},"set the border's\nline color"),t.addItem("corner size...",function(){this.prompt(t.title+"\ncorner\nsize:",this.setCornerSize,this,this.edge.toString(),null,0,100,!0)},"set the corner's\nradius"),t},BoxMorph.prototype.setBorderWidth=function(t){var e;"number"==typeof t?this.border=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.border=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.setBorderColor=function(t){t&&(this.borderColor=t,this.drawNew(),this.changed())},BoxMorph.prototype.setCornerSize=function(t){var e;"number"==typeof t?this.edge=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.edge=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.colorSetters=function(){return["color","borderColor"]},BoxMorph.prototype.numericalSetters=function(){var t=BoxMorph.uber.numericalSetters.call(this);return t.push("setBorderWidth","setCornerSize"),t};var SpeechBubbleMorph;SpeechBubbleMorph.prototype=new BoxMorph,SpeechBubbleMorph.prototype.constructor=SpeechBubbleMorph,SpeechBubbleMorph.uber=BoxMorph.prototype,SpeechBubbleMorph.prototype.init=function(t,e,o,i,r,n,s){this.isPointingRight=!0,this.contents=t||"",this.padding=n||0,this.isThought=s||!1,this.isClickable=!1,SpeechBubbleMorph.uber.init.call(this,o||6,i||(0===i?0:1),r||new Color(140,140,140)),this.color=e||new Color(230,230,230),this.drawNew()},SpeechBubbleMorph.prototype.popUp=function(t,e,o){this.drawNew(),this.setPosition(e.subtract(new Point(0,this.height()))),this.addShadow(new Point(2,2),80),this.keepWithin(t),t.add(this),this.changed(),t.hand.destroyTemporaries(),t.hand.temporaries.push(this),o?this.isClickable=!0:this.mouseEnter=function(){this.destroy()}},SpeechBubbleMorph.prototype.drawNew=function(){this.contentsMorph&&this.contentsMorph.destroy(),this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?this.contentsMorph=new TextMorph(this.contents,MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):this.contentsMorph=new TextMorph(this.contents.toString(),MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"),this.add(this.contentsMorph),this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2),SpeechBubbleMorph.uber.drawNew.call(this),this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))},SpeechBubbleMorph.prototype.outlinePath=function(t,e,o){function i(e,o,i){t.moveTo(e+i,o),t.arc(e,o,i,radians(0),radians(360))}var r,n=e+o,s=this.width(),a=this.height();t.arc(n,n,e,radians(-180),radians(-90),!1),t.arc(s-n,n,e,radians(-90),radians(-0),!1),t.arc(s-n,a-n-e,e,radians(0),radians(90),!1),this.isThought||(this.isPointingRight?(t.lineTo(n+e,a-n),t.lineTo(e/2+o,a-o)):(t.lineTo(s-(e/2+o),a-o),t.lineTo(s-(n+e),a-n))),t.arc(n,a-n-e,e,radians(90),radians(180),!1),this.isThought&&(t.lineTo(o,n),this.isPointingRight?(r=e/4,i(r+o,a-r-o,r),r=e/3.2,i(2*r+o,a-r-2*o,r),r=e/2.8,i(3*r+2*o,a-r-4*o,r)):(r=e/4,i(s-(r+o),a-r-o,r),r=e/3.2,i(s-(2*r+o),a-r-2*o,r),r=e/2.8,i(s-(3*r+2*o),a-r-4*o,r)))},SpeechBubbleMorph.prototype.shadowImage=function(t,e){var o,i,r,n,s,a=t||new Point(7,7),h=e||new Color(0,0,0);return o=this.extent(),i=this.image,r=newCanvas(o),s=r.getContext("2d"),s.drawImage(i,0,0),s.globalCompositeOperation="destination-out",s.drawImage(i,-a.x,-a.y),n=newCanvas(o),s=n.getContext("2d"),s.drawImage(r,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=h.toString(),s.fillRect(0,0,o.x,o.y),n},SpeechBubbleMorph.prototype.shadowImageBlurred=function(t,e){var o,i,r,n,s=t||new Point(7,7),a=this.shadowBlur,h=e||new Color(0,0,0);return o=this.extent().add(2*a),i=this.image,r=newCanvas(o),n=r.getContext("2d"),n.shadowOffsetX=s.x,n.shadowOffsetY=s.y,n.shadowBlur=a,n.shadowColor=h.toString(),n.drawImage(i,a-s.x,a-s.y),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.globalCompositeOperation="destination-out",n.drawImage(i,a-s.x,a-s.y),r},SpeechBubbleMorph.prototype.fixLayout=function(){this.removeShadow(),this.drawNew(),this.addShadow(new Point(2,2),80)};var CircleBoxMorph;
CircleBoxMorph.prototype=new Morph,CircleBoxMorph.prototype.constructor=CircleBoxMorph,CircleBoxMorph.uber=Morph.prototype,CircleBoxMorph.prototype.init=function(t){CircleBoxMorph.uber.init.call(this),this.orientation=t,this.autoOrient=!0,this.setExtent(new Point(20,100))},CircleBoxMorph.prototype.autoOrientation=function(){this.orientation=this.height()>this.width()?"vertical":"horizontal"},CircleBoxMorph.prototype.drawNew=function(){var t,e,o,i,r,n,s,a,h,l=this;this.autoOrient&&this.autoOrientation(),this.image=newCanvas(this.extent()),a=this.image.getContext("2d"),"vertical"===this.orientation?(t=this.width()/2,n=this.center().x,e=new Point(n,this.top()+t),o=new Point(n,this.bottom()-t),i=this.bounds.origin.add(new Point(0,t)).corner(this.bounds.corner.subtract(new Point(0,t)))):(t=this.height()/2,s=this.center().y,e=new Point(this.left()+t,s),o=new Point(this.right()-t,s),i=this.bounds.origin.add(new Point(t,0)).corner(this.bounds.corner.subtract(new Point(t,0)))),r=[e.subtract(this.bounds.origin),o.subtract(this.bounds.origin)],r.forEach(function(e){a.fillStyle=l.color.toString(),a.beginPath(),a.arc(e.x,e.y,t,0,2*Math.PI,!1),a.closePath(),a.fill()}),i=i.translateBy(this.bounds.origin.neg()),h=i.extent(),h.x>0&&h.y>0&&a.fillRect(i.origin.x,i.origin.y,i.width(),i.height())},CircleBoxMorph.prototype.developersMenu=function(){var t=CircleBoxMorph.uber.developersMenu.call(this);return t.addLine(),"vertical"===this.orientation?t.addItem("horizontal...","toggleOrientation","toggle the\norientation"):t.addItem("vertical...","toggleOrientation","toggle the\norientation"),t},CircleBoxMorph.prototype.toggleOrientation=function(){var t=this.center();this.changed(),this.orientation="vertical"===this.orientation?"horizontal":"vertical",this.silentSetExtent(new Point(this.height(),this.width())),this.setCenter(t),this.drawNew(),this.changed()};var SliderButtonMorph;SliderButtonMorph.prototype=new CircleBoxMorph,SliderButtonMorph.prototype.constructor=SliderButtonMorph,SliderButtonMorph.uber=CircleBoxMorph.prototype,SliderButtonMorph.prototype.init=function(t){this.color=new Color(80,80,80),this.highlightColor=new Color(90,90,140),this.pressColor=new Color(80,80,160),this.is3D=!1,this.hasMiddleDip=!0,SliderButtonMorph.uber.init.call(this,t)},SliderButtonMorph.prototype.autoOrientation=function(){nop()},SliderButtonMorph.prototype.drawNew=function(){var t=this.color.copy();SliderButtonMorph.uber.drawNew.call(this),(this.is3D||!MorphicPreferences.isFlat)&&this.drawEdges(),this.normalImage=this.image,this.color=this.highlightColor.copy(),SliderButtonMorph.uber.drawNew.call(this),(this.is3D||!MorphicPreferences.isFlat)&&this.drawEdges(),this.highlightImage=this.image,this.color=this.pressColor.copy(),SliderButtonMorph.uber.drawNew.call(this),(this.is3D||!MorphicPreferences.isFlat)&&this.drawEdges(),this.pressImage=this.image,this.color=t,this.image=this.normalImage},SliderButtonMorph.prototype.drawEdges=function(){var t,e,o=this.image.getContext("2d"),i=this.width(),r=this.height();o.lineJoin="round",o.lineCap="round","vertical"===this.orientation?(o.lineWidth=i/3,t=o.createLinearGradient(0,0,o.lineWidth,0),t.addColorStop(0,"white"),t.addColorStop(1,this.color.toString()),o.strokeStyle=t,o.beginPath(),o.moveTo(.5*o.lineWidth,i/2),o.lineTo(.5*o.lineWidth,r-i/2),o.stroke(),t=o.createLinearGradient(i-o.lineWidth,0,i,0),t.addColorStop(0,this.color.toString()),t.addColorStop(1,"black"),o.strokeStyle=t,o.beginPath(),o.moveTo(i-.5*o.lineWidth,i/2),o.lineTo(i-.5*o.lineWidth,r-i/2),o.stroke(),this.hasMiddleDip&&(t=o.createLinearGradient(o.lineWidth,0,i-o.lineWidth,0),e=i/4,t.addColorStop(0,"black"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,"white"),o.fillStyle=t,o.beginPath(),o.arc(i/2,r/2,e,radians(0),radians(360),!1),o.closePath(),o.fill())):"horizontal"===this.orientation&&(o.lineWidth=r/3,t=o.createLinearGradient(0,0,0,o.lineWidth),t.addColorStop(0,"white"),t.addColorStop(1,this.color.toString()),o.strokeStyle=t,o.beginPath(),o.moveTo(r/2,.5*o.lineWidth),o.lineTo(i-r/2,.5*o.lineWidth),o.stroke(),t=o.createLinearGradient(0,r-o.lineWidth,0,r),t.addColorStop(0,this.color.toString()),t.addColorStop(1,"black"),o.strokeStyle=t,o.beginPath(),o.moveTo(r/2,r-.5*o.lineWidth),o.lineTo(i-r/2,r-.5*o.lineWidth),o.stroke(),this.hasMiddleDip&&(t=o.createLinearGradient(0,o.lineWidth,0,r-o.lineWidth),e=r/4,t.addColorStop(0,"black"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,"white"),o.fillStyle=t,o.beginPath(),o.arc(this.width()/2,this.height()/2,e,radians(0),radians(360),!1),o.closePath(),o.fill()))},SliderButtonMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},SliderButtonMorph.prototype.mouseDownLeft=function(t){this.image=this.pressImage,this.changed(),this.escalateEvent("mouseDownLeft",t)},SliderButtonMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseMove=function(){nop()},SliderMorph.prototype=new CircleBoxMorph,SliderMorph.prototype.constructor=SliderMorph,SliderMorph.uber=CircleBoxMorph.prototype,SliderMorph.prototype.init=function(t,e,o,i,r,n){this.target=null,this.action=null,this.start=t,this.stop=e,this.value=o,this.size=i,this.offset=null,this.button=new SliderButtonMorph,this.button.isDraggable=!1,this.button.color=new Color(200,200,200),this.button.highlightColor=new Color(210,210,255),this.button.pressColor=new Color(180,180,255),SliderMorph.uber.init.call(this,r),this.add(this.button),this.alpha=.3,this.color=n||new Color(0,0,0),this.setExtent(new Point(20,100))},SliderMorph.prototype.autoOrientation=function(){nop()},SliderMorph.prototype.rangeSize=function(){return this.stop-this.start},SliderMorph.prototype.ratio=function(){return this.size/this.rangeSize()},SliderMorph.prototype.unitSize=function(){return"vertical"===this.orientation?(this.height()-this.button.height())/this.rangeSize():(this.width()-this.button.width())/this.rangeSize()},SliderMorph.prototype.drawNew=function(){var t,e,o,i;SliderMorph.uber.drawNew.call(this),this.button.orientation=this.orientation,"vertical"===this.orientation?(t=this.width()-2,e=Math.max(t,Math.round(this.height()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),o=1,i=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.height()-this.button.height())):(e=this.height()-2,t=Math.max(e,Math.round(this.width()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),i=1,o=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.width()-this.button.width())),this.button.setPosition(new Point(o,i).add(this.bounds.origin)),this.button.drawNew(),this.button.changed()},SliderMorph.prototype.updateValue=function(){var t;t="vertical"===this.orientation?this.button.top()-this.top():this.button.left()-this.left(),this.value=Math.round(t/this.unitSize()+this.start),this.updateTarget()},SliderMorph.prototype.updateTarget=function(){this.action&&("function"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},SliderMorph.prototype.copyRecordingReferences=function(t){var e=SliderMorph.uber.copyRecordingReferences.call(this,t);return e.target&&t[this.target]&&(e.target=t[this.target]),e.button&&t[this.button]&&(e.button=t[this.button]),e},SliderMorph.prototype.developersMenu=function(){var t=SliderMorph.uber.developersMenu.call(this);return t.addItem("show value...","showValue","display a dialog box\nshowing the selected number"),t.addItem("floor...",function(){this.prompt(t.title+"\nfloor:",this.setStart,this,this.start.toString(),null,0,this.stop-this.size,!0)},"set the minimum value\nwhich can be selected"),t.addItem("ceiling...",function(){this.prompt(t.title+"\nceiling:",this.setStop,this,this.stop.toString(),null,this.start+this.size,100*this.size,!0)},"set the maximum value\nwhich can be selected"),t.addItem("button size...",function(){this.prompt(t.title+"\nbutton size:",this.setSize,this,this.size.toString(),null,1,this.stop-this.start,!0)},"set the range\ncovered by\nthe slider button"),t.addLine(),t.addItem("set target","setTarget","select another morph\nwhose numerical property\nwill be controlled by this one"),t},SliderMorph.prototype.showValue=function(){this.inform(this.value)},SliderMorph.prototype.userSetStart=function(t){this.start=Math.max(t,this.stop)},SliderMorph.prototype.setStart=function(t){var e;"number"==typeof t?this.start=Math.min(Math.max(t,0),this.stop-this.size):(e=parseFloat(t),isNaN(e)||(this.start=Math.min(Math.max(e,0),this.stop-this.size))),this.value=Math.max(this.value,this.start),this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setStop=function(t){var e;"number"==typeof t?this.stop=Math.max(t,this.start+this.size):(e=parseFloat(t),isNaN(e)||(this.stop=Math.max(e,this.start+this.size))),this.value=Math.min(this.value,this.stop),this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setSize=function(t){var e;"number"==typeof t?this.size=Math.min(Math.max(t,1),this.stop-this.start):(e=parseFloat(t),isNaN(e)||(this.size=Math.min(Math.max(e,1),this.stop-this.start))),this.value=Math.min(this.value,this.stop-this.size),this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),o=this;t.push(this.world()),t.forEach(function(t){e.addItem(t.toString().slice(0,50),function(){o.target=t,o.setTargetSetter()})}),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,"choose target property:"),o=this;t.forEach(function(t){e.addItem(t,function(){o.action=t})}),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.numericalSetters=function(){var t=SliderMorph.uber.numericalSetters.call(this);return t.push("setStart","setStop","setSize"),t},SliderMorph.prototype.step=null,SliderMorph.prototype.mouseDownLeft=function(t){var e,o=this;this.offset=this.button.bounds.containsPoint(t)?t.subtract(this.button.bounds.origin):new Point,e=this.root(),this.step=function(){var t,i,r;e.hand.mouseButton?(t=e.hand.bounds.origin,"vertical"===o.orientation?(i=o.button.bounds.origin.x,r=Math.max(Math.min(t.y-o.offset.y,o.bottom()-o.button.height()),o.top())):(r=o.button.bounds.origin.y,i=Math.max(Math.min(t.x-o.offset.x,o.right()-o.button.width()),o.left())),o.button.setPosition(new Point(i,r)),o.updateValue()):this.step=null}};var MouseSensorMorph;MouseSensorMorph.prototype=new BoxMorph,MouseSensorMorph.prototype.constructor=MouseSensorMorph,MouseSensorMorph.uber=BoxMorph.prototype,MouseSensorMorph.prototype.init=function(t,e,o){MouseSensorMorph.uber.init.call(this),this.edge=t||4,this.border=e||2,this.color=new Color(255,255,255),this.borderColor=o||new Color,this.isTouched=!1,this.upStep=.05,this.downStep=.02,this.noticesTransparentClick=!1,this.drawNew()},MouseSensorMorph.prototype.touch=function(){var t=this;this.isTouched||(this.isTouched=!0,this.alpha=.6,this.step=function(){t.isTouched?t.alpha<1&&(t.alpha=t.alpha+t.upStep):t.alpha>t.downStep?t.alpha=t.alpha-t.downStep:(t.alpha=0,t.step=null),t.changed()})},MouseSensorMorph.prototype.unTouch=function(){this.isTouched=!1},MouseSensorMorph.prototype.mouseEnter=function(){this.touch()},MouseSensorMorph.prototype.mouseLeave=function(){this.unTouch()},MouseSensorMorph.prototype.mouseDownLeft=function(){this.touch()},MouseSensorMorph.prototype.mouseClickLeft=function(){this.unTouch()};var ListMorph,TriggerMorph;InspectorMorph.prototype=new BoxMorph,InspectorMorph.prototype.constructor=InspectorMorph,InspectorMorph.uber=BoxMorph.prototype,InspectorMorph.prototype.init=function(t){this.target=t,this.currentProperty=null,this.showing="attributes",this.markOwnProperties=!1,InspectorMorph.uber.init.call(this),this.silentSetExtent(new Point(20*MorphicPreferences.handleSize,20*MorphicPreferences.handleSize*2/3)),this.isDraggable=!0,this.border=1,this.edge=MorphicPreferences.isFlat?1:5,this.color=new Color(60,60,60),this.borderColor=new Color(95,95,95),this.drawNew(),this.label=null,this.list=null,this.detail=null,this.work=null,this.buttonInspect=null,this.buttonClose=null,this.buttonSubset=null,this.buttonEdit=null,this.resizer=null,this.target&&this.buildPanes()},InspectorMorph.prototype.setTarget=function(t){this.target=t,this.currentProperty=null,this.buildPanes()},InspectorMorph.prototype.buildPanes=function(){var t,e,o,i,r=[],n=this;this.children.forEach(function(t){t!==this.work&&t.destroy()}),this.children=[],this.label=new TextMorph(this.target.toString()),this.label.fontSize=MorphicPreferences.menuFontSize,this.label.isBold=!0,this.label.color=new Color(255,255,255),this.label.drawNew(),this.add(this.label);for(t in this.target)t&&r.push(t);"attributes"===this.showing?r=r.filter(function(t){return"function"!=typeof n.target[t]}):"methods"===this.showing&&(r=r.filter(function(t){return"function"==typeof n.target[t]})),i=function(){var t,e;isObject(n.currentProperty)&&(t=n.world(),e=new InspectorMorph(n.currentProperty),e.setPosition(t.hand.position()),e.keepWithin(t),t.add(e),e.changed())},this.list=new ListMorph(this.target instanceof Array?r:r.sort(),null,this.markOwnProperties?[[new Color(0,0,180),function(t){return Object.prototype.hasOwnProperty.call(n.target,t)}]]:null,i),this.list.action=function(t){var e,o,i;void 0!==t&&(e=n.target[t],n.currentProperty=e,o=null===e?"NULL":isString(e)?e:e.toString(),i=new TextMorph(o),i.isEditable=!0,i.enableSelecting(),i.setReceiver(n.target),n.detail.setContents(i))},this.list.hBar.alpha=.6,this.list.vBar.alpha=.6,this.list.contents.step=null,this.add(this.list),this.detail=new ScrollFrameMorph,this.detail.acceptsDrops=!1,this.detail.contents.acceptsDrops=!1,this.detail.isTextLineWrapping=!0,this.detail.color=new Color(255,255,255),this.detail.hBar.alpha=.6,this.detail.vBar.alpha=.6,e=new TextMorph(""),e.isEditable=!0,e.enableSelecting(),e.setReceiver(this.target),this.detail.setContents(e),this.add(this.detail),null===this.work&&(this.work=new ScrollFrameMorph,this.work.acceptsDrops=!1,this.work.contents.acceptsDrops=!1,this.work.isTextLineWrapping=!0,this.work.color=new Color(255,255,255),this.work.hBar.alpha=.6,this.work.vBar.alpha=.6,o=new TextMorph(""),o.isEditable=!0,o.enableSelecting(),o.setReceiver(this.target),this.work.setContents(o)),this.add(this.work),this.buttonSubset=new TriggerMorph,this.buttonSubset.labelString="show...",this.buttonSubset.action=function(){var t;t=new MenuMorph,t.addItem("attributes",function(){n.showing="attributes",n.buildPanes()}),t.addItem("methods",function(){n.showing="methods",n.buildPanes()}),t.addItem("all",function(){n.showing="all",n.buildPanes()}),t.addLine(),t.addItem(n.markOwnProperties?"un-mark own":"mark own",function(){n.markOwnProperties=!n.markOwnProperties,n.buildPanes()},"highlight\n'own' properties"),t.popUpAtHand(n.world())},this.add(this.buttonSubset),this.buttonInspect=new TriggerMorph,this.buttonInspect.labelString="inspect...",this.buttonInspect.action=function(){var t,e,o;isObject(n.currentProperty)?(t=new MenuMorph,t.addItem("in new inspector...",function(){e=n.world(),o=new InspectorMorph(n.currentProperty),o.setPosition(e.hand.position()),o.keepWithin(e),e.add(o),o.changed()}),t.addItem("here...",function(){n.setTarget(n.currentProperty)}),t.popUpAtHand(n.world())):n.inform((null===n.currentProperty?"null":typeof n.currentProperty)+"\nis not inspectable")},this.add(this.buttonInspect),this.buttonEdit=new TriggerMorph,this.buttonEdit.labelString="edit...",this.buttonEdit.action=function(){var t;t=new MenuMorph(n),t.addItem("save","save","accept changes"),t.addLine(),t.addItem("add property...","addProperty"),t.addItem("rename...","renameProperty"),t.addItem("remove...","removeProperty"),t.popUpAtHand(n.world())},this.add(this.buttonEdit),this.buttonClose=new TriggerMorph,this.buttonClose.labelString="close",this.buttonClose.action=function(){n.destroy()},this.add(this.buttonClose),this.resizer=new HandleMorph(this,150,100,this.edge,this.edge),this.fixLayout()},InspectorMorph.prototype.fixLayout=function(){var t,e,o,i,r,n;Morph.prototype.trackChanges=!1,t=this.left()+this.edge,e=this.top()+this.edge,o=this.right()-this.edge,r=o-t,this.label.setPosition(new Point(t,e)),this.label.setWidth(r),this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew()),e=this.label.bottom()+2,r=Math.min(Math.floor(this.width()/3),this.list.listContents.width()),r-=this.edge,i=this.bottom()-2*this.edge-MorphicPreferences.handleSize,n=i-e,this.list.setPosition(new Point(t,e)),this.list.setExtent(new Point(r,n)),t=this.list.right()+this.edge,o=this.right()-this.edge,r=o-t,this.detail.setPosition(new Point(t,e)),this.detail.setExtent(new Point(r,2*n/3-this.edge)),e=this.detail.bottom()+this.edge,this.work.setPosition(new Point(t,e)),this.work.setExtent(new Point(r,n/3)),t=this.list.left(),e=this.list.bottom()+this.edge,r=this.list.width(),n=MorphicPreferences.handleSize,this.buttonSubset.setPosition(new Point(t,e)),this.buttonSubset.setExtent(new Point(r,n)),t=this.detail.left(),r=this.detail.width()-this.edge-MorphicPreferences.handleSize,r=r/3-this.edge/3,this.buttonInspect.setPosition(new Point(t,e)),this.buttonInspect.setExtent(new Point(r,n)),t=this.buttonInspect.right()+this.edge,this.buttonEdit.setPosition(new Point(t,e)),this.buttonEdit.setExtent(new Point(r,n)),t=this.buttonEdit.right()+this.edge,o=this.detail.right()-this.edge-MorphicPreferences.handleSize,r=o-t,this.buttonClose.setPosition(new Point(t,e)),this.buttonClose.setExtent(new Point(r,n)),Morph.prototype.trackChanges=!0,this.changed()},InspectorMorph.prototype.setExtent=function(t){InspectorMorph.uber.setExtent.call(this,t),this.fixLayout()},InspectorMorph.prototype.save=function(){var t=this.detail.contents.children[0].text.toString(),e=this.list.selected;try{this.target.evaluateString("this."+e+" = "+t),this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(o){this.inform(o)}},InspectorMorph.prototype.addProperty=function(){var t=this;this.prompt("new property name:",function(e){e&&(t.target[e]=null,t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed()))},this,"property")},InspectorMorph.prototype.renameProperty=function(){var t=this,e=this.list.selected;this.prompt("property name:",function(o){try{delete t.target[e],t.target[o]=t.currentProperty}catch(i){t.inform(i)}t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed())},this,e)},InspectorMorph.prototype.removeProperty=function(){var t=this.list.selected;try{delete this.target[t],this.currentProperty=null,this.buildPanes(),this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(e){this.inform(e)}};var MenuItemMorph;MenuMorph.prototype=new BoxMorph,MenuMorph.prototype.constructor=MenuMorph,MenuMorph.uber=BoxMorph.prototype,MenuMorph.prototype.init=function(t,e,o,i){this.target=t,this.title=e||null,this.environment=o||null,this.fontSize=i||null,this.items=[],this.label=null,this.world=null,this.isListContents=!1,MenuMorph.uber.init.call(this),this.isDraggable=!1,this.border=null,this.edge=null},MenuMorph.prototype.addItem=function(t,e,o,i,r,n,s){this.items.push([localize(t||"close"),e||nop,o,i,r||!1,n||!1,s])},MenuMorph.prototype.addLine=function(t){this.items.push([0,t||1])},MenuMorph.prototype.createLabel=function(){var t;null!==this.label&&this.label.destroy(),t=new TextMorph(localize(this.title),this.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,!0,!1,"center"),t.alignment="center",t.color=new Color(255,255,255),t.backgroundColor=this.borderColor,t.drawNew(),this.label=new BoxMorph(3,0),MorphicPreferences.isFlat&&(this.label.edge=0),this.label.color=this.borderColor,this.label.borderColor=this.borderColor,this.label.setExtent(t.extent().add(4)),this.label.drawNew(),this.label.add(t),this.label.text=t},MenuMorph.prototype.drawNew=function(){var t,e,o,i,r=this,n=!1;this.children.forEach(function(t){t.destroy()}),this.children=[],this.isListContents||(this.edge=MorphicPreferences.isFlat?0:5,this.border=MorphicPreferences.isFlat?1:2),this.color=new Color(255,255,255),this.borderColor=new Color(60,60,60),this.silentSetExtent(new Point(0,0)),i=2,o=this.left()+4,this.isListContents||(this.title?(this.createLabel(),this.label.setPosition(this.bounds.origin.add(4)),this.add(this.label),i=this.label.bottom()):i=this.top()+4),i+=1,this.items.forEach(function(e){n=!1,e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph?t=e:0===e[0]?(n=!0,t=new Morph,t.color=r.borderColor,t.setHeight(e[1])):t=new MenuItemMorph(r.target,e[1],e[0],r.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,r.environment,e[2],e[3],e[4],e[5],e[6]),n&&(i+=1),t.setPosition(new Point(o,i)),r.add(t),i+=t.height(),n&&(i+=1)}),e=this.fullBounds(),this.silentSetExtent(e.extent().add(4)),this.adjustWidths(),MenuMorph.uber.drawNew.call(this)},MenuMorph.prototype.maxWidth=function(){var t=0;return this.parent instanceof FrameMorph&&this.parent.scrollFrame instanceof ScrollFrameMorph&&(t=this.parent.scrollFrame.width()),this.children.forEach(function(e){e instanceof MenuItemMorph?t=Math.max(t,e.children[0].width()+8):(e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph)&&(t=Math.max(t,e.width()))}),this.label&&(t=Math.max(t,this.label.width())),t},MenuMorph.prototype.adjustWidths=function(){var t,e=this.maxWidth(),o=this;this.children.forEach(function(i){i.silentSetWidth(e),i instanceof MenuItemMorph?(t=i.image===i.pressImage,i.createBackgrounds(),t&&(i.image=i.pressImage)):(i.drawNew(),i===o.label&&i.text.setPosition(i.center().subtract(i.text.extent().floorDivideBy(2))))})},MenuMorph.prototype.unselectAllItems=function(){this.children.forEach(function(t){t instanceof MenuItemMorph&&(t.image=t.normalImage)}),this.changed()},MenuMorph.prototype.popup=function(t,e){this.drawNew(),this.setPosition(e),this.addShadow(new Point(2,2),80),this.keepWithin(t),t.activeMenu&&t.activeMenu.destroy(),t.add(this),t.activeMenu=this,this.fullChanged()},MenuMorph.prototype.popUpAtHand=function(t){var e=t||this.world;this.popup(e,e.hand.position())},MenuMorph.prototype.popUpCenteredAtHand=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.hand.position().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.popUpCenteredInWorld=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.center().subtract(this.extent().floorDivideBy(2)))},StringMorph.prototype=new Morph,StringMorph.prototype.constructor=StringMorph,StringMorph.uber=Morph.prototype,StringMorph.prototype.init=function(t,e,o,i,r,n,s,a,h,l){this.text=t||(""===t?"":"StringMorph"),this.fontSize=e||12,this.fontName=l||MorphicPreferences.globalFontFamily,this.fontStyle=o||"sans-serif",this.isBold=i||!1,this.isItalic=r||!1,this.isEditable=!1,this.isNumeric=n||!1,this.isPassword=!1,this.shadowOffset=s||new Point(0,0),this.shadowColor=a||null,this.isShowingBlanks=!1,this.blanksColor=new Color(180,140,140),this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),StringMorph.uber.init.call(this),this.color=h||new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},StringMorph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+'("'+this.text.slice(0,30)+'...")'},StringMorph.prototype.password=function(t,e){var o,i="";for(o=0;e>o;o+=1)i+=t;return i},StringMorph.prototype.font=function(){var t="";return this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+this.fontSize+"px "+(this.fontName?this.fontName+", ":"")+this.fontStyle},StringMorph.prototype.drawNew=function(){var t,e,o,i,r,n,s,a,h,l=this.shadowOffset||new Point,p=this.isPassword?this.password("*",this.text.length):this.text;for(this.image=newCanvas(),t=this.image.getContext("2d"),t.font=this.font(),e=Math.max(t.measureText(p).width+Math.abs(l.x),1),this.bounds.corner=this.bounds.origin.add(new Point(e,fontHeight(this.fontSize)+Math.abs(l.y))),this.image.width=e,this.image.height=this.height(),t.font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.shadowColor&&(a=Math.max(l.x,0),h=Math.max(l.y,0),t.fillStyle=this.shadowColor.toString(),t.fillText(p,a,fontHeight(this.fontSize)+h)),a=Math.abs(Math.min(l.x,0)),h=Math.abs(Math.min(l.y,0)),t.fillStyle=this.color.toString(),this.isShowingBlanks?this.renderWithBlanks(t,a,fontHeight(this.fontSize)+h):t.fillText(p,a,fontHeight(this.fontSize)+h),o=Math.min(this.startMark,this.endMark),i=Math.max(this.startMark,this.endMark),r=o;i>r;r+=1)n=this.slotPosition(r).subtract(this.position()),s=p.charAt(r),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(n.x,n.y,t.measureText(s).width+1+a,fontHeight(this.fontSize)+h),t.fillStyle=this.markedTextColor.toString(),t.fillText(s,n.x+a,fontHeight(this.fontSize)+h);this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},StringMorph.prototype.renderWithBlanks=function(t,e,o){function i(){t.drawImage(n,h,0),h+=r}var r=t.measureText(" ").width,n=newCanvas(new Point(r,this.height())),s=n.getContext("2d"),a=this.text.split(" "),h=e||0,l=!0;s.fillStyle=this.blanksColor.toString(),s.arc(r/2,n.height/2,r/2,radians(0),radians(360)),s.fill(),a.forEach(function(e){l||i(),l=!1,""!==e&&(t.fillText(e,h,o),h+=t.measureText(e).width)})},StringMorph.prototype.slotPosition=function(t){var e,o,i,r,n=this.isPassword?this.password("*",this.text.length):this.text,s=Math.min(Math.max(t,0),n.length),a=this.image.getContext("2d");for(e=0,r=0;s>r;r+=1)e+=a.measureText(n[r]).width;return this.pos=s,o=this.left()+e,i=this.top(),new Point(o,i)},StringMorph.prototype.slotAt=function(t){for(var e=this.isPassword?this.password("*",this.text.length):this.text,o=0,i=0,r=this.image.getContext("2d");t.x-this.left()>i;)if(i+=r.measureText(e[o]).width,o+=1,o===e.length&&r.measureText(e).width-r.measureText(e[o-1]).width/2<t.x-this.left())return o;return o-1},StringMorph.prototype.upFrom=function(t){return t},StringMorph.prototype.downFrom=function(t){return t},StringMorph.prototype.startOfLine=function(){return 0},StringMorph.prototype.endOfLine=function(){return this.text.length},StringMorph.prototype.rawHeight=function(){return this.height()/1.2},StringMorph.prototype.developersMenu=function(){var t=StringMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("edit","edit"),t.addItem("font size...",function(){this.prompt(t.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,500,!0)},"set this String's\nfont point size"),"serif"!==this.fontStyle&&t.addItem("serif","setSerif"),"sans-serif"!==this.fontStyle&&t.addItem("sans-serif","setSansSerif"),this.isBold?t.addItem("normal weight","toggleWeight"):t.addItem("bold","toggleWeight"),this.isItalic?t.addItem("normal style","toggleItalic"):t.addItem("italic","toggleItalic"),this.isShowingBlanks?t.addItem("hide blanks","toggleShowBlanks"):t.addItem("show blanks","toggleShowBlanks"),this.isPassword?t.addItem("show characters","toggleIsPassword"):t.addItem("hide characters","toggleIsPassword"),t},StringMorph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable,this.isDraggable?this.disableSelecting():this.enableSelecting()},StringMorph.prototype.toggleShowBlanks=function(){this.isShowingBlanks=!this.isShowingBlanks,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleWeight=function(){this.isBold=!this.isBold,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleItalic=function(){this.isItalic=!this.isItalic,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleIsPassword=function(){this.isPassword=!this.isPassword,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSerif=function(){this.fontStyle="serif",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSansSerif=function(){this.fontStyle="sans-serif",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setFontSize=function(t){var e;"number"==typeof t?this.fontSize=Math.round(Math.min(Math.max(t,4),500)):(e=parseFloat(t),isNaN(e)||(this.fontSize=Math.round(Math.min(Math.max(e,4),500)))),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setText=function(t){this.text=Math.round(t).toString(),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setAlphaScaled","setFontSize","setText"]},StringMorph.prototype.edit=function(){this.root().edit(this)},StringMorph.prototype.selection=function(){var t,e;return t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text.slice(t,e)},StringMorph.prototype.selectionStartSlot=function(){return Math.min(this.startMark,this.endMark)},StringMorph.prototype.clearSelection=function(){this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.drawNew(),this.changed()},StringMorph.prototype.deleteSelection=function(){var t,e,o;o=this.text,t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text=o.slice(0,t)+o.slice(e),this.changed(),this.clearSelection()},StringMorph.prototype.selectAll=function(){this.isEditable&&(this.startMark=0,this.endMark=this.text.length,this.drawNew(),this.changed())},StringMorph.prototype.mouseDownLeft=function(t){this.isEditable?this.clearSelection():this.escalateEvent("mouseDownLeft",t)},StringMorph.prototype.mouseClickLeft=function(t){var e;this.isEditable?(this.currentlySelecting||this.edit(),e=this.root().cursor,e&&e.gotoPos(t),this.currentlySelecting=!0):this.escalateEvent("mouseClickLeft",t)},StringMorph.prototype.enableSelecting=function(){this.mouseDownLeft=function(t){this.clearSelection(),this.isEditable&&!this.isDraggable&&(this.edit(),this.root().cursor.gotoPos(t),this.startMark=this.slotAt(t),this.endMark=this.startMark,this.currentlySelecting=!0)},this.mouseMove=function(t){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable){var e=this.slotAt(t);e!==this.endMark&&(this.endMark=e,this.drawNew(),this.changed())}}},StringMorph.prototype.disableSelecting=function(){this.mouseDownLeft=StringMorph.prototype.mouseDownLeft,delete this.mouseMove},TextMorph.prototype=new Morph,TextMorph.prototype.constructor=TextMorph,TextMorph.uber=Morph.prototype,TextMorph.prototype.init=function(t,e,o,i,r,n,s,a,h,l){this.text=t||(""===t?t:"TextMorph"),this.words=[],this.lines=[],this.lineSlots=[],this.fontSize=e||12,this.fontName=a||MorphicPreferences.globalFontFamily,this.fontStyle=o||"sans-serif",this.isBold=i||!1,this.isItalic=r||!1,this.alignment=n||"left",this.shadowOffset=h||new Point(0,0),this.shadowColor=l||null,this.maxWidth=s||0,this.maxLineWidth=0,this.backgroundColor=null,this.isEditable=!1,this.receiver=null,this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),TextMorph.uber.init.call(this),this.color=new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},TextMorph.prototype.toString=function(){return'a TextMorph("'+this.text.slice(0,30)+'...")'},TextMorph.prototype.font=StringMorph.prototype.font,TextMorph.prototype.parse=function(){var t,e,o=this,i=this.text.split("\n"),r=newCanvas(),n=r.getContext("2d"),s="",a=0;n.font=this.font(),this.maxLineWidth=0,this.lines=[],this.lineSlots=[0],this.words=[],i.forEach(function(t){o.words=o.words.concat(t.split(" ")),o.words.push("\n")}),this.words.forEach(function(i){"\n"===i?(o.lines.push(s),o.lineSlots.push(a),o.maxLineWidth=Math.max(o.maxLineWidth,n.measureText(s).width),s=""):(o.maxWidth>0?(t=s+i+" ",e=n.measureText(t).width,e>o.maxWidth?(o.lines.push(s),o.lineSlots.push(a),o.maxLineWidth=Math.max(o.maxLineWidth,n.measureText(s).width),s=i+" "):s=t):s=s+i+" ",a+=i.length+1)})},TextMorph.prototype.drawNew=function(){var t,e,o,i,r,n,s,a,h,l,p,c,d,u,f;if(this.image=newCanvas(),t=this.image.getContext("2d"),t.font=this.font(),this.parse(),s=Math.abs(this.shadowOffset.x),n=Math.abs(this.shadowOffset.y),e=this.lines.length*(fontHeight(this.fontSize)+n),this.bounds=this.bounds.origin.extent(0===this.maxWidth?new Point(this.maxLineWidth+s,e):new Point(this.maxWidth+s,e)),this.image.width=this.width(),this.image.height=this.height(),t=this.image.getContext("2d"),t.font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.backgroundColor&&(t.fillStyle=this.backgroundColor.toString(),t.fillRect(0,0,this.width(),this.height())),this.shadowColor)for(a=Math.max(this.shadowOffset.x,0),h=Math.max(this.shadowOffset.y,0),t.fillStyle=this.shadowColor.toString(),o=0;o<this.lines.length;o+=1)i=this.lines[o],r=t.measureText(i).width+s,l="right"===this.alignment?this.width()-r:"center"===this.alignment?(this.width()-r)/2:0,p=(o+1)*(fontHeight(this.fontSize)+n)-n,t.fillText(i,l+a,p+h);
for(a=Math.abs(Math.min(this.shadowOffset.x,0)),h=Math.abs(Math.min(this.shadowOffset.y,0)),t.fillStyle=this.color.toString(),o=0;o<this.lines.length;o+=1)i=this.lines[o],r=t.measureText(i).width+s,l="right"===this.alignment?this.width()-r:"center"===this.alignment?(this.width()-r)/2:0,p=(o+1)*(fontHeight(this.fontSize)+n)-n,t.fillText(i,l+a,p+h);for(c=Math.min(this.startMark,this.endMark),d=Math.max(this.startMark,this.endMark),o=c;d>o;o+=1)u=this.slotPosition(o).subtract(this.position()),f=this.text.charAt(o),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(u.x,u.y,t.measureText(f).width+1,fontHeight(this.fontSize)),t.fillStyle=this.markedTextColor.toString(),t.fillText(f,u.x,u.y+fontHeight(this.fontSize));this.parent&&this.parent.layoutChanged&&this.parent.layoutChanged()},TextMorph.prototype.setExtent=function(t){this.maxWidth=Math.max(t.x,0),this.changed(),this.drawNew()},TextMorph.prototype.columnRow=function(t){var e,o,i=0;for(e=0;e<this.lines.length;e+=1)for(i=this.lineSlots[e],o=0;o<this.lines[e].length;o+=1){if(i===t)return new Point(o,e);i+=1}return new Point(this.lines[this.lines.length-1].length-1,this.lines.length-1)},TextMorph.prototype.slotPosition=function(t){var e,o,i,r,n=this.columnRow(t),s=this.image.getContext("2d"),a=Math.abs(this.shadowOffset.y),h=0;for(e=n.y*(fontHeight(this.fontSize)+a),r=0;r<n.x;r+=1)h+=s.measureText(this.lines[n.y][r]).width;return o=this.left()+h,i=this.top()+e,new Point(o,i)},TextMorph.prototype.slotAt=function(t){for(var e=0,o=0,i=0,r=Math.abs(this.shadowOffset.y),n=this.image.getContext("2d");t.y-this.top()>(fontHeight(this.fontSize)+r)*o;)o+=1;for(o=Math.max(o,1);t.x-this.left()>e;)e+=n.measureText(this.lines[o-1][i]).width,i+=1;return this.lineSlots[Math.max(o-1,0)]+i-1},TextMorph.prototype.upFrom=function(t){var e,o=this.columnRow(t);return o.y<1?t:(e=this.lines[o.y-1],e.length<o.x-1?this.lineSlots[o.y-1]+e.length:this.lineSlots[o.y-1]+o.x)},TextMorph.prototype.downFrom=function(t){var e,o=this.columnRow(t);return o.y>this.lines.length-2?t:(e=this.lines[o.y+1],e.length<o.x-1?this.lineSlots[o.y+1]+e.length:this.lineSlots[o.y+1]+o.x)},TextMorph.prototype.startOfLine=function(t){return this.lineSlots[this.columnRow(t).y]},TextMorph.prototype.endOfLine=function(t){return this.startOfLine(t)+this.lines[this.columnRow(t).y].length-1},TextMorph.prototype.edit=StringMorph.prototype.edit,TextMorph.prototype.selection=StringMorph.prototype.selection,TextMorph.prototype.selectionStartSlot=StringMorph.prototype.selectionStartSlot,TextMorph.prototype.clearSelection=StringMorph.prototype.clearSelection,TextMorph.prototype.deleteSelection=StringMorph.prototype.deleteSelection,TextMorph.prototype.selectAll=StringMorph.prototype.selectAll,TextMorph.prototype.mouseDownLeft=StringMorph.prototype.mouseDownLeft,TextMorph.prototype.mouseClickLeft=StringMorph.prototype.mouseClickLeft,TextMorph.prototype.enableSelecting=StringMorph.prototype.enableSelecting,TextMorph.prototype.disableSelecting=StringMorph.prototype.disableSelecting,TextMorph.prototype.selectAllAndEdit=function(){this.edit(),this.selectAll()},TextMorph.prototype.developersMenu=function(){var t=TextMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("edit","edit"),t.addItem("font size...",function(){this.prompt(t.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,100,!0)},"set this Text's\nfont point size"),"left"!==this.alignment&&t.addItem("align left","setAlignmentToLeft"),"right"!==this.alignment&&t.addItem("align right","setAlignmentToRight"),"center"!==this.alignment&&t.addItem("align center","setAlignmentToCenter"),t.addLine(),"serif"!==this.fontStyle&&t.addItem("serif","setSerif"),"sans-serif"!==this.fontStyle&&t.addItem("sans-serif","setSansSerif"),this.isBold?t.addItem("normal weight","toggleWeight"):t.addItem("bold","toggleWeight"),this.isItalic?t.addItem("normal style","toggleItalic"):t.addItem("italic","toggleItalic"),t},TextMorph.prototype.setAlignmentToLeft=function(){this.alignment="left",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToRight=function(){this.alignment="right",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToCenter=function(){this.alignment="center",this.drawNew(),this.changed()},TextMorph.prototype.toggleIsDraggable=StringMorph.prototype.toggleIsDraggable,TextMorph.prototype.toggleWeight=StringMorph.prototype.toggleWeight,TextMorph.prototype.toggleItalic=StringMorph.prototype.toggleItalic,TextMorph.prototype.setSerif=StringMorph.prototype.setSerif,TextMorph.prototype.setSansSerif=StringMorph.prototype.setSansSerif,TextMorph.prototype.setText=StringMorph.prototype.setText,TextMorph.prototype.setFontSize=StringMorph.prototype.setFontSize,TextMorph.prototype.numericalSetters=StringMorph.prototype.numericalSetters,TextMorph.prototype.evaluationMenu=function(){var t=new MenuMorph(this,null);return t.addItem("do it","doIt","evaluate the\nselected expression"),t.addItem("show it","showIt","evaluate the\nselected expression\nand show the result"),t.addItem("inspect it","inspectIt","evaluate the\nselected expression\nand inspect the result"),t.addLine(),t.addItem("select all","selectAllAndEdit"),t},TextMorph.prototype.setReceiver=function(t){this.receiver=t,this.customContextMenu=this.evaluationMenu()},TextMorph.prototype.doIt=function(){this.receiver.evaluateString(this.selection()),this.edit()},TextMorph.prototype.showIt=function(){var t=this.receiver.evaluateString(this.selection());null!==t&&this.inform(t)},TextMorph.prototype.inspectIt=function(){var t,e=this.receiver.evaluateString(this.selection()),o=this.world();null!==e&&(t=new InspectorMorph(e),t.setPosition(o.hand.position()),t.keepWithin(o),o.add(t),t.changed())},TriggerMorph.prototype=new Morph,TriggerMorph.prototype.constructor=TriggerMorph,TriggerMorph.uber=Morph.prototype,TriggerMorph.prototype.init=function(t,e,o,i,r,n,s,a,h,l,p){this.target=t||null,this.action=e||null,this.doubleClickAction=p||null,this.environment=n||null,this.labelString=o||null,this.label=null,this.hint=s||null,this.fontSize=i||MorphicPreferences.menuFontSize,this.fontStyle=r||"sans-serif",this.highlightColor=new Color(192,192,192),this.pressColor=new Color(128,128,128),this.labelColor=a||new Color(0,0,0),this.labelBold=h||!1,this.labelItalic=l||!1,TriggerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.drawNew()},TriggerMorph.prototype.drawNew=function(){this.createBackgrounds(),null!==this.labelString&&this.createLabel()},TriggerMorph.prototype.createBackgrounds=function(){var t,e=this.extent();this.normalImage=newCanvas(e),t=this.normalImage.getContext("2d"),t.fillStyle=this.color.toString(),t.fillRect(0,0,e.x,e.y),this.highlightImage=newCanvas(e),t=this.highlightImage.getContext("2d"),t.fillStyle=this.highlightColor.toString(),t.fillRect(0,0,e.x,e.y),this.pressImage=newCanvas(e),t=this.pressImage.getContext("2d"),t.fillStyle=this.pressColor.toString(),t.fillRect(0,0,e.x,e.y),this.image=this.normalImage},TriggerMorph.prototype.createLabel=function(){null!==this.label&&this.label.destroy(),this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic,!1,null,null,this.labelColor),this.label.setPosition(this.center().subtract(this.label.extent().floorDivideBy(2))),this.add(this.label)},TriggerMorph.prototype.copyRecordingReferences=function(t){var e=TriggerMorph.uber.copyRecordingReferences.call(this,t);return e.label&&t[this.label]&&(e.label=t[this.label]),e},TriggerMorph.prototype.trigger=function(){"function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call(),this):this.target.call(this.environment,this.action,this):"function"==typeof this.action?this.action.call(this.target):this.target[this.action]()},TriggerMorph.prototype.triggerDoubleClick=function(){this.doubleClickAction&&("function"==typeof this.target?"function"==typeof this.doubleClickAction?this.target.call(this.environment,this.doubleClickAction.call(),this):this.target.call(this.environment,this.doubleClickAction,this):"function"==typeof this.doubleClickAction?this.doubleClickAction.call(this.target):this.target[this.doubleClickAction]())},TriggerMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed(),this.hint&&this.bubbleHelp(this.hint)},TriggerMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed(),this.hint&&this.world().hand.destroyTemporaries()},TriggerMorph.prototype.mouseDownLeft=function(){this.image=this.pressImage,this.changed()},TriggerMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed(),this.trigger()},TriggerMorph.prototype.mouseDoubleClick=function(){this.triggerDoubleClick()},TriggerMorph.prototype.rootForGrab=function(){return this.isDraggable?TriggerMorph.uber.rootForGrab.call(this):null},TriggerMorph.prototype.bubbleHelp=function(t){var e=this;this.fps=2,this.step=function(){this.bounds.containsPoint(this.world().hand.position())&&e.popUpbubbleHelp(t),e.fps=0,delete e.step}},TriggerMorph.prototype.popUpbubbleHelp=function(t){new SpeechBubbleMorph(localize(t),null,null,1).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))};var MenuItemMorph;MenuItemMorph.prototype=new TriggerMorph,MenuItemMorph.prototype.constructor=MenuItemMorph,MenuItemMorph.uber=TriggerMorph.prototype,MenuItemMorph.prototype.createLabel=function(){var t,e,o;null!==this.label&&this.label.destroy(),isString(this.labelString)?this.label=this.createLabelString(this.labelString):this.labelString instanceof Array?(this.label=new Morph,this.label.alpha=0,t=this.createIcon(this.labelString[0]),this.label.add(t),e=this.createLabelString(this.labelString[1]),this.label.add(e),e.setCenter(t.center()),e.setLeft(t.right()+4),this.label.bounds=t.bounds.merge(e.bounds),this.label.drawNew()):this.label=this.createIcon(this.labelString),this.silentSetExtent(this.label.extent().add(new Point(8,0))),o=this.position().add(new Point(4,0)),this.label.bounds=o.extent(this.label.extent()),this.add(this.label)},MenuItemMorph.prototype.createIcon=function(t){var e,o=new Morph;return o.image=t instanceof Morph?t.fullImage():t,t instanceof Morph&&t.getShadow()&&(e=o.image,o.image=newCanvas(t.fullBounds().extent().subtract(this.shadowBlur*(useBlurredShadows?1:2))),o.image.getContext("2d").drawImage(e,0,0)),o.silentSetWidth(o.image.width),o.silentSetHeight(o.image.height),o},MenuItemMorph.prototype.createLabelString=function(t){var e=new TextMorph(t,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic);return e.setColor(this.labelColor),e},MenuItemMorph.prototype.mouseEnter=function(){this.isListItem()||(this.image=this.highlightImage,this.changed()),this.hint&&this.bubbleHelp(this.hint)},MenuItemMorph.prototype.mouseLeave=function(){this.isListItem()||(this.image=this.normalImage,this.changed()),this.hint&&this.world().hand.destroyTemporaries()},MenuItemMorph.prototype.mouseDownLeft=function(t){this.isListItem()&&(this.parent.unselectAllItems(),this.escalateEvent("mouseDownLeft",t)),this.image=this.pressImage,this.changed()},MenuItemMorph.prototype.mouseMove=function(){this.isListItem()&&this.escalateEvent("mouseMove")},MenuItemMorph.prototype.mouseClickLeft=function(){this.isListItem()||(this.parent.destroy(),this.root().activeMenu=null),this.trigger()},MenuItemMorph.prototype.isListItem=function(){return this.parent?this.parent.isListContents:!1},MenuItemMorph.prototype.isSelectedListItem=function(){return this.isListItem()?this.image===this.pressImage:!1},FrameMorph.prototype=new Morph,FrameMorph.prototype.constructor=FrameMorph,FrameMorph.uber=Morph.prototype,FrameMorph.prototype.init=function(t){this.scrollFrame=t||null,FrameMorph.uber.init.call(this),this.color=new Color(255,250,245),this.drawNew(),this.acceptsDrops=!0,this.scrollFrame&&(this.isDraggable=!1,this.noticesTransparentClick=!1,this.alpha=0)},FrameMorph.prototype.fullBounds=function(){var t=this.getShadow();return null!==t?this.bounds.merge(t.bounds):this.bounds},FrameMorph.prototype.fullImage=function(){return this.image},FrameMorph.prototype.fullDrawOn=function(t,e){var o,i;return this.isVisible?(o=e||this.fullBounds(),i=this.bounds.intersect(o),i.extent().gt(new Point(0,0))?(this.drawOn(t,i),void this.children.forEach(function(e){e instanceof ShadowMorph?e.fullDrawOn(t,o):e.fullDrawOn(t,i)})):null):null},FrameMorph.prototype.moveBy=function(t){this.changed(),this.bounds=this.bounds.translateBy(t),this.children.forEach(function(e){e.silentMoveBy(t)}),this.changed()},FrameMorph.prototype.submorphBounds=function(){var t=null;return this.children.length>0&&(t=this.children[0].bounds,this.children.forEach(function(e){t=t.merge(e.fullBounds())})),t},FrameMorph.prototype.keepInScrollFrame=function(){return null===this.scrollFrame?null:(this.left()>this.scrollFrame.left()&&this.moveBy(new Point(this.scrollFrame.left()-this.left(),0)),this.right()<this.scrollFrame.right()&&this.moveBy(new Point(this.scrollFrame.right()-this.right(),0)),this.top()>this.scrollFrame.top()&&this.moveBy(new Point(0,this.scrollFrame.top()-this.top())),void(this.bottom()<this.scrollFrame.bottom()&&this.moveBy(0,new Point(this.scrollFrame.bottom()-this.bottom(),0))))},FrameMorph.prototype.adjustBounds=function(){var t,e,o=this;return null===this.scrollFrame?null:(t=this.submorphBounds(),e=t&&!this.scrollFrame.isTextLineWrapping?t.expandBy(this.scrollFrame.padding).growBy(this.scrollFrame.growth).merge(this.scrollFrame.bounds):this.scrollFrame.bounds.copy(),this.bounds.eq(e)||(this.bounds=e,this.drawNew(),this.keepInScrollFrame()),this.scrollFrame.isTextLineWrapping&&this.children.forEach(function(t){t instanceof TextMorph&&(t.setWidth(o.width()),o.setHeight(Math.max(t.height(),o.scrollFrame.height())))}),void this.scrollFrame.adjustScrollBars())},FrameMorph.prototype.reactToDropOf=function(){this.adjustBounds()},FrameMorph.prototype.reactToGrabOf=function(){this.adjustBounds()},FrameMorph.prototype.copyRecordingReferences=function(t){var e=FrameMorph.uber.copyRecordingReferences.call(this,t);return e.frame&&t[this.scrollFrame]&&(e.frame=t[this.scrollFrame]),e},FrameMorph.prototype.developersMenu=function(){var t=FrameMorph.uber.developersMenu.call(this);return this.children.length>0&&(t.addLine(),t.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible")),t},FrameMorph.prototype.keepAllSubmorphsWithin=function(){var t=this;this.children.forEach(function(e){e.keepWithin(t)})},ScrollFrameMorph.prototype=new FrameMorph,ScrollFrameMorph.prototype.constructor=ScrollFrameMorph,ScrollFrameMorph.uber=FrameMorph.prototype,ScrollFrameMorph.prototype.init=function(t,e,o){var i=this;ScrollFrameMorph.uber.init.call(this),this.scrollBarSize=e||MorphicPreferences.scrollBarSize,this.autoScrollTrigger=null,this.isScrollingByDragging=!0,this.hasVelocity=!0,this.padding=0,this.growth=0,this.isTextLineWrapping=!1,this.contents=t||new FrameMorph(this),this.add(this.contents),this.hBar=new SliderMorph(null,null,null,null,"horizontal",o),this.hBar.setHeight(this.scrollBarSize),this.hBar.action=function(t){i.contents.setPosition(new Point(i.left()-t,i.contents.position().y))},this.hBar.isDraggable=!1,this.add(this.hBar),this.vBar=new SliderMorph(null,null,null,null,"vertical",o),this.vBar.setWidth(this.scrollBarSize),this.vBar.action=function(t){i.contents.setPosition(new Point(i.contents.position().x,i.top()-t))},this.vBar.isDraggable=!1,this.add(this.vBar)},ScrollFrameMorph.prototype.adjustScrollBars=function(){var t=this.width()-this.scrollBarSize,e=this.height()-this.scrollBarSize;this.changed(),this.contents.width()>this.width()+MorphicPreferences.scrollBarSize?(this.hBar.show(),this.hBar.width()!==t&&this.hBar.setWidth(t),this.hBar.setPosition(new Point(this.left(),this.bottom()-this.hBar.height())),this.hBar.start=0,this.hBar.stop=this.contents.width()-this.width(),this.hBar.size=this.width()/this.contents.width()*this.hBar.stop,this.hBar.value=this.left()-this.contents.left(),this.hBar.drawNew()):this.hBar.hide(),this.contents.height()>this.height()+this.scrollBarSize?(this.vBar.show(),this.vBar.height()!==e&&this.vBar.setHeight(e),this.vBar.setPosition(new Point(this.right()-this.vBar.width(),this.top())),this.vBar.start=0,this.vBar.stop=this.contents.height()-this.height(),this.vBar.size=this.height()/this.contents.height()*this.vBar.stop,this.vBar.value=this.top()-this.contents.top(),this.vBar.drawNew()):this.vBar.hide()},ScrollFrameMorph.prototype.addContents=function(t){this.contents.add(t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.setContents=function(t){this.contents.children.forEach(function(t){t.destroy()}),this.contents.children=[],t.setPosition(this.position().add(this.padding+2)),this.addContents(t)},ScrollFrameMorph.prototype.setExtent=function(t){this.isTextLineWrapping&&this.contents.setPosition(this.position().copy()),ScrollFrameMorph.uber.setExtent.call(this,t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.scrollX=function(t){var e,o=this.contents.left(),i=this.left(),r=this.contents.width(),n=this.right();e=o+t,n>e+r&&(e=n-r),e>i&&(e=i),e!==o&&this.contents.setLeft(e)},ScrollFrameMorph.prototype.scrollY=function(t){var e,o=this.contents.top(),i=this.top(),r=this.contents.height(),n=this.bottom();e=o+t,n>e+r&&(e=n-r),e>i&&(e=i),e!==o&&this.contents.setTop(e)},ScrollFrameMorph.prototype.step=function(){nop()},ScrollFrameMorph.prototype.mouseDownLeft=function(t){if(!this.isScrollingByDragging)return null;var e=this.root(),o=t,i=this,r=0,n=0,s=.8;this.step=function(){var t;e.hand.mouseButton&&0===e.hand.children.length&&i.bounds.containsPoint(e.hand.position())?(t=e.hand.bounds.origin,r=t.x-o.x,0!==r&&i.scrollX(r),n=t.y-o.y,0!==n&&i.scrollY(n),o=t):i.hasVelocity?Math.abs(r)<.5&&Math.abs(n)<.5?i.step=function(){nop()}:(r*=s,i.scrollX(Math.round(r)),n*=s,i.scrollY(Math.round(n))):i.step=function(){nop()},this.adjustScrollBars()}},ScrollFrameMorph.prototype.startAutoScrolling=function(){var t,e,o,i=this,r=3*MorphicPreferences.scrollBarSize,n=this.world();return n?(t=n.hand,this.autoScrollTrigger||(this.autoScrollTrigger=Date.now()),void(this.step=function(){o=t.bounds.origin,e=i.bounds.insetBy(r),i.bounds.containsPoint(o)&&!e.containsPoint(o)&&t.children.length>0?i.autoScroll(o):(i.step=function(){nop()},i.autoScrollTrigger=null)})):null},ScrollFrameMorph.prototype.autoScroll=function(t){var e,o;return Date.now()-this.autoScrollTrigger<500?null:(e=3*MorphicPreferences.scrollBarSize,o=this.topLeft().extent(new Point(this.width(),e)),o.containsPoint(t)&&this.scrollY(e-(t.y-this.top())),o=this.topLeft().extent(new Point(e,this.height())),o.containsPoint(t)&&this.scrollX(e-(t.x-this.left())),o=new Point(this.right()-e,this.top()).extent(new Point(e,this.height())),o.containsPoint(t)&&this.scrollX(-(e-(this.right()-t.x))),o=new Point(this.left(),this.bottom()-e).extent(new Point(this.width(),e)),o.containsPoint(t)&&this.scrollY(-(e-(this.bottom()-t.y))),void this.adjustScrollBars())},ScrollFrameMorph.prototype.scrollCursorIntoView=function(t){var e=t.target,o=e.position().subtract(this.contents.position()),i=this.top()+this.padding,r=this.bottom()-this.padding;this.contents.setExtent(e.extent().add(o).add(this.padding)),t.top()<i?(this.contents.setTop(this.contents.top()+i-t.top()),t.setTop(i)):t.bottom()>r&&(this.contents.setBottom(this.contents.bottom()+r-t.bottom()),t.setBottom(r)),this.adjustScrollBars()},ScrollFrameMorph.prototype.mouseScroll=function(t,e){t&&this.scrollY(t*MorphicPreferences.mouseScrollAmount),e&&this.scrollX(e*MorphicPreferences.mouseScrollAmount),this.adjustScrollBars()},ScrollFrameMorph.prototype.copyRecordingReferences=function(t){var e=ScrollFrameMorph.uber.copyRecordingReferences.call(this,t);return e.contents&&t[this.contents]&&(e.contents=t[this.contents]),e.hBar&&t[this.hBar]&&(e.hBar=t[this.hBar],e.hBar.action=function(t){e.contents.setPosition(new Point(e.left()-t,e.contents.position().y))}),e.vBar&&t[this.vBar]&&(e.vBar=t[this.vBar],e.vBar.action=function(t){e.contents.setPosition(new Point(e.contents.position().x,e.top()-t))}),e},ScrollFrameMorph.prototype.developersMenu=function(){var t=ScrollFrameMorph.uber.developersMenu.call(this);return this.isTextLineWrapping?t.addItem("auto line wrap off...","toggleTextLineWrapping","turn automatic\nline wrapping\noff"):t.addItem("auto line wrap on...","toggleTextLineWrapping","enable automatic\nline wrapping"),t},ScrollFrameMorph.prototype.toggleTextLineWrapping=function(){this.isTextLineWrapping=!this.isTextLineWrapping},ListMorph.prototype=new ScrollFrameMorph,ListMorph.prototype.constructor=ListMorph,ListMorph.uber=ScrollFrameMorph.prototype,ListMorph.prototype.init=function(t,e,o,i){ListMorph.uber.init.call(this),this.contents.acceptsDrops=!1,this.color=new Color(255,255,255),this.hBar.alpha=.6,this.vBar.alpha=.6,this.elements=t||[],this.labelGetter=e,this.format=o,this.listContents=null,this.selected=null,this.active=null,this.action=null,this.doubleClickAction=i||null,this.acceptsDrops=!1,this.buildListContents()},ListMorph.prototype.buildListContents=function(){var t=this;this.listContents&&this.listContents.destroy(),this.listContents=new MenuMorph(this.select,null,this),0===this.elements.length&&(this.elements=["(empty)"]),this.elements.forEach(function(e){var o=null,i=!1,r=!1;t.format.forEach(function(t){t[1].call(null,e)&&("bold"===t[0]?i=!0:"italic"===t[0]?r=!0:o=t[0])}),t.listContents.addItem(t.labelGetter(e),e,null,o,i,r,t.doubleClickAction)}),this.listContents.setPosition(this.contents.position()),this.listContents.isListContents=!0,this.listContents.drawNew(),this.addContents(this.listContents)},ListMorph.prototype.select=function(t,e){this.selected=t,this.active=e,this.action&&this.action.call(null,t)},ListMorph.prototype.setExtent=function(t){var e=this.listContents.bounds,o=this.bounds.origin.copy().corner(this.bounds.origin.add(t));o.right()>e.right()&&o.width()<=e.width()&&this.listContents.setRight(o.right()),o.bottom()>e.bottom()&&o.height()<=e.height()&&this.listContents.setBottom(o.bottom()),ListMorph.uber.setExtent.call(this,t)},StringFieldMorph.prototype=new FrameMorph,StringFieldMorph.prototype.constructor=StringFieldMorph,StringFieldMorph.uber=FrameMorph.prototype,StringFieldMorph.prototype.init=function(t,e,o,i,r,n,s){this.defaultContents=t,this.minWidth=e,this.fontSize=o,this.fontStyle=i,this.isBold=r,this.isItalic=n,this.isNumeric=s||!1,this.text=null,StringFieldMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isEditable=!0,this.acceptsDrops=!1,this.drawNew()},StringFieldMorph.prototype.drawNew=function(){var t;t=this.text?this.string():this.defaultContents,this.text=null,this.children.forEach(function(t){t.destroy()}),this.children=[],this.text=new StringMorph(t,this.fontSize,this.fontStyle,this.isBold,this.isItalic,this.isNumeric),this.text.isNumeric=this.isNumeric,this.text.setPosition(this.bounds.origin.copy()),this.text.isEditable=this.isEditable,this.text.isDraggable=!1,this.text.enableSelecting(),this.silentSetExtent(new Point(Math.max(this.width(),this.minWidth),this.text.height())),StringFieldMorph.uber.drawNew.call(this),this.add(this.text)},StringFieldMorph.prototype.string=function(){return this.text.text},StringFieldMorph.prototype.mouseClickLeft=function(t){this.isEditable?this.text.edit():this.escalateEvent("mouseClickLeft",t)},StringFieldMorph.prototype.copyRecordingReferences=function(t){var e=StringFieldMorph.uber.copyRecordingReferences.call(this,t);return e.text&&t[this.text]&&(e.text=t[this.text]),e};var BouncerMorph;BouncerMorph.prototype=new Morph,BouncerMorph.prototype.constructor=BouncerMorph,BouncerMorph.uber=Morph.prototype,BouncerMorph.prototype.init=function(t,e){BouncerMorph.uber.init.call(this),this.fps=50,this.isStopped=!1,this.type=t||"vertical",this.direction="vertical"===this.type?"down":"right",this.speed=e||1},BouncerMorph.prototype.moveUp=function(){this.moveBy(new Point(0,-this.speed))},BouncerMorph.prototype.moveDown=function(){this.moveBy(new Point(0,this.speed))},BouncerMorph.prototype.moveRight=function(){this.moveBy(new Point(this.speed,0))},BouncerMorph.prototype.moveLeft=function(){this.moveBy(new Point(-this.speed,0))},BouncerMorph.prototype.step=function(){this.isStopped||("vertical"===this.type?("down"===this.direction?this.moveDown():this.moveUp(),this.fullBounds().top()<this.parent.top()&&"up"===this.direction&&(this.direction="down"),this.fullBounds().bottom()>this.parent.bottom()&&"down"===this.direction&&(this.direction="up")):"horizontal"===this.type&&("right"===this.direction?this.moveRight():this.moveLeft(),this.fullBounds().left()<this.parent.left()&&"left"===this.direction&&(this.direction="right"),this.fullBounds().right()>this.parent.right()&&"right"===this.direction&&(this.direction="left")))},HandMorph.prototype=new Morph,HandMorph.prototype.constructor=HandMorph,HandMorph.uber=Morph.prototype,HandMorph.prototype.init=function(t){HandMorph.uber.init.call(this),this.bounds=new Rectangle,this.world=t,this.mouseButton=null,this.mouseOverList=[],this.mouseDownMorph=null,this.morphToGrab=null,this.grabOrigin=null,this.temporaries=[],this.touchHoldTimeout=null},HandMorph.prototype.changed=function(){var t;null!==this.world&&(t=this.fullBounds(),t.extent().eq(new Point)||this.world.broken.push(this.fullBounds().spread()))},HandMorph.prototype.morphAtPointer=function(){var t=this.world.allChildren().slice(0).reverse(),e=this,o=null;return t.forEach(function(t){!t.visibleBounds().containsPoint(e.bounds.origin)||null!==o||!t.isVisible||!t.noticesTransparentClick&&t.isTransparentAt(e.bounds.origin)||t instanceof ShadowMorph||!t.allParents().every(function(t){return t.isVisible})||(o=t)}),null!==o?o:this.world},HandMorph.prototype.allMorphsAtPointer=function(){var t=this.world.allChildren(),e=this;return t.filter(function(t){return t.isVisible&&t.visibleBounds().containsPoint(e.bounds.origin)})},HandMorph.prototype.dropTargetFor=function(t){for(var e=this.morphAtPointer();!e.wantsDropOf(t);)e=e.parent;return e},HandMorph.prototype.grab=function(t){var e=t.parent;return t instanceof WorldMorph?null:void(0===this.children.length&&(this.world.stopEditing(),this.grabOrigin=t.situation(),t.addShadow(),t.prepareToBeGrabbed&&t.prepareToBeGrabbed(this),this.add(t),this.changed(),e&&e.reactToGrabOf&&e.reactToGrabOf(t)))},HandMorph.prototype.drop=function(){var t,e;0!==this.children.length&&(e=this.children[0],t=this.dropTargetFor(e),this.changed(),t.add(e),e.changed(),e.removeShadow(),this.children=[],this.setExtent(new Point),e.justDropped&&e.justDropped(this),t.reactToDropOf&&t.reactToDropOf(e,this),this.dragOrigin=null)},HandMorph.prototype.processMouseDown=function(t){var e,o,i;if(this.destroyTemporaries(),this.morphToGrab=null,0!==this.children.length)this.drop(),this.mouseButton=null;else{for(e=this.morphAtPointer(),this.world.activeMenu&&(contains(e.allParents(),this.world.activeMenu)?clearInterval(this.touchHoldTimeout):this.world.activeMenu.destroy()),this.world.activeHandle&&e!==this.world.activeHandle&&this.world.activeHandle.destroy(),this.world.cursor&&e!==this.world.cursor.target&&this.world.stopEditing(),e.mouseMove||(this.morphToGrab=e.rootForGrab()),2===t.button||t.ctrlKey?(this.mouseButton="right",i="mouseDownRight",o="mouseClickRight"):(this.mouseButton="left",i="mouseDownLeft",o="mouseClickLeft"),this.mouseDownMorph=e;!this.mouseDownMorph[o];)this.mouseDownMorph=this.mouseDownMorph.parent;for(;!e[i];)e=e.parent;e[i](this.bounds.origin)}},HandMorph.prototype.processTouchStart=function(t){var e=this;MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),1===t.touches.length&&(this.touchHoldTimeout=setInterval(function(){e.processMouseDown({button:2}),e.processMouseUp({button:2}),t.preventDefault(),clearInterval(e.touchHoldTimeout)},400),this.processMouseMove(t.touches[0]),this.processMouseDown({button:0}),t.preventDefault())},HandMorph.prototype.processTouchMove=function(t){if(MorphicPreferences.isTouchDevice=!0,1===t.touches.length){var e=t.touches[0];this.processMouseMove(e),clearInterval(this.touchHoldTimeout)}},HandMorph.prototype.processTouchEnd=function(t){MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),nop(t),this.processMouseUp({button:0})},HandMorph.prototype.processMouseUp=function(){var t,e,o,i=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{if("left"===this.mouseButton)o="mouseClickLeft";else if(o="mouseClickRight",this.mouseButton){for(t=i,e=t.contextMenu();!e&&t.parent;)t=t.parent,e=t.contextMenu();e&&e.popUpAtHand(this.world)}for(;!i[o];)i=i.parent;i[o](this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processDoubleClick=function(){var t=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{for(;t&&!t.mouseDoubleClick;)t=t.parent;t&&t.mouseDoubleClick(this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processMouseMove=function(t){var e,o,i,r,n,s=getDocumentPositionOf(this.world.worldCanvas),a=this;void 0===a.world.mousemovecounter||0===a.world.mousemovecounter?(a.world.mousemovecounter=1,e=new Point(t.pageX-s.x,t.pageY-s.y),this.setPosition(e),o=this.morphAtPointer().allParents(),0===this.children.length&&"left"===this.mouseButton&&(r=this.morphAtPointer(),i=r.rootForGrab(),r.mouseMove&&r.mouseMove(e),this.morphToGrab&&(this.morphToGrab.isDraggable?(i=this.morphToGrab,this.grab(i)):this.morphToGrab.isTemplate&&(i=this.morphToGrab.fullCopy(),i.isTemplate=!1,i.isDraggable=!0,this.grab(i),this.grabOrigin=this.morphToGrab.situation()),i&&(n=i.fullBounds(),n.containsPoint(e)||(this.bounds.origin=n.center(),this.grab(i),this.setPosition(e))))),this.mouseOverList.forEach(function(t){contains(o,t)||(t.mouseLeave&&t.mouseLeave(),t.mouseLeaveDragging&&a.mouseButton&&t.mouseLeaveDragging())}),o.forEach(function(t){contains(a.mouseOverList,t)||(t.mouseEnter&&t.mouseEnter(),t.mouseEnterDragging&&a.mouseButton&&t.mouseEnterDragging()),a.children.length>0&&t instanceof ScrollFrameMorph&&(t.bounds.insetBy(3*MorphicPreferences.scrollBarSize).containsPoint(a.bounds.origin)||t.startAutoScrolling())}),this.mouseOverList=o):a.world.mousemovecounter=(a.world.mousemovecounter+1)%4},HandMorph.prototype.processMouseScroll=function(t){for(var e=this.morphAtPointer();e&&!e.mouseScroll;)e=e.parent;e&&e.mouseScroll(t.detail/-3||(Object.prototype.hasOwnProperty.call(t,"wheelDeltaY")?t.wheelDeltaY/120:t.wheelDelta/120),t.wheelDeltaX/120||0)},HandMorph.prototype.processDrop=function(t){function e(t){for(var e=new Image,o=new FileReader;!f.droppedSVG;)f=f.parent;e.onload=function(){f.droppedSVG(e,t.name)},o=new FileReader,o.onloadend=function(t){e.src=t.target.result},o.readAsDataURL(t)}function o(t){for(var e=new Image,o=new FileReader;!f.droppedImage;)f=f.parent;e.onload=function(){l=newCanvas(new Point(e.width,e.height)),l.getContext("2d").drawImage(e,0,0),f.droppedImage(l,t.name)},o=new FileReader,o.onloadend=function(t){e.src=t.target.result},o.readAsDataURL(t)}function i(t){for(var e=new Audio,o=new FileReader;!f.droppedAudio;)f=f.parent;o.onloadend=function(o){e.src=o.target.result,f.droppedAudio(e,t.name)},o.readAsDataURL(t)}function r(t){for(var e=new FileReader;!f.droppedText;)f=f.parent;e.onloadend=function(e){f.droppedText(e.target.result,t.name)},e.readAsText(t)}function n(t){for(var e=new FileReader;!f.droppedBinary;)f=f.parent;e.onloadend=function(e){f.droppedBinary(e.target.result,t.name)},e.readAsArrayBuffer(t)}function s(t){var e,o,i="",r=t.indexOf('<img src="');if(-1===r)return null;for(r+=10,e=r;e<t.length;e+=1){if(o=t[e],'"'===o)return i;i=i.concat(o)}return null}var a,h,l,p,c=t instanceof FileList?t:t.target.files||t.dataTransfer.files,d=t.dataTransfer?t.dataTransfer.getData("URL"):null,u=t.dataTransfer?t.dataTransfer.getData("Text/HTML"):null,f=this.morphAtPointer(),g=new Image;if(c.length>0)for(p=0;p<c.length;p+=1)a=c[p],-1===a.type.indexOf("svg")||MorphicPreferences.rasterizeSVGs?0===a.type.indexOf("image")?o(a):0===a.type.indexOf("audio")?i(a):0===a.type.indexOf("text")?r(a):n(a):e(a);else if(d){if(contains(["gif","png","jpg","jpeg","bmp"],d.slice(d.lastIndexOf(".")+1).toLowerCase())){for(;!f.droppedImage;)f=f.parent;g=new Image,g.onload=function(){l=newCanvas(new Point(g.width,g.height)),l.getContext("2d").drawImage(g,0,0),f.droppedImage(l)},g.src=d}}else if(u){for(;!f.droppedImage;)f=f.parent;g=new Image,g.onload=function(){l=newCanvas(new Point(g.width,g.height)),l.getContext("2d").drawImage(g,0,0),f.droppedImage(l)},h=s(u),h&&(g.src=h)}},HandMorph.prototype.destroyTemporaries=function(){var t=this;this.temporaries.forEach(function(e){e.isClickable&&e.bounds.containsPoint(t.position())||(e.destroy(),t.temporaries.splice(t.temporaries.indexOf(e),1))
})},HandMorph.prototype.moveBy=function(t){Morph.prototype.trackChanges=!1,HandMorph.uber.moveBy.call(this,t),Morph.prototype.trackChanges=!0,this.fullChanged()},WorldMorph.prototype=new FrameMorph,WorldMorph.prototype.constructor=WorldMorph,WorldMorph.uber=FrameMorph.prototype,WorldMorph.prototype.init=function(t,e){for(WorldMorph.uber.init.call(this),this.color=new Color(205,205,205),this.alpha=1,this.bounds=new Rectangle(0,0,t.width,t.height),this.drawNew(),this.isVisible=!0,this.isDraggable=!1,this.currentKey=null,this.worldCanvas=t,this.stamp=Date.now();this.stamp===Date.now();)nop();this.stamp=Date.now(),this.useFillPage=e,void 0===this.useFillPage&&(this.useFillPage=!0),this.isDevMode=!1,this.role="STUDENT",this.broken=[],this.hand=new HandMorph(this),this.keyboardReceiver=null,this.lastEditedText=null,this.cursor=null,this.activeMenu=null,this.activeHandle=null,this.virtualKeyboard=null,this.initEventListeners()},WorldMorph.prototype.brokenFor=function(t){var e=t.fullBounds();return this.broken.filter(function(t){return t.intersects(e)})},WorldMorph.prototype.fullDrawOn=function(t,e){WorldMorph.uber.fullDrawOn.call(this,t,e),this.hand.fullDrawOn(t,e)},WorldMorph.prototype.updateBroken=function(){var t=this;this.condenseDamages(),this.broken.forEach(function(e){e.extent().gt(new Point(0,0))&&t.fullDrawOn(t.worldCanvas,e)}),this.broken=[]},WorldMorph.prototype.condenseDamages=function(){function t(t){var e,o=[];return t.forEach(function(t){e=detect(o,function(e){return e.isNearTo(t,20)}),e?e.mergeWith(t):o.push(t)}),o}for(var e=!0,o=this.broken.length;e;)this.broken=t(this.broken),e=this.broken.length<o,o=this.broken.length},WorldMorph.prototype.doOneCycle=function(){this.stepFrame(),this.updateBroken()},WorldMorph.prototype.fillPage=function(){var t=getDocumentPositionOf(this.worldCanvas),e=window.innerHeight,o=window.innerWidth,i=this;t.x>0&&(this.worldCanvas.style.position="absolute",this.worldCanvas.style.left="0px",t.x=0),t.y>0&&(this.worldCanvas.style.position="absolute",this.worldCanvas.style.top="0px",t.y=0),document.documentElement.scrollTop&&(e=document.documentElement.clientHeight),document.documentElement.scrollLeft&&(o=document.documentElement.clientWidth),this.worldCanvas.width!==o&&(this.worldCanvas.width=o,this.setWidth(o)),this.worldCanvas.height!==e&&(this.worldCanvas.height=e,this.setHeight(e)),this.children.forEach(function(t){t.reactToWorldResize&&t.reactToWorldResize(i.bounds.copy())})},WorldMorph.prototype.getGlobalPixelColor=function(t){var e=this.worldCanvas.getContext("2d").getImageData(t.x,t.y,1,1).data;return new Color(e[0],e[1],e[2])},WorldMorph.prototype.initVirtualKeyboard=function(){var t=this;this.virtualKeyboard&&(document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard=document.createElement("input"),this.virtualKeyboard.type="text",this.virtualKeyboard.style.color="transparent",this.virtualKeyboard.style.backgroundColor="transparent",this.virtualKeyboard.style.border="none",this.virtualKeyboard.style.outline="none",this.virtualKeyboard.style.position="absolute",this.virtualKeyboard.style.top="0px",this.virtualKeyboard.style.left="0px",this.virtualKeyboard.style.width="0px",this.virtualKeyboard.style.height="0px",this.virtualKeyboard.autocapitalize="none",document.body.appendChild(this.virtualKeyboard),this.virtualKeyboard.addEventListener("keydown",function(e){t.currentKey=e.keyCode,t.keyboardReceiver&&t.keyboardReceiver.processKeyDown(e),("U+0008"===e.keyIdentifier||"Backspace"===e.keyIdentifier)&&e.preventDefault(),("U+0009"===e.keyIdentifier||"Tab"===e.keyIdentifier)&&(t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault())},!1),this.virtualKeyboard.addEventListener("keyup",function(e){t.currentKey=null,t.keyboardReceiver&&t.keyboardReceiver.processKeyUp&&t.keyboardReceiver.processKeyUp(e),e.preventDefault()},!1),this.virtualKeyboard.addEventListener("keypress",function(e){t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault()},!1))},WorldMorph.prototype.initEventListeners=function(){var t=this.worldCanvas,e=this;e.useFillPage?e.fillPage():this.changed(),t.addEventListener("mousedown",function(o){o.preventDefault(),t.focus(),e.hand.processMouseDown(o)},!1),t.addEventListener("touchstart",function(t){e.hand.processTouchStart(t)},!1),t.addEventListener("mouseup",function(t){t.preventDefault(),e.hand.processMouseUp(t)},!1),t.addEventListener("dblclick",function(t){t.preventDefault(),e.hand.processDoubleClick(t)},!1),t.addEventListener("touchend",function(t){e.hand.processTouchEnd(t)},!1),t.addEventListener("mousemove",function(t){e.hand.processMouseMove(t)},!1),t.addEventListener("touchmove",function(t){e.hand.processTouchMove(t)},!1),t.addEventListener("contextmenu",function(t){t.preventDefault()},!1),t.addEventListener("keydown",function(t){e.currentKey=t.keyCode,e.keyboardReceiver&&e.keyboardReceiver.processKeyDown(t),("U+0008"===t.keyIdentifier||"Backspace"===t.keyIdentifier)&&t.preventDefault(),("U+0009"===t.keyIdentifier||"Tab"===t.keyIdentifier)&&(e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault())},!1),t.addEventListener("keyup",function(t){e.currentKey=null,e.keyboardReceiver&&e.keyboardReceiver.processKeyUp&&e.keyboardReceiver.processKeyUp(t),t.preventDefault()},!1),t.addEventListener("keypress",function(t){e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()},!1),t.addEventListener("mousewheel",function(t){e.hand.processMouseScroll(t),t.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(t){e.hand.processMouseScroll(t),t.preventDefault()},!1),document.body.addEventListener("paste",function(t){var o=t.clipboardData.getData("Text");o&&e.cursor&&e.cursor.insert(o)},!1),window.addEventListener("dragover",function(t){t.preventDefault()},!1),window.addEventListener("drop",function(t){e.hand.processDrop(t),t.preventDefault()},!1),window.addEventListener("resize",function(){e.useFillPage&&e.fillPage()},!1)},WorldMorph.prototype.mouseDownLeft=function(){nop()},WorldMorph.prototype.mouseClickLeft=function(){nop()},WorldMorph.prototype.mouseDownRight=function(){nop()},WorldMorph.prototype.mouseClickRight=function(){nop()},WorldMorph.prototype.wantsDropOf=function(){return this.acceptsDrops},WorldMorph.prototype.droppedImage=function(){return null},WorldMorph.prototype.droppedSVG=function(){return null},WorldMorph.prototype.nextTab=function(t){var e=this.nextEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.previousTab=function(t){var e=this.previousEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.contextMenu=function(){var t;return t=this.isDevMode?new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]):new MenuMorph(this,"Morphic"),this.isDevMode&&(t.addItem("demo...","userCreateMorph","sample morphs"),t.addLine(),t.addItem("hide all...","hideAll"),t.addItem("show all...","showAllHiddens"),t.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"),t.addItem("inspect...","inspect","open a window on\nall properties"),t.addLine(),t.addItem("restore display","changed","redraw the\nscreen once"),t.addItem("fill page...","fillPage","let the World automatically\nadjust to browser resizings"),useBlurredShadows?t.addItem("sharp shadows...","toggleBlurredShadows","sharp drop shadows\nuse for old browsers"):t.addItem("blurred shadows...","toggleBlurredShadows","blurry shades,\n use for new browsers"),t.addItem("color...",function(){this.pickColor(t.title+"\ncolor:",this.setColor,this,this.color)},"choose the World's\nbackground color"),MorphicPreferences===standardSettings?t.addItem("touch screen settings","togglePreferences","bigger menu fonts\nand sliders"):t.addItem("standard settings","togglePreferences","smaller menu fonts\nand sliders"),t.addLine()),this.isDevMode?t.addItem("user mode...","toggleDevMode","disable developers'\ncontext menus"):t.addItem("development mode...","toggleDevMode"),t.addItem("about morphic.js...","about"),t},WorldMorph.prototype.userCreateMorph=function(){function t(t){t.isDraggable=!0,t.pickUp(i)}var e,o,i=this;e=new MenuMorph(this,"make a morph"),e.addItem("rectangle",function(){t(new Morph)}),e.addItem("box",function(){t(new BoxMorph)}),e.addItem("circle box",function(){t(new CircleBoxMorph)}),e.addLine(),e.addItem("slider",function(){t(new SliderMorph)}),e.addItem("frame",function(){o=new FrameMorph,o.setExtent(new Point(350,250)),t(o)}),e.addItem("scroll frame",function(){o=new ScrollFrameMorph,o.contents.acceptsDrops=!0,o.contents.adjustBounds(),o.setExtent(new Point(350,250)),t(o)}),e.addItem("handle",function(){t(new HandleMorph)}),e.addLine(),e.addItem("string",function(){o=new StringMorph("Hello, World!"),o.isEditable=!0,t(o)}),e.addItem("text",function(){o=new TextMorph("Ich wei\xdf nicht, was soll es bedeuten, dass ich so traurig bin, ein M\xe4rchen aus uralten Zeiten, das kommt mir nicht aus dem Sinn. Die Luft ist k\xfchl und es dunkelt, und ruhig flie\xdft der Rhein; der Gipfel des Berges funkelt im Abendsonnenschein. Die sch\xf6nste Jungfrau sitzet dort oben wunderbar, ihr gold'nes Geschmeide blitzet, sie k\xe4mmt ihr goldenes Haar, sie k\xe4mmt es mit goldenem Kamme, und singt ein Lied dabei; das hat eine wundersame, gewalt'ge Melodei. Den Schiffer im kleinen Schiffe, ergreift es mit wildem Weh; er schaut nicht die Felsenriffe, er schaut nur hinauf in die H\xf6h'. Ich glaube, die Wellen verschlingen am Ende Schiffer und Kahn, und das hat mit ihrem Singen, die Loreley getan."),o.isEditable=!0,o.maxWidth=300,o.drawNew(),t(o)}),e.addItem("speech bubble",function(){o=new SpeechBubbleMorph("Hello, World!"),t(o)}),e.addLine(),e.addItem("gray scale palette",function(){t(new GrayPaletteMorph)}),e.addItem("color palette",function(){t(new ColorPaletteMorph)}),e.addItem("color picker",function(){t(new ColorPickerMorph)}),e.addLine(),e.addItem("sensor demo",function(){o=new MouseSensorMorph,o.setColor(new Color(230,200,100)),o.edge=35,o.border=15,o.borderColor=new Color(200,100,50),o.alpha=.2,o.setExtent(new Point(100,100)),t(o)}),e.addItem("animation demo",function(){var e,o,i,r,n;e=new BouncerMorph,e.setPosition(new Point(50,20)),e.setExtent(new Point(300,200)),e.alpha=.9,e.speed=3,o=new BouncerMorph,o.setColor(new Color(50,50,50)),o.setPosition(new Point(80,80)),o.setExtent(new Point(80,250)),o.type="horizontal",o.direction="right",o.alpha=.9,o.speed=5,i=new BouncerMorph,i.setColor(new Color(20,20,20)),i.setPosition(new Point(90,140)),i.setExtent(new Point(40,30)),i.type="horizontal",i.direction="right",i.speed=3,r=new BouncerMorph,r.setColor(new Color(200,20,20)),r.setPosition(new Point(90,140)),r.setExtent(new Point(20,20)),r.type="vertical",r.direction="up",r.speed=8,n=new BouncerMorph,n.setColor(new Color(20,200,20)),n.setPosition(new Point(120,140)),n.setExtent(new Point(20,20)),n.type="vertical",n.direction="down",n.speed=4,o.add(r),o.add(i),e.add(n),e.add(o),t(e)}),e.addItem("pen",function(){t(new PenMorph)}),i.customMorphs&&(e.addLine(),i.customMorphs().forEach(function(o){e.addItem(o.toString(),function(){t(o)})})),e.popUpAtHand(this)},WorldMorph.prototype.toggleDevMode=function(){this.isDevMode=!this.isDevMode},WorldMorph.prototype.hideAll=function(){this.children.forEach(function(t){t.hide()})},WorldMorph.prototype.showAllHiddens=function(){this.forAllChildren(function(t){t.isVisible||t.show()})},WorldMorph.prototype.about=function(){var t,e="";for(t in modules)Object.prototype.hasOwnProperty.call(modules,t)&&(e+="\n"+t+" ("+modules[t]+")");""!==e&&(e="\n\nmodules:\n\nmorphic ("+morphicVersion+")"+e),this.inform("morphic.js\n\na lively Web GUI\ninspired by Squeak\n"+morphicVersion+"\n\nwritten by Jens M\xf6nig\njens@moenig.org"+e)},WorldMorph.prototype.edit=function(t){var e=getDocumentPositionOf(this.worldCanvas);return t.isEditable?(this.cursor&&this.cursor.destroy(),this.lastEditedText&&this.lastEditedText.clearSelection(),this.cursor=new CursorMorph(t),t.parent.add(this.cursor),this.keyboardReceiver=this.cursor,this.initVirtualKeyboard(),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard.style.top=this.cursor.top()+e.y+"px",this.virtualKeyboard.style.left=this.cursor.left()+e.x+"px",this.virtualKeyboard.focus()),void(MorphicPreferences.useSliderForInput&&(t.parentThatIsA(MenuMorph)||this.slide(t)))):null},WorldMorph.prototype.slide=function(t){var e,o,i=parseFloat(t.text);isNaN(i)&&(i=0),e=new MenuMorph,o=new SliderMorph(i-25,i+25,i,10,"horizontal"),o.alpha=1,o.color=new Color(225,225,225),o.button.color=e.borderColor,o.button.highlightColor=o.button.color.copy(),o.button.highlightColor.b+=100,o.button.pressColor=o.button.color.copy(),o.button.pressColor.b+=150,o.silentSetHeight(MorphicPreferences.scrollBarSize),o.silentSetWidth(10*MorphicPreferences.menuFontSize),o.drawNew(),o.action=function(e){t.changed(),t.text=Math.round(e).toString(),t.drawNew(),t.changed(),t.escalateEvent("reactToSliderEdit",t)},e.items.push(o),e.popup(this,t.bottomLeft().add(new Point(0,5)))},WorldMorph.prototype.stopEditing=function(){this.cursor&&(this.lastEditedText=this.cursor.target,this.cursor.destroy(),this.cursor=null,this.lastEditedText.escalateEvent("reactToEdit",this.lastEditedText)),this.keyboardReceiver=null,this.virtualKeyboard&&(this.virtualKeyboard.blur(),document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),this.worldCanvas.focus()},WorldMorph.prototype.toggleBlurredShadows=function(){useBlurredShadows=!useBlurredShadows},WorldMorph.prototype.togglePreferences=function(){MorphicPreferences=MorphicPreferences===standardSettings?touchScreenSettings:standardSettings},modules.locale="2014-February-13";var Localizer,SnapTranslator=new Localizer;Localizer.prototype.translate=function(t){return Object.prototype.hasOwnProperty.call(this.dict[this.language],t)?this.dict[this.language][t]:t},Localizer.prototype.languages=function(){var t,e=[];for(t in this.dict)Object.prototype.hasOwnProperty.call(this.dict,t)&&e.push(t);return e.sort()},Localizer.prototype.languageName=function(t){return this.dict[t].language_name||t},Localizer.prototype.credits=function(){var t="",e=this;return this.languages().forEach(function(o){t=t+"\n"+e.languageName(o)+" ("+o+") - "+e.dict[o].language_translator+" - "+e.dict[o].last_changed}),t},Localizer.prototype.unload=function(){var t,e=["language_name","language_translator","last_changed"],o=this;this.languages().forEach(function(i){var r;if("en"!==i){t=o.dict[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&!contains(e,r)&&delete t[r]}})},SnapTranslator.dict.en={language_name:"English",language_translator:"Jens M\xf6nig","translator_e-mail":"jens@moenig.org",last_changed:"2012-10-16","file menu import hint":"load an exported project file\nor block library, a costume\nor a sound","settings menu prefer empty slots hint":"check to focus on empty slots\nwhen dragging & dropping reporters","costumes tab help":"import a picture from another web page or from\na file on your computer by dropping it here\n","block deletion dialog text":"Are you sure you want to delete this\ncustom block and all its instances?"},SnapTranslator.dict.de={language_name:"Deutsch",language_translator:"Jens M\xf6nig","translator_e-mail":"jens@moenig.org",last_changed:"2014-02-13"},SnapTranslator.dict.it={language_name:"Italiano",language_translator:"Stefano Federici","translator_e-mail":"s_federici@yahoo.com",last_changed:"2013-04-08"},SnapTranslator.dict.ja={language_name:"\u65e5\u672c\u8a9e",language_translator:"Kazuhiro Abe","translator_e-mail":"abee@squeakland.jp",last_changed:"2012-04-02"},SnapTranslator.dict.ja_HIRA={language_name:"\u306b\u307b\u3093\u3054",language_translator:"Kazuhiro Abe","translator_e-mail":"abee@squeakland.jp",last_changed:"2012-04-02"},SnapTranslator.dict.ko={language_name:"\ud55c\uad6d\uc5b4",language_translator:"Yunjae Jang","translator_e-mail":"yunjae.jang@inc.korea.ac.kr",last_changed:"2012-11-18"},SnapTranslator.dict.pt={language_name:"Portugu\xeas",language_translator:"Manuel Menezes de Sequeira","translator_e-mail":"mmsequeira@gmail.com",last_changed:"2014-01-12"},SnapTranslator.dict.cs={language_name:"\u010cesky",language_translator:"Michal Moc","translator_e-mail":"info@iguru.eu",last_changed:"2013-03-11"},SnapTranslator.dict.zh={language_name:"\u7b80\u4f53\u4e2d\u6587",language_translator:"\u9093\u6c5f\u534e","translator_e-mail":"djh@rhjxx.cn",last_changed:"2013-03-25"},SnapTranslator.dict.eo={language_name:"Esperanto",language_translator:"Sebastian Cyprych","translator_e-mail":"scy(\u0109e)epf.pl",last_changed:"2012-11-11"},SnapTranslator.dict.fr={language_name:"Fran\xe7ais",language_translator:"Jean-Jacques Valliet, Mark Rafter, Martin Quinson","translator_e-mail":"i.scool@mac.com",last_changed:"2014-02-04"},SnapTranslator.dict.si={language_name:"Sloven\u0161\u010dina",language_translator:"Sasa Divjak","translator_e-mail":"sasa.divjak@fri.uni-lj.si",last_changed:"2013-01-07"},SnapTranslator.dict.ru={language_name:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",language_translator:"Svetlana Ptashnaya","translator_e-mail":"svetlanap@berkeley.edu",last_changed:"2013-03-19"},SnapTranslator.dict.es={language_name:"Espa\xf1ol",language_translator:"V\xedctor Manuel Muratalla Morales","translator_e-mail":"victor.muratalla@yahoo.com",last_changed:"2013-03-25"},SnapTranslator.dict.nl={language_name:"Nederlands",language_translator:"Frank Sierens, Sjoerd Dirk Meijer","translator_e-mail":"frank.sierens@telenet.be, sjoerddirk@fromScratchEd.nl",last_changed:"2013-08-12"},SnapTranslator.dict.pl={language_name:"Polski",language_translator:"Witek Kranas","translator_e-mail":"witek@oeiizk.waw.pl",last_changed:"2013-08-05"},SnapTranslator.dict.tw={language_name:"\u7e41\u9ad4\u4e2d\u6587",language_translator:"cch","translator_e-mail":"cchuang2009@gmail.com",last_changed:"2013-8-14"},SnapTranslator.dict.no={language_name:"Norsk",language_translator:"Olav A Marschall","translator_e-mail":"mattebananer@gmail.com",last_changed:"2013-09-16"},SnapTranslator.dict.dk={language_name:"Dansk",language_translator:"FAB","translator_e-mail":"fab@nielsen.mail.dk",last_changed:"2013-09-16"},SnapTranslator.dict.el={language_name:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",language_translator:"Ino Samaras","translator_e-mail":"ino.samaras@berkeley.edu",last_changed:"2013-09-16"},SnapTranslator.dict.ca={language_name:"Catal\xe0",language_translator:"Bernat Romagosa Carrasquer","translator_e-mail":"tibabenfortlapalanca@gmail.com",last_changed:"2013-11-26"},modules.widgets="2014-February-13";var PushButtonMorph,ToggleButtonMorph,TabMorph,ToggleMorph,ToggleElementMorph,DialogBoxMorph,AlignmentMorph,InputFieldMorph;PushButtonMorph.prototype=new TriggerMorph,PushButtonMorph.prototype.constructor=PushButtonMorph,PushButtonMorph.uber=TriggerMorph.prototype,PushButtonMorph.prototype.fontSize=10,PushButtonMorph.prototype.fontStyle="sans-serif",PushButtonMorph.prototype.labelColor=new Color(0,0,0),PushButtonMorph.prototype.labelShadowColor=new Color(255,255,255),PushButtonMorph.prototype.labelShadowOffset=new Point(1,1),PushButtonMorph.prototype.color=new Color(220,220,220),PushButtonMorph.prototype.pressColor=new Color(115,180,240),PushButtonMorph.prototype.highlightColor=PushButtonMorph.prototype.pressColor.lighter(50),PushButtonMorph.prototype.outlineColor=new Color(30,30,30),PushButtonMorph.prototype.outlineGradient=!1,PushButtonMorph.prototype.contrast=60,PushButtonMorph.prototype.edge=2,PushButtonMorph.prototype.corner=5,PushButtonMorph.prototype.outline=1.00001,PushButtonMorph.prototype.padding=3,PushButtonMorph.prototype.init=function(t,e,o,i,r,n){this.is3D=!1,this.target=t||null,this.action=e||null,this.environment=i||null,this.labelString=o||null,this.label=null,this.labelMinExtent=new Point(0,0),this.hint=r||null,this.template=n||null,TriggerMorph.uber.init.call(this),this.color=PushButtonMorph.prototype.color,this.drawNew(),this.fixLayout()},PushButtonMorph.prototype.fixLayout=function(){if(null!==this.label){var t=2*this.padding+2*this.outline+2*this.edge;this.setExtent(new Point(Math.max(this.label.width(),this.labelMinExtent.x)+t,Math.max(this.label instanceof StringMorph?this.label.rawHeight():this.label.height(),this.labelMinExtent.y)+t)),this.label.setCenter(this.center())}},PushButtonMorph.prototype.mouseDownLeft=function(){PushButtonMorph.uber.mouseDownLeft.call(this),this.label&&this.label.setCenter(this.center().add(1))},PushButtonMorph.prototype.mouseClickLeft=function(){PushButtonMorph.uber.mouseClickLeft.call(this),this.label&&this.label.setCenter(this.center())},PushButtonMorph.prototype.mouseLeave=function(){PushButtonMorph.uber.mouseLeave.call(this),this.label&&this.label.setCenter(this.center())},PushButtonMorph.prototype.outlinePath=BoxMorph.prototype.outlinePath,PushButtonMorph.prototype.drawOutline=function(t){var e,o=MorphicPreferences.isFlat&&!this.is3D;return!this.outline||o?null:(this.outlineGradient?(e=t.createLinearGradient(0,0,0,this.height()),e.addColorStop(1,"white"),e.addColorStop(0,this.outlineColor.darker().toString())):e=this.outlineColor.toString(),t.fillStyle=e,t.beginPath(),this.outlinePath(t,o?0:this.corner,0),t.closePath(),void t.fill())},PushButtonMorph.prototype.drawBackground=function(t,e){var o=MorphicPreferences.isFlat&&!this.is3D;t.fillStyle=e.toString(),t.beginPath(),this.outlinePath(t,o?0:Math.max(this.corner-this.outline,0),this.outline),t.closePath(),t.fill(),t.lineWidth=this.outline},PushButtonMorph.prototype.drawEdges=function(t,e,o,i){if(!MorphicPreferences.isFlat||this.is3D){var r,n=Math.max(this.corner,this.outline+this.edge),s=this.width(),a=this.height();r=t.createLinearGradient(0,this.outline,0,this.outline+this.edge),r.addColorStop(0,o.toString()),r.addColorStop(1,e.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(n,this.outline+this.edge/2),t.lineTo(s-n,this.outline+this.edge/2),t.stroke(),r=t.createRadialGradient(this.corner,this.corner,Math.max(this.corner-this.outline-this.edge,0),this.corner,this.corner,Math.max(this.corner-this.outline,0)),r.addColorStop(1,o.toString()),r.addColorStop(0,e.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.arc(this.corner,this.corner,Math.max(this.corner-this.outline-this.edge/2,0),radians(180),radians(270),!1),t.stroke(),r=t.createLinearGradient(this.outline,0,this.outline+this.edge,0),r.addColorStop(0,o.toString()),r.addColorStop(1,e.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(this.outline+this.edge/2,n),t.lineTo(this.outline+this.edge/2,a-n),t.stroke(),r=t.createLinearGradient(0,a-this.outline,0,a-this.outline-this.edge),r.addColorStop(0,i.toString()),r.addColorStop(1,e.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(n,a-this.outline-this.edge/2),t.lineTo(s-n,a-this.outline-this.edge/2),t.stroke(),r=t.createRadialGradient(s-this.corner,a-this.corner,Math.max(this.corner-this.outline-this.edge,0),s-this.corner,a-this.corner,Math.max(this.corner-this.outline,0)),r.addColorStop(1,i.toString()),r.addColorStop(0,e.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.arc(s-this.corner,a-this.corner,Math.max(this.corner-this.outline-this.edge/2,0),radians(0),radians(90),!1),t.stroke(),r=t.createLinearGradient(s-this.outline,0,s-this.outline-this.edge,0),r.addColorStop(0,i.toString()),r.addColorStop(1,e.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(s-this.outline-this.edge/2,n),t.lineTo(s-this.outline-this.edge/2,a-n),t.stroke()}},PushButtonMorph.prototype.createBackgrounds=function(){var t,e=this.extent();return this.template?(this.image=this.template.image,this.normalImage=this.template.normalImage,this.highlightImage=this.template.highlightImage,this.pressImage=this.template.pressImage,null):(this.normalImage=newCanvas(e),t=this.normalImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.color),this.drawEdges(t,this.color,this.color.lighter(this.contrast),this.color.darker(this.contrast)),this.highlightImage=newCanvas(e),t=this.highlightImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.highlightColor),this.drawEdges(t,this.highlightColor,this.highlightColor.lighter(this.contrast),this.highlightColor.darker(this.contrast)),this.pressImage=newCanvas(e),t=this.pressImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.pressColor),this.drawEdges(t,this.pressColor,this.pressColor.darker(this.contrast),this.pressColor.lighter(this.contrast)),void(this.image=this.normalImage))},PushButtonMorph.prototype.createLabel=function(){var t=!MorphicPreferences.isFlat||this.is3D;null!==this.label&&this.label.destroy(),this.labelString instanceof SymbolMorph?(this.label=this.labelString.fullCopy(),t&&(this.label.shadowOffset=this.labelShadowOffset,this.label.shadowColor=this.labelShadowColor),this.label.color=this.labelColor,this.label.drawNew()):this.label=new StringMorph(localize(this.labelString),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:null,this.labelShadowColor,this.labelColor),this.add(this.label)},ToggleButtonMorph.prototype=new PushButtonMorph,ToggleButtonMorph.prototype.constructor=ToggleButtonMorph,ToggleButtonMorph.uber=PushButtonMorph.prototype,ToggleButtonMorph.prototype.contrast=30,ToggleButtonMorph.prototype.init=function(t,e,o,i,r,n,s,a,h,l,p){this.state=!1,this.query=r||function(){return!0},this.minWidth=h||null,this.hasPreview=l||!1,this.isPicture=p||!1,this.trueStateLabel=null,ToggleButtonMorph.uber.init.call(this,e,o,i,n,s,a),t&&(this.color=t[0],this.highlightColor=t[1],this.pressColor=t[2]),this.refresh(),this.drawNew()},ToggleButtonMorph.prototype.mouseEnter=function(){this.state||(this.image=this.highlightImage,this.changed()),this.hint&&this.bubbleHelp(this.hint)},ToggleButtonMorph.prototype.mouseLeave=function(){this.state||(this.image=this.normalImage,this.changed()),this.hint&&this.world().hand.destroyTemporaries()},ToggleButtonMorph.prototype.mouseDownLeft=function(){this.state||(this.image=this.pressImage,this.changed())},ToggleButtonMorph.prototype.mouseClickLeft=function(){this.state||(this.image=this.highlightImage,this.changed()),this.trigger()},ToggleButtonMorph.prototype.trigger=function(){ToggleButtonMorph.uber.trigger.call(this),this.refresh()},ToggleButtonMorph.prototype.refresh=function(){this.state="function"==typeof this.query?this.query.call(this.target):this.target[this.query](),this.state?(this.image=this.pressImage,this.trueStateLabel&&(this.label.hide(),this.trueStateLabel.show())):(this.image=this.normalImage,this.trueStateLabel&&(this.label.show(),this.trueStateLabel.hide())),this.changed()},ToggleButtonMorph.prototype.fixLayout=function(){if(null!==this.label){var t=Math.max(this.label.width(),this.labelMinExtent.x),e=2*this.padding+2*this.outline+2*this.edge;this.setExtent(new Point(this.minWidth?Math.max(this.minWidth,t)+e:t+e,Math.max(this.label instanceof StringMorph?this.label.rawHeight():this.label.height(),this.labelMinExtent.y)+e)),this.label.setCenter(this.center()),this.trueStateLabel&&this.trueStateLabel.setCenter(this.center()),this.minWidth&&this.label.setLeft(this.left()+this.outline+this.edge+this.corner+this.padding)}},ToggleButtonMorph.prototype.createBackgrounds=function(){var t,e=this.extent();return this.template?(this.image=this.template.image,this.normalImage=this.template.normalImage,this.highlightImage=this.template.highlightImage,this.pressImage=this.template.pressImage,null):(this.normalImage=newCanvas(e),t=this.normalImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.color),this.drawEdges(t,this.color,this.color.lighter(this.contrast),this.color.darker(this.contrast)),this.highlightImage=newCanvas(e),t=this.highlightImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.highlightColor),this.drawEdges(t,this.highlightColor,this.highlightColor.lighter(this.contrast),this.highlightColor.darker(this.contrast)),this.pressImage=newCanvas(e),t=this.pressImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.pressColor),this.drawEdges(t,this.pressColor,this.pressColor.lighter(40),this.pressColor.darker(40)),void(this.image=this.normalImage))},ToggleButtonMorph.prototype.drawEdges=function(t,e,o,i){var r;if(ToggleButtonMorph.uber.drawEdges.call(this,t,e,o,i),this.hasPreview){if(MorphicPreferences.isFlat&&!this.is3D)return t.fillStyle=this.pressColor.toString(),void t.fillRect(this.outline,this.outline,this.corner,this.height()-2*this.outline);r=t.createLinearGradient(0,0,this.corner,0),r.addColorStop(0,this.pressColor.lighter(40).toString()),r.addColorStop(1,this.pressColor.darker(40).toString()),t.fillStyle=r,t.beginPath(),this.previewPath(t,Math.max(this.corner-this.outline,0),this.outline),t.closePath(),t.fill()}},ToggleButtonMorph.prototype.previewPath=function(t,e,o){var i=e+o,r=this.height();t.arc(i,i,e,radians(-180),radians(-90),!1),t.arc(i,r-i,e,radians(90),radians(180),!1)},ToggleButtonMorph.prototype.createLabel=function(){var t=!MorphicPreferences.isFlat||this.is3D,e=new Point;null!==this.label&&this.label.destroy(),null!==this.trueStateLabel&&this.trueStateLabel.destroy(),this.labelString instanceof Array&&2===this.labelString.length?this.labelString[0]instanceof SymbolMorph?(this.label=this.labelString[0].fullCopy(),this.trueStateLabel=this.labelString[1].fullCopy(),this.isPicture||(this.label.shadowOffset=t?this.labelShadowOffset:e,this.label.shadowColor=this.labelShadowColor,this.label.color=this.labelColor,this.label.drawNew(),this.trueStateLabel.shadowOffset=t?this.labelShadowOffset:e,this.trueStateLabel.shadowColor=this.labelShadowColor,this.trueStateLabel.color=this.labelColor,this.trueStateLabel.drawNew())):this.labelString[0]instanceof Morph?(this.label=this.labelString[0].fullCopy(),this.trueStateLabel=this.labelString[1].fullCopy()):(this.label=new StringMorph(localize(this.labelString[0]),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:null,this.labelShadowColor,this.labelColor),this.trueStateLabel=new StringMorph(localize(this.labelString[1]),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:null,this.labelShadowColor,this.labelColor)):this.labelString instanceof SymbolMorph?(this.label=this.labelString.fullCopy(),this.isPicture||(this.label.shadowOffset=t?this.labelShadowOffset:e,this.label.shadowColor=this.labelShadowColor,this.label.color=this.labelColor,this.label.drawNew())):this.label=this.labelString instanceof Morph?this.labelString.fullCopy():new StringMorph(localize(this.labelString),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:e,this.labelShadowColor,this.labelColor),this.add(this.label),this.trueStateLabel&&this.add(this.trueStateLabel)},ToggleButtonMorph.prototype.hide=function(){this.isVisible=!1,this.changed()},ToggleButtonMorph.prototype.show=function(){this.isVisible=!0,this.changed()},TabMorph.prototype=new ToggleButtonMorph,TabMorph.prototype.constructor=TabMorph,TabMorph.uber=ToggleButtonMorph.prototype,TabMorph.prototype.fixLayout=function(){null!==this.label&&(this.setExtent(new Point(this.label.width()+2*this.padding+3*this.corner+2*this.edge,(this.label instanceof StringMorph?this.label.rawHeight():this.label.height())+2*this.padding+this.edge)),this.label.setCenter(this.center()))},TabMorph.prototype.refresh=function(){this.state&&this.parent&&this.parent.add(this),TabMorph.uber.refresh.call(this)},TabMorph.prototype.drawBackground=function(t,e){var o=this.width(),i=this.height(),r=this.corner;t.fillStyle=e.toString(),t.beginPath(),t.moveTo(0,i),t.bezierCurveTo(r,i,r,0,2*r,0),t.lineTo(o-2*r,0),t.bezierCurveTo(o-r,0,o-r,i,o,i),t.closePath(),t.fill()},TabMorph.prototype.drawOutline=function(){nop()},TabMorph.prototype.drawEdges=function(t,e,o,i){if(!MorphicPreferences.isFlat||this.is3D){var r,n=this.width(),s=this.height(),a=this.corner,h=this.edge,l=h/2;nop(e),r=t.createLinearGradient(0,0,n,0),r.addColorStop(0,o.toString()),r.addColorStop(1,i.toString()),t.strokeStyle=r,t.lineCap="round",t.lineWidth=h,t.beginPath(),t.moveTo(0,s+l),t.bezierCurveTo(a,s,a,0,2*a,l),t.lineTo(n-2*a,l),t.bezierCurveTo(n-a,0,n-a,s,n,s+l),t.stroke()}},ToggleMorph.prototype=new PushButtonMorph,ToggleMorph.prototype.constructor=ToggleMorph,ToggleMorph.uber=PushButtonMorph.prototype,ToggleMorph.prototype.init=function(t,e,o,i,r,n,s,a,h,l){this.padding=1,t=t||"checkbox",this.corner="checkbox"===t?0:fontHeight(this.fontSize)/2+this.outline+this.padding,this.state=!1,this.query=r||function(){return!0
},this.tick=null,this.captionString=i||null,this.labelAlignment="right",this.element=h||null,this.builder=l||null,this.toggleElement=null,ToggleMorph.uber.init.call(this,e,o,"checkbox"===t?"\u2713":"\u25cf",n,s,a),this.refresh(),this.drawNew()},ToggleMorph.prototype.fixLayout=function(){var t,e=2*this.padding+2*this.outline;null!==this.tick&&(this.silentSetHeight(this.tick.rawHeight()+e),this.silentSetWidth(this.tick.width()+e),this.setExtent(new Point(Math.max(this.width(),this.height()),Math.max(this.width(),this.height()))),this.tick.setCenter(this.center())),this.state?this.tick.show():this.tick.hide(),this.toggleElement&&"right"===this.labelAlignment&&(t=this.top()+(this.height()-this.toggleElement.height())/2,this.toggleElement.setPosition(new Point(this.right()+e,t))),null!==this.label&&(t=this.top()+(this.height()-this.label.height())/2,this.label.setPosition("right"===this.labelAlignment?new Point(this.toggleElement?this.toggleElement instanceof ToggleElementMorph?this.toggleElement.right():this.toggleElement.right()+e:this.right()+e,t):new Point(this.left()-this.label.width()-e,t)))},ToggleMorph.prototype.createLabel=function(){var t=!MorphicPreferences.isFlat||this.is3D;null===this.label&&this.captionString&&(this.label=new TextMorph(localize(this.captionString),this.fontSize,this.fontStyle,!0),this.add(this.label)),null===this.tick&&(this.tick=new StringMorph(localize(this.labelString),this.fontSize,this.fontStyle,!0,!1,!1,t?new Point(1,1):null,new Color(240,240,240)),this.add(this.tick)),null===this.toggleElement&&this.element&&(this.element instanceof Morph?this.toggleElement=new ToggleElementMorph(this.target,this.action,this.element,this.query,this.environment,this.hint,this.builder):this.element instanceof HTMLCanvasElement&&(this.toggleElement=new Morph,this.toggleElement.silentSetExtent(new Point(this.element.width,this.element.height)),this.toggleElement.image=this.element),this.add(this.toggleElement))},ToggleMorph.prototype.trigger=function(){ToggleMorph.uber.trigger.call(this),this.refresh()},ToggleMorph.prototype.refresh=function(){this.state="function"==typeof this.query?this.query.call(this.target):this.target[this.query](),this.state?this.tick.show():this.tick.hide(),this.toggleElement&&this.toggleElement.refresh&&this.toggleElement.refresh()},ToggleMorph.prototype.mouseDownLeft=function(){PushButtonMorph.uber.mouseDownLeft.call(this),this.tick&&this.tick.setCenter(this.center().add(1))},ToggleMorph.prototype.mouseClickLeft=function(){PushButtonMorph.uber.mouseClickLeft.call(this),this.tick&&this.tick.setCenter(this.center())},ToggleMorph.prototype.mouseLeave=function(){PushButtonMorph.uber.mouseLeave.call(this),this.tick&&this.tick.setCenter(this.center())},ToggleMorph.prototype.hide=ToggleButtonMorph.prototype.hide,ToggleMorph.prototype.show=ToggleButtonMorph.prototype.show,ToggleElementMorph.prototype=new TriggerMorph,ToggleElementMorph.prototype.constructor=ToggleElementMorph,ToggleElementMorph.uber=TriggerMorph.prototype,ToggleElementMorph.prototype.contrast=50,ToggleElementMorph.prototype.shadowOffset=new Point(2,2),ToggleElementMorph.prototype.shadowAlpha=.6,ToggleElementMorph.prototype.fontSize=10,ToggleElementMorph.prototype.inactiveColor=new Color(180,180,180),ToggleElementMorph.prototype.init=function(t,e,o,i,r,n,s,a){this.target=t||null,this.action=e||null,this.element=o,this.query=i||function(){return!0},this.environment=r||null,this.hint=n||null,this.builder=s||"nop",this.captionString=a||null,this.labelAlignment="right",this.state=!1,TriggerMorph.uber.init.call(this),this.color=o.color,this.createLabel()},ToggleElementMorph.prototype.createBackgrounds=function(){var t=!MorphicPreferences.isFlat||this.is3D;this.color=this.element.color,this.element.removeShadow(),this.element[this.builder](),t&&this.element.addShadow(this.shadowOffset,this.shadowAlpha),this.silentSetExtent(this.element.fullBounds().extent()),this.pressImage=this.element.fullImage(),this.element.removeShadow(),this.element.setColor(this.inactiveColor),this.element[this.builder](this.contrast),t&&this.element.addShadow(this.shadowOffset,0),this.normalImage=this.element.fullImage(),this.element.removeShadow(),this.element.setColor(this.color.lighter(this.contrast)),this.element[this.builder](this.contrast),t&&this.element.addShadow(this.shadowOffset,this.shadowAlpha),this.highlightImage=this.element.fullImage(),this.element.removeShadow(),this.element.setColor(this.color),this.element[this.builder](),this.image=this.normalImage},ToggleElementMorph.prototype.setColor=function(t){this.element.setColor(t),this.createBackgrounds(),this.refresh()},ToggleElementMorph.prototype.createLabel=function(){var t;this.captionString&&(this.label=new StringMorph(this.captionString,this.fontSize,this.fontStyle,!0),this.add(this.label),t=this.top()+(this.height()-this.label.height())/2,this.label.setPosition("right"===this.labelAlignment?new Point(this.right(),t):new Point(this.left()-this.label.width(),t)))},ToggleElementMorph.prototype.trigger=ToggleButtonMorph.prototype.trigger,ToggleElementMorph.prototype.refresh=ToggleButtonMorph.prototype.refresh,ToggleElementMorph.prototype.mouseEnter=ToggleButtonMorph.prototype.mouseEnter,ToggleElementMorph.prototype.mouseLeave=ToggleButtonMorph.prototype.mouseLeave,ToggleElementMorph.prototype.mouseDownLeft=ToggleButtonMorph.prototype.mouseDownLeft,ToggleElementMorph.prototype.mouseClickLeft=ToggleButtonMorph.prototype.mouseClickLeft,DialogBoxMorph.prototype=new Morph,DialogBoxMorph.prototype.constructor=DialogBoxMorph,DialogBoxMorph.uber=Morph.prototype,DialogBoxMorph.prototype.fontSize=12,DialogBoxMorph.prototype.titleFontSize=14,DialogBoxMorph.prototype.fontStyle="sans-serif",DialogBoxMorph.prototype.color=PushButtonMorph.prototype.color,DialogBoxMorph.prototype.titleTextColor=new Color(255,255,255),DialogBoxMorph.prototype.titleBarColor=PushButtonMorph.prototype.pressColor,DialogBoxMorph.prototype.contrast=40,DialogBoxMorph.prototype.corner=12,DialogBoxMorph.prototype.padding=14,DialogBoxMorph.prototype.titlePadding=6,DialogBoxMorph.prototype.buttonContrast=50,DialogBoxMorph.prototype.buttonFontSize=12,DialogBoxMorph.prototype.buttonCorner=12,DialogBoxMorph.prototype.buttonEdge=6,DialogBoxMorph.prototype.buttonPadding=0,DialogBoxMorph.prototype.buttonOutline=3,DialogBoxMorph.prototype.buttonOutlineColor=PushButtonMorph.prototype.color,DialogBoxMorph.prototype.buttonOutlineGradient=!0,DialogBoxMorph.prototype.instances={},DialogBoxMorph.prototype.init=function(t,e,o){this.is3D=!1,this.target=t||null,this.action=e||null,this.environment=o||null,this.key=null,this.labelString=null,this.label=null,this.head=null,this.body=null,this.buttons=null,DialogBoxMorph.uber.init.call(this),this.isDraggable=!0,this.color=PushButtonMorph.prototype.color,this.createLabel(),this.createButtons(),this.setExtent(new Point(300,150))},DialogBoxMorph.prototype.inform=function(t,e,o,i){var r=new TextMorph(e,this.fontSize,this.fontStyle,!0,!1,"center",null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255));this.key||(this.key="inform"+t+e),this.labelString=t,this.createLabel(),i&&this.setPicture(i),e&&this.addBody(r),this.addButton("ok","OK"),this.drawNew(),this.fixLayout(),this.popUp(o)},DialogBoxMorph.prototype.askYesNo=function(t,e,o,i){var r=new TextMorph(e,this.fontSize,this.fontStyle,!0,!1,"center",null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255));this.key||(this.key="decide"+t+e),this.labelString=t,this.createLabel(),i&&this.setPicture(i),this.addBody(r),this.addButton("ok","Yes"),this.addButton("cancel","No"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.popUp(o)},DialogBoxMorph.prototype.prompt=function(t,e,o,i,r,n,s,a,h,l){var p,c,d=new InputFieldMorph(e,s||!1,r||null,r?n||!1:!1);d.setWidth(250),s?(i&&(c=new AlignmentMorph("column",this.padding),i.setPosition(c.position()),c.add(i)),isNil(a)||isNil(h)||(p=new SliderMorph(100*a,100*h,100*parseFloat(e),(h-a)/10*100,"horizontal"),p.alpha=1,p.color=this.color.lighter(50),p.setHeight(.7*d.height()),p.setWidth(d.width()),p.action=function(t){l&&l(t/100),d.setContents(t/100),d.edit()},c||(c=new AlignmentMorph("column",this.padding)),c.add(p)),c&&(c.fixLayout(),this.setPicture(c),c.fixLayout())):i&&this.setPicture(i),this.reactToChoice=function(t){p&&(p.value=100*t,p.drawNew(),p.changed()),l&&l(t)},d.reactToKeystroke=function(){var t=d.getValue();p&&(t=Math.max(t,a),p.value=100*t,p.drawNew(),p.changed()),l&&l(t)},this.labelString=t,this.createLabel(),this.key||(this.key="prompt"+t+e),this.addBody(d),d.drawNew(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.popUp(o)},DialogBoxMorph.prototype.promptCode=function(t,e,o,i,r){function n(t){return new TextMorph(localize(t),10,null,!1,null,null,null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255))}var s=new ScrollFrameMorph,a=new TextMorph(e||""),h=new AlignmentMorph("column",this.padding),l=i?Math.max(i.width,400):400;this.getInput=function(){return a.text},s.padding=6,s.setWidth(l),s.acceptsDrops=!1,s.contents.acceptsDrops=!1,a.fontName="monospace",a.fontStyle="monospace",a.fontSize=11,a.setPosition(s.topLeft().add(s.padding)),a.enableSelecting(),a.isEditable=!0,s.setHeight(l/4),s.fixLayout=nop,s.edge=InputFieldMorph.prototype.edge,s.fontSize=InputFieldMorph.prototype.fontSize,s.typeInPadding=InputFieldMorph.prototype.typeInPadding,s.contrast=InputFieldMorph.prototype.contrast,s.drawNew=InputFieldMorph.prototype.drawNew,s.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,s.addContents(a),a.drawNew(),i&&this.setPicture(i),this.labelString=t,this.createLabel(),this.key||(this.key="promptCode"+t+e),h.setColor(this.color),h.add(s),r&&h.add(n(r)),h.fixLayout(),this.addBody(h),s.drawNew(),h.drawNew(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.popUp(o),a.edit()},DialogBoxMorph.prototype.promptVector=function(t,e,o,i,r,n,s,a){function h(t){return new TextMorph(localize(t),10,null,!1,null,null,null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255))}var l=new AlignmentMorph("row",4),p=new InputFieldMorph(e.x.toString(),!0),c=new InputFieldMorph(e.y.toString(),!0),d=new AlignmentMorph("column",2),u=new AlignmentMorph("column",2),f=new AlignmentMorph("column",2),g=new AlignmentMorph("column",this.padding);f.alignment="left",f.setColor(this.color),g.setColor(this.color),d.alignment="left",d.setColor(this.color),u.alignment="left",u.setColor(this.color),d.add(h(i)),d.add(p),u.add(h(r)),u.add(c),l.add(d),l.add(u),f.add(l),a&&g.add(h(a)),g.add(f),l.fixLayout(),d.fixLayout(),u.fixLayout(),f.fixLayout(),g.fixLayout(),this.labelString=t,this.createLabel(),s&&this.setPicture(s),this.addBody(g),l.drawNew(),d.drawNew(),p.drawNew(),u.drawNew(),c.drawNew(),g.fixLayout(),this.addButton("ok","OK"),o instanceof Point&&this.addButton(function(){p.setContents(o.x.toString()),c.setContents(o.y.toString())},"Default"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.edit=function(){p.edit()},this.getInput=function(){return new Point(p.getValue(),c.getValue())},this.key||(this.key="vector"+t),this.popUp(n)},DialogBoxMorph.prototype.promptCredentials=function(t,e,o,i,r,n,s,a,h,l){function p(t){return new TextMorph(localize(t),10,null,!1,null,null,null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255))}function c(t,e){var o=new PushButtonMorph(F,function(){window.open(e)},"  "+localize(t)+"  ");return o.fontSize=10,o.corner=F.buttonCorner,o.edge=F.buttonEdge,o.outline=F.buttonOutline,o.outlineColor=F.buttonOutlineColor,o.outlineGradient=F.buttonOutlineGradient,o.padding=F.buttonPadding,o.contrast=F.buttonContrast,o.drawNew(),o.fixLayout(),o}function d(){var t,e,o=(new Date).getFullYear()+(new Date).getMonth()/12,i=+g.getValue()||0,r=f.getValue();return r instanceof Array&&(r=r[0]),isNaN(i)&&(i=0),t=["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(r),isNaN(t)&&(t=0),e=i+t/12,o-e}function u(){function t(t,e){var o=new SpeechBubbleMorph(localize(e));o.isPointingRight=!1,o.drawNew(),o.popUp(a,t.leftCenter().subtract(new Point(o.width()+2,0))),t.edit&&t.edit()}var o,i,r=b.getValue();if("login"===e?o=[M,w]:"signup"===e?o=[M,f,g,b]:"changePassword"===e?o=[C,w,S]:"resetPassword"===e&&(o=[M]),i=detect(o,function(t){return!t.getValue()}))return t(i,"please fill out\nthis field"),!1;if("signup"===e){if(M.getValue().length<4)return t(M,"User name must be four\ncharacters or longer"),!1;if(r.indexOf(" ")>-1||-1===r.indexOf("@")||-1===r.indexOf("."))return t(b,"please provide a valid\nemail address"),!1}if("changePassword"===e){if(w.getValue().length<6)return t(w,"password must be six\ncharacters or longer"),!1;if(w.getValue()!==S.getValue())return t(S,"passwords do\nnot match"),!1}return"signup"!==e||v?!0:(t(y,"please agree to\nthe TOS"),!1)}var f,g,m,y,M=new InputFieldMorph,b=new InputFieldMorph,w=new InputFieldMorph,S=new InputFieldMorph,C=new InputFieldMorph,v=!1,x=new AlignmentMorph("row",4),k=new AlignmentMorph("column",2),B=new AlignmentMorph("column",2),P=new AlignmentMorph("column",2),T=new AlignmentMorph("row",4),I=new AlignmentMorph("column",this.padding),E={},L=(new Date).getFullYear(),D=L-20,F=this;for(f=new InputFieldMorph(null,!1,{January:["January"],February:["February"],March:["March"],April:["April"],May:["May"],June:["June"],July:["July"],August:["August"],September:["September"],October:["October"],November:["November"],December:["December"]},!0),L;L>D;L-=1)E[L.toString()+" "]=L;E[D+" "+localize("or before")]="< "+L,g=new InputFieldMorph(null,!1,E,!0),P.alignment="left",P.setColor(this.color),I.setColor(this.color),k.alignment="left",k.setColor(this.color),B.alignment="left",B.setColor(this.color),M.setWidth(200),f.setWidth(100),g.contents().minWidth=80,g.setWidth(80),b.setWidth(200),w.setWidth(200),S.setWidth(200),C.setWidth(200),w.contents().text.toggleIsPassword(),S.contents().text.toggleIsPassword(),C.contents().text.toggleIsPassword(),"login"===e&&(P.add(p("User name:")),P.add(M)),"signup"===e&&(P.add(p("User name:")),P.add(M),k.add(p("Birth date:")),k.add(f),B.add(p("year:")),B.add(g),x.add(k),x.add(B),P.add(x),m=p("foo"),P.add(m),P.add(b)),"login"===e&&(P.add(p("Password:")),P.add(w)),"changePassword"===e&&(P.add(p("Old password:")),P.add(C),P.add(p("New password:")),P.add(w),P.add(p("Repeat new password:")),P.add(S)),"resetPassword"===e&&(P.add(p("User name:")),P.add(M)),l&&I.add(p(l)),I.add(P),(o||r)&&I.add(T),o&&T.add(c(i,o)),r&&T.add(c(n,r)),s&&(y=new ToggleMorph("checkbox",this,function(){v=!v},s,function(){return v}),y.edge=this.buttonEdge/2,y.outline=this.buttonOutline/2,y.outlineColor=this.buttonOutlineColor,y.outlineGradient=this.buttonOutlineGradient,y.contrast=this.buttonContrast,y.drawNew(),y.fixLayout(),I.add(y)),x.fixLayout(),k.fixLayout(),B.fixLayout(),P.fixLayout(),T.fixLayout(),I.fixLayout(),this.labelString=t,this.createLabel(),h&&this.setPicture(h),this.addBody(I),M.drawNew(),x.drawNew(),k.drawNew(),f.drawNew(),B.drawNew(),g.drawNew(),w.drawNew(),S.drawNew(),C.drawNew(),b.drawNew(),I.fixLayout(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.accept=function(){u()&&DialogBoxMorph.prototype.accept.call(F)},this.edit=function(){"changePassword"===e?C.edit():M.edit()},this.getInput=function(){return{username:M.getValue(),email:b.getValue(),oldpassword:C.getValue(),password:w.getValue(),choice:v}},this.reactToChoice=function(){"signup"===e&&(m.changed(),m.text=d()<=13?"E-mail address of parent or guardian:":"E-mail address:",m.text=localize(m.text),m.drawNew(),m.changed())},this.reactToChoice(),this.key||(this.key="credentials"+t+e),this.popUp(a)},DialogBoxMorph.prototype.accept=function(){this.action&&("function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call()):this.target.call(this.environment,this.action):"function"==typeof this.action?this.action.call(this.target,this.getInput()):this.target[this.action](this.getInput())),this.destroy()},DialogBoxMorph.prototype.withKey=function(t){return this.key=t,this},DialogBoxMorph.prototype.popUp=function(t){t&&(this.key&&(this.instances[t.stamp]?(this.instances[t.stamp][this.key]&&this.instances[t.stamp][this.key].destroy(),this.instances[t.stamp][this.key]=this):(this.instances[t.stamp]={},this.instances[t.stamp][this.key]=this)),t.add(this),t.keyboardReceiver=this,this.setCenter(t.center()),this.edit())},DialogBoxMorph.prototype.destroy=function(){DialogBoxMorph.uber.destroy.call(this),this.key&&delete this.instances[this.key]},DialogBoxMorph.prototype.ok=function(){this.accept()},DialogBoxMorph.prototype.cancel=function(){this.destroy()},DialogBoxMorph.prototype.edit=function(){this.children.forEach(function(t){return t.edit?t.edit():void 0})},DialogBoxMorph.prototype.getInput=function(){return this.body instanceof InputFieldMorph?this.body.getValue():null},DialogBoxMorph.prototype.justDropped=function(t){t.world.keyboardReceiver=this,this.edit()},DialogBoxMorph.prototype.destroy=function(){var t=this.world();t.keyboardReceiver=null,t.hand.destroyTemporaries(),DialogBoxMorph.uber.destroy.call(this)},DialogBoxMorph.prototype.normalizeSpaces=function(t){var e,o,i="",r=!1;for(e=0;e<t.length;e+=1)o=t[e]," "===o?r&&(i+=o,r=!1):(i+=o,r=!0);return i.trim()},DialogBoxMorph.prototype.createLabel=function(){var t=!MorphicPreferences.isFlat||this.is3D;this.label&&this.label.destroy(),this.labelString&&(this.label=new StringMorph(localize(this.labelString),this.titleFontSize,this.fontStyle,!0,!1,!1,t?new Point(2,1):null,this.titleBarColor.darker(this.contrast)),this.label.color=this.titleTextColor,this.label.drawNew(),this.add(this.label))},DialogBoxMorph.prototype.createButtons=function(){this.buttons&&this.buttons.destroy(),this.buttons=new AlignmentMorph("row",this.padding),this.add(this.buttons)},DialogBoxMorph.prototype.addButton=function(t,e){var o=new PushButtonMorph(this,t||"ok","  "+localize(e||"OK")+"  ");return o.fontSize=this.buttonFontSize,o.corner=this.buttonCorner,o.edge=this.buttonEdge,o.outline=this.buttonOutline,o.outlineColor=this.buttonOutlineColor,o.outlineGradient=this.buttonOutlineGradient,o.padding=this.buttonPadding,o.contrast=this.buttonContrast,o.drawNew(),o.fixLayout(),this.buttons.add(o),o},DialogBoxMorph.prototype.setPicture=function(t){var e;t instanceof Morph?e=t:(e=new Morph,e.image=t,e.silentSetWidth(t.width),e.silentSetHeight(t.height)),this.addHead(e)},DialogBoxMorph.prototype.addHead=function(t){this.head&&this.head.destroy(),this.head=t,this.add(this.head)},DialogBoxMorph.prototype.addBody=function(t){this.body&&this.body.destroy(),this.body=t,this.add(this.body)},DialogBoxMorph.prototype.addShadow=function(){nop()},DialogBoxMorph.prototype.removeShadow=function(){nop()},DialogBoxMorph.prototype.fixLayout=function(){var t,e=fontHeight(this.titleFontSize)+2*this.titlePadding;this.head&&(this.head.setPosition(this.position().add(new Point(this.padding,e+this.padding))),this.silentSetWidth(this.head.width()+2*this.padding),this.silentSetHeight(this.head.height()+2*this.padding+e)),this.body&&(this.head?(this.body.setPosition(this.head.bottomLeft().add(new Point(0,this.padding))),this.silentSetWidth(Math.max(this.width(),this.body.width()+2*this.padding)),this.silentSetHeight(this.height()+this.body.height()+this.padding),t=this.width(),this.head.setLeft(this.left()+Math.round((t-this.head.width())/2)),this.body.setLeft(this.left()+Math.round((t-this.body.width())/2))):(this.body.setPosition(this.position().add(new Point(this.padding,e+this.padding))),this.silentSetWidth(this.body.width()+2*this.padding),this.silentSetHeight(this.body.height()+2*this.padding+e))),this.label&&(this.label.setCenter(this.center()),this.label.setTop(this.top()+(e-this.label.height())/2)),this.buttons&&this.buttons.children.length>0&&(this.buttons.fixLayout(),this.silentSetHeight(this.height()+this.buttons.height()+this.padding),this.buttons.setCenter(this.center()),this.buttons.setBottom(this.bottom()-this.padding))},DialogBoxMorph.prototype.shadowImage=function(t,e){var o,i,r,n,s,a=t||new Point(7,7),h=e||new Color(0,0,0);return o=this.extent(),i=this.image,r=newCanvas(o),s=r.getContext("2d"),s.drawImage(i,0,0),s.globalCompositeOperation="destination-out",s.drawImage(i,-a.x,-a.y),n=newCanvas(o),s=n.getContext("2d"),s.drawImage(r,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=h.toString(),s.fillRect(0,0,o.x,o.y),n},DialogBoxMorph.prototype.shadowImageBlurred=function(t,e){var o,i,r,n,s=t||new Point(7,7),a=this.shadowBlur,h=e||new Color(0,0,0);return o=this.extent().add(2*a),i=this.image,r=newCanvas(o),n=r.getContext("2d"),n.shadowOffsetX=s.x,n.shadowOffsetY=s.y,n.shadowBlur=a,n.shadowColor=h.toString(),n.drawImage(i,a-s.x,a-s.y),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.globalCompositeOperation="destination-out",n.drawImage(i,a-s.x,a-s.y),r},DialogBoxMorph.prototype.processKeyPress=function(){nop()},DialogBoxMorph.prototype.processKeyDown=function(t){switch(t.keyCode){case 13:this.ok();break;case 27:this.cancel();break;default:nop()}},DialogBoxMorph.prototype.drawNew=function(){this.fullChanged(),Morph.prototype.trackChanges=!1,DialogBoxMorph.uber.removeShadow.call(this),this.fixLayout();var t,e,o,i,r=this.width(),n=this.height(),s=Math.floor(fontHeight(this.titleFontSize)+2*this.titlePadding),a=this.corner/2,h=MorphicPreferences.isFlat&&!this.is3D;return this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),h?t.fillStyle=this.titleBarColor.toString():(e=t.createLinearGradient(0,0,0,s),e.addColorStop(0,this.titleBarColor.lighter(this.contrast/2).toString()),e.addColorStop(1,this.titleBarColor.darker(this.contrast).toString()),t.fillStyle=e),t.beginPath(),this.outlinePathTitle(t,h?0:this.corner),t.closePath(),t.fill(),t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePathBody(t,h?0:this.corner),t.closePath(),t.fill(),h?(DialogBoxMorph.uber.addShadow.call(this),Morph.prototype.trackChanges=!0,void this.fullChanged()):(e=t.createLinearGradient(0,n-this.corner,0,n),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast.toString())),t.lineWidth=this.corner,t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(this.corner,n-a),t.lineTo(this.corner+1,n-a),t.stroke(),e=t.createLinearGradient(0,n-this.corner,0,n),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast.toString())),t.lineWidth=this.corner,t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.moveTo(this.corner,n-a),t.lineTo(r-this.corner,n-a),t.stroke(),e=t.createLinearGradient(r-this.corner,0,r,0),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast).toString()),t.lineWidth=this.corner,t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.moveTo(r-a,s),t.lineTo(r-a,n-this.corner),t.stroke(),o=r-this.corner,i=n-this.corner,e=t.createRadialGradient(o,i,0,o,i,this.corner),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast.toString())),t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.arc(o,i,a,radians(90),radians(0),!0),t.stroke(),e=t.createLinearGradient(0,0,this.corner,0),e.addColorStop(1,this.color.toString()),e.addColorStop(0,this.color.lighter(this.contrast).toString()),t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.moveTo(a,s),t.lineTo(a,n-2*this.corner),t.stroke(),e=t.createLinearGradient(0,0,this.corner,0),e.addColorStop(1,this.color.toString()),e.addColorStop(0,this.color.lighter(this.contrast).toString()),t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(a,n-2*this.corner),t.lineTo(a,n-this.corner-a),t.stroke(),DialogBoxMorph.uber.addShadow.call(this),Morph.prototype.trackChanges=!0,void this.fullChanged())},DialogBoxMorph.prototype.outlinePathTitle=function(t,e){var o=this.width(),i=Math.ceil(fontHeight(this.titleFontSize))+2*this.titlePadding;t.arc(e,e,e,radians(-180),radians(-90),!1),t.arc(o-e,e,e,radians(-90),radians(-0),!1),t.lineTo(o,i),t.lineTo(0,i)},DialogBoxMorph.prototype.outlinePathBody=function(t,e){var o=this.width(),i=this.height(),r=Math.floor(fontHeight(this.titleFontSize))+2*this.titlePadding;t.moveTo(0,r),t.lineTo(o,r),t.arc(o-e,i-e,e,radians(0),radians(90),!1),t.arc(e,i-e,e,radians(90),radians(180),!1)},AlignmentMorph.prototype=new Morph,AlignmentMorph.prototype.constructor=AlignmentMorph,AlignmentMorph.uber=Morph.prototype,AlignmentMorph.prototype.init=function(t,e){this.orientation=t||"row",this.alignment="center",this.padding=e||0,this.respectHiddens=!1,AlignmentMorph.uber.init.call(this)},AlignmentMorph.prototype.drawNew=function(){this.image=newCanvas(new Point(1,1)),this.fixLayout()},AlignmentMorph.prototype.fixLayout=function(){var t,e=this,o=null;return 0===this.children.length?null:(this.children.forEach(function(i){var r,n=i.fullBounds();(i.isVisible||e.respectHiddens)&&(o?(r=o.fullBounds(),i.setPosition("row"===e.orientation?r.topRight().add(new Point(e.padding,(r.height()-n.height())/2)):r.bottomLeft().add(new Point("center"===e.alignment?(r.width()-n.width())/2:0,e.padding))),t=t.merge(n)):t=n,o=i)}),void(this.bounds=t))},InputFieldMorph.prototype=new Morph,InputFieldMorph.prototype.constructor=InputFieldMorph,InputFieldMorph.uber=Morph.prototype,InputFieldMorph.prototype.edge=2,InputFieldMorph.prototype.fontSize=12,InputFieldMorph.prototype.typeInPadding=2,InputFieldMorph.prototype.contrast=65,InputFieldMorph.prototype.init=function(t,e,o,i){var r=new StringFieldMorph(t||""),n=new ArrowMorph("down",0,Math.max(Math.floor(this.fontSize/6),1));this.choices=o||null,this.isReadOnly=i||!1,this.isNumeric=e||!1,r.alpha=0,r.fontSize=this.fontSize,r.drawNew(),this.oldContentsExtent=r.extent(),this.isNumeric=e||!1,InputFieldMorph.uber.init.call(this),this.color=new Color(255,255,255),this.add(r),this.add(n),r.isDraggable=!1,this.drawNew()},InputFieldMorph.prototype.contents=function(){return detect(this.children,function(t){return t instanceof StringFieldMorph})},InputFieldMorph.prototype.arrow=function(){return detect(this.children,function(t){return t instanceof ArrowMorph})},InputFieldMorph.prototype.setChoice=function(t){this.setContents(t),this.escalateEvent("reactToChoice",t)},InputFieldMorph.prototype.setContents=function(t){var e=this.contents();return e.text.text=t,void 0===t?null:(null===t?e.text.text="":t.toString&&(e.text.text=t.toString()),e.drawNew(),void e.changed())},InputFieldMorph.prototype.edit=function(){var t=this.contents();t.text.edit(),t.text.selectAll()},InputFieldMorph.prototype.setIsNumeric=function(t){var e;this.isNumeric=t,this.contents().isNumeric=t,this.contents().text.isNumeric=t,e=this.getValue(),this.isNumeric&&(e=parseFloat(e),isNaN(e)&&(e=null)),this.setContents(e)},InputFieldMorph.prototype.dropDownMenu=function(){var t,e=this.choices,o=new MenuMorph(this.setChoice,null,this,this.fontSize);if(e instanceof Function?e=e.call(this):isString(e)&&(e=this[e]()),!e)return null;if(o.addItem(" ",null),e instanceof Array)e.forEach(function(t){o.addItem(t[0],t[1])});else for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&("~"===t[0]?o.addLine():o.addItem(t,e[t]));return o.items.length>0?void o.popUpAtHand(this.world()):null},InputFieldMorph.prototype.fixLayout=function(){var t=this.contents(),e=this.arrow();return t?(t.isNumeric=this.isNumeric,t.isEditable=!this.isReadOnly,this.choices?(e.setSize(this.fontSize),e.show()):(e.setSize(0),e.hide()),this.silentSetHeight(t.height()+2*this.edge+2*this.typeInPadding),this.silentSetWidth(Math.max(t.minWidth+2*this.edge+2*this.typeInPadding,this.width())),t.setWidth(this.width()-this.edge-this.typeInPadding-(this.choices?e.width()+this.typeInPadding:0)),t.silentSetPosition(new Point(this.edge,this.edge).add(this.typeInPadding).add(this.position())),void e.silentSetPosition(new Point(this.right()-e.width()-this.edge,t.top()))):null},InputFieldMorph.prototype.mouseClickLeft=function(t){this.arrow().bounds.containsPoint(t)?this.dropDownMenu():this.isReadOnly?this.dropDownMenu():this.escalateEvent("mouseClickLeft",t)},InputFieldMorph.prototype.getValue=function(){var t,e=this.contents();return this.isNumeric&&(t=parseFloat(e.text),!isNaN(t))?t:this.normalizeSpaces(e.string())},InputFieldMorph.prototype.normalizeSpaces=DialogBoxMorph.prototype.normalizeSpaces,InputFieldMorph.prototype.drawNew=function(){var t,e;this.fixLayout(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.parent?(this.color=this.parent.color.eq(new Color(255,255,255))?this.parent.color.darker(.1*this.contrast):this.parent.color.lighter(.75*this.contrast),e=this.parent.color):e=new Color(120,120,120),t.fillStyle=this.color.toString(),this.cachedClr=e.toString(),this.cachedClrBright=e.lighter(this.contrast).toString(),this.cachedClrDark=e.darker(this.contrast).toString(),t.fillRect(this.edge,this.edge,this.width()-2*this.edge,this.height()-2*this.edge),this.drawRectBorder(t)},InputFieldMorph.prototype.drawRectBorder=function(t){var e,o=.5*this.edge;(!MorphicPreferences.isFlat||this.is3D)&&(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.shadowOffsetY=o,t.shadowBlur=4*this.edge,t.shadowColor=this.cachedClrDark,e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(this.edge,o),t.lineTo(this.width()-this.edge-o,o),t.stroke(),t.shadowOffsetY=0,e=t.createLinearGradient(0,0,this.edge,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(o,this.edge),t.lineTo(o,this.height()-this.edge-o),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createLinearGradient(0,this.height()-this.edge,0,this.height()),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.edge,this.height()-o),t.lineTo(this.width()-this.edge,this.height()-o),t.stroke(),e=t.createLinearGradient(this.width()-this.edge,0,this.width(),0),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.width()-o,this.edge),t.lineTo(this.width()-o,this.height()-this.edge),t.stroke())},modules.blocks="2014-February-11";var SyntaxElementMorph,BlockMorph,CommandBlockMorph,ReporterBlockMorph,ScriptsMorph,ArgMorph,CommandSlotMorph,CSlotMorph,InputSlotMorph,BooleanSlotMorph,ArrowMorph,ColorSlotMorph,HatBlockMorph,BlockHighlightMorph,MultiArgMorph,TemplateSlotMorph,FunctionSlotMorph,ReporterSlotMorph,RingMorph,RingCommandSlotMorph,RingReporterSlotMorph,SymbolMorph,CommentMorph,ArgLabelMorph,TextSlotMorph;WorldMorph.prototype.customMorphs=function(){return[]},SyntaxElementMorph.prototype=new Morph,SyntaxElementMorph.prototype.constructor=SyntaxElementMorph,SyntaxElementMorph.uber=Morph.prototype,SyntaxElementMorph.prototype.setScale=function(t){var e=Math.min(Math.max(t,1),25);this.scale=e,this.corner=3*e,this.rounding=9*e,this.edge=1.000001*e,this.inset=6*e,this.hatHeight=12*e,this.hatWidth=70*e,this.rfBorder=3*e,this.minWidth=0,this.dent=8*e,this.bottomPadding=3*e,this.cSlotPadding=4*e,this.typeInPadding=e,this.labelPadding=4*e,this.labelFontName="Verdana",this.labelFontStyle="sans-serif",this.fontSize=10*e,this.embossing=new Point(-1*Math.max(e/2,1),-1*Math.max(e/2,1)),this.labelWidth=450*e,this.labelWordWrap=!0,this.dynamicInputLabels=!0,this.feedbackColor=new Color(255,255,255),this.feedbackMinHeight=5,this.minSnapDistance=20,this.reporterDropFeedbackPadding=10*e,this.contrast=65,this.labelContrast=25,this.activeHighlight=new Color(153,255,213),this.errorHighlight=new Color(173,15,0),this.activeBlur=20,this.activeBorder=4,this.rfColor=new Color(120,120,120)},SyntaxElementMorph.prototype.setScale(1),SyntaxElementMorph.prototype.init=function(){this.cachedClr=null,this.cachedClrBright=null,this.cachedClrDark=null,this.isStatic=!1,SyntaxElementMorph.uber.init.call(this),this.defaults=[]},SyntaxElementMorph.prototype.parts=function(){var t=null;return this.nextBlock&&(t=this.nextBlock()),this.children.filter(function(e){return!(e===t||e instanceof ShadowMorph||e instanceof BlockHighlightMorph)})},SyntaxElementMorph.prototype.inputs=function(){return this.parts().filter(function(t){return t instanceof SyntaxElementMorph})},SyntaxElementMorph.prototype.allInputs=function(){var t=this;return this.allChildren().slice(0).reverse().filter(function(e){return e instanceof ArgMorph||e instanceof ReporterBlockMorph&&e!==t})},SyntaxElementMorph.prototype.allEmptySlots=function(){var t=[];return this instanceof RingMorph||this.children.forEach(function(e){e.isEmptySlot&&e.isEmptySlot()?t.push(e):e.allEmptySlots&&(t=t.concat(e.allEmptySlots()))
}),t},SyntaxElementMorph.prototype.replaceInput=function(t,e){var o,i=this.parentThatIsA(ScriptsMorph),r=e,n=this.children.indexOf(t),s=0;return-1===n&&e instanceof MultiArgMorph&&this.children.forEach(function(e){e instanceof ArgLabelMorph&&e.argMorph()===t&&(n=s),s+=1}),-1===n||null===i?null:(this.startLayout(),e.parent&&e.parent.removeChild(e),t instanceof MultiArgMorph&&(t.inputs().forEach(function(e){t.replaceInput(e,new InputSlotMorph)}),this.dynamicInputLabels&&(r=new ArgLabelMorph(e))),r.parent=this,this.children[n]=r,t instanceof ReporterBlockMorph?(!(t instanceof RingMorph)||t instanceof RingMorph&&t.contents())&&(i.add(t),t.moveBy(r.extent()),t.fixBlockColor()):t instanceof CommandSlotMorph&&(o=t.nestedBlock(),o&&(i.add(o),o.moveBy(r.extent()),o.fixBlockColor())),r instanceof MultiArgMorph||r instanceof ArgLabelMorph||r.constructor===CommandSlotMorph?(r.fixLayout(),this.fixLabelColor&&this.fixLabelColor()):(r.drawNew(),this.fixLayout()),void this.endLayout())},SyntaxElementMorph.prototype.silentReplaceInput=function(t,e){var o,i=this.children.indexOf(t);-1!==i&&(e.parent&&e.parent.removeChild(e),o=t instanceof MultiArgMorph&&this.dynamicInputLabels?new ArgLabelMorph(e):e,o.parent=this,this.children[i]=o,o instanceof MultiArgMorph||o instanceof ArgLabelMorph||o.constructor===CommandSlotMorph?(o.fixLayout(),this.fixLabelColor&&this.fixLabelColor()):(o.drawNew(),this.fixLayout()))},SyntaxElementMorph.prototype.revertToDefaultInput=function(t,e){var o=this.parts().indexOf(t),i=this.inputs().indexOf(t),r=new InputSlotMorph;-1!==o&&(this instanceof BlockMorph?(r=this.labelPart(this.parseSpec(this.blockSpec)[o]),r instanceof InputSlotMorph&&this.definition&&(r.setChoices.apply(r,this.definition.inputOptionsOfIdx(i)),r.setContents(this.definition.defaultValueOfInputIdx(i)))):this instanceof MultiArgMorph?r=this.labelPart(this.slotSpec):this instanceof ReporterSlotMorph&&(r=this.emptySlot())),e||-1!==i&&(r instanceof MultiArgMorph?(r.setContents(this.defaults),r.defaults=this.defaults):isNil(this.defaults[i])||r.setContents(this.defaults[i])),this.silentReplaceInput(t,r),r instanceof MultiArgMorph?r.refresh():r instanceof RingMorph&&r.fixBlockColor()},SyntaxElementMorph.prototype.isLocked=function(){return this.isStatic},SyntaxElementMorph.prototype.topBlock=function(){return this.parent&&this.parent.topBlock?this.parent.topBlock():this},SyntaxElementMorph.prototype.reactToGrabOf=function(t){var e,o=this.topBlock();t instanceof CommandBlockMorph&&(e=this.parentThatIsA(CommandSlotMorph),e&&(this.startLayout(),e.fixLayout(),this.endLayout())),o&&(o.allComments().forEach(function(t){t.align(o)}),o.getHighlight()&&o.addHighlight(o.removeHighlight()))},SyntaxElementMorph.prototype.bright=function(){return this.color.lighter(this.contrast).toString()},SyntaxElementMorph.prototype.dark=function(){return this.color.darker(this.contrast).toString()},SyntaxElementMorph.prototype.setColor=function(t){t&&(this.color.eq(t)||(this.color=t,this.drawNew(),this.children.forEach(function(t){t.drawNew(),t.changed()}),this.changed()))},SyntaxElementMorph.prototype.setLabelColor=function(t,e,o){this.children.forEach(function(i){i instanceof StringMorph&&!i.isProtectedLabel?(i.shadowOffset=o||i.shadowOffset,i.shadowColor=e||i.shadowColor,i.setColor(t)):(i instanceof MultiArgMorph||i instanceof ArgLabelMorph||i instanceof SymbolMorph&&!i.isProtectedLabel||i instanceof InputSlotMorph&&i.isReadOnly)&&i.setLabelColor(t,e,o)})},SyntaxElementMorph.prototype.fixBlockColor=function(t,e){this.children.forEach(function(o){o instanceof SyntaxElementMorph&&o.fixBlockColor(t,e)})},SyntaxElementMorph.prototype.labelPart=function(t){var e,o;if("%"===t[0]&&t.length>1&&"reportGetVar"!==this.selector){if(t.length>5&&"%mult"===t.slice(0,5))return e=new MultiArgMorph(t.slice(5)),e.addInput(),e;switch(t){case"%inputs":e=new MultiArgMorph("%s","with inputs"),e.isStatic=!1,e.canBeEmpty=!1;break;case"%scriptVars":e=new MultiArgMorph("%t",null,1,t),e.canBeEmpty=!1;break;case"%parms":e=new MultiArgMorph("%t","Input Names:",0,t),e.canBeEmpty=!1;break;case"%ringparms":e=new MultiArgMorph("%t","input names:",0,t);break;case"%cmdRing":e=new RingMorph,e.color=SpriteMorph.prototype.blockColor.other,e.selector="reifyScript",e.setSpec("%rc %ringparms"),e.isDraggable=!0;break;case"%repRing":e=new RingMorph,e.color=SpriteMorph.prototype.blockColor.other,e.selector="reifyReporter",e.setSpec("%rr %ringparms"),e.isDraggable=!0,e.isStatic=!0;break;case"%predRing":e=new RingMorph(!0),e.color=SpriteMorph.prototype.blockColor.other,e.selector="reifyPredicate",e.setSpec("%rp %ringparms"),e.isDraggable=!0,e.isStatic=!0;break;case"%words":e=new MultiArgMorph("%s",null,0),e.addInput(),e.addInput(),e.isStatic=!1;break;case"%exp":e=new MultiArgMorph("%s",null,0),e.addInput(),e.isStatic=!0,e.canBeEmpty=!1;break;case"%br":e=new Morph,e.setExtent(new Point(0,0)),e.isBlockLabelBreak=!0,e.getSpec=function(){return"%br"};break;case"%inputName":e=new ReporterBlockMorph,e.category="variables",e.color=SpriteMorph.prototype.blockColor.variables,e.setSpec(localize("Input name"));break;case"%s":e=new InputSlotMorph;break;case"%anyUE":e=new InputSlotMorph,e.isUnevaluated=!0;break;case"%txt":e=new InputSlotMorph,e.minWidth=1.7*e.height(),e.fixLayout();break;case"%mlt":e=new TextSlotMorph,e.fixLayout();break;case"%code":e=new TextSlotMorph,e.contents().fontName="monospace",e.contents().fontStyle="monospace",e.fixLayout();break;case"%obj":e=new ArgMorph("object");break;case"%n":e=new InputSlotMorph(null,!0);break;case"%dir":e=new InputSlotMorph(null,!0,{"(90) right":90,"(-90) left":-90,"(0) up":"0","(180) down":180}),e.setContents(90);break;case"%inst":e=new InputSlotMorph(null,!0,{"(1) Acoustic Grand":1,"(2) Bright Acoustic":2,"(3) Electric Grand":3,"(4) Honky Tonk":4,"(5) Electric Piano 1":5,"(6) Electric Piano 2":6,"(7) Harpsichord":7}),e.setContents(1);break;case"%month":e=new InputSlotMorph(null,!1,{January:["January"],February:["February"],March:["March"],April:["April"],May:["May"],June:["June"],July:["July"],August:["August"],September:["September"],October:["October"],November:["November"],December:["December"]},!0);break;case"%dates":e=new InputSlotMorph(null,!1,{year:["year"],month:["month"],date:["date"],"day of week":["day of week"],hour:["hour"],minute:["minute"],second:["second"],"time in milliseconds":["time in milliseconds"]},!0),e.setContents(["date"]);break;case"%delim":e=new InputSlotMorph(null,!1,{whitespace:["whitespace"],line:["line"],tab:["tab"],cr:["cr"]},!1);break;case"%ida":e=new InputSlotMorph(null,!0,{1:1,last:["last"],"~":null,all:["all"]}),e.setContents(1);break;case"%idx":e=new InputSlotMorph(null,!0,{1:1,last:["last"],any:["any"]}),e.setContents(1);break;case"%spr":e=new InputSlotMorph(null,!1,"objectsMenu",!0);break;case"%col":e=new InputSlotMorph(null,!1,"collidablesMenu",!0);break;case"%dst":e=new InputSlotMorph(null,!1,"distancesMenu",!0);break;case"%cln":e=new InputSlotMorph(null,!1,"clonablesMenu",!0);break;case"%cst":e=new InputSlotMorph(null,!1,"costumesMenu",!0);break;case"%eff":e=new InputSlotMorph(null,!1,{ghost:["ghost"]},!0),e.setContents(["ghost"]);break;case"%snd":e=new InputSlotMorph(null,!1,"soundsMenu",!0);break;case"%key":e=new InputSlotMorph(null,!1,{"up arrow":["up arrow"],"down arrow":["down arrow"],"right arrow":["right arrow"],"left arrow":["left arrow"],space:["space"],a:["a"],b:["b"],c:["c"],d:["d"],e:["e"],f:["f"],g:["g"],h:["h"],i:["i"],j:["j"],k:["k"],l:["l"],m:["m"],n:["n"],o:["o"],p:["p"],q:["q"],r:["r"],s:["s"],t:["t"],u:["u"],v:["v"],w:["w"],x:["x"],y:["y"],z:["z"],0:["0"],1:["1"],2:["2"],3:["3"],4:["4"],5:["5"],6:["6"],7:["7"],8:["8"],9:["9"]},!0),e.setContents(["space"]);break;case"%keyHat":e=this.labelPart("%key"),e.isStatic=!0;break;case"%msg":e=new InputSlotMorph(null,!1,"messagesMenu",!0);break;case"%msgHat":e=new InputSlotMorph(null,!1,"messagesReceivedMenu",!0),e.isStatic=!0;break;case"%att":e=new InputSlotMorph(null,!1,"attributesMenu",!0);break;case"%fun":e=new InputSlotMorph(null,!1,{abs:["abs"],floor:["floor"],sqrt:["sqrt"],sin:["sin"],cos:["cos"],tan:["tan"],asin:["asin"],acos:["acos"],atan:["atan"],ln:["ln"],"e^":["e^"]},!0),e.setContents(["sqrt"]);break;case"%txtfun":e=new InputSlotMorph(null,!1,{"encode URI":["encode URI"],"decode URI":["decode URI"],"encode URI component":["encode URI component"],"decode URI component":["decode URI component"],"XML escape":["XML escape"],"XML unescape":["XML unescape"],"hex sha512 hash":["hex sha512 hash"]},!0),e.setContents(["encode URI"]);break;case"%stopChoices":e=new InputSlotMorph(null,!1,{all:["all"],"this script":["this script"],"this block":["this block"]},!0),e.setContents(["all"]),e.isStatic=!0;break;case"%stopOthersChoices":e=new InputSlotMorph(null,!1,{"all but this script":["all but this script"],"other scripts in sprite":["other scripts in sprite"]},!0),e.setContents(["all but this script"]),e.isStatic=!0;break;case"%typ":e=new InputSlotMorph(null,!1,{number:["number"],text:["text"],Boolean:["Boolean"],list:["list"],command:["command"],reporter:["reporter"],predicate:["predicate"]},!0),e.setContents(["number"]);break;case"%var":e=new InputSlotMorph(null,!1,"getVarNamesDict",!0),e.isStatic=!0;break;case"%lst":e=new InputSlotMorph(null,!1,{list1:"list1",list2:"list2",list3:"list3"},!0);break;case"%codeKind":e=new InputSlotMorph(null,!1,{code:["code"],header:["header"]},!0),e.setContents(["code"]);break;case"%l":e=new ArgMorph("list");break;case"%b":case"%boolUE":e=new BooleanSlotMorph(null,!0);break;case"%cmd":e=new CommandSlotMorph;break;case"%rc":e=new RingCommandSlotMorph,e.isStatic=!0;break;case"%rr":e=new RingReporterSlotMorph,e.isStatic=!0;break;case"%rp":e=new RingReporterSlotMorph(!0),e.isStatic=!0;break;case"%c":e=new CSlotMorph,e.isStatic=!0;break;case"%cs":e=new CSlotMorph;break;case"%clr":e=new ColorSlotMorph,e.isStatic=!0;break;case"%t":e=new TemplateSlotMorph("a");break;case"%upvar":e=new TemplateSlotMorph("\u2191");break;case"%f":e=new FunctionSlotMorph;break;case"%r":e=new ReporterSlotMorph;break;case"%p":e=new ReporterSlotMorph(!0);break;case"%codeListPart":e=new InputSlotMorph(null,!1,{list:["list"],item:["item"],delimiter:["delimiter"]},!0);break;case"%codeListKind":e=new InputSlotMorph(null,!1,{collection:["collection"],variables:["variables"],parameters:["parameters"]},!0);break;case"%turtle":e=new SymbolMorph("turtle"),e.size=1.2*this.fontSize,e.color=new Color(255,255,255),e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;case"%turtleOutline":e=new SymbolMorph("turtleOutline"),e.size=this.fontSize,e.color=new Color(255,255,255),e.isProtectedLabel=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;case"%clockwise":e=new SymbolMorph("turnRight"),e.size=1.5*this.fontSize,e.color=new Color(255,255,255),e.isProtectedLabel=!1,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;case"%counterclockwise":e=new SymbolMorph("turnLeft"),e.size=1.5*this.fontSize,e.color=new Color(255,255,255),e.isProtectedLabel=!1,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;case"%greenflag":e=new SymbolMorph("flag"),e.size=1.5*this.fontSize,e.color=new Color(0,200,0),e.isProtectedLabel=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;case"%stop":e=new SymbolMorph("octagon"),e.size=1.5*this.fontSize,e.color=new Color(200,0,0),e.isProtectedLabel=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;case"%pause":e=new SymbolMorph("pause"),e.size=this.fontSize,e.color=new Color(160,80,0),e.isProtectedLabel=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();break;default:nop()}}else if("$"===t[0]&&t.length>1&&"reportGetVar"!==this.selector){if(o=t.slice(1).split("-"),!contains(SymbolMorph.prototype.names,o[0]))return e=new StringMorph(t),e.fontName=this.labelFontName,e.fontStyle=this.labelFontStyle,e.fontSize=this.fontSize,e.color=new Color(255,255,255),e.isBold=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew(),e;e=new SymbolMorph(o[0]),e.size=this.fontSize*(+o[1]||1.2),e.color=new Color(0===+o[2]?0:+o[2]||255,0===+o[3]?0:+o[3]||255,0===+o[4]?0:+o[4]||255),e.isProtectedLabel=o.length>2,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew()}else e=new StringMorph(t),e.fontName=this.labelFontName,e.fontStyle=this.labelFontStyle,e.fontSize=this.fontSize,e.color=new Color(255,255,255),e.isBold=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=MorphicPreferences.isFlat?new Point:this.embossing,e.drawNew();return e},SyntaxElementMorph.prototype.fixLayout=function(){var t,e,o,i,r,n=this.parts(),s=this,a=0,h=0,l=0,p=this.minWidth,c=[],d=[],u=this.isPrototype?1:Math.floor(fontHeight(this.fontSize)/3),f=this.extent();if(p+=this instanceof MultiArgMorph&&"%c"!==this.slotSpec?this.arrows().width():this instanceof ReporterBlockMorph?2*this.rounding+2*this.edge:4*this.corner+2*this.edge+3*this.inset+this.dent,this.nextBlock&&(t=this.nextBlock()),n.forEach(function(t){t instanceof CSlotMorph||"%c"===t.slotSpec?c.length>0?(d.push(c),d.push([t]),c=[],a=0):d.push([t]):t instanceof BlockHighlightMorph?nop():(t.isVisible&&(a+=t.fullBounds().width()+u),(a>s.labelWidth||t.isBlockLabelBreak)&&c.length>0&&(d.push(c),c=[],a=t.fullBounds().width()+u),c.push(t),t.isBlockLabelBreak&&(a=0))}),c.length>0&&d.push(c),this instanceof CommandBlockMorph?(e=this.top()+this.corner+this.edge,this instanceof HatBlockMorph&&(e+=this.hatHeight)):this instanceof ReporterBlockMorph?e=this.top()+2*this.edge:(this instanceof MultiArgMorph||this instanceof ArgLabelMorph)&&(e=this.top()),d.forEach(function(t){a=s.left()+s.edge+s.labelPadding,s instanceof RingMorph?a=s.left()+u:s.isPredicate?a=s.left()+s.rounding:(s instanceof MultiArgMorph||s instanceof ArgLabelMorph)&&(a=s.left()),e+=h,h=0,t.forEach(function(t){t instanceof CSlotMorph?(a-=s.labelPadding,s.isPredicate&&(a=s.left()+s.rounding),t.setColor(s.color),t.setPosition(new Point(a,e)),h=t.height()):(t.setPosition(new Point(a,e)),t.isBlockLabelBreak||("%c"===t.slotSpec?a+=t.width():t.isVisible&&(a+=t.fullBounds().width()+u)),l=Math.max(l,a),h=Math.max(h,t instanceof StringMorph?t.rawHeight():t.height()))}),t.forEach(function(t){t.moveBy(new Point(0,Math.floor((h-t.height())/2)))})}),e+=h,this.children.some(function(t){return t instanceof CSlotMorph})&&(r=this.bottomPadding,this instanceof ReporterBlockMorph&&!this.isPredicate&&(r=Math.max(this.bottomPadding,this.rounding-this.bottomPadding)),e+=r),this instanceof CommandBlockMorph?o=e-this.top()+2*this.corner:this instanceof ReporterBlockMorph?o=e-this.top()+2*this.edge:(this instanceof MultiArgMorph||this instanceof ArgLabelMorph)&&(o=e-this.top()),this.isPredicate?p=Math.max(p,l-this.left()+this.rounding):this instanceof MultiArgMorph||this instanceof ArgLabelMorph?p=Math.max(p,l-this.left()-u):(p=Math.max(p,l-this.left()+this.labelPadding-this.edge),n[n.length-1]instanceof MultiArgMorph&&1===d.length&&(p-=u),this instanceof HatBlockMorph&&(p=Math.max(p,1.5*this.hatWidth))),this.setExtent(new Point(p,o)),n.forEach(function(t){t instanceof CSlotMorph&&t.setWidth(s.isPredicate?p-2*s.rounding:p-s.edge)}),this.drawNew(),t&&t.setPosition(new Point(this.left(),this.bottom()-this.corner)),this instanceof CommandBlockMorph){if(this.height()!==f.y&&(i=this.parentThatIsA(CommandSlotMorph),i&&i.fixLayout()),this.width()!==f.x&&(i=this.parentThatIsAnyOf([ReporterBlockMorph,CommandSlotMorph,RingCommandSlotMorph]),i&&i.fixLayout()),i)return}else if(this instanceof ReporterBlockMorph&&this.parent&&this.parent.fixLayout)return this.parent.fixLayout();this.fixHighlight()},SyntaxElementMorph.prototype.fixHighlight=function(){var t=this.topBlock();t.getHighlight&&t.getHighlight()&&t.addHighlight(t.removeHighlight())},SyntaxElementMorph.prototype.evaluate=function(){return null},SyntaxElementMorph.prototype.isEmptySlot=function(){return!1},SyntaxElementMorph.prototype.showBubble=function(t){var e,o,i,r,n=!1,s=this.world();return void 0!==t&&s?(t instanceof ListWatcherMorph?(r=t,r.update(!0),r.step=t.update,r.isDraggable=!1,n=!0):t instanceof Morph?(i=t.fullImage(),r=new Morph,r.silentSetWidth(i.width),r.silentSetHeight(i.height),r.image=i):t instanceof Context?(i=t.image(),r=new Morph,r.silentSetWidth(i.width),r.silentSetHeight(i.height),r.image=i):"boolean"==typeof t?r=SpriteMorph.prototype.booleanMorph.call(null,t):isString(t)?(o=t.length>500?t.slice(0,500)+"...":t,r=new TextMorph(o,this.fontSize)):null===t?r=new TextMorph("",this.fontSize):0===t?r=new TextMorph("0",this.fontSize):t.toString&&(r=new TextMorph(t.toString(),this.fontSize)),e=new SpeechBubbleMorph(r,null,Math.max(this.rounding-2,6),0),void e.popUp(s,this.rightCenter().add(new Point(2,0)),n)):null},SyntaxElementMorph.prototype.mappedCode=function(t){var e=this.evaluate();return e instanceof BlockMorph?e.mappedCode(t):e},SyntaxElementMorph.prototype.startLayout=function(){this.topBlock().fullChanged(),Morph.prototype.trackChanges=!1},SyntaxElementMorph.prototype.endLayout=function(){Morph.prototype.trackChanges=!0,this.topBlock().fullChanged()},BlockMorph.prototype=new SyntaxElementMorph,BlockMorph.prototype.constructor=BlockMorph,BlockMorph.uber=SyntaxElementMorph.prototype,BlockMorph.prototype.zebraContrast=40,BlockMorph.prototype.snapSound=null,BlockMorph.prototype.toggleSnapSound=function(){null!==this.snapSound?this.snapSound=null:(BlockMorph.prototype.snapSound=document.createElement("audio"),BlockMorph.prototype.snapSound.src="click.wav"),CommentMorph.prototype.snapSound=BlockMorph.prototype.snapSound},BlockMorph.prototype.init=function(){this.selector=null,this.blockSpec="",this.comment=null,this.hidden=!1,this.wasHidden=!1,this.instantiationSpec=null,this.category=null,BlockMorph.uber.init.call(this),this.color=new Color(0,17,173),this.hide=function(){this.isVisible?(BlockMorph.uber.hide.call(this),this.acceptsDrops=!1):this.wasHidden=!0},this.show=function(){this.wasHidden?this.wasHidden=!1:(BlockMorph.uber.show.call(this),this.acceptsDrops=!0,this.fixLayout())}},BlockMorph.prototype.receiver=function(){for(var t=this.parent;t;){if(t.owner)return t.owner;t=t.parent}return null},BlockMorph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+' ("'+this.blockSpec.slice(0,30)+'...")'},BlockMorph.prototype.parseSpec=function(t){function e(t){"%"===t[0]&&t.length>1?(""!==r&&(i.push(r),r=""),i.push(t)):""!==r?r+=" "+t:r=t}var o,i=[],r="";return o=isString(t)?t.split(" "):[],0===o.length&&(o=[t]),this.labelWordWrap?o:(o.forEach(function(t){e(t)}),""!==r&&i.push(r),i)},BlockMorph.prototype.setSpec=function(t){var e,o=this,i=-1;t&&(this.parts().forEach(function(t){t.destroy()}),this.isPrototype&&this.add(this.placeHolder()),this.parseSpec(t).forEach(function(t){"%"===t[0]&&(i+=1),e=o.labelPart(t),o.add(e),e instanceof CommandSlotMorph||e.drawNew(),e instanceof RingMorph&&e.fixBlockColor(),(e instanceof MultiArgMorph||contains([CommandSlotMorph,RingCommandSlotMorph],e.constructor))&&e.fixLayout(),o.isPrototype&&o.add(o.placeHolder()),e instanceof InputSlotMorph&&o.definition&&e.setChoices.apply(e,o.definition.inputOptionsOfIdx(i))}),this.blockSpec=t,this.fixLayout())},BlockMorph.prototype.buildSpec=function(){var t=this;this.blockSpec="",this.parts().forEach(function(e){t.blockSpec+=e instanceof StringMorph?e.text:e instanceof ArgMorph?e.getSpec():e.isBlockLabelBreak?e.getSpec():"[undefined]",t.blockSpec+=" "}),this.blockSpec=this.blockSpec.trim()},BlockMorph.prototype.rebuild=function(t){this.setSpec(this.blockSpec),t&&this.inputs().forEach(function(e){e instanceof ReporterBlockMorph&&(e.setColor(e.color.lighter(t)),e.setSpec(e.blockSpec))})},BlockMorph.prototype.userMenu=function(){var t,e=new MenuMorph(this),o=this.world(),i=this;if(e.addItem("help...","showHelp"),"STUDENT"!==o.role){if(this.isTemplate)return this.parent instanceof SyntaxElementMorph||("evaluateCustomBlock"!==this.selector&&e.addItem("hide","hidePrimitive"),StageMorph.prototype.enableCodeMapping&&(e.addLine(),e.addItem("header mapping...","mapToHeader"),e.addItem("code mapping...","mapToCode"))),e;e.addLine(),"reportGetVar"===this.selector?(t=this.fullCopy(),t.addShadow(),e.addItem("rename...",function(){new DialogBoxMorph(i,i.setSpec,i).prompt("Variable name",i.blockSpec,o,t.fullImage(),InputSlotMorph.prototype.getVarNamesDict.call(i))})):SpriteMorph.prototype.blockAlternatives[this.selector]&&e.addItem("relabel...",function(){i.relabel(SpriteMorph.prototype.blockAlternatives[i.selector])}),e.addItem("hide",function(){this.hide()})}return e.addItem("duplicate",function(){this.fullCopy().pickUp(o)},"make a copy\nand pick it up"),this instanceof CommandBlockMorph&&this.nextBlock()&&e.addItem(this.thumbnail(.5,60,!1),function(){var t=this.fullCopy(),e=t.nextBlock();e&&e.destroy(),t.pickUp(o)},"only duplicate this block"),"STUDENT"!==o.role&&e.addItem("delete","userDestroy"),e.addItem("script pic...",function(){window.open(i.topBlock().fullImage().toDataURL())},"open a new window\nwith a picture of this script"),this.parentThatIsA(RingMorph)?(e.addLine(),e.addItem("unringify","unringify"),e):this.parent instanceof ReporterSlotMorph||this.parent instanceof CommandSlotMorph||this instanceof HatBlockMorph||this instanceof CommandBlockMorph&&this.topBlock()instanceof HatBlockMorph?e:(e.addLine(),e.addItem("ringify","ringify"),StageMorph.prototype.enableCodeMapping&&(e.addLine(),e.addItem("header mapping...","mapToHeader"),e.addItem("code mapping...","mapToCode")),e)},BlockMorph.prototype.developersMenu=function(){var t=BlockMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("delete block","deleteBlock"),t.addItem("spec...",function(){new DialogBoxMorph(this,this.setSpec,this).prompt(t.title+"\nspec",this.blockSpec,this.world())}),t},BlockMorph.prototype.hidePrimitive=function(){var t,e=this.parentThatIsA(IDE_Morph);e&&(StageMorph.prototype.hiddenPrimitives[this.selector]=!0,t={doWarp:"control",reifyScript:"operators",reifyReporter:"operators",reifyPredicate:"operators",doDeclareVariables:"variables"}[this.selector]||this.category,"lists"===t&&(t="variables"),e.flushBlocksCache(t),e.refreshPalette())},BlockMorph.prototype.deleteBlock=function(){var t,e,o=this.parentThatIsA(ScriptsMorph),i=this.nextBlock?this.nextBlock():null;o&&(i&&o.add(i),this.inputs().forEach(function(t){t instanceof BlockMorph&&o.add(t)})),this instanceof ReporterBlockMorph?this.parent instanceof BlockMorph&&this.parent.revertToDefaultInput(this):this.parent?this.parent.fixLayout&&(t=this.parentThatIsA(ArgMorph)):e=!0,this.destroy(),e&&(this.isCorpse=!0),t&&t.fixLayout()},BlockMorph.prototype.ringify=function(){var t=new RingMorph,e=this.topBlock(),o=e.fullBounds().center();return null===this.parent?null:(this.parent instanceof SyntaxElementMorph?this instanceof ReporterBlockMorph?(this.parent.silentReplaceInput(this,t),t.embed(this)):e&&(e.parent.add(t),t.embed(e),t.setCenter(o)):(this.parent.add(t),t.embed(this),t.setCenter(o)),void this.fixBlockColor(null,!0))},BlockMorph.prototype.unringify=function(){var t,e,o=this.parentThatIsA(RingMorph),i=this.parentThatIsA(ScriptsMorph);return null===o?null:(t=o.contents(),e=o.center(),o.parent instanceof SyntaxElementMorph?t instanceof ReporterBlockMorph?o.parent.silentReplaceInput(o,t):i&&(i.add(t),t.setFullCenter(e),t.moveBy(20),o.parent.revertToDefaultInput(o)):(o.parent.add(t),t.setFullCenter(e),o.destroy()),void this.fixBlockColor(null,!0))},BlockMorph.prototype.relabel=function(t){var e=new MenuMorph(this),o=this.inputs(),i=this;t.forEach(function(t){var r=SpriteMorph.prototype.blockForSelector(t);r.restoreInputs(o),r.addShadow(new Point(3,3)),e.addItem(r,function(){i.setSelector(t)})}),e.popup(this.world(),this.bottomLeft().subtract(new Point(8,this instanceof CommandBlockMorph?this.corner:0)))},BlockMorph.prototype.setSelector=function(t){var e,o=this.inputs();e=SpriteMorph.prototype.blocks[t],this.category=e.category,this.selector=t,this.setSpec(localize(e.spec)),this.restoreInputs(o),this.fixLabelColor()},BlockMorph.prototype.restoreInputs=function(t){var e,o=0,i=this;this.inputs().forEach(function(r){e=t[o],e instanceof ReporterBlockMorph?i.silentReplaceInput(r,e.fullCopy()):e&&r instanceof InputSlotMorph&&r.setContents(e.contents().text),o+=1})},BlockMorph.prototype.showHelp=function(){var t,e,o,i,r=this,n=new Image,s="evaluateCustomBlock"===this.selector,a=s?this.definition.helpSpec():this.selector;n.onload=function(){t=newCanvas(new Point(n.width,n.height)),i=t.getContext("2d"),i.drawImage(n,0,0),(new DialogBoxMorph).inform("Help",null,r.world(),t)},s&&this.definition.comment?(o=this.fullCopy(),o.addShadow(),e=this.definition.comment.fullCopy(),e.contents.parse(),t="",e.contents.lines.forEach(function(e){t=t+"\n"+e}),(new DialogBoxMorph).inform("Help",t.substr(1),r.world(),o.fullImage())):(n.src=window.getAsset("help/"+SnapTranslator.language+"/"+a+".png"),n.onerror=function(){n.src=window.getAsset("help/en/"+a+".png")})},BlockMorph.prototype.mapToHeader=function(){var t,e,o="reify"===this.selector.substr(0,5)?"reify":this.selector,i=this.codeDefinitionHeader(),r=this;i.addShadow(new Point(3,3)),e=i.fullImageClassic(),t=this.definition?"Enter code that corresponds to the block's definition. Use the formal parameter\nnames as shown and <body> to reference the definition body's generated text code.":"Enter code that corresponds to the block's definition. Choose your own\nformal parameter names (ignoring the ones shown).",new DialogBoxMorph(this,function(t){"evaluateCustomBlock"===o?r.definition.codeHeader=t:StageMorph.prototype.codeHeaders[o]=t},this).promptCode("Header mapping","evaluateCustomBlock"===o?this.definition.codeHeader||"":StageMorph.prototype.codeHeaders[o]||"",this.world(),e,t)},BlockMorph.prototype.mapToCode=function(){var t,e="reify"===this.selector.substr(0,5)?"reify":this.selector,o=this.codeMappingHeader(),i=this;o.addShadow(new Point(3,3)),t=o.fullImageClassic(),new DialogBoxMorph(this,function(t){"evaluateCustomBlock"===e?i.definition.codeMapping=t:StageMorph.prototype.codeMappings[e]=t},this).promptCode("Code mapping","evaluateCustomBlock"===e?this.definition.codeMapping||"":StageMorph.prototype.codeMappings[e]||"",this.world(),t,"Enter code that corresponds to the block's operation (usually a single\nfunction invocation). Use <#n> to reference actual arguments as shown.")},BlockMorph.prototype.mapHeader=function(t,e){var o=e||"reify"===this.selector.substr(0,5)?"reify":this.selector;t&&(this.definition?this.definition.codeHeader=t:StageMorph.prototype.codeHeaders[o]=t)},BlockMorph.prototype.mapCode=function(t,e){var o=e||"reify"===this.selector.substr(0,5)?"reify":this.selector;t&&(this.definition?this.definition.codeMapping=t:StageMorph.prototype.codeMappings[o]=t)},BlockMorph.prototype.mappedCode=function(t){var e,o,i,r,n,s,a,h="reify"===this.selector.substr(0,5)?"reify":this.selector,l=1,p=this.definition?this.definition.spec:h,c=t||{},d=[];return e="reportGetVar"===h?this.blockSpec:this.definition?this.definition.codeMapping||"":StageMorph.prototype.codeMappings[h]||"","reportGetVar"===h||c.hasOwnProperty(p)||(c[p]=null,this.definition?(i=this.definition.codeHeader||"",-1!==i.indexOf("<body")&&(s="",this.definition.body&&(s=this.definition.body.expression.mappedCode(c)),a=s.split("\n"),n=i.split("\n"),n.forEach(function(t,e){var o,i="";0===t.trimLeft().indexOf("<body")&&(o=t.indexOf("<body"),i=t.slice(0,o)),n[e]=t.replace(new RegExp("<body>"),a.join("\n"+i)),n[e]=n[e].replace(new RegExp("<body>","g"),a.join("\n"))}),i=n.join("\n")),c[p]=i):c[p]=StageMorph.prototype.codeHeaders[p]),o=e.split("\n"),this.inputs().forEach(function(t){d.push(t.mappedCode(c).toString())}),d.forEach(function(t){var e=t.split("\n"),i="<#"+l+">",r=new RegExp(i,"g");o.forEach(function(t,n){var s,a="";0===t.trimLeft().indexOf(i)&&(s=t.indexOf(i),a=t.slice(0,s)),o[n]=t.replace(new RegExp(i),e.join("\n"+a)),o[n]=o[n].replace(r,e.join("\n"))}),l+=1}),e=o.join("\n"),this.nextBlock&&this.nextBlock()&&(e+="\n"+this.nextBlock().mappedCode(c)),!t&&(r=[],Object.keys(c).forEach(function(t){c[t]&&r.push(c[t])}),r.length)?r.join("\n\n")+"\n\n"+e:e},BlockMorph.prototype.codeDefinitionHeader=function(){var t=this.definition?new PrototypeHatBlockMorph(this.definition):SpriteMorph.prototype.blockForSelector(this.selector),e=new HatBlockMorph,o=1;return this.definition?t:(t.inputs().forEach(function(e){var i=new TemplateSlotMorph("#"+o);t.silentReplaceInput(e,i),o+=1}),t.isPrototype=!0,e.setCategory("control"),e.setSpec("%s"),e.silentReplaceInput(e.inputs()[0],t),"control"===this.category&&e.alternateBlockColor(),e)},BlockMorph.prototype.codeMappingHeader=function(){var t=this.definition?this.definition.blockInstance():SpriteMorph.prototype.blockForSelector(this.selector),e=new HatBlockMorph,o=1;return t.inputs().forEach(function(e){var i=new TemplateSlotMorph("<#"+o+">");t.silentReplaceInput(e,i),o+=1}),t.isPrototype=!0,e.setCategory("control"),e.setSpec("%s"),e.silentReplaceInput(e.inputs()[0],t),"control"===this.category&&e.alternateBlockColor(),e},BlockMorph.prototype.eraseHoles=function(t){var e,o,i=this,r=this instanceof ReporterBlockMorph,n=.5*this.edge,s=this.parts().filter(function(t){return t.isHole});this.isPredicate&&s.length>0&&(o=this.width()-this.rounding,t.clearRect(o,0,this.width(),this.height()),e=t.createLinearGradient(o-this.edge,0,this.width(),0),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.dark()),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(o-n,this.edge+n),t.lineTo(o-n,this.height()-this.edge-n),t.stroke()),s.forEach(function(e){var o=e.width(),n=Math.floor(e.height())-2;t.clearRect(Math.floor(e.bounds.origin.x-i.bounds.origin.x)+1,Math.floor(e.bounds.origin.y-i.bounds.origin.y)+1,r?o-1:o+1,n)})},BlockMorph.prototype.addHighlight=function(t){var e,o=!this.isVisible;return o&&this.show(),e=this.highlight(t?t.color:this.activeHighlight,this.activeBlur,this.activeBorder),this.addBack(e),this.fullChanged(),o&&this.hide(),e},BlockMorph.prototype.addErrorHighlight=function(){var t,e=!this.isVisible;return e&&this.show(),this.removeHighlight(),t=this.highlight(this.errorHighlight,this.activeBlur,this.activeBorder),this.addBack(t),this.fullChanged(),e&&this.hide(),t},BlockMorph.prototype.removeHighlight=function(){var t=this.getHighlight();return null!==t&&(this.fullChanged(),this.removeChild(t)),t},BlockMorph.prototype.toggleHighlight=function(){this.getHighlight()?this.removeHighlight():this.addHighlight()},BlockMorph.prototype.highlight=function(t,e,o){var i=new BlockHighlightMorph,r=this.fullBounds(),n=useBlurredShadows&&!MorphicPreferences.isFlat?e:o;return i.setExtent(r.extent().add(2*n)),i.color=t,i.image=useBlurredShadows&&!MorphicPreferences.isFlat?this.highlightImageBlurred(t,e):this.highlightImage(t,o),i.setPosition(r.origin.subtract(new Point(n,n))),i},BlockMorph.prototype.highlightImage=function(t,e){var o,i,r,n,s;return o=this.fullBounds().extent(),i=this.fullImage(),r=newCanvas(o.add(2*e)),n=r.getContext("2d"),n.drawImage(i,0,0),n.drawImage(i,e,0),n.drawImage(i,2*e,0),n.drawImage(i,2*e,e),n.drawImage(i,2*e,2*e),n.drawImage(i,e,2*e),n.drawImage(i,0,2*e),n.drawImage(i,0,e),n.globalCompositeOperation="destination-out",n.drawImage(i,e,e),s=newCanvas(o.add(2*e)),n=s.getContext("2d"),n.drawImage(r,0,0),n.globalCompositeOperation="source-atop",n.fillStyle=t.toString(),n.fillRect(0,0,s.width,s.height),s},BlockMorph.prototype.highlightImageBlurred=function(t,e){var o,i,r,n;return o=this.fullBounds().extent(),i=this.fullImage(),r=newCanvas(o.add(2*e)),n=r.getContext("2d"),n.shadowBlur=e,n.shadowColor=t.toString(),n.drawImage(i,e,e),n.shadowBlur=0,n.globalCompositeOperation="destination-out",n.drawImage(i,e,e),r},BlockMorph.prototype.getHighlight=function(){var t;return t=this.children.slice(0).reverse().filter(function(t){return t instanceof BlockHighlightMorph}),0!==t.length?t[0]:null},BlockMorph.prototype.fixBlockColor=function(t,e){var o,i,r=t;if(this.zebraContrast||e){if(!this.zebraContrast&&e)return this.forceNormalColoring();r||this.parent&&(this.isPrototype?r=null:this instanceof ReporterBlockMorph?r=this.parent.parentThatIsA(BlockMorph):(i=this.parentThatIsA(CommandSlotMorph),i&&(r=i.parentThatIsA(BlockMorph)))),r?r.category===this.category?r.color.eq(this.color)&&this.alternateBlockColor():this.category&&!this.color.eq(SpriteMorph.prototype.blockColor[this.category])&&this.alternateBlockColor():(o=SpriteMorph.prototype.blockColor[this.category],this.color.eq(o)||this.alternateBlockColor()),e&&this.fixChildrensBlockColor(!0)
}},BlockMorph.prototype.forceNormalColoring=function(){var t=SpriteMorph.prototype.blockColor[this.category];this.setColor(t),this.setLabelColor(new Color(255,255,255),t.darker(this.labelContrast),new Point(-1,-1)),this.fixChildrensBlockColor(!0)},BlockMorph.prototype.alternateBlockColor=function(){var t=SpriteMorph.prototype.blockColor[this.category];this.setColor(this.color.eq(t)?this.zebraContrast<0?t.darker(Math.abs(this.zebraContrast)):t.lighter(this.zebraContrast):t),this.fixLabelColor(),this.fixChildrensBlockColor(!0)},BlockMorph.prototype.fixLabelColor=function(){if(this.zebraContrast>0&&this.category){var t=SpriteMorph.prototype.blockColor[this.category];this.color.eq(t)?this.setLabelColor(new Color(255,255,255),t.darker(this.labelContrast),MorphicPreferences.isFlat?null:new Point(-1,-1)):this.setLabelColor(new Color(0,0,0),t.lighter(this.zebraContrast).lighter(2*this.labelContrast),MorphicPreferences.isFlat?null:new Point(1,1))}},BlockMorph.prototype.fixChildrensBlockColor=function(t){var e=this;this.children.forEach(function(o){o instanceof CommandBlockMorph?o.fixBlockColor(null,t):o instanceof SyntaxElementMorph&&o.fixBlockColor(e,t)})},BlockMorph.prototype.setCategory=function(t){this.category=t,this.startLayout(),this.fixBlockColor(),this.endLayout()},BlockMorph.prototype.fullCopy=function(){var t=BlockMorph.uber.fullCopy.call(this);return t.removeHighlight(),t.isDraggable=!0,this.instantiationSpec&&t.setSpec(this.instantiationSpec),t.allChildren().filter(function(t){return!isNil(t.comment)}).forEach(function(t){var e=t.comment.fullCopy();t.comment=e,e.block=t}),t},BlockMorph.prototype.mouseClickLeft=function(){var t,e=this.topBlock(),o=e.receiver();if("STUDENT"!==world.role){if(e instanceof PrototypeHatBlockMorph)return e.mouseClickLeft();o&&(t=o.parentThatIsA(StageMorph),t&&t.threads.toggleProcess(e))}},BlockMorph.prototype.thumbnail=function(t,e,o){var i,r,n,s,a=this.fullCopy(),h=a.nextBlock(),l=12;return h&&h.destroy(),o||a.addShadow(),i=a.fullBounds().extent(),o||(i=i.subtract(this.shadowBlur*(useBlurredShadows&&!MorphicPreferences.isFlat?1:2))),r=newCanvas(new Point(Math.min(i.x*t,e||i.x),i.y*t)),n=r.getContext("2d"),n.scale(t,t),n.drawImage(a.fullImage(),0,0),r.width===e&&(s=n.createLinearGradient(r.width/t-l,0,r.width/t,0),s.addColorStop(0,new Color(255,255,255,0).toString()),s.addColorStop(1,"white"),n.fillStyle=s,n.fillRect(r.width/t-l,0,r.width/t,r.height/t)),r},BlockMorph.prototype.rootForGrab=function(){return this},BlockMorph.prototype.wantsDropOf=function(t){return(t instanceof ArgMorph||t instanceof StringMorph||t instanceof TextMorph)&&!this.isTemplate},BlockMorph.prototype.reactToDropOf=function(t){t.isDraggable=!1,t instanceof InputSlotMorph?t.drawNew():t instanceof MultiArgMorph&&t.fixLayout(),this.fixLayout(),this.buildSpec()},BlockMorph.prototype.situation=function(){var t=this.parentThatIsA(ScriptsMorph);return t?{origin:t,position:this.position().subtract(t.position())}:BlockMorph.uber.situation.call(this)},BlockMorph.prototype.prepareToBeGrabbed=function(t){var e=this;this.allComments().forEach(function(o){o.startFollowing(e,t.world)})},BlockMorph.prototype.justDropped=function(){this.allComments().forEach(function(t){t.stopFollowing()})},BlockMorph.prototype.allComments=function(){return this.allChildren().filter(function(t){return!isNil(t.comment)}).map(function(t){return t.comment})},BlockMorph.prototype.destroy=function(){this.allComments().forEach(function(t){t.destroy()}),BlockMorph.uber.destroy.call(this)},BlockMorph.prototype.stackHeight=function(){var t=this.fullBounds(),e=Math.max(this.allComments().map(function(t){return t.bottom()}))||this.bottom();return Math.max(t.bottom(),e)-t.top()},BlockMorph.prototype.snap=function(){var t=this.topBlock();t.allComments().forEach(function(e){e.align(t)}),this.getHighlight()&&this!==t&&this.removeHighlight(),t.getHighlight()&&t.addHighlight(t.removeHighlight())},CommandBlockMorph.prototype=new BlockMorph,CommandBlockMorph.prototype.constructor=CommandBlockMorph,CommandBlockMorph.uber=BlockMorph.prototype,CommandBlockMorph.prototype.init=function(){CommandBlockMorph.uber.init.call(this),this.setExtent(new Point(200,100))},CommandBlockMorph.prototype.blockSequence=function(){var t=this.nextBlock(),e=[this];return t&&(e=e.concat(t.blockSequence())),e},CommandBlockMorph.prototype.bottomBlock=function(){return this.nextBlock()?this.nextBlock().bottomBlock():this},CommandBlockMorph.prototype.nextBlock=function(t){if(!t)return detect(this.children,function(t){return t instanceof CommandBlockMorph&&!t.isPrototype});var e=this.nextBlock(),o=this.parentThatIsA(CommandSlotMorph);this.add(t),e&&t.bottomBlock().nextBlock(e),this.fixLayout(),o&&o.fixLayout()},CommandBlockMorph.prototype.topAttachPoint=function(){return new Point(this.dentCenter(),this.top())},CommandBlockMorph.prototype.bottomAttachPoint=function(){return new Point(this.dentCenter(),this.bottom())},CommandBlockMorph.prototype.dentLeft=function(){return this.left()+this.corner+this.inset},CommandBlockMorph.prototype.dentCenter=function(){return this.dentLeft()+this.corner+.5*this.dent},CommandBlockMorph.prototype.attachTargets=function(){var t=[];return this instanceof HatBlockMorph||this.parent instanceof SyntaxElementMorph||t.push({point:this.topAttachPoint(),element:this,loc:"top",type:"block"}),this.isStop()||t.push({point:this.bottomAttachPoint(),element:this,loc:"bottom",type:"block"}),t},CommandBlockMorph.prototype.allAttachTargets=function(t){var e,o=this,i=t||this.parent,r=[];return e=i.children.filter(function(t){return t!==o&&t instanceof SyntaxElementMorph&&!t.isTemplate}),e.forEach(function(t){t.forAllChildren(function(t){t.attachTargets&&t.attachTargets().forEach(function(t){r.push(t)})})}),r},CommandBlockMorph.prototype.closestAttachTarget=function(t){var e,o=t||this.parent,i=this.bottomBlock(),r=null,n=Math.max(2*this.corner+this.dent,this.minSnapDistance),s=[],a=1e3;return this instanceof HatBlockMorph||s.push({point:this.topAttachPoint(),loc:"top"}),this.isStop()||s.push({point:i.bottomAttachPoint(),loc:"bottom"}),this.allAttachTargets(o).forEach(function(t){s.forEach(function(o){o.loc!==t.loc&&(e=o.point.distanceTo(t.point),n>e&&a>e&&t.element.isVisible&&(a=e,r=t))})}),r},CommandBlockMorph.prototype.snap=function(){var t,e,o,i=this.closestAttachTarget(),r=this.parentThatIsA(ScriptsMorph);return r.clearDropHistory(),r.lastDroppedBlock=this,null===i?(this.startLayout(),this.fixBlockColor(),this.endLayout(),void CommandBlockMorph.uber.snap.call(this)):(r.lastDropTarget=i,this.startLayout(),"bottom"===i.loc?("slot"===i.type?(this.removeHighlight(),r.lastNextBlock=i.element.nestedBlock(),i.element.nestedBlock(this)):(r.lastNextBlock=i.element.nextBlock(),i.element.nextBlock(this)),this.isStop()&&(t=this.nextBlock(),t&&(r.add(t),t.moveBy(this.extent().floorDivideBy(2)),o=this.parentThatIsA(CommandSlotMorph),o&&o.fixLayout()))):"top"===i.loc&&(i.element.removeHighlight(),e=this.bottomBlock().bottom()-this.bottom(),this.setBottom(i.element.top()+this.corner-e),this.setLeft(i.element.left()),this.bottomBlock().nextBlock(i.element)),this.fixBlockColor(),this.endLayout(),CommandBlockMorph.uber.snap.call(this),void(this.snapSound&&this.snapSound.play()))},CommandBlockMorph.prototype.isStop=function(){return["doStopThis","doStop","doStopBlock","doStopAll","doForever","doReport","removeClone"].indexOf(this.selector)>-1},CommandBlockMorph.prototype.userDestroy=function(){var t=this.parentThatIsA(CSlotMorph);this.destroy(),t&&t.fixLayout()},CommandBlockMorph.prototype.drawNew=function(){var t;this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,this.drawTop(t),this.drawBody(t),this.drawBottom(t),MorphicPreferences.isFlat?nop():(this.drawTopDentEdge(t,0,0),this.drawBottomDentEdge(t,0,this.height()-this.corner),this.drawLeftEdge(t),this.drawRightEdge(t),this.drawTopLeftEdge(t),this.drawBottomRightEdge(t)),this.eraseHoles(t)},CommandBlockMorph.prototype.drawBody=function(t){t.fillRect(0,Math.floor(this.corner),this.width(),this.height()-Math.floor(3*this.corner)+1)},CommandBlockMorph.prototype.drawTop=function(t){t.beginPath(),t.arc(this.corner,this.corner,this.corner,radians(-180),radians(-90),!1),this.drawDent(t,0,0),t.arc(this.width()-this.corner,this.corner,this.corner,radians(-90),radians(-0),!1),t.closePath(),t.fill()},CommandBlockMorph.prototype.drawBottom=function(t){var e=this.height()-2*this.corner;t.beginPath(),t.arc(this.corner,e,this.corner,radians(180),radians(90),!0),this.isStop()||this.drawDent(t,0,this.height()-this.corner),t.arc(this.width()-this.corner,e,this.corner,radians(90),radians(0),!0),t.closePath(),t.fill()},CommandBlockMorph.prototype.drawDent=function(t,e,o){var i=e+2*this.corner+this.inset;t.lineTo(e+this.corner+this.inset,o),t.lineTo(i,o+this.corner),t.lineTo(i+this.dent,o+this.corner),t.lineTo(e+3*this.corner+this.inset+this.dent,o),t.lineTo(this.width()-this.corner,o)},CommandBlockMorph.prototype.drawTopDentEdge=function(t,e,o){var i,r,n,s,a=.5*this.edge,h=e+2*this.corner+this.inset;t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",i=t.createLinearGradient(0,o,0,o+this.edge),i.addColorStop(0,this.cachedClrBright),i.addColorStop(1,this.cachedClr),t.strokeStyle=i,t.beginPath(),t.moveTo(this.corner,o+a),t.lineTo(e+this.corner+this.inset,o+a),t.stroke(),t.strokeStyle=i,t.beginPath(),t.moveTo(e+3*this.corner+this.inset+this.dent+a,o+a),t.lineTo(this.width()-this.corner,o+a),t.stroke(),s=e+this.corner+this.inset,n=t.createLinearGradient(s-this.edge,o+this.edge,s,o),n.addColorStop(0,this.cachedClr),n.addColorStop(1,this.cachedClrBright),t.strokeStyle=n,t.beginPath(),t.moveTo(e+this.corner+this.inset,o+a),t.lineTo(h,o+this.corner+a),t.stroke(),r=t.createLinearGradient(0,o+this.corner,0,o+this.corner+this.edge),r.addColorStop(0,this.cachedClrBright),r.addColorStop(1,this.cachedClr),t.strokeStyle=r,t.beginPath(),t.moveTo(h,o+this.corner+a),t.lineTo(h+this.dent,o+this.corner+a),t.stroke()},CommandBlockMorph.prototype.drawBottomDentEdge=function(t,e,o){var i,r,n,s=.5*this.edge,a=e+2*this.corner+this.inset;return t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",i=t.createLinearGradient(0,o-this.edge,0,o),i.addColorStop(0,this.cachedClr),i.addColorStop(1,this.cachedClrDark),t.strokeStyle=i,t.beginPath(),t.moveTo(this.corner,o-s),this.isStop()?t.lineTo(this.width()-this.corner,o-s):t.lineTo(e+this.corner+this.inset-s,o-s),t.stroke(),this.isStop()?null:(r=t.createLinearGradient(0,o+this.corner-this.edge,0,o+this.corner),r.addColorStop(0,this.cachedClr),r.addColorStop(1,this.cachedClrDark),t.strokeStyle=r,t.beginPath(),t.moveTo(a+s,o+this.corner-s),t.lineTo(a+this.dent,o+this.corner-s),t.stroke(),n=t.createLinearGradient(e+a+this.dent-this.edge,o+this.corner-this.edge,e+a+this.dent,o+this.corner),n.addColorStop(0,this.cachedClr),n.addColorStop(1,this.cachedClrDark),t.strokeStyle=n,t.beginPath(),t.moveTo(e+a+this.dent,o+this.corner-s),t.lineTo(e+3*this.corner+this.inset+this.dent,o-s),t.stroke(),t.strokeStyle=i,t.beginPath(),t.moveTo(e+3*this.corner+this.inset+this.dent,o-s),t.lineTo(this.width()-this.corner,o-s),void t.stroke())},CommandBlockMorph.prototype.drawFlatBottomDentEdge=function(t){this.isStop()||(t.fillStyle=this.color.darker(this.contrast/2).toString(),t.beginPath(),this.drawDent(t,0,this.height()-this.corner),t.closePath(),t.fill())},CommandBlockMorph.prototype.drawLeftEdge=function(t){var e=.5*this.edge,o=t.createLinearGradient(0,0,this.edge,0);o.addColorStop(0,this.cachedClrBright),o.addColorStop(1,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=o,t.beginPath(),t.moveTo(e,this.corner),t.lineTo(e,this.height()-2*this.corner-e),t.stroke()},CommandBlockMorph.prototype.drawRightEdge=function(t){var e,o=.5*this.edge,i=this.width();e=t.createLinearGradient(i-this.edge,0,i,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(i-o,this.corner+o),t.lineTo(i-o,this.height()-2*this.corner),t.stroke()},CommandBlockMorph.prototype.drawTopLeftEdge=function(t){var e,o=.5*this.edge;e=t.createRadialGradient(this.corner,this.corner,this.corner,this.corner,this.corner,this.corner-this.edge),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.arc(this.corner,this.corner,this.corner-o,radians(-180),radians(-90),!1),t.stroke()},CommandBlockMorph.prototype.drawBottomRightEdge=function(t){var e,o=.5*this.edge,i=this.width()-this.corner,r=this.height()-2*this.corner;e=t.createRadialGradient(i,r,this.corner,i,r,this.corner-this.edge),e.addColorStop(0,this.cachedClrDark),e.addColorStop(1,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.arc(i,r,this.corner-o,radians(90),radians(0),!0),t.stroke()},HatBlockMorph.prototype=new CommandBlockMorph,HatBlockMorph.prototype.constructor=HatBlockMorph,HatBlockMorph.uber=CommandBlockMorph.prototype,HatBlockMorph.prototype.init=function(){HatBlockMorph.uber.init.call(this),this.setExtent(new Point(300,150))},HatBlockMorph.prototype.blockSequence=function(){var t=HatBlockMorph.uber.blockSequence.call(this);return t.shift(),t},HatBlockMorph.prototype.drawTop=function(t){var e=this.hatWidth,o=this.hatHeight,i=(4*o*o+e*e)/(8*o),r=degrees(4*Math.atan(2*o/e)),n=r/2,s=Math.min(1.7*e,this.width()-this.corner);t.beginPath(),t.moveTo(0,o+this.corner),t.arc(e/2,i,i,radians(-n-90),radians(-90),!1),t.bezierCurveTo(e,0,e,o,s,o),t.arc(this.width()-this.corner,o+this.corner,this.corner,radians(-90),radians(-0),!1),t.closePath(),t.fill()},HatBlockMorph.prototype.drawBody=function(t){t.fillRect(0,this.hatHeight+Math.floor(this.corner)-1,this.width(),this.height()-Math.floor(3*this.corner)-this.hatHeight+2)},HatBlockMorph.prototype.drawLeftEdge=function(t){var e=.5*this.edge,o=t.createLinearGradient(0,0,this.edge,0);o.addColorStop(0,this.cachedClrBright),o.addColorStop(1,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=o,t.beginPath(),t.moveTo(e,this.hatHeight+e),t.lineTo(e,this.height()-2*this.corner-e),t.stroke()},HatBlockMorph.prototype.drawRightEdge=function(t){var e,o=.5*this.edge,i=this.width();e=t.createLinearGradient(i-this.edge,0,i,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(i-o,this.corner+this.hatHeight+o),t.lineTo(i-o,this.height()-2*this.corner),t.stroke()},HatBlockMorph.prototype.drawTopDentEdge=function(){return null},HatBlockMorph.prototype.drawTopLeftEdge=function(t){var e,o=.5*this.edge,i=this.hatWidth,r=this.hatHeight,n=(4*r*r+i*i)/(8*r),s=degrees(4*Math.atan(2*r/i)),a=s/2,h=Math.min(1.7*i,this.width()-this.corner);e=t.createRadialGradient(i/2,n,n-this.edge,i/2,n,n),e.addColorStop(1,this.cachedClrBright),e.addColorStop(0,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.arc(Math.round(i/2),n,n-o,radians(-a-90),radians(-90),!1),t.moveTo(i/2,o),t.bezierCurveTo(i,o,i,r+o,h,r+o),t.lineTo(this.width()-this.corner,r+o),t.stroke()},ReporterBlockMorph.prototype=new BlockMorph,ReporterBlockMorph.prototype.constructor=ReporterBlockMorph,ReporterBlockMorph.uber=BlockMorph.prototype,ReporterBlockMorph.prototype.init=function(t){ReporterBlockMorph.uber.init.call(this),this.isPredicate=t||!1,this.setExtent(new Point(200,80))},ReporterBlockMorph.prototype.snap=function(t){var e,o=this.parent;return!o instanceof ScriptsMorph?null:(o.clearDropHistory(),o.lastDroppedBlock=this,e=o.closestInput(this,t),null!==e&&(o.lastReplacedInput=e,o.lastDropTarget=e.parent,e instanceof MultiArgMorph&&(o.lastPreservedBlocks=e.inputs(),o.lastReplacedInput=e.fullCopy()),e.parent.replaceInput(e,this),this.snapSound&&this.snapSound.play()),this.startLayout(),this.fixBlockColor(),this.endLayout(),void ReporterBlockMorph.uber.snap.call(this))},ReporterBlockMorph.prototype.prepareToBeGrabbed=function(t){var e=this.position();nop(t),(this.parent instanceof BlockMorph||this.parent instanceof MultiArgMorph||this.parent instanceof ReporterSlotMorph)&&(this.parent.revertToDefaultInput(this),this.setPosition(e)),ReporterBlockMorph.uber.prepareToBeGrabbed.call(this,t)},ReporterBlockMorph.prototype.blockSequence=function(){return this},ReporterBlockMorph.prototype.isUnevaluated=function(){return contains(["%anyUE","%boolUE","%f"],this.getSlotSpec())},ReporterBlockMorph.prototype.isLocked=function(){return this.isStatic||"%t"===this.getSlotSpec()},ReporterBlockMorph.prototype.getSlotSpec=function(){var t,e;return this.parent instanceof BlockMorph&&(t=this.parent.parts().filter(function(t){return!(t instanceof BlockHighlightMorph)}),e=t.indexOf(this),-1!==e&&this.parent.blockSpec)?this.parseSpec(this.parent.blockSpec)[e]:this.parent instanceof MultiArgMorph?this.parent.slotSpec:this.parent instanceof TemplateSlotMorph?this.parent.getSpec():null},ReporterBlockMorph.prototype.mouseClickLeft=function(t){var e;return this.parent instanceof BlockInputFragmentMorph?this.parent.mouseClickLeft():void(this.parent instanceof TemplateSlotMorph?(e=this.parent.parent&&this.parent.parent.parent&&this.parent.parent.parent instanceof RingMorph,new DialogBoxMorph(this,this.setSpec,this).prompt(e?"Input name":"Script variable name",this.blockSpec,this.world())):ReporterBlockMorph.uber.mouseClickLeft.call(this,t))},ReporterBlockMorph.prototype.userDestroy=function(){this.prepareToBeGrabbed(this.world().hand),this.destroy()},ReporterBlockMorph.prototype.drawNew=function(){var t;this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,this.isPredicate?this.drawDiamond(t):this.drawRounded(t),this.eraseHoles(t)},ReporterBlockMorph.prototype.drawRounded=function(t){var e,o=this.height(),i=Math.min(this.rounding,o/2),r=this.width(),n=this.edge/2;t.fillStyle=this.cachedClr,t.beginPath(),t.arc(i,i,i,radians(-180),radians(-90),!1),t.arc(r-i,i,i,radians(-90),radians(-0),!1),t.arc(r-i,o-i,i,radians(0),radians(90),!1),t.arc(i,o-i,i,radians(90),radians(180),!1),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",e=t.createRadialGradient(i,o-i,i-this.edge,i,o-i,i+this.edge),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.arc(i,o-i,i-n,radians(90),radians(180),!1),t.stroke(),e=t.createRadialGradient(r-i,i,i-this.edge,r-i,i,i+this.edge),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.arc(r-i,i,i-n,radians(-90),radians(0),!1),t.stroke(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(i-n,n),t.lineTo(r-i+n,n),t.stroke(),e=t.createRadialGradient(i,i,i-this.edge,i,i,i),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.arc(i,i,i-n,radians(180),radians(270),!1),t.stroke(),e=t.createRadialGradient(r-i,o-i,i-this.edge,r-i,o-i,i),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.arc(r-i,o-i,i-n,radians(0),radians(90),!1),t.stroke(),e=t.createLinearGradient(0,o-this.edge,0,o),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(i-n,o-n),t.lineTo(r-i+n,o-n),t.stroke(),e=t.createLinearGradient(0,0,this.edge,0),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,i),t.lineTo(n,o-i),t.stroke(),e=t.createLinearGradient(r-this.edge,0,r,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(r-n,i+n),t.lineTo(r-n,o-i),t.stroke())},ReporterBlockMorph.prototype.drawDiamond=function(t){var e,o=this.width(),i=this.height(),r=Math.floor(i/2),n=this.rounding,s=this.edge/2;t.fillStyle=this.cachedClr,t.beginPath(),t.moveTo(0,r),t.lineTo(n,0),t.lineTo(o-n,0),t.lineTo(o,r),t.lineTo(o-n,i),t.lineTo(n,i),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",e=t.createLinearGradient(-n,0,n,0),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(s,r),t.lineTo(n,i-s),t.closePath(),t.stroke(),e=t.createLinearGradient(o-n,0,o+n,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(o-s,r),t.lineTo(o-n,s),t.closePath(),t.stroke(),e=t.createLinearGradient(0,0,n,0),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(s,r),t.lineTo(n,s),t.closePath(),t.stroke(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,s),t.lineTo(o-n,s),t.closePath(),t.stroke(),e=t.createLinearGradient(o-n,0,o,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(o-n,i-s),t.lineTo(o-s,r),t.closePath(),t.stroke(),e=t.createLinearGradient(0,i-this.edge,0,i),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(n+s,i-s),t.lineTo(o-n-s,i-s),t.closePath(),t.stroke())},RingMorph.prototype=new ReporterBlockMorph,RingMorph.prototype.constructor=RingMorph,RingMorph.uber=ReporterBlockMorph.prototype,RingMorph.prototype.init=function(){RingMorph.uber.init.call(this),this.category="other",this.alpha=RingMorph.prototype.alpha,this.contrast=RingMorph.prototype.contrast,this.setExtent(new Point(200,80))},RingMorph.prototype.rootForGrab=function(){return this.isDraggable?this:BlockMorph.uber.rootForGrab.call(this)},RingMorph.prototype.embed=function(t,e){var o;this.color=SpriteMorph.prototype.blockColor.other,this.isDraggable=!0,t instanceof CommandBlockMorph?(this.isStatic=!1,this.setSpec("%rc %ringparms"),this.selector="reifyScript",o=this.parts()[0],o.nestedBlock(t)):t.isPredicate?(this.isStatic=!0,this.setSpec("%rp %ringparms"),this.selector="reifyPredicate",o=this.parts()[0],o.silentReplaceInput(o.contents(),t)):(this.isStatic=!1,this.setSpec("%rr %ringparms"),this.selector="reifyReporter",o=this.parts()[0],o.silentReplaceInput(o.contents(),t)),o=this.parts()[1],e&&e.forEach(function(t){o.addInput(t)}),this.fixBlockColor(null,!0)},RingMorph.prototype.vanishForSimilar=function(){var t=this.parts()[0],e=t.nestedBlock();return e&&this.parent instanceof SyntaxElementMorph?this.parent instanceof RingReporterSlotMorph||this.parent instanceof RingCommandSlotMorph?null:void(("reportGetVar"===e.selector||e instanceof RingMorph)&&this.parent.silentReplaceInput(this,e)):null},RingMorph.prototype.contents=function(){return this.parts()[0].nestedBlock()},RingMorph.prototype.inputNames=function(){return this.parts()[1].evaluate()},RingMorph.prototype.dataType=function(){switch(this.selector){case"reifyScript":return"command";case"reifyPredicate":return"predicate";default:return"reporter"}},RingMorph.prototype.fixBlockColor=function(t,e){var o=this.parts()[0];RingMorph.uber.fixBlockColor.call(this,t,e),o instanceof RingCommandSlotMorph&&o.fixLayout()},ScriptsMorph.prototype=new FrameMorph,ScriptsMorph.prototype.constructor=ScriptsMorph,ScriptsMorph.uber=FrameMorph.prototype,ScriptsMorph.prototype.cleanUpMargin=20,ScriptsMorph.prototype.cleanUpSpacing=15,ScriptsMorph.prototype.isPreferringEmptySlots=!0,ScriptsMorph.prototype.init=function(t){this.owner=t||null,this.feedbackColor=SyntaxElementMorph.prototype.feedbackColor,this.feedbackMorph=new BoxMorph,this.lastDroppedBlock=null,this.lastReplacedInput=null,this.lastDropTarget=null,this.lastPreservedBlocks=null,this.lastNextBlock=null,ScriptsMorph.uber.init.call(this),this.setColor(new Color(70,70,70))},ScriptsMorph.prototype.fullCopy=function(){var t,e=new ScriptsMorph,o=this.position();return this.children.forEach(function(i){i.block||(t=i.fullCopy(),t.setPosition(i.position().subtract(o)),e.add(t),t instanceof BlockMorph&&t.allComments().forEach(function(e){e.align(t)}))}),e.adjustBounds(),e},ScriptsMorph.prototype.step=function(){var t,e=this.world().hand;return this.feedbackMorph.parent&&(this.feedbackMorph.destroy(),this.feedbackMorph.parent=null),0===e.children.length?null:this.bounds.containsPoint(e.bounds.origin)?(t=e.children[0],(t instanceof BlockMorph||t instanceof CommentMorph)&&contains(e.morphAtPointer().allParents(),this)?void(t instanceof CommentMorph?this.showCommentDropFeedback(t,e):t instanceof ReporterBlockMorph?this.showReporterDropFeedback(t,e):this.showCommandDropFeedback(t)):null):null},ScriptsMorph.prototype.showReporterDropFeedback=function(t,e){var o=this.closestInput(t,e);return null===o?null:(this.feedbackMorph.bounds=o.fullBounds().expandBy(Math.max(2*t.edge,t.reporterDropFeedbackPadding)),this.feedbackMorph.edge=SyntaxElementMorph.prototype.rounding,this.feedbackMorph.border=Math.max(SyntaxElementMorph.prototype.edge,3),this.add(this.feedbackMorph),o instanceof MultiArgMorph?(this.feedbackMorph.color=SpriteMorph.prototype.blockColor.lists.copy(),this.feedbackMorph.borderColor=SpriteMorph.prototype.blockColor.lists):(this.feedbackMorph.color=this.feedbackColor.copy(),this.feedbackMorph.borderColor=this.feedbackColor),this.feedbackMorph.color.a=.5,this.feedbackMorph.drawNew(),void this.feedbackMorph.changed())},ScriptsMorph.prototype.showCommandDropFeedback=function(t){var e,o;return(o=t.closestAttachTarget(this))?(this.add(this.feedbackMorph),this.feedbackMorph.border=0,this.feedbackMorph.edge=0,this.feedbackMorph.alpha=1,this.feedbackMorph.setExtent(new Point(o.element.width(),Math.max(SyntaxElementMorph.prototype.corner,SyntaxElementMorph.prototype.feedbackMinHeight))),this.feedbackMorph.color=this.feedbackColor,this.feedbackMorph.drawNew(),this.feedbackMorph.changed(),e=o.point.y,"bottom"===o.loc&&("block"===o.type?o.element.nextBlock()&&(e-=SyntaxElementMorph.prototype.corner):"slot"===o.type&&o.element.nestedBlock()&&(e-=SyntaxElementMorph.prototype.corner)),void this.feedbackMorph.setPosition(new Point(o.element.left(),e))):null},ScriptsMorph.prototype.showCommentDropFeedback=function(t,e){var o=this.closestBlock(t,e);return o?(this.feedbackMorph.bounds=o.bounds.expandBy(Math.max(2*BlockMorph.prototype.edge,BlockMorph.prototype.reporterDropFeedbackPadding)),this.feedbackMorph.edge=SyntaxElementMorph.prototype.rounding,this.feedbackMorph.border=Math.max(SyntaxElementMorph.prototype.edge,3),this.add(this.feedbackMorph),this.feedbackMorph.color=t.color.copy(),this.feedbackMorph.color.a=.25,this.feedbackMorph.borderColor=t.titleBar.color,this.feedbackMorph.drawNew(),void this.feedbackMorph.changed()):null},ScriptsMorph.prototype.closestInput=function(t,e){function o(t,e){return t instanceof MultiArgMorph?e?t.arrows().bounds.containsPoint(e):t.arrows().bounds.intersects(s):!0}var i,r,n,s=t.fullBoundsNoShadow(),a=this.children.filter(function(t){return t instanceof BlockMorph&&t.fullBounds().intersects(s)}),h=t.allInputs();if(n=[],a.forEach(function(t){n=n.concat(t.allInputs())}),0===n.length)return null;if(this.isPreferringEmptySlots){if(e&&(i=e.position(),r=detect(n,function(t){return(t instanceof InputSlotMorph||t instanceof ArgMorph||t instanceof RingMorph&&!t.contents()||t.isEmptySlot())&&!t.isLocked()&&t.bounds.containsPoint(i)&&!contains(h,t)&&o(t,i)})))return r;if(r=detect(n,function(t){return(t instanceof InputSlotMorph||t instanceof ArgMorph||t instanceof RingMorph&&!t.contents()||t.isEmptySlot())&&!t.isLocked()&&t.bounds.intersects(s)&&!contains(h,t)&&o(t)}))return r}return e&&(i=e.position(),r=detect(n,function(e){return!(e===t||e.isLocked()||!e.bounds.containsPoint(i)||e.parent instanceof PrototypeHatBlockMorph||contains(h,e))}))?r:detect(n,function(e){return!(e===t||e.isLocked()||!e.fullBounds().intersects(s)||e.parent instanceof PrototypeHatBlockMorph||contains(h,e))})},ScriptsMorph.prototype.closestBlock=function(t,e){var o,i,r,n=t.bounds,s=this.children.filter(function(t){return t instanceof BlockMorph&&t.fullBounds().intersects(n)});return r=[],s.forEach(function(t){r=r.concat(t.allChildren().slice(0).reverse().filter(function(t){return t instanceof BlockMorph&&!t.isTemplate}))}),0===r.length?null:e&&(o=e.position(),i=detect(r,function(t){return!t.comment&&!t.isPrototype&&t.bounds.containsPoint(o)}))?i:detect(r,function(t){return!t.comment&&!t.isPrototype&&t.bounds.intersects(n)})},ScriptsMorph.prototype.userMenu=function(){var t,e=new MenuMorph(this),o=this.parentThatIsA(IDE_Morph),i=this,r=this.owner,n=r.parentThatIsA(StageMorph);return o||(t=this.parentThatIsA(BlockEditorMorph),t&&(o=t.target.parentThatIsA(IDE_Morph))),"STUDENT"!==world.role&&(e.addItem(localize("show all"),"showall"),e.addItem(localize("hide all"),"hideall")),e.addItem("clean up","cleanUp","arrange scripts\nvertically"),e.addItem("add comment","addComment"),this.lastDroppedBlock&&e.addItem("undrop","undrop","undo the last\nblock drop\nin this pane"),e.addItem("scripts pic...","exportScriptsPicture","open a new window\nwith a picture of all scripts"),o&&"STUDENT"!=world.role&&(e.addLine(),e.addItem("make a block...",function(){new BlockDialogMorph(null,function(t){""!==t.spec&&(t.isGlobal?n.globalBlocks.push(t):r.customBlocks.push(t),o.flushPaletteCache(),o.refreshPalette(),new BlockEditorMorph(t,r).popUp())},i).prompt("Make a block",null,i.world())})),e},ScriptsMorph.prototype.showall=function(){this.children.forEach(function(t){t instanceof CommentMorph&&t.block&&t.show(),t instanceof BlockMorph&&t.show()})},ScriptsMorph.prototype.hideall=function(){this.children.forEach(function(t){t instanceof CommentMorph&&t.block&&t.hide(),t instanceof BlockMorph&&t.hide()})},ScriptsMorph.prototype.cleanUp=function(){var t=this.topLeft(),e=this.cleanUpMargin,o=this;this.children.sort(function(t,e){return t instanceof PrototypeHatBlockMorph?0:t.top()-e.top()}).forEach(function(i){i instanceof CommentMorph&&i.block||(i.setPosition(t.add(new Point(o.cleanUpMargin,e))),i instanceof BlockMorph&&i.allComments().forEach(function(t){t.align(i,!0)}),e+=i.stackHeight()+o.cleanUpSpacing)}),this.parent&&this.setPosition(this.parent.topLeft()),this.adjustBounds()},ScriptsMorph.prototype.exportScriptsPicture=function(){var t,e,o;0!==this.children.length&&(t=this.children[0].fullBounds(),this.children.forEach(function(e){e.isVisible&&(t=t.merge(e.fullBounds()))}),e=newCanvas(t.extent()),o=e.getContext("2d"),this.children.forEach(function(e){var i=e.position();e.isVisible&&o.drawImage(e.fullImageClassic(),i.x-t.origin.x,i.y-t.origin.y)}),window.open(e.toDataURL()))},ScriptsMorph.prototype.addComment=function(){(new CommentMorph).pickUp(this.world())},ScriptsMorph.prototype.undrop=function(){this.lastDroppedBlock&&(this.lastDroppedBlock instanceof CommandBlockMorph?(this.lastNextBlock&&this.add(this.lastNextBlock),this.lastDropTarget&&("bottom"===this.lastDropTarget.loc?"slot"===this.lastDropTarget.type?this.lastNextBlock&&this.lastDropTarget.element.nestedBlock(this.lastNextBlock):this.lastNextBlock&&this.lastDropTarget.element.nextBlock(this.lastNextBlock):"top"===this.lastDropTarget.loc&&this.add(this.lastDropTarget.element))):this.lastDropTarget&&(this.lastDropTarget.replaceInput(this.lastDroppedBlock,this.lastReplacedInput),this.lastDropTarget.fixBlockColor(null,!0),this.lastPreservedBlocks&&this.lastPreservedBlocks.forEach(function(t){t.destroy()})),this.lastDroppedBlock.pickUp(this.world()),this.clearDropHistory())},ScriptsMorph.prototype.clearDropHistory=function(){this.lastDroppedBlock=null,this.lastReplacedInput=null,this.lastDropTarget=null,this.lastPreservedBlocks=null,this.lastNextBlock=null},ScriptsMorph.prototype.fixMultiArgs=function(){var t=Morph.prototype.trackChanges;Morph.prototype.trackChanges=!1,this.forAllChildren(function(t){t instanceof MultiArgMorph&&t.fixLayout()}),Morph.prototype.trackChanges=t},ScriptsMorph.prototype.wantsDropOf=function(t){return t instanceof SyntaxElementMorph||t instanceof CommentMorph},ScriptsMorph.prototype.reactToDropOf=function(t,e){(t instanceof BlockMorph||t instanceof CommentMorph)&&t.snap(e),this.adjustBounds()},ArgMorph.prototype=new SyntaxElementMorph,ArgMorph.prototype.constructor=ArgMorph,ArgMorph.uber=SyntaxElementMorph.prototype,ArgMorph.prototype.init=function(t){this.type=t||null,this.isHole=!1,ArgMorph.uber.init.call(this),this.color=new Color(0,17,173),this.setExtent(new Point(50,50))
},ArgMorph.prototype.justDropped=function(){this instanceof CommandSlotMorph||(this.drawNew(),this.changed())},ArgMorph.prototype.getSpec=function(){return"%s"},ArgMorph.prototype.drawNew=function(){"list"===this.type?(this.image=this.listIcon(),this.silentSetExtent(new Point(this.image.width,this.image.height))):"object"===this.type?(this.image=this.objectIcon(),this.silentSetExtent(new Point(this.image.width,this.image.height))):ArgMorph.uber.drawNew.call(this)},ArgMorph.prototype.listIcon=function(){var t,e,o,i,r=new Morph,n=new CellMorph,s=new CellMorph;return r.color=new Color(255,255,255),s.setPosition(n.bottomLeft().add(new Point(0,this.fontSize/3))),n.add(s),n.setPosition(r.position().add(this.fontSize)),r.add(n),r.bounds.corner=s.bounds.corner.add(this.fontSize),r.drawNew(),t=r.fullImage(),i=(this.fontSize+this.edge)/t.height,e=newCanvas(new Point(Math.ceil(t.width*i)+1,Math.ceil(t.height*i)+1)),o=e.getContext("2d"),o.fillStyle="black",o.fillRect(0,0,e.width,e.height),o.scale(i,i),o.drawImage(t,1/i,1/i),e},ArgMorph.prototype.objectIcon=function(){return this.labelPart("%turtle").image},ArgMorph.prototype.isEmptySlot=function(){return null!==this.type},CommandSlotMorph.prototype=new ArgMorph,CommandSlotMorph.prototype.constructor=CommandSlotMorph,CommandSlotMorph.uber=ArgMorph.prototype,CommandSlotMorph.prototype.init=function(){CommandSlotMorph.uber.init.call(this),this.color=new Color(0,17,173),this.setExtent(new Point(230,4*this.corner+this.cSlotPadding))},CommandSlotMorph.prototype.getSpec=function(){return"%cmd"},CommandSlotMorph.prototype.topBlock=function(){return this.parent.topBlock?this.parent.topBlock():this.nestedBlock()},CommandSlotMorph.prototype.nestedBlock=function(t){if(!t)return detect(this.children,function(t){return t instanceof CommandBlockMorph});var e=this.nestedBlock();this.add(t),e&&t.bottomBlock().nextBlock(e),this.fixLayout()},CommandSlotMorph.prototype.slotAttachPoint=function(){return new Point(this.dentCenter(),this.top()+2*this.corner)},CommandSlotMorph.prototype.dentLeft=function(){return this.left()+this.corner+2*this.inset},CommandSlotMorph.prototype.dentCenter=function(){return this.dentLeft()+this.corner+.5*this.dent},CommandSlotMorph.prototype.attachTargets=function(){var t=[];return t.push({point:this.slotAttachPoint(),element:this,loc:"bottom",type:"slot"}),t},CommandSlotMorph.prototype.fixLayout=function(){var t=this.nestedBlock();this.parent&&(this.color.eq(this.parent.color)||this.setColor(this.parent.color)),t?(t.setPosition(new Point(this.left()+this.edge+this.rfBorder,this.top()+this.edge+this.rfBorder)),this.setWidth(t.fullBounds().width()+2*(this.edge+this.rfBorder)),this.setHeight(t.fullBounds().height()+this.edge+2*this.rfBorder-(this.corner-this.edge))):(this.setHeight(4*this.corner),this.setWidth(4*this.corner+this.inset+this.dent)),this.parent.fixLayout&&this.parent.fixLayout()},CommandSlotMorph.prototype.evaluate=function(){return this.nestedBlock()},CommandSlotMorph.prototype.isEmptySlot=function(){return!this.isStatic&&null===this.nestedBlock()},CommandSlotMorph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose new parent:"),o=this;t.forEach(function(t){e.addItem(t.toString().slice(0,50),function(){t.add(o),o.isDraggable=!1,t.fixLayout&&t.fixLayout()})}),t.length>0&&e.popUpAtHand(this.world())},CommandSlotMorph.prototype.drawNew=function(){var t;this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,t.fillRect(0,0,this.width(),this.height()),t.fillStyle=this.rfColor.toString(),this.drawFlat(t),MorphicPreferences.isFlat||this.drawEdges(t)},CommandSlotMorph.prototype.drawFlat=function(t){var e=null!==this.nestedBlock(),o=e?this.inset:this.inset/2,i=e?this.dent:this.dent/2,r=2*this.corner+o,n=this.edge,s=e?this.rfBorder:0,a=this.height()-this.corner-n;t.beginPath(),t.arc(this.corner+n,this.corner+n,this.corner,radians(-180),radians(-90),!1),t.lineTo(this.corner+o+n+2*s,n),t.lineTo(r+n+2*s,this.corner+n),t.lineTo(r+n+2*s+(i-2*s),this.corner+n),t.lineTo(r+n+2*s+(i-2*s)+this.corner,n),t.lineTo(this.width()-this.corner-n,n),t.arc(this.width()-this.corner-n,this.corner+n,this.corner,radians(-90),radians(-0),!1),t.arc(this.width()-this.corner-n,a,this.corner,radians(0),radians(90),!1),t.arc(this.corner+n,a,this.corner,radians(90),radians(180),!1),t.closePath(),t.fill()},CommandSlotMorph.prototype.drawEdges=function(t){var e,o,i,r,n=null!==this.nestedBlock(),s=n?this.inset:this.inset/2,a=n?this.dent:this.dent/2,h=2*this.corner+s,l=this.edge,p=n?this.rfBorder:0,c=.5*this.edge;t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",e=t.createLinearGradient(0,this.height(),0,this.height()-this.edge),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(this.corner+l,this.height()-c),t.lineTo(this.width()-this.corner-l,this.height()-c),t.stroke(),e=t.createRadialGradient(this.width()-(this.corner+l),this.height()-(this.corner+l),this.corner,this.width()-(this.corner+l),this.height()-(this.corner+l),this.corner+l),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.arc(this.width()-(this.corner+l),this.height()-(this.corner+l),this.corner+c,radians(0),radians(90),!1),t.stroke(),e=t.createLinearGradient(this.width(),0,this.width()-this.edge,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(this.width()-c,this.height()-this.corner-this.edge),t.lineTo(this.width()-c,l+this.corner),t.stroke(),t.shadowOffsetY=c,t.shadowBlur=this.edge,t.shadowColor=this.rfColor.darker(80).toString(),e=t.createLinearGradient(0,0,l,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(c,l+this.corner),t.lineTo(c,this.height()-l-this.corner),t.stroke(),e=t.createRadialGradient(this.corner+l,this.corner+l,this.corner,this.corner+l,this.corner+l,this.corner+l),e.addColorStop(0,this.cachedClrDark),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.arc(this.corner+l,this.corner+l,this.corner+c,radians(-180),radians(-90),!1),t.stroke(),o=t.createLinearGradient(0,0,0,this.edge),o.addColorStop(0,this.cachedClr),o.addColorStop(1,this.cachedClrDark),t.strokeStyle=o,t.beginPath(),t.moveTo(this.corner+l,c),t.lineTo(this.corner+s+l+2*p-c,c),t.stroke(),i=t.createLinearGradient(0,this.corner,0,this.corner+l),i.addColorStop(0,this.cachedClr),i.addColorStop(1,this.cachedClrDark),t.strokeStyle=i,t.beginPath(),t.moveTo(h+l+2*p+c,this.corner+c),t.lineTo(h+l+2*p+(a-2*p),this.corner+c),t.stroke(),r=t.createLinearGradient(h+l+2*p+(a-2*p)-c,this.corner,h+l+2*p+(a-2*p)+.7*c,this.corner+c+.7*c),r.addColorStop(0,this.cachedClr),r.addColorStop(1,this.cachedClrDark),t.strokeStyle=r,t.beginPath(),t.moveTo(h+l+2*p+(a-2*p),this.corner+c),t.lineTo(h+l+2*p+(a-2*p)+this.corner,c),t.stroke(),t.strokeStyle=o,t.beginPath(),t.moveTo(h+l+2*p+(a-2*p)+this.corner,c),t.lineTo(this.width()-this.corner-l,c),t.stroke()},RingCommandSlotMorph.prototype=new CommandSlotMorph,RingCommandSlotMorph.prototype.constructor=RingCommandSlotMorph,RingCommandSlotMorph.uber=CommandSlotMorph.prototype,RingCommandSlotMorph.prototype.rfBorder=0,RingCommandSlotMorph.prototype.edge=RingMorph.prototype.edge,RingCommandSlotMorph.prototype.init=function(){RingCommandSlotMorph.uber.init.call(this),this.isHole=!0,this.noticesTransparentClick=!0,this.color=new Color(0,17,173),this.alpha=RingMorph.prototype.alpha,this.contrast=RingMorph.prototype.contrast},RingCommandSlotMorph.prototype.getSpec=function(){return"%rc"},RingCommandSlotMorph.prototype.drawNew=function(){var t;this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,this.drawFlat(t),MorphicPreferences.isFlat||this.drawEdges(t)},RingCommandSlotMorph.prototype.drawFlat=function(t){var e=null!==this.nestedBlock(),o=e?this.inset:this.inset/2,i=e?this.dent:this.dent/2,r=2*this.corner+o,n=this.edge,s=this.width(),a=this.height(),h=e?this.rfBorder:0,l=a-this.corner-n;t.beginPath(),t.moveTo(0,a/2),t.lineTo(n,a/2),t.arc(this.corner+n,this.corner+n,this.corner,radians(-180),radians(-90),!1),t.lineTo(this.corner+o+n+2*h,n),t.lineTo(r+n+2*h,this.corner+n),t.lineTo(r+n+2*h+(i-2*h),this.corner+n),t.lineTo(r+n+2*h+(i-2*h)+this.corner,n),t.lineTo(this.width()-this.corner-n,n),t.arc(s-this.corner-n,this.corner+n,this.corner,radians(-90),radians(-0),!1),t.lineTo(s-this.edge,a/2),t.lineTo(s,a/2),t.lineTo(s,0),t.lineTo(0,0),t.closePath(),t.fill(),t.beginPath(),t.moveTo(s,a/2),t.lineTo(s-n,a/2),t.arc(this.width()-this.corner-n,l,this.corner,radians(0),radians(90),!1),t.arc(this.corner+n,l,this.corner,radians(90),radians(180),!1),t.lineTo(n,a/2),t.lineTo(0,a/2),t.lineTo(0,a),t.lineTo(s,a),t.closePath(),t.fill()},CSlotMorph.prototype=new CommandSlotMorph,CSlotMorph.prototype.constructor=CSlotMorph,CSlotMorph.uber=CommandSlotMorph.prototype,CSlotMorph.prototype.init=function(){CommandSlotMorph.uber.init.call(this),this.isHole=!0,this.color=new Color(0,17,173),this.setExtent(new Point(230,4*this.corner+this.cSlotPadding))},CSlotMorph.prototype.getSpec=function(){return"%c"},CSlotMorph.prototype.mappedCode=function(t){var e=StageMorph.prototype.codeMappings.reify||"<#1>",o=e.split("\n"),i=this.nestedBlock(),r=i?i.mappedCode(t):"",n=r.toString().split("\n"),s=new RegExp("<#1>","g");return o.forEach(function(t,e){var i,r="";0===t.trimLeft().indexOf("<#1>")&&(i=t.indexOf("<#1>"),r=t.slice(0,i)),o[e]=t.replace(new RegExp("<#1>"),n.join("\n"+r)),o[e]=o[e].replace(s,n.join("\n"))}),o.join("\n")},CSlotMorph.prototype.fixLayout=function(){var t=this.nestedBlock();t?(t.setPosition(new Point(this.left()+this.inset,this.top()+this.corner)),this.setHeight(t.fullBounds().height()+this.corner),this.setWidth(t.fullBounds().width()+2*this.cSlotPadding)):(this.setHeight(4*this.corner+this.cSlotPadding),this.setWidth(4*this.corner+2*this.inset+this.dent+2*this.cSlotPadding)),this.parent.fixLayout&&this.parent.fixLayout()},CSlotMorph.prototype.drawNew=function(){var t;this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,this.drawFlat(t),MorphicPreferences.isFlat||(this.drawTopRightEdge(t),this.drawTopEdge(t,this.inset,this.corner),this.drawTopLeftEdge(t),this.drawBottomEdge(t),this.drawRightEdge(t))},CSlotMorph.prototype.drawFlat=function(t){t.beginPath(),t.moveTo(0,0),t.lineTo(this.width(),0),t.arc(this.width()-this.corner,0,this.corner,radians(90),radians(0),!0),t.lineTo(this.width()-this.corner,this.corner),t.lineTo(2*this.inset+3*this.corner+this.dent,this.corner),t.lineTo(2*this.inset+2*this.corner+this.dent,2*this.corner),t.lineTo(2*this.inset+2*this.corner,2*this.corner),t.lineTo(2*this.inset+this.corner,this.corner),t.lineTo(this.inset+this.corner,this.corner),t.arc(this.inset+this.corner,2*this.corner,this.corner,radians(270),radians(180),!0),t.lineTo(this.inset,this.height()-2*this.corner),t.arc(this.inset+this.corner,this.height()-2*this.corner,this.corner,radians(180),radians(90),!0),t.lineTo(this.width()-this.corner,this.height()-this.corner),t.arc(this.width()-this.corner,this.height(),this.corner,radians(-90),radians(-0),!1),t.lineTo(0,this.height()),t.closePath(),t.fill()},CSlotMorph.prototype.drawTopRightEdge=function(t){var e,o=.5*this.edge,i=this.width()-this.corner,r=0;e=t.createRadialGradient(i,r,this.corner,i,r,this.corner-this.edge),e.addColorStop(0,this.cachedClrDark),e.addColorStop(1,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.arc(i,r,this.corner-o,radians(90),radians(0),!0),t.stroke()},CSlotMorph.prototype.drawTopEdge=function(t,e,o){var i,r,n,s=.5*this.edge,a=e+2*this.corner+this.inset;t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",i=t.createLinearGradient(0,o-this.edge,0,o),i.addColorStop(0,this.cachedClr),i.addColorStop(1,this.cachedClrDark),t.strokeStyle=i,t.beginPath(),t.moveTo(e+this.corner,o-s),t.lineTo(e+this.corner+this.inset-s,o-s),t.stroke(),r=t.createLinearGradient(0,o+this.corner-this.edge,0,o+this.corner),r.addColorStop(0,this.cachedClr),r.addColorStop(1,this.cachedClrDark),t.strokeStyle=r,t.beginPath(),t.moveTo(a+s,o+this.corner-s),t.lineTo(a+this.dent,o+this.corner-s),t.stroke(),n=t.createLinearGradient(e+this.inset+2*this.corner+this.dent-s,o+this.corner-s-s,e+this.inset+2*this.corner+this.dent+.7*s,o+this.corner-s+.7*s),n.addColorStop(0,this.cachedClr),n.addColorStop(1,this.cachedClrDark),t.strokeStyle=n,t.beginPath(),t.moveTo(e+this.inset+2*this.corner+this.dent,o+this.corner-s),t.lineTo(e+3*this.corner+this.inset+this.dent,o-s),t.stroke(),t.strokeStyle=i,t.beginPath(),t.moveTo(e+3*this.corner+this.inset+this.dent,o-s),t.lineTo(this.width()-this.corner,o-s),t.stroke()},CSlotMorph.prototype.drawTopLeftEdge=function(t){var e,o=.5*this.edge;e=t.createRadialGradient(this.corner+this.inset,2*this.corner,this.corner,this.corner+this.inset,2*this.corner,this.corner+this.edge),e.addColorStop(0,this.cachedClrDark),e.addColorStop(1,this.cachedClr),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.arc(this.corner+this.inset,2*this.corner,this.corner+o,radians(-180),radians(-90),!1),t.stroke()},CSlotMorph.prototype.drawRightEdge=function(t){var e,o=.5*this.edge,i=this.inset;e=t.createLinearGradient(i-this.edge,0,i,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(i-o,2*this.corner),t.lineTo(i-o,this.height()-2*this.corner),t.stroke()},CSlotMorph.prototype.drawBottomEdge=function(t){var e,o,i=.5*this.edge;t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",o=t.createRadialGradient(this.corner+this.inset,this.height()-2*this.corner,this.corner,this.corner+this.inset,this.height()-2*this.corner,this.corner+this.edge),o.addColorStop(0,this.cachedClrBright),o.addColorStop(1,this.cachedClr),t.strokeStyle=o,t.beginPath(),t.arc(this.corner+this.inset,this.height()-2*this.corner,this.corner+i,radians(180),radians(90),!0),t.stroke(),e=t.createLinearGradient(0,this.height()-this.corner,0,this.height()-this.corner+this.edge),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.inset+this.corner,this.height()-this.corner+i),t.lineTo(this.width()-this.corner,this.height()-this.corner+i),t.stroke()},InputSlotMorph.prototype=new ArgMorph,InputSlotMorph.prototype.constructor=InputSlotMorph,InputSlotMorph.uber=ArgMorph.prototype,InputSlotMorph.prototype.executeOnSliderEdit=!1,InputSlotMorph.prototype.init=function(t,e,o,i){var r=new StringMorph(""),n=new ArrowMorph("down",0,Math.max(Math.floor(this.fontSize/6),1));r.fontSize=this.fontSize,r.isShowingBlanks=!0,r.drawNew(),this.isUnevaluated=!1,this.choices=o||null,this.oldContentsExtent=r.extent(),this.isNumeric=e||!1,this.isReadOnly=i||!1,this.minWidth=0,this.constant=null,InputSlotMorph.uber.init.call(this),this.color=new Color(255,255,255),this.add(r),this.add(n),r.isEditable=!0,r.isDraggable=!1,r.enableSelecting(),this.setContents(t)},InputSlotMorph.prototype.getSpec=function(){return this.isNumeric?"%n":"%s"},InputSlotMorph.prototype.contents=function(){return detect(this.children,function(t){return t instanceof StringMorph})},InputSlotMorph.prototype.arrow=function(){return detect(this.children,function(t){return t instanceof ArrowMorph})},InputSlotMorph.prototype.setContents=function(t){var e=this.contents(),o=t,i=o instanceof Array;if(i)o=localize(o[0]),e.isItalic=!this.isReadOnly;else if(e.isItalic=!1,null!==this.choices&&this.choices[o]instanceof Array)return this.setContents(this.choices[o]);e.text=o,isNil(o)?e.text="":o.toString&&(e.text=o.toString()),e.drawNew(),this.isReadOnly&&this.parent instanceof BlockMorph&&this.parent.fixLabelColor(),this.constant=i?t:null},InputSlotMorph.prototype.dropDownMenu=function(){var t,e=this.choices,o=new MenuMorph(this.setContents,null,this,this.fontSize);if(e instanceof Function?e=e.call(this):isString(e)&&(e=this[e]()),!e)return null;o.addItem(" ",null);for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&("~"===t[0]?o.addLine():o.addItem(t,e[t]));return o.items.length>0?void o.popUpAtHand(this.world()):null},InputSlotMorph.prototype.messagesMenu=function(){var t={},e=this.parentThatIsA(BlockMorph).receiver(),o=e.parentThatIsA(StageMorph),i=this,r=[];return o.children.concat(o).forEach(function(t){(t instanceof SpriteMorph||t instanceof StageMorph)&&(r=r.concat(t.allMessageNames()))}),r.forEach(function(e){t[e]=e}),r.length>0&&(t["~"]=null),t["new..."]=function(){new DialogBoxMorph(i,i.setContents,i).prompt("Message name",null,i.world())},t},InputSlotMorph.prototype.messagesReceivedMenu=function(){var t={"any message":["any message"]},e=this.parentThatIsA(BlockMorph).receiver(),o=e.parentThatIsA(StageMorph),i=this,r=[];return o.children.concat(o).forEach(function(t){(t instanceof SpriteMorph||t instanceof StageMorph)&&(r=r.concat(t.allMessageNames()))}),r.forEach(function(e){t[e]=e}),t["~"]=null,t["new..."]=function(){new DialogBoxMorph(i,i.setContents,i).prompt("Message name",null,i.world())},t},InputSlotMorph.prototype.collidablesMenu=function(){var t={"mouse-pointer":["mouse-pointer"],edge:["edge"],"pen trails":["pen trails"]},e=this.parentThatIsA(BlockMorph).receiver(),o=e.parentThatIsA(StageMorph),i=[];return o.children.forEach(function(t){t instanceof SpriteMorph&&t.name!==e.name&&(i=i.concat(t.name))}),i.length>0&&(t["~"]=null,i.forEach(function(e){t[e]=e})),t},InputSlotMorph.prototype.distancesMenu=function(){var t={"mouse-pointer":["mouse-pointer"]},e=this.parentThatIsA(BlockMorph).receiver(),o=e.parentThatIsA(StageMorph),i=[];return o.children.forEach(function(t){t instanceof SpriteMorph&&t.name!==e.name&&(i=i.concat(t.name))}),i.length>0&&(t["~"]=null,i.forEach(function(e){t[e]=e})),t},InputSlotMorph.prototype.clonablesMenu=function(){var t={},e=this.parentThatIsA(BlockMorph).receiver(),o=e.parentThatIsA(StageMorph),i=[];return e instanceof SpriteMorph&&(t.myself=["myself"]),o.children.forEach(function(t){t instanceof SpriteMorph&&!t.isClone&&(i=i.concat(t.name))}),i.length>0&&(t["~"]=null,i.forEach(function(e){t[e]=e})),t},InputSlotMorph.prototype.objectsMenu=function(){var t=this.parentThatIsA(BlockMorph).receiver(),e=t.parentThatIsA(StageMorph),o={},i=[];return o[e.name]=e.name,e.children.forEach(function(t){t instanceof SpriteMorph&&i.push(t.name)}),i.length>0&&(o["~"]=null,i.forEach(function(t){o[t]=t})),o},InputSlotMorph.prototype.attributesMenu=function(){var t,e=this.parentThatIsA(BlockMorph),o=e.inputs()[1].evaluate(),i=e.receiver(),r=i.parentThatIsA(StageMorph),n={},s=[];return(t=o===r.name?r:detect(r.children,function(t){return t.name===o}))?(n=t instanceof SpriteMorph?{"x position":["x position"],"y position":["y position"],direction:["direction"],"costume #":["costume #"],"costume name":["costume name"],size:["size"]}:{"costume #":["costume #"],"costume name":["costume name"]},s=t.variables.names(),s.length>0&&(n["~"]=null,s.forEach(function(t){n[t]=t})),n):n},InputSlotMorph.prototype.costumesMenu=function(){var t,e=this.parentThatIsA(BlockMorph).receiver(),o=[];return t=e instanceof SpriteMorph?{Turtle:["Turtle"]}:{Empty:["Empty"]},e.costumes.asArray().forEach(function(t){o=o.concat(t.name)}),o.length>0&&(t["~"]=null,o.forEach(function(e){t[e]=e})),t},InputSlotMorph.prototype.soundsMenu=function(){var t=this.parentThatIsA(BlockMorph).receiver(),e=[],o={};return t.sounds.asArray().forEach(function(t){e=e.concat(t.name)}),e.length>0&&e.forEach(function(t){o[t]=t}),o},InputSlotMorph.prototype.getVarNamesDict=function(){var t,e,o,i,r,n=this.parentThatIsA(BlockMorph),s=[];return n?(t=n.receiver(),e=detect(n.allParents(),function(t){return t instanceof PrototypeHatBlockMorph}),e&&(s=e.inputs()[0].inputFragmentNames()),o=n.allParents().filter(function(t){return t instanceof RingMorph}),o.forEach(function(t){s=s.concat(t.inputs()[1].evaluate())}),i=n.allParents().filter(function(t){return"doDeclareVariables"===t.selector}),i.forEach(function(t){s=s.concat(t.inputs()[0].evaluate())}),t?(r=t.variables.allNamesDict(),s.forEach(function(t){r[t]=t}),r):{}):{}},InputSlotMorph.prototype.setChoices=function(t,e){var o=this.contents();this.choices=t,this.isReadOnly=e||!1,this.parent instanceof BlockMorph&&(this.parent.fixLabelColor(),e||(o.shadowOffset=new Point,o.shadowColor=null,o.setColor(new Color(0,0,0)))),this.fixLayout()},InputSlotMorph.prototype.fixLayout=function(){var t=this.contents(),e=this.arrow();t.isNumeric=this.isNumeric,t.isEditable=!this.isReadOnly,this.isReadOnly?(t.disableSelecting(),t.color=new Color(254,254,254)):(t.enableSelecting(),t.color=new Color(0,0,0)),this.choices?(e.setSize(this.fontSize),e.show()):(e.setSize(0),e.hide()),this.setHeight(t.height()+2*this.edge),this.setWidth(this.isNumeric?t.width()+Math.floor(.5*e.width())+this.height()+2*this.typeInPadding:Math.max(t.width()+e.width()+2*this.edge+2*this.typeInPadding,t.rawHeight?t.rawHeight()+e.width():t.height()/1.2+e.width(),this.minWidth)),t.setPosition(this.isNumeric?new Point(Math.floor(this.height()/2),this.edge).add(new Point(this.typeInPadding,0)).add(this.position()):new Point(this.edge,this.edge).add(new Point(this.typeInPadding,0)).add(this.position())),e.setPosition(new Point(this.right()-e.width()-this.edge,t.top())),this.parent&&this.parent.fixLayout&&(this.world()?(this.startLayout(),this.parent.fixLayout(),this.endLayout()):this.parent.fixLayout())},InputSlotMorph.prototype.mouseClickLeft=function(t){this.arrow().bounds.containsPoint(t)?this.dropDownMenu():this.isReadOnly?this.dropDownMenu():(this.contents().edit(),this.contents().selectAll())},InputSlotMorph.prototype.reactToKeystroke=function(){var t;this.constant&&(t=this.contents(),this.constant=null,t.isItalic=!1,t.drawNew())},InputSlotMorph.prototype.reactToEdit=function(){this.contents().clearSelection()},InputSlotMorph.prototype.reactToSliderEdit=function(){var t,e,o,i;if(this.executeOnSliderEdit&&(t=this.parentThatIsA(BlockMorph))){if(e=t.topBlock(),o=e.receiver(),e instanceof PrototypeHatBlockMorph)return;o&&(i=o.parentThatIsA(StageMorph),i&&i.isThreadSafe?i.threads.startProcess(e,i.isThreadSafe):e.mouseClickLeft())}},InputSlotMorph.prototype.userMenu=function(){var t=new MenuMorph(this);return!StageMorph.prototype.enableCodeMapping||this.isNumeric?this.parent.userMenu():(t.addItem("code string mapping...","mapToCode"),t)},InputSlotMorph.prototype.mapToCode=function(){new DialogBoxMorph(this,function(t){StageMorph.prototype.codeMappings.string=t},this).promptCode("Code mapping - String <#1>",StageMorph.prototype.codeMappings.string||"",this.world())},InputSlotMorph.prototype.mappedCode=function(){var t=StageMorph.prototype.codeMappings.string||"<#1>",e=this.parentThatIsA(BlockMorph),o=this.evaluate();return this.isNumeric?o:isNaN(parseFloat(o))&&isString(o)?e&&contains(["doSetVar","doChangeVar","doShowVar","doHideVar"],e.selector)?o:t.replace(/<#1>/g,o):o},InputSlotMorph.prototype.evaluate=function(){var t,e=this.contents();return this.constant?this.constant:this.isNumeric&&(t=parseFloat(e.text||"0"),!isNaN(t))?t:e.text},InputSlotMorph.prototype.isEmptySlot=function(){return""===this.contents().text},InputSlotMorph.prototype.drawNew=function(){var t,e,o;this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),e=this.parent?this.parent.color:new Color(120,120,120),t.fillStyle=this.color.toString(),this.isReadOnly&&(t.fillStyle=e.darker().toString()),this.cachedClr=e.toString(),this.cachedClrBright=e.lighter(this.contrast).toString(),this.cachedClrDark=e.darker(this.contrast).toString(),this.isNumeric?(o=(this.height()-2*this.edge)/2,t.beginPath(),t.arc(o+this.edge,o+this.edge,o,radians(90),radians(-90),!1),t.arc(this.width()-o-this.edge,o+this.edge,o,radians(-90),radians(90),!1),t.closePath(),t.fill(),MorphicPreferences.isFlat||this.drawRoundBorder(t)):(t.fillRect(this.edge,this.edge,this.width()-2*this.edge,this.height()-2*this.edge),MorphicPreferences.isFlat||this.drawRectBorder(t))},InputSlotMorph.prototype.drawRectBorder=function(t){var e,o=.5*this.edge;t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.shadowOffsetY=o,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(this.edge,o),t.lineTo(this.width()-this.edge-o,o),t.stroke(),t.shadowOffsetY=0,e=t.createLinearGradient(0,0,this.edge,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(o,this.edge),t.lineTo(o,this.height()-this.edge-o),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createLinearGradient(0,this.height()-this.edge,0,this.height()),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.edge,this.height()-o),t.lineTo(this.width()-this.edge,this.height()-o),t.stroke(),e=t.createLinearGradient(this.width()-this.edge,0,this.width(),0),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.width()-o,this.edge),t.lineTo(this.width()-o,this.height()-this.edge),t.stroke()},InputSlotMorph.prototype.drawRoundBorder=function(t){var e,o,i,r=.5*this.edge,n=(this.height()-2*this.edge)/2;t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",e=n+this.edge,o=this.width()-n-this.edge,o>e&&(t.shadowOffsetX=r,t.shadowOffsetY=r,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),i=t.createLinearGradient(0,0,0,this.edge),i.addColorStop(0,this.cachedClr),i.addColorStop(1,this.cachedClrDark),t.strokeStyle=i,t.beginPath(),t.moveTo(e,r),t.lineTo(o,r),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0),i=t.createLinearGradient(0,this.height()-this.edge,0,this.height()),i.addColorStop(0,this.cachedClrBright),i.addColorStop(1,this.cachedClr),t.strokeStyle=i,t.beginPath(),t.moveTo(n+this.edge,this.height()-r),t.lineTo(this.width()-n-this.edge,this.height()-r),t.stroke(),n=this.height()/2,t.shadowOffsetX=r,t.shadowOffsetY=r,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),i=t.createRadialGradient(n,n,n-this.edge,n,n,n),i.addColorStop(1,this.cachedClr),i.addColorStop(0,this.cachedClrDark),t.strokeStyle=i,t.beginPath(),t.arc(n,n,n-r,radians(180),radians(270),!1),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,i=t.createRadialGradient(this.width()-n,n,n-this.edge,this.width()-n,n,n),i.addColorStop(1,this.cachedClr),i.addColorStop(0,this.cachedClrBright),t.strokeStyle=i,t.beginPath(),t.arc(this.width()-n,n,n-r,radians(0),radians(90),!1),t.stroke()},TemplateSlotMorph.prototype=new ArgMorph,TemplateSlotMorph.prototype.constructor=TemplateSlotMorph,TemplateSlotMorph.uber=ArgMorph.prototype,TemplateSlotMorph.prototype.init=function(t){var e=new ReporterBlockMorph;this.labelString=t||"",e.isDraggable=!1,e.isTemplate=!0,void 0!==modules.objects?(e.color=SpriteMorph.prototype.blockColor.variables,e.category="variables"):(e.color=new Color(243,118,29),e.category=null),e.setSpec(this.labelString),e.selector="reportGetVar",TemplateSlotMorph.uber.init.call(this),this.add(e),this.fixLayout(),this.isDraggable=!1,this.isStatic=!0},TemplateSlotMorph.prototype.getSpec=function(){return"%t"},TemplateSlotMorph.prototype.template=function(){return this.children[0]},TemplateSlotMorph.prototype.contents=function(){return this.template().blockSpec},TemplateSlotMorph.prototype.setContents=function(t){var e=this.template();e.setSpec(t),e.fixBlockColor(),e.fixLabelColor()},TemplateSlotMorph.prototype.evaluate=function(){return this.contents()},TemplateSlotMorph.prototype.fixLayout=function(){var t=this.template();this.setExtent(t.extent().add(2*this.edge+2)),t.setPosition(this.position().add(this.edge+1)),this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},TemplateSlotMorph.prototype.drawNew=function(){var t;this.parent instanceof Morph&&(this.color=this.parent.color.copy()),this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,this.drawRounded(t)},TemplateSlotMorph.prototype.drawRounded=ReporterBlockMorph.prototype.drawRounded,BooleanSlotMorph.prototype=new ArgMorph,BooleanSlotMorph.prototype.constructor=BooleanSlotMorph,BooleanSlotMorph.uber=ArgMorph.prototype,BooleanSlotMorph.prototype.init=function(){BooleanSlotMorph.uber.init.call(this)},BooleanSlotMorph.prototype.getSpec=function(){return"%b"},BooleanSlotMorph.prototype.drawNew=function(){var t;this.silentSetExtent(new Point(2*(this.fontSize+2*this.edge),this.fontSize+2*this.edge)),this.parent&&(this.color=this.parent.color),this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.drawDiamond(t,!0)},BooleanSlotMorph.prototype.drawDiamond=function(t){var e,o=this.width(),i=this.height(),r=i/2,n=this.edge/2;t.fillStyle=this.color.darker(25).toString(),t.beginPath(),t.moveTo(0,r),t.lineTo(r,0),t.lineTo(o-r,0),t.lineTo(o,r),t.lineTo(o-r,i),t.lineTo(r,i),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.shadowOffsetX=n,t.shadowBlur=n,t.shadowColor="black",e=t.createLinearGradient(0,r,.6*this.edge,r+.6*this.edge),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,r),t.lineTo(r,n),t.closePath(),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=n,t.shadowBlur=this.edge,e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(r,n),t.lineTo(o-r,n),t.closePath(),t.stroke(),t.shadowOffsetY=0,t.shadowBlur=0,e=t.createLinearGradient(o-r-.6*this.edge,i-.6*this.edge,o-r,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(o-r,i-n),t.lineTo(o-n,r),t.closePath(),t.stroke(),e=t.createLinearGradient(0,i-this.edge,0,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(r,i-n),t.lineTo(o-r-n,i-n),t.closePath(),t.stroke())},BooleanSlotMorph.prototype.isEmptySlot=function(){return!0},ArrowMorph.prototype=new Morph,ArrowMorph.prototype.constructor=ArrowMorph,ArrowMorph.uber=Morph.prototype,ArrowMorph.prototype.init=function(t,e,o,i){this.direction=t||"down",this.size=e||(0===e?0:50),this.padding=o||0,ArrowMorph.uber.init.call(this),this.color=i||new Color(0,0,0),this.setExtent(new Point(this.size,this.size))},ArrowMorph.prototype.setSize=function(t){var e=Math.max(t,1);this.size=t,this.setExtent(new Point(e,e))},ArrowMorph.prototype.drawNew=function(){this.image=newCanvas(this.extent());var t=this.image.getContext("2d"),e=this.padding,o=this.height(),i=Math.floor(o/2),r=this.width(),n=Math.floor(r/2);t.fillStyle=this.color.toString(),t.beginPath(),"down"===this.direction?(t.moveTo(e,i),t.lineTo(r-e,i),t.lineTo(n,o-e)):"up"===this.direction?(t.moveTo(e,i),t.lineTo(r-e,i),t.lineTo(n,e)):"left"===this.direction?(t.moveTo(e,i),t.lineTo(n,e),t.lineTo(n,o-e)):(t.moveTo(n,e),t.lineTo(r-e,i),t.lineTo(n,o-e)),t.closePath(),t.fill()},TextSlotMorph.prototype=new InputSlotMorph,TextSlotMorph.prototype.constructor=TextSlotMorph,TextSlotMorph.uber=InputSlotMorph.prototype,TextSlotMorph.prototype.init=function(t,e,o,i){var r=new TextMorph(""),n=new ArrowMorph("down",0,Math.max(Math.floor(this.fontSize/6),1));r.fontSize=this.fontSize,r.drawNew(),this.isUnevaluated=!1,this.choices=o||null,this.oldContentsExtent=r.extent(),this.isNumeric=e||!1,this.isReadOnly=i||!1,this.minWidth=0,this.constant=null,InputSlotMorph.uber.init.call(this),this.color=new Color(255,255,255),this.add(r),this.add(n),r.isEditable=!0,r.isDraggable=!1,r.enableSelecting(),this.setContents(t)},TextSlotMorph.prototype.getSpec=function(){return this.isNumeric?"%mln":"%mlt"},TextSlotMorph.prototype.contents=function(){return detect(this.children,function(t){return t instanceof TextMorph})},TextSlotMorph.prototype.layoutChanged=function(){this.fixLayout()},SymbolMorph.prototype=new Morph,SymbolMorph.prototype.constructor=SymbolMorph,SymbolMorph.uber=Morph.prototype,SymbolMorph.prototype.names=["square","pointRight","gears","file","fullScreen","normalScreen","smallStage","normalStage","turtle","stage","turtleOutline","pause","flag","octagon","cloud","cloudOutline","cloudGradient","turnRight","turnLeft","storage","poster","flash","brush","rectangle","rectangleSolid","circle","circleSolid","line","crosshairs","paintbucket","eraser","pipette","speechBubble","speechBubbleOutline","arrowUp","arrowUpOutline","arrowLeft","arrowLeftOutline","arrowDown","arrowDownOutline","arrowRight","arrowRightOutline","robot"],SymbolMorph.prototype.init=function(t,e,o,i,r){this.isProtectedLabel=!1,this.isReadOnly=!0,this.name=t||"square",this.size=e||(0===e?0:50),this.shadowOffset=i||new Point(0,0),this.shadowColor=r||null,SymbolMorph.uber.init.call(this),this.color=o||new Color(0,0,0),this.drawNew()
},SymbolMorph.prototype.setLabelColor=function(t,e,o){this.shadowOffset=o,this.shadowColor=e,this.setColor(t)},SymbolMorph.prototype.drawNew=function(){var t,e,o,i,r;this.image=newCanvas(new Point(this.symbolWidth()+Math.abs(this.shadowOffset.x),this.size+Math.abs(this.shadowOffset.y))),this.silentSetWidth(this.image.width),this.silentSetHeight(this.image.height),t=this.image.getContext("2d"),i=this.shadowOffset.x<0?0:this.shadowOffset.x,r=this.shadowOffset.y<0?0:this.shadowOffset.y,e=this.shadowOffset.x<0?Math.abs(this.shadowOffset.x):0,o=this.shadowOffset.y<0?Math.abs(this.shadowOffset.y):0,this.shadowColor&&t.drawImage(this.symbolCanvasColored(this.shadowColor),i,r),t.drawImage(this.symbolCanvasColored(this.color),e,o)},SymbolMorph.prototype.symbolCanvasColored=function(t){if(this.name instanceof Costume)return this.name.thumbnail(new Point(this.symbolWidth(),this.size));var e=newCanvas(new Point(this.symbolWidth(),this.size));switch(this.name){case"square":return this.drawSymbolStop(e,t);case"pointRight":return this.drawSymbolPointRight(e,t);case"gears":return this.drawSymbolGears(e,t);case"file":return this.drawSymbolFile(e,t);case"fullScreen":return this.drawSymbolFullScreen(e,t);case"normalScreen":return this.drawSymbolNormalScreen(e,t);case"smallStage":return this.drawSymbolSmallStage(e,t);case"normalStage":return this.drawSymbolNormalStage(e,t);case"turtle":return this.drawSymbolTurtle(e,t);case"stage":return this.drawSymbolStop(e,t);case"turtleOutline":return this.drawSymbolTurtleOutline(e,t);case"pause":return this.drawSymbolPause(e,t);case"flag":return this.drawSymbolFlag(e,t);case"octagon":return this.drawSymbolOctagon(e,t);case"cloud":return this.drawSymbolCloud(e,t);case"cloudOutline":return this.drawSymbolCloudOutline(e,t);case"cloudGradient":return this.drawSymbolCloudGradient(e,t);case"turnRight":return this.drawSymbolTurnRight(e,t);case"turnLeft":return this.drawSymbolTurnLeft(e,t);case"storage":return this.drawSymbolStorage(e,t);case"poster":return this.drawSymbolPoster(e,t);case"flash":return this.drawSymbolFlash(e,t);case"brush":return this.drawSymbolBrush(e,t);case"rectangle":return this.drawSymbolRectangle(e,t);case"rectangleSolid":return this.drawSymbolRectangleSolid(e,t);case"circle":return this.drawSymbolCircle(e,t);case"circleSolid":return this.drawSymbolCircleSolid(e,t);case"line":return this.drawSymbolLine(e,t);case"crosshairs":return this.drawSymbolCrosshairs(e,t);case"paintbucket":return this.drawSymbolPaintbucket(e,t);case"eraser":return this.drawSymbolEraser(e,t);case"pipette":return this.drawSymbolPipette(e,t);case"speechBubble":return this.drawSymbolSpeechBubble(e,t);case"speechBubbleOutline":return this.drawSymbolSpeechBubbleOutline(e,t);case"arrowUp":return this.drawSymbolArrowUp(e,t);case"arrowUpOutline":return this.drawSymbolArrowUpOutline(e,t);case"arrowLeft":return this.drawSymbolArrowLeft(e,t);case"arrowLeftOutline":return this.drawSymbolArrowLeftOutline(e,t);case"arrowDown":return this.drawSymbolArrowDown(e,t);case"arrowDownOutline":return this.drawSymbolArrowDownOutline(e,t);case"arrowRight":return this.drawSymbolArrowRight(e,t);case"arrowRightOutline":return this.drawSymbolArrowRightOutline(e,t);case"robot":return this.drawSymbolRobot(e,t);default:return e}},SymbolMorph.prototype.symbolWidth=function(){var t=this.size;if(this.name instanceof Costume)return t/this.name.height()*this.name.width();switch(this.name){case"pointRight":return Math.sqrt(t*t-Math.pow(t/2,2));case"flash":case"file":return.8*t;case"smallStage":case"normalStage":return 1.2*t;case"turtle":case"turtleOutline":case"stage":return 1.3*t;case"cloud":case"cloudGradient":case"cloudOutline":return 1.6*t;case"turnRight":case"turnLeft":return t/3*2;default:return t}},SymbolMorph.prototype.drawSymbolStop=function(t,e){var o=t.getContext("2d");return o.fillStyle=e.toString(),o.fillRect(0,0,t.width,t.height),t},SymbolMorph.prototype.drawSymbolPointRight=function(t,e){var o=t.getContext("2d");return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(0,0),o.lineTo(t.width,Math.round(t.height/2)),o.lineTo(0,t.height),o.lineTo(0,0),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolGears=function(t,e){var o=t.getContext("2d"),i=t.width,r=i/2,n=i/6;return o.strokeStyle=e.toString(),o.lineWidth=t.width/7,o.beginPath(),o.arc(r,r,i,radians(0),radians(360),!0),o.arc(r,r,1.5*n,radians(0),radians(360),!1),o.closePath(),o.clip(),o.moveTo(0,r),o.lineTo(i,r),o.stroke(),o.moveTo(r,0),o.lineTo(r,i),o.stroke(),o.moveTo(n,n),o.lineTo(i-n,i-n),o.stroke(),o.moveTo(i-n,n),o.lineTo(n,i-n),o.stroke(),t},SymbolMorph.prototype.drawSymbolFile=function(t,e){var o=t.getContext("2d"),i=Math.min(t.width,t.height)/2;return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(0,0),o.lineTo(i,0),o.lineTo(i,i),o.lineTo(t.width,i),o.lineTo(t.width,t.height),o.lineTo(0,t.height),o.closePath(),o.fill(),o.fillStyle=e.darker(25).toString(),o.beginPath(),o.moveTo(i,0),o.lineTo(t.width,i),o.lineTo(i,i),o.lineTo(i,0),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolFullScreen=function(t,e){var o=t.getContext("2d"),i=t.height,r=t.width/2,n=t.width/20,s=t.width/2;return o.strokeStyle=e.toString(),o.lineWidth=t.width/5,o.moveTo(r-n,r+n),o.lineTo(0,i),o.stroke(),o.strokeStyle=e.toString(),o.lineWidth=t.width/5,o.moveTo(r+n,r-n),o.lineTo(i,0),o.stroke(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(0,i),o.lineTo(0,i-s),o.lineTo(s,i),o.closePath(),o.fill(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(i,0),o.lineTo(i-s,0),o.lineTo(i,s),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolNormalScreen=function(t,e){var o=t.getContext("2d"),i=t.height,r=t.width/2,n=t.width/20,s=t.width;return o.strokeStyle=e.toString(),o.lineWidth=t.width/5,o.moveTo(r-3*n,r+3*n),o.lineTo(0,i),o.stroke(),o.strokeStyle=e.toString(),o.lineWidth=t.width/5,o.moveTo(r+3*n,r-3*n),o.lineTo(i,0),o.stroke(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(r+n,r-n),o.lineTo(s,r-n),o.lineTo(r+n,0),o.closePath(),o.fill(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(r-n,r+n),o.lineTo(0,r+n),o.lineTo(r-n,s),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolSmallStage=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=i/2,s=r/2;return o.fillStyle=e.darker(40).toString(),o.fillRect(0,0,i,r),o.fillStyle=e.toString(),o.fillRect(n,0,n,s),t},SymbolMorph.prototype.drawSymbolNormalStage=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=i/2,s=r/2;return o.fillStyle=e.toString(),o.fillRect(0,0,i,r),o.fillStyle=e.darker(25).toString(),o.fillRect(n,0,n,s),t},SymbolMorph.prototype.drawSymbolTurtle=function(t,e){var o=t.getContext("2d");return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(0,0),o.lineTo(t.width,t.height/2),o.lineTo(0,t.height),o.lineTo(t.height/2,t.height/2),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolTurtleOutline=function(t,e){var o=t.getContext("2d");return o.strokeStyle=e.toString(),o.beginPath(),o.moveTo(0,0),o.lineTo(t.width,t.height/2),o.lineTo(0,t.height),o.lineTo(t.height/2,t.height/2),o.closePath(),o.stroke(),t},SymbolMorph.prototype.drawSymbolPause=function(t,e){var o=t.getContext("2d"),i=t.width/5;return o.fillStyle=e.toString(),o.fillRect(0,0,2*i,t.height),o.fillRect(3*i,0,2*i,t.height),t},SymbolMorph.prototype.drawSymbolFlag=function(t,e){var o=t.getContext("2d"),i=t.width,r=Math.max(i/12,1),n=t.height;return o.lineWidth=r,o.strokeStyle=e.toString(),o.beginPath(),o.moveTo(r/2,0),o.lineTo(r/2,t.height),o.stroke(),o.lineWidth=n/2,o.beginPath(),o.moveTo(0,n/4),o.bezierCurveTo(.8*i,n/4,.1*i,.5*n,i,.5*n),o.stroke(),t},SymbolMorph.prototype.drawSymbolOctagon=function(t,e){var o=t.getContext("2d"),i=t.width,r=(i-.383*i)/2;return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(r,0),o.lineTo(i-r,0),o.lineTo(i,r),o.lineTo(i,i-r),o.lineTo(i-r,i),o.lineTo(r,i),o.lineTo(0,i-r),o.lineTo(0,r),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolCloud=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=2*r/5,s=r/4,a=3*r/10,h=r/5;return o.fillStyle=e.toString(),o.beginPath(),o.arc(s,r-s,s,radians(90),radians(259),!1),o.arc(i/20*5,r/9*4,h,radians(165),radians(300),!1),o.arc(i/20*11,n,n,radians(200),radians(357),!1),o.arc(i-a,r-a,a,radians(269),radians(90),!1),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolCloudGradient=function(t,e){var o,i=t.getContext("2d"),r=t.width,n=t.height,s=2*n/5,a=n/4,h=3*n/10,l=n/5;return o=i.createRadialGradient(0,0,0,0,0,r),o.addColorStop(0,e.lighter(25).toString()),o.addColorStop(1,e.darker(25).toString()),i.fillStyle=o,i.beginPath(),i.arc(a,n-a,a,radians(90),radians(259),!1),i.arc(r/20*5,n/9*4,l,radians(165),radians(300),!1),i.arc(r/20*11,s,s,radians(200),radians(357),!1),i.arc(r-h,n-h,h,radians(269),radians(90),!1),i.closePath(),i.fill(),t},SymbolMorph.prototype.drawSymbolCloudOutline=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=2*r/5,s=r/4,a=3*r/10,h=r/5;return o.strokeStyle=e.toString(),o.beginPath(),o.arc(s+1,r-s-1,s,radians(90),radians(259),!1),o.arc(i/20*5,r/9*4,h,radians(165),radians(300),!1),o.arc(i/20*11,n+1,n,radians(200),radians(357),!1),o.arc(i-a-1,r-a-1,a,radians(269),radians(90),!1),o.closePath(),o.stroke(),t},SymbolMorph.prototype.drawSymbolTurnRight=function(t,e){var o=t.getContext("2d"),i=t.width,r=Math.max(i/10,1),n=i/2;return o.lineWidth=r,o.strokeStyle=e.toString(),o.beginPath(),o.arc(n,2*n,n-r/2,radians(0),radians(-90),!1),o.stroke(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(i,n),o.lineTo(n,0),o.lineTo(n,2*n),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolTurnLeft=function(t,e){var o=t.getContext("2d"),i=t.width,r=Math.max(i/10,1),n=i/2;return o.lineWidth=r,o.strokeStyle=e.toString(),o.beginPath(),o.arc(n,2*n,n-r/2,radians(180),radians(-90),!0),o.stroke(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(0,n),o.lineTo(n,0),o.lineTo(n,2*n),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolStorage=function(t,e){function o(t,o){i.fillStyle=e.toString(),i.beginPath(),i.arc(r/2,t-n,s,radians(60),radians(120),!1),i.lineTo(0,t-2*a),i.arc(r/2,t-n-2*a,s,radians(120),radians(60),!0),i.closePath(),i.fill(),i.fillStyle=e.darker(25).toString(),i.beginPath(),o&&i.arc(r/2,t-n-2*a,s,radians(120),radians(60),!0),i.arc(r/2,t+6*a+1,s,radians(60),radians(120),!0),i.closePath(),o?i.fill():i.stroke()}var i=t.getContext("2d"),r=t.width,n=t.height,s=t.height,a=t.height/11;return i.strokeStyle=e.toString(),o(n),o(n-3*a),o(n-6*a,!1),t},SymbolMorph.prototype.drawSymbolPoster=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=.75*r,s=t.height/5;return o.fillStyle=e.toString(),o.strokeStyle=e.toString(),o.lineWidth=i/15,o.moveTo(i/2,r/3),o.lineTo(i/6,r),o.stroke(),o.moveTo(i/2,r/3),o.lineTo(i/2,r),o.stroke(),o.moveTo(i/2,r/3),o.lineTo(5*i/6,r),o.stroke(),o.fillRect(0,0,i,n),o.clearRect(0,n,i,i/20),o.clearRect(i-s,n-s,s+1,s+1),o.fillStyle=e.darker(25).toString(),o.beginPath(),o.moveTo(i,n-s),o.lineTo(i-s,n-s),o.lineTo(i-s,n),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolFlash=function(t,e){var o=t.getContext("2d"),i=t.width,r=i/3,n=t.height,s=n/3,a=s/3;return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(r,0),o.lineTo(0,s),o.lineTo(r,s),o.lineTo(0,2*s),o.lineTo(r,2*s),o.lineTo(0,n),o.lineTo(i,2*s-a),o.lineTo(2*r,2*s-a),o.lineTo(i,s-a),o.lineTo(2*r,s-a),o.lineTo(i,0),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolBrush=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=Math.max(i/30,.5);return o.fillStyle=e.toString(),o.lineWidth=2*n,o.beginPath(),o.moveTo(i/8*3,r/2),o.quadraticCurveTo(0,r/2,n,r-n),o.quadraticCurveTo(i/2,r,i/2,r/8*5),o.closePath(),o.fill(),o.lineJoin="round",o.lineCap="round",o.strokeStyle=e.toString(),o.moveTo(i/8*3,r/2),o.lineTo(.75*i,n),o.quadraticCurveTo(i,0,i-n,.25*r),o.stroke(),o.moveTo(i/2,r/8*5),o.lineTo(i-n,.25*r),o.stroke(),t},SymbolMorph.prototype.drawSymbolRectangle=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.width,n=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*n,o.beginPath(),o.moveTo(n,n),o.lineTo(i-n,n),o.lineTo(i-n,r-n),o.lineTo(n,r-n),o.closePath(),o.stroke(),t},SymbolMorph.prototype.drawSymbolRectangleSolid=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.width;return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(0,0),o.lineTo(i,0),o.lineTo(i,r),o.lineTo(0,r),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolCircle=function(t,e){var o=t.getContext("2d"),i=t.width,r=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*r,o.arc(i/2,i/2,i/2-r,radians(0),radians(360),!1),o.stroke(),t},SymbolMorph.prototype.drawSymbolCircleSolid=function(t,e){var o=t.getContext("2d"),i=t.width;return o.fillStyle=e.toString(),o.arc(i/2,i/2,i/2,radians(0),radians(360),!1),o.fill(),t},SymbolMorph.prototype.drawSymbolLine=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*n,o.lineCap="round",o.moveTo(n,n),o.lineTo(i-n,r-n),o.stroke(),t},SymbolMorph.prototype.drawSymbolCrosshairs=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=.5;return o.strokeStyle=e.toString(),o.lineWidth=2*n,o.moveTo(n,r/2),o.lineTo(i-n,r/2),o.stroke(),o.moveTo(i/2,n),o.lineTo(i/2,r-n),o.stroke(),o.moveTo(i/2,r/2),o.arc(i/2,i/2,i/3-n,radians(0),radians(360),!1),o.stroke(),t},SymbolMorph.prototype.drawSymbolPaintbucket=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/5,s=Math.max(i/30,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*s,o.beginPath(),o.moveTo(2*n,n),o.lineTo(4*n,3*n),o.lineTo(3*n,4*n),o.quadraticCurveTo(2*n,r,n,4*n),o.quadraticCurveTo(0,3*n,n,2*n),o.closePath(),o.stroke(),o.lineWidth=s,o.moveTo(2*n,2.5*n),o.arc(2*n,2.5*n,s,radians(0),radians(360),!1),o.stroke(),o.moveTo(2*n,2.5*n),o.lineTo(2*n,n/2+s),o.stroke(),o.arc(1.5*n,n/2+s,n/2,radians(0),radians(180),!0),o.stroke(),o.moveTo(n,n/2+s),o.lineTo(n,2*n),o.stroke(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(3.5*n,3.5*n),o.quadraticCurveTo(i,3.5*n,i-s,r),o.lineTo(i,r),o.quadraticCurveTo(i,2*n,2.5*n,1.5*n),o.lineTo(4*n,3*n),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolEraser=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/4,s=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*s,o.beginPath(),o.moveTo(3*n,s),o.lineTo(s,3*n),o.quadraticCurveTo(n,r,2*n,3*n),o.lineTo(i-s,n),o.closePath(),o.stroke(),o.fillStyle=e.toString(),o.beginPath(),o.moveTo(3*n,0),o.lineTo(1.5*n,1.5*n),o.lineTo(2.5*n,2.5*n),o.lineTo(i,n),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolPipette=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/4,s=n/2,a=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*a,o.beginPath(),o.moveTo(a,r-a),o.quadraticCurveTo(s,r-s,s,r-n),o.lineTo(2*n,1.5*n),o.stroke(),o.beginPath(),o.moveTo(a,r-a),o.quadraticCurveTo(s,r-s,n,r-s),o.lineTo(2.5*n,2*n),o.stroke(),o.fillStyle=e.toString(),o.arc(3*n,n,n-a,radians(0),radians(360),!1),o.fill(),o.beginPath(),o.moveTo(2*n,n),o.lineTo(3*n,2*n),o.stroke(),t},SymbolMorph.prototype.drawSymbolSpeechBubble=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/3,s=Math.max(i/20,.5);return o.fillStyle=e.toString(),o.lineWidth=2*s,o.beginPath(),o.moveTo(n,2*n),o.quadraticCurveTo(s,2*n,s,n),o.quadraticCurveTo(s,s,n,s),o.lineTo(2*n,s),o.quadraticCurveTo(i-s,s,i-s,n),o.quadraticCurveTo(i-s,2*n,2*n,2*n),o.lineTo(n/2,r-s),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolSpeechBubbleOutline=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/3,s=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*s,o.beginPath(),o.moveTo(n,2*n),o.quadraticCurveTo(s,2*n,s,n),o.quadraticCurveTo(s,s,n,s),o.lineTo(2*n,s),o.quadraticCurveTo(i-s,s,i-s,n),o.quadraticCurveTo(i-s,2*n,2*n,2*n),o.lineTo(n/2,r-s),o.closePath(),o.stroke(),t},SymbolMorph.prototype.drawSymbolArrowUp=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/2,s=Math.max(i/20,.5);return o.fillStyle=e.toString(),o.lineWidth=2*s,o.beginPath(),o.moveTo(s,n),o.lineTo(n,s),o.lineTo(i-s,n),o.lineTo(.65*i,n),o.lineTo(.65*i,r-s),o.lineTo(.35*i,r-s),o.lineTo(.35*i,n),o.closePath(),o.fill(),t},SymbolMorph.prototype.drawSymbolArrowUpOutline=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/2,s=Math.max(i/20,.5);return o.strokeStyle=e.toString(),o.lineWidth=2*s,o.beginPath(),o.moveTo(s,n),o.lineTo(n,s),o.lineTo(i-s,n),o.lineTo(.65*i,n),o.lineTo(.65*i,r-s),o.lineTo(.35*i,r-s),o.lineTo(.35*i,n),o.closePath(),o.stroke(),t},SymbolMorph.prototype.drawSymbolArrowDown=function(t,e){var o=t.getContext("2d"),i=t.width;return o.save(),o.translate(i,i),o.rotate(radians(180)),this.drawSymbolArrowUp(t,e),o.restore(),t},SymbolMorph.prototype.drawSymbolArrowDownOutline=function(t,e){var o=t.getContext("2d"),i=t.width;return o.save(),o.translate(i,i),o.rotate(radians(180)),this.drawSymbolArrowUpOutline(t,e),o.restore(),t},SymbolMorph.prototype.drawSymbolArrowLeft=function(t,e){var o=t.getContext("2d"),i=t.width;return o.save(),o.translate(0,i),o.rotate(radians(-90)),this.drawSymbolArrowUp(t,e),o.restore(),t},SymbolMorph.prototype.drawSymbolArrowLeftOutline=function(t,e){var o=t.getContext("2d"),i=t.width;return o.save(),o.translate(0,i),o.rotate(radians(-90)),this.drawSymbolArrowUpOutline(t,e),o.restore(),t},SymbolMorph.prototype.drawSymbolArrowRight=function(t,e){var o=t.getContext("2d"),i=t.width;return o.save(),o.translate(i,0),o.rotate(radians(90)),this.drawSymbolArrowUp(t,e),o.restore(),t},SymbolMorph.prototype.drawSymbolArrowRightOutline=function(t,e){var o=t.getContext("2d"),i=t.width;return o.save(),o.translate(i,0),o.rotate(radians(90)),this.drawSymbolArrowUpOutline(t,e),o.restore(),t},SymbolMorph.prototype.drawSymbolRobot=function(t,e){var o=t.getContext("2d"),i=t.width,r=t.height,n=t.width/6,s=n/2,a=Math.max(i/20,.5);return o.fillStyle=e.toString(),o.beginPath(),o.moveTo(n+a,n),o.lineTo(2*n,n),o.lineTo(2.5*n,1.5*n),o.lineTo(3.5*n,1.5*n),o.lineTo(4*n,n),o.lineTo(5*n-a,n),o.lineTo(4*n,3*n),o.lineTo(4*n,4*n-a),o.lineTo(2*n,4*n-a),o.lineTo(2*n,3*n),o.closePath(),o.fill(),o.beginPath(),o.moveTo(2.75*n,n+a),o.lineTo(2.4*n,n),o.lineTo(2.2*n,0),o.lineTo(3.8*n,0),o.lineTo(3.6*n,n),o.lineTo(3.25*n,n+a),o.closePath(),o.fill(),o.beginPath(),o.moveTo(2.5*n,4*n),o.lineTo(n,4*n),o.lineTo(s+a,r),o.lineTo(2*n,r),o.closePath(),o.fill(),o.beginPath(),o.moveTo(3.5*n,4*n),o.lineTo(5*n,4*n),o.lineTo(i-(s+a),r),o.lineTo(4*n,r),o.closePath(),o.fill(),o.beginPath(),o.moveTo(n,n),o.lineTo(a,1.5*n),o.lineTo(a,3.25*n),o.lineTo(1.5*n,3.5*n),o.closePath(),o.fill(),o.beginPath(),o.moveTo(5*n,n),o.lineTo(i-a,1.5*n),o.lineTo(i-a,3.25*n),o.lineTo(4.5*n,3.5*n),o.closePath(),o.fill(),t},ColorSlotMorph.prototype=new ArgMorph,ColorSlotMorph.prototype.constructor=ColorSlotMorph,ColorSlotMorph.uber=ArgMorph.prototype,ColorSlotMorph.prototype.init=function(t){ColorSlotMorph.uber.init.call(this),this.setColor(t||new Color(145,26,68))},ColorSlotMorph.prototype.getSpec=function(){return"%clr"},ColorSlotMorph.prototype.getUserColor=function(){var t=this,e=this.world(),o=e.hand,i=getDocumentPositionOf(e.worldCanvas),r=o.processMouseMove,n=o.processMouseDown,s=o.processMouseUp,a=new ColorPaletteMorph(null,new Point(16*this.fontSize,10*this.fontSize));e.add(a),a.setPosition(this.bottomLeft().add(new Point(0,this.edge))),o.processMouseMove=function(r){o.setPosition(new Point(r.pageX-i.x,r.pageY-i.y)),t.setColor(e.getGlobalPixelColor(o.position()))},o.processMouseDown=nop,o.processMouseUp=function(){a.destroy(),o.processMouseMove=r,o.processMouseDown=n,o.processMouseUp=s}},ColorSlotMorph.prototype.mouseClickLeft=function(){this.getUserColor()},ColorSlotMorph.prototype.evaluate=function(){return this.color},ColorSlotMorph.prototype.drawNew=function(){var t,e,o;o=this.fontSize+2*this.edge+2*this.typeInPadding,this.silentSetExtent(new Point(o,o)),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),e=this.parent?this.parent.color:new Color(120,120,120),t.fillStyle=this.color.toString(),this.cachedClr=e.toString(),this.cachedClrBright=e.lighter(this.contrast).toString(),this.cachedClrDark=e.darker(this.contrast).toString(),t.fillRect(this.edge,this.edge,this.width()-2*this.edge,this.height()-2*this.edge),MorphicPreferences.isFlat||this.drawRectBorder(t)},ColorSlotMorph.prototype.drawRectBorder=InputSlotMorph.prototype.drawRectBorder,BlockHighlightMorph.prototype=new Morph,BlockHighlightMorph.prototype.constructor=BlockHighlightMorph,BlockHighlightMorph.uber=Morph.prototype,MultiArgMorph.prototype=new ArgMorph,MultiArgMorph.prototype.constructor=MultiArgMorph,MultiArgMorph.uber=ArgMorph.prototype,MultiArgMorph.prototype.init=function(t,e,o,i,r,n,s,a,h){var l,p,c,d,u=new FrameMorph;for(this.slotSpec=t||"%s",this.labelText=localize(e||""),this.minInputs=o||0,this.elementSpec=i||null,this.labelColor=n||null,this.shadowColor=s||null,this.shadowOffset=a||null,this.canBeEmpty=!0,MultiArgMorph.uber.init.call(this),this.alpha=h===!1?1:0,u.alpha=h===!1?1:0,u.noticesTransparentClick=!0,this.noticesTransparentclick=!0,l=this.labelPart(this.labelText),this.add(l),l.hide(),p=new ArrowMorph("left",this.fontSize,Math.max(Math.floor(this.fontSize/6),1),r),c=new ArrowMorph("right",this.fontSize,Math.max(Math.floor(this.fontSize/6),1),r),u.add(p),u.add(c),u.drawNew(),u.acceptsDrops=!1,this.add(u),d=0;d<this.minInputs;d+=1)this.addInput()},MultiArgMorph.prototype.label=function(){return this.children[0]},MultiArgMorph.prototype.arrows=function(){return this.children[this.children.length-1]},MultiArgMorph.prototype.getSpec=function(){return"%mult"+this.slotSpec},MultiArgMorph.prototype.setContents=function(t){var e,o=this.inputs();for(e=0;e<t.length;e+=1)null!==t[e]&&o[e]&&o[e].setContents(t[e])},MultiArgMorph.prototype.hide=function(){this.isVisible=!1,this.changed()},MultiArgMorph.prototype.show=function(){this.isVisible=!0,this.changed()},MultiArgMorph.prototype.setLabelColor=function(t,e,o){this.textColor=t,this.shadowColor=e,this.shadowOffset=o,MultiArgMorph.uber.setLabelColor.call(this,t,e,o)},MultiArgMorph.prototype.fixLayout=function(){if("%t"===this.slotSpec&&(this.isStatic=!0),this.parent){var t,e,o=this.label();this.color=this.parent.color,t=this.shadowColor||this.parent.color.darker(this.labelContrast),e=this.shadowOffset||o.shadowOffset,this.arrows().color=this.color,""!==this.labelText&&(o.shadowColor.eq(t)||(o.shadowColor=t,o.shadowOffset=e,o.drawNew()))}this.fixArrowsLayout(),MultiArgMorph.uber.fixLayout.call(this),this.parent&&this.parent.fixLayout()},MultiArgMorph.prototype.fixArrowsLayout=function(){var t=this.label(),e=this.arrows(),o=e.children[0],i=e.children[1],r=new Point(i.width()/2,i.height());this.inputs().length<this.minInputs+1?(t.hide(),o.hide(),i.setPosition(e.position().subtract(new Point(r.x,0))),e.setExtent(r)):(""!==this.labelText&&t.show(),o.show(),i.setPosition(o.topCenter()),e.bounds.corner=i.bottomRight().copy()),e.drawNew()},MultiArgMorph.prototype.refresh=function(){this.inputs().forEach(function(t){t.drawNew()})},MultiArgMorph.prototype.drawNew=function(){MultiArgMorph.uber.drawNew.call(this),this.refresh()},MultiArgMorph.prototype.addInput=function(t){var e,o,i=this.labelPart(this.slotSpec),r=this.children.length-1;if(t)i.setContents(t);else if("%scriptVars"===this.elementSpec){for(o="",e=r;e>0;)o=String.fromCharCode(97+(e-1)%26)+o,e=Math.floor((e-1)/26);i.setContents(o)}else contains(["%parms","%ringparms"],this.elementSpec)&&i.setContents("#"+r);i.parent=this,this.children.splice(r,0,i),i.drawNew(),this.fixLayout()},MultiArgMorph.prototype.removeInput=function(){var t,e;this.children.length>1&&(t=this.children[this.children.length-2],this.removeChild(t),t instanceof BlockMorph&&(e=this.parentThatIsA(ScriptsMorph),e&&e.add(t))),this.fixLayout()},MultiArgMorph.prototype.mouseClickLeft=function(t){var e,o=this.arrows(),i=o.children[0],r=o.children[1],n=16===this.world().currentKey?3:1;if(this.startLayout(),r.bounds.containsPoint(t))for(e=0;n>e;e+=1)r.isVisible&&this.addInput();else if(i.bounds.containsPoint(t))for(e=0;n>e;e+=1)i.isVisible&&this.removeInput();else this.escalateEvent("mouseClickLeft",t);this.endLayout()},MultiArgMorph.prototype.userMenu=function(){var t=new MenuMorph(this),e=this.parentThatIsA(BlockMorph),o="",i=this;return StageMorph.prototype.enableCodeMapping?(e&&(e instanceof RingMorph?o="parms_":"doDeclareVariables"===e.selector&&(o="tempvars_")),t.addItem("code list mapping...",function(){i.mapCodeList(o)}),t.addItem("code item mapping...",function(){i.mapCodeItem(o)}),t.addItem("code delimiter mapping...",function(){i.mapCodeDelimiter(o)}),t):this.parent.userMenu()},MultiArgMorph.prototype.mapCodeDelimiter=function(t){this.mapToCode(t+"delim","list item delimiter")},MultiArgMorph.prototype.mapCodeList=function(t){this.mapToCode(t+"list","list contents <#1>")},MultiArgMorph.prototype.mapCodeItem=function(t){this.mapToCode(t+"item","list item <#1>")},MultiArgMorph.prototype.mapToCode=function(t,e){new DialogBoxMorph(this,function(e){StageMorph.prototype.codeMappings[t]=e},this).promptCode("Code mapping - "+e,StageMorph.prototype.codeMappings[t]||"",this.world())},MultiArgMorph.prototype.mappedCode=function(t){var e,o,i,r=this.parentThatIsA(BlockMorph),n="",s="",a=0,h=[];return r&&(r instanceof RingMorph?n="parms_":"doDeclareVariables"===r.selector&&(n="tempvars_")),e=StageMorph.prototype.codeMappings[n+"list"]||"<#1>",o=StageMorph.prototype.codeMappings[n+"item"]||"<#1>",i=StageMorph.prototype.codeMappings[n+"delim"]||" ",this.inputs().forEach(function(e){h.push(o.replace(/<#1>/g,e.mappedCode(t)))}),h.forEach(function(t){a&&(s+=i),s+=t,a+=1}),e=e.replace(/<#1>/g,s)},MultiArgMorph.prototype.evaluate=function(){var t=[];return this.inputs().forEach(function(e){t.push(e.evaluate())}),t},MultiArgMorph.prototype.isEmptySlot=function(){return this.canBeEmpty?0===this.inputs().length:!1},ArgLabelMorph.prototype=new ArgMorph,ArgLabelMorph.prototype.constructor=ArgLabelMorph,ArgLabelMorph.uber=ArgMorph.prototype,ArgLabelMorph.prototype.init=function(t,e){var o;this.labelText=localize(e||"input list:"),ArgLabelMorph.uber.init.call(this),this.isStatic=!0,this.alpha=0,this.noticesTransparentclick=!0,o=this.labelPart(this.labelText),this.add(o),this.add(t)},ArgLabelMorph.prototype.label=function(){return this.children[0]},ArgLabelMorph.prototype.argMorph=function(){return this.children[1]},ArgLabelMorph.prototype.fixLayout=function(){var t,e,o=this.label();this.parent&&(this.color=this.parent.color,e=o.shadowOffset||new Point,t=e.x<0?this.parent.color.darker(this.labelContrast):this.parent.color.lighter(this.labelContrast),""!==this.labelText&&(o.shadowColor.eq(t)||(o.shadowColor=t,o.shadowOffset=e,o.drawNew()))),ArgLabelMorph.uber.fixLayout.call(this),this.parent&&this.parent.fixLayout()},ArgLabelMorph.prototype.refresh=function(){this.inputs().forEach(function(t){t.drawNew()})},ArgLabelMorph.prototype.drawNew=function(){ArgLabelMorph.uber.drawNew.call(this),this.refresh()},ArgLabelMorph.prototype.setLabelColor=function(t,e,o){if(""!==this.labelText){var i=this.label();i.color=t,i.shadowColor=e,i.shadowOffset=o,i.drawNew()}},ArgLabelMorph.prototype.reactToGrabOf=function(){this.parent instanceof SyntaxElementMorph&&this.parent.revertToDefaultInput(this)},ArgLabelMorph.prototype.evaluate=function(){return this.argMorph().evaluate()},ArgLabelMorph.prototype.isEmptySlot=function(){return!1},FunctionSlotMorph.prototype=new ArgMorph,FunctionSlotMorph.prototype.constructor=FunctionSlotMorph,FunctionSlotMorph.uber=ArgMorph.prototype,FunctionSlotMorph.prototype.init=function(t){FunctionSlotMorph.uber.init.call(this),this.isPredicate=t||!1,this.color=this.rfColor,this.setExtent(new Point(2*(this.fontSize+2*this.edge),this.fontSize+2*this.edge))},FunctionSlotMorph.prototype.getSpec=function(){return"%f"},FunctionSlotMorph.prototype.drawNew=function(){var t,e;this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),e=this.parent?this.parent.color:new Color(120,120,120),this.cachedClr=e.toString(),this.cachedClrBright=e.lighter(this.contrast).toString(),this.cachedClrDark=e.darker(this.contrast).toString(),this.isPredicate?this.drawDiamond(t):this.drawRounded(t)},FunctionSlotMorph.prototype.drawRounded=function(t){var e,o=this.height(),i=Math.min(this.rounding,o/2),r=this.width(),n=this.edge/2;t.fillStyle=this.color.toString(),t.beginPath(),t.arc(i,i,i,radians(-180),radians(-90),!1),t.arc(r-i,i,i,radians(-90),radians(-0),!1),t.arc(r-i,o-i,i,radians(0),radians(90),!1),t.arc(i,o-i,i,radians(90),radians(180),!1),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.cachedClr,t.beginPath(),t.arc(i,o-i,i-n,radians(90),radians(180),!1),t.stroke(),t.strokeStyle=this.cachedClr,t.beginPath(),t.arc(r-i,i,i-n,radians(-90),radians(0),!1),t.stroke(),t.shadowOffsetX=n,t.shadowOffsetY=n,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(i-n,n),t.lineTo(r-i+n,n),t.stroke(),e=t.createRadialGradient(i,i,i-this.edge,i,i,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.arc(i,i,i-n,radians(180),radians(270),!1),t.stroke(),e=t.createLinearGradient(0,0,this.edge,0),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,i),t.lineTo(n,o-i),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createRadialGradient(r-i,o-i,i-this.edge,r-i,o-i,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.arc(r-i,o-i,i-n,radians(0),radians(90),!1),t.stroke(),e=t.createLinearGradient(0,o-this.edge,0,o),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(i-n,o-n),t.lineTo(r-i+n,o-n),t.stroke(),e=t.createLinearGradient(r-this.edge,0,r,0),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(r-n,i+n),t.lineTo(r-n,o-i),t.stroke())},FunctionSlotMorph.prototype.drawDiamond=function(t){var e,o=this.width(),i=this.height(),r=Math.floor(i/2),n=Math.min(this.rounding,r),s=this.edge/2;t.fillStyle=this.color.toString(),t.beginPath(),t.moveTo(0,r),t.lineTo(n,0),t.lineTo(o-n,0),t.lineTo(o,r),t.lineTo(o-n,i),t.lineTo(n,i),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.cachedClr,t.beginPath(),t.moveTo(s,r),t.lineTo(n,i-s),t.stroke(),t.strokeStyle=this.cachedClr,t.beginPath(),t.moveTo(o-s,r),t.lineTo(o-n,s),t.stroke(),t.shadowOffsetX=s,t.shadowOffsetY=s,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),e=t.createLinearGradient(0,0,n,0),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(s,r),t.lineTo(n,s),t.stroke(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,s),t.lineTo(o-n,s),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createLinearGradient(o-n,0,o,0),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(o-n,i-s),t.lineTo(o-s,r),t.stroke(),e=t.createLinearGradient(0,i-this.edge,0,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(n+s,i-s),t.lineTo(o-n-s,i-s),t.stroke())},ReporterSlotMorph.prototype=new FunctionSlotMorph,ReporterSlotMorph.prototype.constructor=ReporterSlotMorph,ReporterSlotMorph.uber=FunctionSlotMorph.prototype,ReporterSlotMorph.prototype.init=function(t){ReporterSlotMorph.uber.init.call(this,t),this.add(this.emptySlot()),this.fixLayout()},ReporterSlotMorph.prototype.emptySlot=function(){var t=new ArgMorph,e=2*this.rfBorder+2*this.edge;return t.color=this.rfColor,t.alpha=0,t.setExtent(new Point(2*(this.fontSize+2*this.edge)-e,this.fontSize+2*this.edge-e)),t},ReporterSlotMorph.prototype.getSpec=function(){return"%r"},ReporterSlotMorph.prototype.contents=function(){return this.children[0]},ReporterSlotMorph.prototype.nestedBlock=function(){var t=this.contents();return t instanceof ReporterBlockMorph?t:null},ReporterSlotMorph.prototype.evaluate=function(){return this.nestedBlock()},ReporterSlotMorph.prototype.isEmptySlot=function(){return null===this.nestedBlock()},ReporterSlotMorph.prototype.fixLayout=function(){var t=this.contents();this.setExtent(t.extent().add(2*this.edge+2*this.rfBorder)),t.setCenter(this.center()),this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},RingReporterSlotMorph.prototype=new ReporterSlotMorph,RingReporterSlotMorph.prototype.constructor=RingReporterSlotMorph,RingReporterSlotMorph.uber=ReporterSlotMorph.prototype,RingReporterSlotMorph.prototype.rfBorder=RingCommandSlotMorph.prototype.rfBorder,RingReporterSlotMorph.prototype.edge=RingCommandSlotMorph.prototype.edge,RingReporterSlotMorph.prototype.init=function(t){RingReporterSlotMorph.uber.init.call(this,t),this.alpha=RingMorph.prototype.alpha,this.contrast=RingMorph.prototype.contrast,this.isHole=!0
},RingReporterSlotMorph.prototype.getSpec=function(){return"%rr"},RingReporterSlotMorph.prototype.replaceInput=function(t,e){RingReporterSlotMorph.uber.replaceInput.call(this,t,e),this.parent instanceof RingMorph&&this.parent.vanishForSimilar()},RingReporterSlotMorph.prototype.drawRounded=function(t){var e,o=this.height(),i=Math.min(this.rounding,o/2),r=this.width(),n=this.edge/2;t.fillStyle=this.cachedClr,t.beginPath(),t.moveTo(0,o/2),t.arc(i,i,i,radians(-180),radians(-90),!1),t.arc(r-i,i,i,radians(-90),radians(-0),!1),t.lineTo(r,o/2),t.lineTo(r,0),t.lineTo(0,0),t.closePath(),t.fill(),t.beginPath(),t.moveTo(r,o/2),t.arc(r-i,o-i,i,radians(0),radians(90),!1),t.arc(i,o-i,i,radians(90),radians(180),!1),t.lineTo(0,o/2),t.lineTo(0,o),t.lineTo(r,o),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.cachedClr,t.beginPath(),t.arc(i,o-i,i-n,radians(90),radians(180),!1),t.stroke(),t.strokeStyle=this.cachedClr,t.beginPath(),t.arc(r-i,i,i-n,radians(-90),radians(0),!1),t.stroke(),t.shadowOffsetX=n,t.shadowOffsetY=n,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(i-n,n),t.lineTo(r-i+n,n),t.stroke(),e=t.createRadialGradient(i,i,i-this.edge,i,i,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.arc(i,i,i-n,radians(180),radians(270),!1),t.stroke(),e=t.createLinearGradient(0,0,this.edge,0),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,i),t.lineTo(n,o-i),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createRadialGradient(r-i,o-i,i-this.edge,r-i,o-i,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.arc(r-i,o-i,i-n,radians(0),radians(90),!1),t.stroke(),e=t.createLinearGradient(0,o-this.edge,0,o),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(i-n,o-n),t.lineTo(r-i+n,o-n),t.stroke(),e=t.createLinearGradient(r-this.edge,0,r,0),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(r-n,i+n),t.lineTo(r-n,o-i),t.stroke())},RingReporterSlotMorph.prototype.drawDiamond=function(t){var e,o=this.width(),i=this.height(),r=Math.floor(i/2),n=Math.min(this.rounding,r),s=this.edge/2;t.fillStyle=this.cachedClr,t.beginPath(),t.moveTo(0,0),t.lineTo(0,r),t.lineTo(n,0),t.lineTo(o-n,0),t.lineTo(o,r),t.lineTo(o,0),t.closePath(),t.fill(),t.moveTo(o,r),t.lineTo(o-n,i),t.lineTo(n,i),t.lineTo(0,r),t.lineTo(0,i),t.lineTo(o,i),t.closePath(),t.fill(),MorphicPreferences.isFlat||(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.strokeStyle=this.cachedClr,t.beginPath(),t.moveTo(s,r),t.lineTo(n,i-s),t.stroke(),t.strokeStyle=this.cachedClr,t.beginPath(),t.moveTo(o-s,r),t.lineTo(o-n,s),t.stroke(),t.shadowOffsetX=s,t.shadowOffsetY=s,t.shadowBlur=this.edge,t.shadowColor=this.color.darker(80).toString(),e=t.createLinearGradient(0,0,n,0),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(s,r),t.lineTo(n,s),t.stroke(),e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(1,this.cachedClrDark),e.addColorStop(0,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(n,s),t.lineTo(o-n,s),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createLinearGradient(o-n,0,o,0),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(o-n,i-s),t.lineTo(o-s,r),t.stroke(),e=t.createLinearGradient(0,i-this.edge,0,i),e.addColorStop(1,this.cachedClr),e.addColorStop(0,this.cachedClrBright),t.strokeStyle=e,t.beginPath(),t.moveTo(n+s,i-s),t.lineTo(o-n-s,i-s),t.stroke())},CommentMorph.prototype=new BoxMorph,CommentMorph.prototype.constructor=CommentMorph,CommentMorph.uber=BoxMorph.prototype,CommentMorph.prototype.refreshScale=function(){CommentMorph.prototype.fontSize=SyntaxElementMorph.prototype.fontSize,CommentMorph.prototype.padding=5*SyntaxElementMorph.prototype.scale,CommentMorph.prototype.rounding=8*SyntaxElementMorph.prototype.scale},CommentMorph.prototype.refreshScale(),CommentMorph.prototype.init=function(t){var e=this,o=SyntaxElementMorph.prototype.scale;this.block=null,this.stickyOffset=null,this.isCollapsed=!1,this.titleBar=new BoxMorph(this.rounding,1.000001*o,new Color(255,255,180)),this.titleBar.color=new Color(255,255,180),this.titleBar.setHeight(fontHeight(this.fontSize)+this.padding),this.title=null,this.arrow=new ArrowMorph("down",this.fontSize),this.arrow.noticesTransparentClick=!0,this.arrow.mouseClickLeft=function(){e.toggleExpand()},this.contents=new TextMorph(t||localize("add comment here..."),this.fontSize),this.contents.isEditable=!0,this.contents.enableSelecting(),this.contents.maxWidth=90*o,this.contents.drawNew(),this.handle=new HandleMorph(this.contents,80,2*this.fontSize,-2,-2),this.handle.setExtent(new Point(11*o,11*o)),this.anchor=null,CommentMorph.uber.init.call(this,this.rounding,1.000001*o,new Color(255,255,180)),this.color=new Color(255,255,220),this.isDraggable=!0,this.add(this.titleBar),this.add(this.arrow),this.add(this.contents),this.add(this.handle),this.fixLayout()},CommentMorph.prototype.fullCopy=function(){var t=new CommentMorph(this.contents.text);return t.isCollapsed=this.isCollapsed,t.setTextWidth(this.textWidth()),t},CommentMorph.prototype.setTextWidth=function(t){this.contents.maxWidth=t,this.contents.drawNew(),this.fixLayout()},CommentMorph.prototype.textWidth=function(){return this.contents.maxWidth},CommentMorph.prototype.text=function(){return this.contents.text},CommentMorph.prototype.toggleExpand=function(){this.isCollapsed=!this.isCollapsed,this.fixLayout(),this.align()},CommentMorph.prototype.layoutChanged=function(){this.fixLayout(),this.align()},CommentMorph.prototype.fixLayout=function(){var t,e=this.contents.width()+2*this.padding,o=this,i=Morph.prototype.trackChanges;Morph.prototype.trackChanges=!1,this.title&&(this.title.destroy(),this.title=null),this.isCollapsed?(this.contents.hide(),this.title=new FrameMorph,this.title.alpha=0,this.title.acceptsDrops=!1,t=new StringMorph(this.contents.text,this.fontSize,null,!0),t.rootForGrab=function(){return o},this.title.add(t),this.title.setHeight(t.height()),this.title.setWidth(e-this.arrow.width()-2*this.padding-this.rounding),this.add(this.title)):this.contents.show(),this.titleBar.setWidth(e),this.contents.setLeft(this.titleBar.left()+this.padding),this.contents.setTop(this.titleBar.bottom()+this.padding),this.arrow.direction=this.isCollapsed?"right":"down",this.arrow.drawNew(),this.arrow.setCenter(this.titleBar.center()),this.arrow.setLeft(this.titleBar.left()+this.padding),this.title&&this.title.setPosition(this.arrow.topRight().add(new Point(this.padding,0))),Morph.prototype.trackChanges=i,this.changed(),this.silentSetHeight(this.titleBar.height()+(this.isCollapsed?0:this.padding+this.contents.height()+this.padding)),this.silentSetWidth(this.titleBar.width()),this.drawNew(),this.handle.drawNew(),this.changed()},CommentMorph.prototype.userMenu=function(){var t=new MenuMorph(this),e=this;return t.addItem("duplicate",function(){e.fullCopy().pickUp(e.world())},"make a copy\nand pick it up"),t.addItem("delete","destroy"),t.addItem("comment pic...",function(){window.open(e.fullImage().toDataURL())},"open a new window\nwith a picture of this comment"),t},CommentMorph.prototype.hide=function(){this.isVisible=!1,this.changed()},CommentMorph.prototype.show=function(){this.isVisible=!0,this.changed()},CommentMorph.prototype.prepareToBeGrabbed=function(){this.block&&(this.block.comment=null,this.block=null),this.anchor&&(this.anchor.destroy(),this.anchor=null,this.removeShadow(),this.addShadow())},CommentMorph.prototype.snap=function(t){var e,o=this.parent;return!o instanceof ScriptsMorph?null:(o.clearDropHistory(),o.lastDroppedBlock=this,e=o.closestBlock(this,t),null!==e&&(e.comment=this,this.block=e,this.snapSound&&this.snapSound.play()),void this.align())},CommentMorph.prototype.align=function(t,e){if(this.block){var o,i,r,n,s=t||this.block.topBlock(),a=s.parentThatIsA(ScriptsMorph);this.setTop(this.block.top()+this.block.corner),i=this.top(),r=this.bottom(),o=s.allChildren().filter(function(t){return t instanceof BlockMorph&&t.bottom()>i&&t.top()<r}),n=Math.max.apply(null,o.map(function(t){return t.right()})),this.setLeft(n+5),!e&&a&&a.addBack(this),this.anchor||(this.anchor=new Morph,this.anchor.color=this.titleBar.color),this.anchor.silentSetPosition(new Point(this.block.right(),this.top()+this.edge)),this.anchor.bounds.corner=new Point(this.left(),this.top()+this.edge+1),this.anchor.drawNew(),this.addBack(this.anchor),this.anchor.changed()}},CommentMorph.prototype.startFollowing=function(t,e){this.align(t),e.add(this),this.addShadow(),this.stickyOffset=this.position().subtract(this.block.position()),this.step=function(){this.setPosition(this.block.position().add(this.stickyOffset))}},CommentMorph.prototype.stopFollowing=function(){this.removeShadow(),delete this.step},CommentMorph.prototype.destroy=function(){this.block&&(this.block.comment=null),CommentMorph.uber.destroy.call(this)},CommentMorph.prototype.stackHeight=function(){return this.height()},modules.threads="2014-Feb-10";var ThreadManager,Process,Context,VariableFrame,UpvarReference;ThreadManager.prototype.toggleProcess=function(t){var e=this.findProcess(t);return e?void e.stop():this.startProcess(t)},ThreadManager.prototype.startProcess=function(t,e){var o,i=this.findProcess(t),r=t.topBlock();if(i){if(e)return i;i.stop(),this.removeTerminatedProcesses()}return r.addHighlight(),o=new Process(t.topBlock()),this.processes.push(o),o},ThreadManager.prototype.stopAll=function(t){this.processes.forEach(function(e){e!==t&&e.stop()})},ThreadManager.prototype.stopAllForReceiver=function(t,e){this.processes.forEach(function(o){o.homeContext.receiver===t&&o!==e&&(o.stop(),t.isClone&&(o.isDead=!0))})},ThreadManager.prototype.stopProcess=function(t){var e=this.findProcess(t);e&&e.stop()},ThreadManager.prototype.pauseAll=function(t){this.processes.forEach(function(t){t.pause()}),t&&t.pauseAllActiveSounds()},ThreadManager.prototype.isPaused=function(){return null!==detect(this.processes,function(t){return t.isPaused})},ThreadManager.prototype.resumeAll=function(t){this.processes.forEach(function(t){t.resume()}),t&&t.resumeAllActiveSounds()},ThreadManager.prototype.step=function(){this.processes.forEach(function(t){t.homeContext.receiver.isPickedUp()||t.isDead||t.runStep()}),this.removeTerminatedProcesses()},ThreadManager.prototype.removeTerminatedProcesses=function(){var t=[],e=this;this.processes.forEach(function(o){o.isRunning()||o.errorFlag||o.isDead?t.push(o):(o.topBlock.removeHighlight(),o.topBlock.blockSpec===localize("when %greenflag clicked")&&o.doBroadcast(e.finishedMessage).forEach(function(e){t.push(e)}),o.prompter&&(o.prompter.destroy(),o.homeContext.receiver.stopTalking&&o.homeContext.receiver.stopTalking()),o.topBlock instanceof ReporterBlockMorph&&o.topBlock.showBubble(o.homeContext.inputs[0]instanceof List?new ListWatcherMorph(o.homeContext.inputs[0]):o.homeContext.inputs[0]))}),this.processes=t},ThreadManager.prototype.findProcess=function(t){var e=t.topBlock();return detect(this.processes,function(t){return t.topBlock===e})},Process.prototype={},Process.prototype.contructor=Process,Process.prototype.timeout=500,Process.prototype.isCatchingErrors=!0,Process.prototype.isRunning=function(){return null!==this.context&&!this.readyToTerminate},Process.prototype.runStep=function(){if(this.isPaused)return this.pauseStep();for(this.readyToYield=!1;!this.readyToYield&&this.context&&(this.isAtomic?Date.now()-this.lastYield<this.timeout:!0);){if(this.isPaused)return this.pauseStep();this.evaluateContext()}if(this.lastYield=Date.now(),this.isAtomic&&this.homeContext.receiver&&this.homeContext.receiver.endWarp&&(this.homeContext.receiver.endWarp(),this.homeContext.receiver.startWarp()),this.readyToTerminate){for(;this.context;)this.popContext();this.homeContext.receiver&&this.homeContext.receiver.endWarp&&this.homeContext.receiver.endWarp()}},Process.prototype.stop=function(){this.readyToYield=!0,this.readyToTerminate=!0,this.errorFlag=!1,this.context&&this.context.stopMusic()},Process.prototype.pause=function(){this.isPaused=!0,this.context&&this.context.startTime&&(this.pauseOffset=Date.now()-this.context.startTime)},Process.prototype.resume=function(){this.isPaused=!1,this.pauseOffset=null},Process.prototype.pauseStep=function(){this.lastYield=Date.now(),this.context&&this.context.startTime&&(this.context.startTime=this.lastYield-this.pauseOffset)},Process.prototype.evaluateContext=function(){var t=this.context.expression;return this.frameCount+=1,t instanceof Array?this.evaluateSequence(t):t instanceof MultiArgMorph?this.evaluateMultiSlot(t,t.inputs().length):t instanceof ArgLabelMorph?this.evaluateArgLabel(t):t instanceof ArgMorph||t.bindingID?this.evaluateInput(t):t instanceof BlockMorph?this.evaluateBlock(t,t.inputs().length):isString(t)?this[t]():void this.popContext()},Process.prototype.evaluateBlock=function(t,e){if(contains(["reportOr","reportAnd"],t.selector))return this[t.selector](t);var o=this.context.receiver||this.topBlock.receiver(),i=this.context.inputs;if(e>i.length)this.evaluateNextInput(t);else if(this[t.selector]&&(o=this),this.isCatchingErrors)try{this.returnValueToParentContext(o[t.selector].apply(o,i)),this.popContext()}catch(r){this.handleError(r,t)}else this.returnValueToParentContext(o[t.selector].apply(o,i)),this.popContext()},Process.prototype.reportOr=function(t){var e=this.context.inputs;e.length<1?this.evaluateNextInput(t):e[0]?(this.returnValueToParentContext(!0),this.popContext()):e.length<2?this.evaluateNextInput(t):(this.returnValueToParentContext(e[1]===!0),this.popContext())},Process.prototype.reportAnd=function(t){var e=this.context.inputs;e.length<1?this.evaluateNextInput(t):e[0]?e.length<2?this.evaluateNextInput(t):(this.returnValueToParentContext(e[1]===!0),this.popContext()):(this.returnValueToParentContext(!1),this.popContext())},Process.prototype.evaluateMultiSlot=function(t,e){var o,i=this.context.inputs;if(t.bindingID){if(this.isCatchingErrors)try{o=this.context.variables.getVar(t.bindingID)}catch(r){this.handleError(r,t)}else o=this.context.variables.getVar(t.bindingID);this.returnValueToParentContext(o),this.popContext()}else e>i.length?this.evaluateNextInput(t):(this.returnValueToParentContext(new List(i)),this.popContext())},Process.prototype.evaluateArgLabel=function(t){var e=this.context.inputs;e.length<1?this.evaluateNextInput(t):(this.returnValueToParentContext(e[0]),this.popContext())},Process.prototype.evaluateInput=function(t){var e;if(t.bindingID)if(this.isCatchingErrors)try{e=this.context.variables.getVar(t.bindingID)}catch(o){this.handleError(o,t)}else e=this.context.variables.getVar(t.bindingID);else e=t.evaluate(),e&&(contains([CommandSlotMorph,ReporterSlotMorph],t.constructor)||t instanceof CSlotMorph&&!t.isStatic)&&(e=this.reify(e,new List),e.isImplicitLambda=!0);this.returnValueToParentContext(e),this.popContext()},Process.prototype.evaluateSequence=function(t){var e=this.context.pc,o=this.context.outerContext,i=this.context.isLambda,r=this.context.isImplicitLambda,n=this.context.isCustomBlock,s=this.context.upvars;e===t.length-1?(this.context=new Context(this.context.parentContext,t[e],this.context.outerContext,this.context.receiver),this.context.isLambda=i,this.context.isImplicitLambda=r,this.context.isCustomBlock=n,s&&(this.context.upvars=new UpvarReference(s))):e>=t.length?this.popContext():(this.context.pc+=1,this.pushContext(t[e],o))},Process.prototype.evaluateNextInput=function(t){var e=this.context.inputs.length,o=t.inputs(),i=o[e],r=this.context.outerContext;i.isUnevaluated&&(i.isUnevaluated===!0||i.isUnevaluated())?this.context.addInput(contains(["reify","reportScript"],this.context.expression.selector)?i:this.reify(i,new List)):this.pushContext(i,r)},Process.prototype.doYield=function(){this.popContext(),this.isAtomic||(this.readyToYield=!0)},Process.prototype.handleError=function(t,e){this.stop(),this.errorFlag=!0,this.topBlock.addErrorHighlight(),(e||this.topBlock).showBubble((e?"":"Inside: ")+t.name+"\n"+t.message)},Process.prototype.reify=function(t,e,o){var i=new Context(null,null,this.context?this.context.outerContext:null),r=0;return t?(i.expression=t.fullCopy(),i.expression.show(),o||(i.expression.allEmptySlots().forEach(function(t){r+=1,t.bindingID=t instanceof MultiArgMorph?["arguments"]:r}),i.emptySlots=r)):i.expression=[this.context.expression.fullCopy()],i.inputs=e.asArray(),i.receiver=this.context?this.context.receiver:t.receiver(),i},Process.prototype.reportScript=function(t,e){return this.reify(e,t)},Process.prototype.reifyScript=function(t,e){return this.reify(t,e)},Process.prototype.reifyReporter=function(t,e){return this.reify(t,e)},Process.prototype.reifyPredicate=function(t,e){return this.reify(t,e)},Process.prototype.doRun=function(t,e,o){return this.evaluate(t,e,!0,o)},Process.prototype.evaluate=function(t,e,o){if(!t)return null;if(t.isContinuation)return this.runContinuation(t,e);if(!(t instanceof Context))throw new Error("expecting a ring but getting "+t);var i,r,n,s,a=new Context(null,null,t.outerContext),h=e.asArray();if(a.receiver||(a.receiver=t.receiver),i=new Context(this.context.parentContext,t.expression,a,t.receiver),r=new Context(i,"doYield"),this.context.parentContext=o||t.expression instanceof ReporterBlockMorph?r:i,i.isLambda=!0,i.isImplicitLambda=t.isImplicitLambda,i.isCustomBlock=!1,h.length>0){for(n=0;n<t.inputs.length;n+=1)s=0,isNil(h[n])||(s=h[n]),a.variables.addVar(t.inputs[n],s);if(0===t.inputs.length)if(a.variables.addVar(["arguments"],e),1===h.length)for(n=1;n<=t.emptySlots;n+=1)a.variables.addVar(n,h[0]);else if(h.length===t.emptySlots)for(n=1;n<=h.length;n+=1)a.variables.addVar(n,h[n-1]);else if(1!==t.emptySlots)throw new Error("expecting "+t.emptySlots+" input(s), but getting "+h.length)}this.context.upvars&&(i.upvars=new UpvarReference(this.context.upvars)),i.expression instanceof CommandBlockMorph&&(i.expression=i.expression.blockSequence())},Process.prototype.fork=function(t,e){if(t.isContinuation)throw new Error("continuations cannot be forked");var o,i,r=new Context(null,null,t.outerContext),n=new Context(null,t.expression,r),s=e.asArray(),a=this.homeContext.receiver.parentThatIsA(StageMorph),h=new Process;if(n.isLambda=!0,s.length>0){for(o=0;o<t.inputs.length;o+=1)i=0,isNil(s[o])||(i=s[o]),r.variables.addVar(t.inputs[o],i);if(0===t.inputs.length)if(r.variables.addVar(["arguments"],e),1===s.length)for(o=1;o<=t.emptySlots;o+=1)r.variables.addVar(o,s[0]);else if(s.length===t.emptySlots)for(o=1;o<=s.length;o+=1)r.variables.addVar(o,s[o-1]);else if(1!==t.emptySlots)throw new Error("expecting "+t.emptySlots+" input(s), but getting "+s.length)}n.expression instanceof CommandBlockMorph&&(n.expression=n.expression.blockSequence()),h.homeContext=t.outerContext,h.topBlock=t.expression,h.context=n,h.pushContext("doYield"),a.threads.processes.push(h)},Process.prototype.doReport=function(t,e){for(;this.context&&!this.context.isLambda;)"doStopWarping"===this.context.expression?this.doStopWarping():this.popContext();return this.context&&this.context.isImplicitLambda?("doStopWarping"===this.context.expression?this.doStopWarping():this.popContext(),this.doReport(t,!0)):(this.context&&this.context.isCustomBlock&&(this.context.pc=this.context.expression.length-1),e&&this.context.parentContext.expression instanceof Array&&this.popContext(),t)},Process.prototype.doStopBlock=function(){this.doReport()},Process.prototype.doCallCC=function(t){this.evaluate(t,new List([this.context.continuation()]))},Process.prototype.reportCallCC=function(t){this.doCallCC(t)},Process.prototype.runContinuation=function(t,e){var o=e.asArray();this.context.parentContext=t.copyForContinuationCall(),1===o.length&&this.context.parentContext.outerContext.variables.addVar(1,o[0])},Process.prototype.evaluateCustomBlock=function(){var t,e,o,i,r,n,s=this.context.expression.definition.body,a=this.context.expression.definition.declarations,h=new List(this.context.inputs),l=h.asArray();if(!s)return null;if(n=new Context,n.receiver=this.context.receiver,n.variables.parentFrame=n.receiver?n.receiver.variables:null,t=new Context(this.context.parentContext,s.expression,n,n.receiver,!0),e=new Context(t,"doYield"),this.context.parentContext=e,t.isLambda=!0,t.isCustomBlock=!0,l.length>0)for(o=0;o<s.inputs.length;o+=1)i=0,isNil(l[o])||(i=l[o]),n.variables.addVar(s.inputs[o],i),"%upvar"===a[s.inputs[o]][0]&&(r||(r=new UpvarReference(this.context.upvars)),r.addReference(i,s.inputs[o],n.variables));r?t.upvars=r:this.context.upvars&&(t.upvars=new UpvarReference(this.context.upvars)),t.expression instanceof CommandBlockMorph&&(t.expression=t.expression.blockSequence())},Process.prototype.doDeclareVariables=function(t){var e=this.context.outerContext.variables;t.asArray().forEach(function(t){e.addVar(t)})},Process.prototype.doSetVar=function(t,e){var o=this.context.variables,i=t;i instanceof Context&&"reportGetVar"===i.expression.selector&&(i=i.expression.blockSpec),o.setVar(i,e)},Process.prototype.doChangeVar=function(t,e){var o=this.context.variables,i=t;i instanceof Context&&"reportGetVar"===i.expression.selector&&(i=i.expression.blockSpec),o.changeVar(i,e)},Process.prototype.reportGetVar=function(){var t=this.context.expression.blockSpec;return this.context.variables.getVar(t,this.context.upvars)},Process.prototype.doShowVar=function(t){var e,o,i,r,n,s=this.context.variables,a=t;if(a instanceof Context&&"reportGetVar"===a.expression.selector&&(a=a.expression.blockSpec),this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(StageMorph))){if(i=s.find(a),o=detect(e.children,function(t){return t instanceof WatcherMorph&&t.target===i&&t.getter===a}),null!==o)return o.show(),void o.fixLayout();r=i.owner?a:a+" (temporary)",o=new WatcherMorph(r,SpriteMorph.prototype.blockColor.variables,i,a),o.setPosition(e.position().add(10)),n=e.watchers(o.left()),n.length>0&&o.setTop(n[n.length-1].bottom()),e.add(o),o.fixLayout()}},Process.prototype.doHideVar=function(t){var e,o,i,r=this.context.variables,n=t;return n instanceof Context&&"reportGetVar"===n.expression.selector&&(n=n.expression.blockSpec),n?void(this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(StageMorph),e&&(i=r.find(n),o=detect(e.children,function(t){return t instanceof WatcherMorph&&t.target===i&&t.getter===n}),null!==o&&(o.isTemporary()?o.destroy():o.hide())))):void this.doRemoveTemporaries()},Process.prototype.doRemoveTemporaries=function(){var t;this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&t.watchers().forEach(function(t){t.isTemporary()&&t.destroy()}))},Process.prototype.reportNewList=function(t){return t},Process.prototype.reportCONS=function(t,e){return(new List).cons(t,e)},Process.prototype.reportCDR=function(t){return t.cdr()},Process.prototype.doAddToList=function(t,e){e.add(t)},Process.prototype.doDeleteFromList=function(t,e){var o=t;return"all"===this.inputOption(t)?e.clear():""===t?null:("last"===this.inputOption(t)&&(o=e.length()),void e.remove(o))},Process.prototype.doInsertInList=function(t,e,o){var i=e;return""===e?null:("any"===this.inputOption(e)&&(i=this.reportRandom(1,o.length())),"last"===this.inputOption(e)&&(i=o.length()+1),void o.add(t,i))},Process.prototype.doReplaceInList=function(t,e,o){var i=t;return""===t?null:("any"===this.inputOption(t)&&(i=this.reportRandom(1,e.length())),"last"===this.inputOption(t)&&(i=e.length()),void e.put(o,i))},Process.prototype.reportListItem=function(t,e){var o=t;return""===t?"":("any"===this.inputOption(t)&&(o=this.reportRandom(1,e.length())),"last"===this.inputOption(t)&&(o=e.length()),e.at(o))},Process.prototype.reportListLength=function(t){return t.length()},Process.prototype.reportListContainsItem=function(t,e){return t.contains(e)},Process.prototype.doIf=function(){var t=this.context.inputs,e=this.context.outerContext,o=this.context.isLambda,i=this.context.isImplicitLambda,r=this.context.isCustomBlock,n=this.context.upvars;this.popContext(),t[0]&&t[1]&&(this.pushContext(t[1].blockSequence(),e),this.context.isLambda=o,this.context.isImplicitLambda=i,this.context.isCustomBlock=r,this.context.upvars=new UpvarReference(n)),this.pushContext()},Process.prototype.doIfElse=function(){var t=this.context.inputs,e=this.context.outerContext,o=this.context.isLambda,i=this.context.isImplicitLambda,r=this.context.isCustomBlock,n=this.context.upvars;this.popContext(),t[0]?t[1]&&this.pushContext(t[1].blockSequence(),e):t[2]?this.pushContext(t[2].blockSequence(),e):this.pushContext("doYield"),this.context&&(this.context.isLambda=o,this.context.isImplicitLambda=i,this.context.isCustomBlock=r,this.context.upvars=new UpvarReference(n)),this.pushContext()},Process.prototype.doStop=function(){this.stop()},Process.prototype.doStopAll=function(){var t,e;this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&(t.threads.resumeAll(t),t.keysPressed={},t.threads.stopAll(),t.stopAllActiveSounds(),t.children.forEach(function(t){t.stopTalking&&t.stopTalking()}),t.removeAllClones()),e=t.parentThatIsA(IDE_Morph),e&&e.controlBar.pauseButton.refresh())},Process.prototype.doStopThis=function(t){switch(this.inputOption(t)){case"all":this.doStopAll();break;case"this script":this.doStop();break;case"this block":this.doStopBlock();break;default:nop()}},Process.prototype.doStopOthers=function(t){var e;if(this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(StageMorph)))switch(this.inputOption(t)){case"all but this script":e.threads.stopAll(this);break;case"other scripts in sprite":e.threads.stopAllForReceiver(this.homeContext.receiver,this);break;default:nop()}},Process.prototype.doWarp=function(t){var e,o=this.context.outerContext,i=this.context.isLambda,r=this.context.isImplicitLambda,n=this.context.isCustomBlock;this.popContext(),t&&(this.homeContext.receiver&&(this.homeContext.receiver.startWarp&&this.homeContext.receiver.startWarp(),e=this.homeContext.receiver.parentThatIsA(StageMorph),e&&(e.fps=0)),this.pushContext("doYield"),this.context.isLambda=i,this.context.isImplicitLambda=r,this.context.isCustomBlock=n,this.isAtomic||this.pushContext("doStopWarping"),this.pushContext(t.blockSequence(),o),this.isAtomic=!0),this.pushContext()},Process.prototype.doStopWarping=function(){var t;this.popContext(),this.isAtomic=!1,this.homeContext.receiver&&(this.homeContext.receiver.endWarp&&this.homeContext.receiver.endWarp(),t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&(t.fps=t.frameRate))},Process.prototype.reportIsFastTracking=function(){var t;return this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(IDE_Morph))?t.stage.isFastTracked:!1},Process.prototype.doSetFastTracking=function(t){var e;this.reportIsA(t,"Boolean")&&this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(IDE_Morph),e&&(t?e.startFastTracking():e.stopFastTracking()))},Process.prototype.doPauseAll=function(){var t,e;this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&t.threads.pauseAll(t),e=t.parentThatIsA(IDE_Morph),e&&e.controlBar.pauseButton.refresh())},Process.prototype.doForever=function(t){this.pushContext("doYield"),t&&this.pushContext(t.blockSequence()),this.pushContext()},Process.prototype.doRepeat=function(t,e){var o=this.context.expression,i=this.context.outerContext,r=this.context.isLambda,n=this.context.isImplicitLambda,s=this.context.isCustomBlock,a=this.context.upvars;return 1>t?null:(this.popContext(),this.pushContext(o,i),this.context.isLambda=r,this.context.isImplicitLambda=n,this.context.isCustomBlock=s,this.context.upvars=new UpvarReference(a),this.context.addInput(t-1),this.pushContext("doYield"),e&&this.pushContext(e.blockSequence()),void this.pushContext())},Process.prototype.doUntil=function(t,e){return t?(this.popContext(),this.pushContext("doYield"),null):(this.context.inputs=[],this.pushContext("doYield"),e&&this.pushContext(e.blockSequence()),void this.pushContext())},Process.prototype.doWaitUntil=function(t){return t?(this.popContext(),this.pushContext("doYield"),null):(this.context.inputs=[],this.pushContext("doYield"),void this.pushContext())},Process.prototype.reportMap=function(t,e){var o;if(e.isLinked){if(this.context.inputs.length<3&&(this.context.addInput(new List),this.context.inputs[2].isLinked=!0,this.context.addInput(this.context.inputs[2]),this.context.addInput(e)),0===this.context.inputs[4].length())return this.context.inputs[3].rest=e.cons(this.context.inputs[5]),void this.returnValueToParentContext(this.context.inputs[2].cdr());this.context.inputs.length>5&&(this.context.inputs[3].rest=e.cons(this.context.inputs[5]),this.context.inputs[3]=this.context.inputs[3].rest,this.context.inputs.splice(5)),o=this.context.inputs[4].at(1),this.context.inputs[4]=this.context.inputs[4].cdr(),this.pushContext(),this.evaluate(t,new List([o]))}else{if(this.context.inputs.length-2===e.length())return void this.returnValueToParentContext(new List(this.context.inputs.slice(2)));o=e.at(this.context.inputs.length-1),this.pushContext(),this.evaluate(t,new List([o]))}},Process.prototype.doWait=function(t){return this.context.startTime||(this.context.startTime=Date.now()),Date.now()-this.context.startTime>=1e3*t?null:(this.pushContext("doYield"),void this.pushContext())},Process.prototype.doGlide=function(t,e,o){return this.context.startTime||(this.context.startTime=Date.now(),this.context.startValue=new Point(this.blockReceiver().xPosition(),this.blockReceiver().yPosition())),Date.now()-this.context.startTime>=1e3*t?(this.blockReceiver().gotoXY(e,o),null):(this.blockReceiver().glide(1e3*t,e,o,Date.now()-this.context.startTime,this.context.startValue),this.pushContext("doYield"),void this.pushContext())},Process.prototype.doSayFor=function(t,e){return this.context.startTime||(this.context.startTime=Date.now(),this.blockReceiver().bubble(t)),Date.now()-this.context.startTime>=1e3*e?(this.blockReceiver().stopTalking(),null):(this.pushContext("doYield"),void this.pushContext())},Process.prototype.doThinkFor=function(t,e){return this.context.startTime||(this.context.startTime=Date.now(),this.blockReceiver().doThink(t)),Date.now()-this.context.startTime>=1e3*e?(this.blockReceiver().stopTalking(),null):(this.pushContext("doYield"),void this.pushContext())},Process.prototype.blockReceiver=function(){return this.context?this.context.receiver||this.homeContext.receiver:this.homeContext.receiver},Process.prototype.doPlaySoundUntilDone=function(t){var e=this.homeContext.receiver;return null===this.context.activeAudio&&(this.context.activeAudio=e.playSound(t)),this.context.activeAudio.ended||this.context.activeAudio.terminated?null:(this.pushContext("doYield"),void this.pushContext())},Process.prototype.doStopAllSounds=function(){var t=this.homeContext.receiver.parentThatIsA(StageMorph);t&&(t.threads.processes.forEach(function(t){t.context&&(t.context.stopMusic(),t.context.activeAudio&&t.popContext())}),t.stopAllActiveSounds())},Process.prototype.doAsk=function(t){var e,o=this.homeContext.receiver.parentThatIsA(StageMorph),i=this.blockReceiver()instanceof StageMorph;if(this.prompter){if(this.prompter.isDone)return o.lastAnswer=this.prompter.inputField.getValue(),this.prompter.destroy(),this.prompter=null,i||this.blockReceiver().stopTalking(),null}else e=detect(o.children,function(t){return t instanceof StagePrompterMorph}),e||(i||this.blockReceiver().bubble(t,!1,!0),this.prompter=new StagePrompterMorph(i?t:null),this.prompter.setWidth(o.scale<1?o.width()-10:o.dimensions.x-20),this.prompter.fixLayout(),this.prompter.setCenter(o.center()),this.prompter.setBottom(o.bottom()-this.prompter.border),o.add(this.prompter),this.prompter.inputField.edit(),o.changed());this.pushContext("doYield"),this.pushContext()},Process.prototype.reportLastAnswer=function(){return this.homeContext.receiver.parentThatIsA(StageMorph).lastAnswer},Process.prototype.reportURL=function(t){var e;if(this.httpRequest){if(4===this.httpRequest.readyState)return e=this.httpRequest.responseText,this.httpRequest=null,e}else this.httpRequest=new XMLHttpRequest,this.httpRequest.open("GET","http://"+t,!0),this.httpRequest.send(null);this.pushContext("doYield"),this.pushContext()},Process.prototype.doSendMissionSolved=function(){this.homeContext.receiver&&(ide=this.homeContext.receiver.parentThatIsA(IDE_Morph),ide&&ide.missionSolved())
},Process.prototype.doBroadcast=function(t){var e=this.homeContext.receiver.parentThatIsA(StageMorph),o=[],i=[],r=e.threads;return""!==t&&(e.lastMessage=t,e.children.concat(e).forEach(function(e){(e instanceof SpriteMorph||e instanceof StageMorph)&&(o=o.concat(e.allHatBlocksFor(t)))}),o.forEach(function(t){var o=!0;r.processes.forEach(function(e){o=o&&e.topBlock!=t}),o&&i.push(e.threads.startProcess(t,e.isThreadSafe))})),i},Process.prototype.doBroadcastAndWait=function(t){return this.context.activeSends||(this.context.activeSends=this.doBroadcast(t)),this.context.activeSends=this.context.activeSends.filter(function(t){return t.isRunning()}),0===this.context.activeSends.length?null:(this.pushContext("doYield"),void this.pushContext())},Process.prototype.getLastMessage=function(){var t;return this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph))?t.getLastMessage():""},Process.prototype.reportIsA=function(t,e){return this.reportTypeOf(t)===this.inputOption(e)},Process.prototype.reportTypeOf=function(t){var e;return null===t||void 0===t?"nothing":t===!0||t===!1?"Boolean":isNaN(parseFloat(t))?isString(t)?"text":t instanceof List?"list":t instanceof Context?t.expression instanceof RingMorph?t.expression.dataType():t.expression instanceof ReporterBlockMorph?t.expression.isPredicate?"predicate":"reporter":t.expression instanceof Array?(e=t.expression[t.pc||0],e.isPredicate?"predicate":e instanceof RingMorph?e.dataType():e instanceof ReporterBlockMorph?"reporter":e instanceof CommandBlockMorph?"command":"reporter"):t.expression instanceof CommandBlockMorph?"command":"reporter":"undefined":"number"},Process.prototype.reportSum=function(t,e){return+t+ +e},Process.prototype.reportDifference=function(t,e){return+t-+e},Process.prototype.reportProduct=function(t,e){return+t*+e},Process.prototype.reportQuotient=function(t,e){return+t/+e},Process.prototype.reportModulus=function(t,e){var o=+t,i=+e;return(o%i+i)%i},Process.prototype.reportRandom=function(t,e){var o=+t,i=+e;return o%1!==0||i%1!==0?Math.random()*(i-o)+o:Math.floor(Math.random()*(i-o+1))+o},Process.prototype.reportLessThan=function(t,e){var o=+t,i=+e;return(isNaN(o)||isNaN(i))&&(o=t,i=e),i>o},Process.prototype.reportNot=function(t){return!t},Process.prototype.reportGreaterThan=function(t,e){var o=+t,i=+e;return(isNaN(o)||isNaN(i))&&(o=t,i=e),o>i},Process.prototype.reportEquals=function(t,e){return snapEquals(t,e)},Process.prototype.reportIsIdentical=function(t,e){function o(){Object.prototype.hasOwnProperty.call(t,i)&&delete t[i],Object.prototype.hasOwnProperty.call(e,i)&&delete e[i]}var i="idTag";return this.isImmutable(t)||this.isImmutable(e)?snapEquals(t,e):(o(),t[i]=Date.now(),e[i]===t[i]?(o(),!0):(o(),!1))},Process.prototype.isImmutable=function(t){return contains(["nothing","Boolean","text","number","undefined"],this.reportTypeOf(t))},Process.prototype.reportTrue=function(){return!0},Process.prototype.reportFalse=function(){return!1},Process.prototype.reportRound=function(t){return Math.round(+t)},Process.prototype.reportMonadic=function(t,e){var o=+e,i=0;switch(this.inputOption(t)){case"abs":i=Math.abs(o);break;case"floor":i=Math.floor(o);break;case"sqrt":i=Math.sqrt(o);break;case"sin":i=Math.sin(radians(o));break;case"cos":i=Math.cos(radians(o));break;case"tan":i=Math.tan(radians(o));break;case"asin":i=degrees(Math.asin(o));break;case"acos":i=degrees(Math.acos(o));break;case"atan":i=degrees(Math.atan(o));break;case"ln":i=Math.log(o);break;case"log":i=0;break;case"e^":i=Math.exp(o);break;case"10^":i=0;break;default:nop()}return i},Process.prototype.reportTextFunction=function(t,e){var o=(isNil(e)?"":e).toString(),i="";switch(this.inputOption(t)){case"encode URI":i=encodeURI(o);break;case"decode URI":i=decodeURI(o);break;case"encode URI component":i=encodeURIComponent(o);break;case"decode URI component":i=decodeURIComponent(o);break;case"XML escape":i=(new XML_Element).escape(o);break;case"XML unescape":i=(new XML_Element).unescape(o);break;case"hex sha512 hash":i=hex_sha512(o);break;default:nop()}return i},Process.prototype.reportJoin=function(t,e){var o=(isNil(t)?"":t).toString(),i=(isNil(e)?"":e).toString();return o.concat(i)},Process.prototype.reportJoinWords=function(t){return t instanceof List?t.asText():(t||"").toString()},Process.prototype.reportLetter=function(t,e){var o=+(t||0),i=(e||"").toString();return i[o-1]||""},Process.prototype.reportStringSize=function(t){if(t instanceof List)return t.length();var e=(t||"").toString();return e.length},Process.prototype.reportUnicode=function(t){var e=(t||"").toString()[0];return e?e.charCodeAt(0):0},Process.prototype.reportUnicodeAsLetter=function(t){var e=+(t||0);return String.fromCharCode(e)},Process.prototype.reportTextSplit=function(t,e){var o,i,r=["text","number"],n=this.reportTypeOf(t),s=this.reportTypeOf(this.inputOption(e));if(!contains(r,n))throw new Error("expecting a text instad of a "+n);if(!contains(r,s))throw new Error("expecting a text delimiter instad of a "+s);switch(o=(t||"").toString(),this.inputOption(e)){case"line":i="\n";break;case"tab":i="	";break;case"cr":i="\r";break;case"whitespace":return new List(o.trim().split(/[\t\r\n ]+/));default:i=(e||"").toString()}return new List(o.split(i))},Process.prototype.alert=function(t){var e;this.homeContext.receiver&&(e=this.homeContext.receiver.world(),e.isDevMode&&alert("Snap! "+t.asArray()))},Process.prototype.log=function(t){var e;this.homeContext.receiver&&(e=this.homeContext.receiver.world(),e.isDevMode&&console.log("Snap! "+t.asArray()))},Process.prototype.getOtherObject=function(t,e,o){var i=isNil(o)?e.parentThatIsA(StageMorph):o,r=null;return i&&(r=detect(i.children,function(e){return e.name===t}),r||(r=detect(i.world().hand.children,function(e){return e instanceof SpriteMorph&&e.name===t}))),r},Process.prototype.getObjectsNamed=function(t,e,o){function i(e){return e instanceof SpriteMorph&&e.isClone?e.cloneOriginName===t:e.name===t}var r=isNil(o)?e.parentThatIsA(StageMorph):o,n=[];return r&&(n=r.children.filter(i),n.length||(n=r.world().hand.children.filter(i))),n},Process.prototype.doFaceTowards=function(t){var e,o=this.homeContext.receiver;o&&("mouse-pointer"===this.inputOption(t)?o.faceToXY(this.reportMouseX(),this.reportMouseY()):(e=this.getOtherObject(t,o),e&&o.faceToXY(e.xPosition(),e.yPosition())))},Process.prototype.doGotoObject=function(t){var e,o=this.homeContext.receiver;o&&("mouse-pointer"===this.inputOption(t)?o.gotoXY(this.reportMouseX(),this.reportMouseY()):(e=this.getOtherObject(t,o),e&&o.gotoXY(e.xPosition(),e.yPosition())))},Process.prototype.createClone=function(t){var e,o=this.homeContext.receiver;t&&o&&("myself"===this.inputOption(t)?o.createClone():(e=this.getOtherObject(t,o),e&&e.createClone()))},Process.prototype.reportTouchingObject=function(t){var e=this.blockReceiver();return e?this.objectTouchingObject(e,t):!1},Process.prototype.objectTouchingObject=function(t,e){var o,i,r,n=this;if("mouse-pointer"===this.inputOption(e)){if(r=t.world().hand.position(),t.bounds.containsPoint(r)&&!t.isTransparentAt(r))return!0}else if(i=t.parentThatIsA(StageMorph)){if("edge"===this.inputOption(e)&&!i.bounds.containsRectangle(t.bounds))return!0;if("pen trails"===this.inputOption(e)&&t.isTouching(i.penTrailsMorph()))return!0;if(o=this.getObjectsNamed(e,t,i),o.some(function(e){return t.isTouching(e)}))return!0}return t.parts.some(function(t){return n.objectTouchingObject(t,e)})},Process.prototype.reportTouchingColor=function(t){var e,o=this.homeContext.receiver;return o&&(e=o.parentThatIsA(StageMorph))?o.isTouching(e.colorFiltered(t,o))?!0:o.parts.some(function(o){return o.isTouching(e.colorFiltered(t,o))}):!1},Process.prototype.reportColorIsTouchingColor=function(t,e){var o,i=this.homeContext.receiver;return i&&(o=i.parentThatIsA(StageMorph))?i.colorFiltered(t).isTouching(o.colorFiltered(e,i))?!0:i.parts.some(function(i){return i.colorFiltered(t).isTouching(o.colorFiltered(e,i))}):!1},Process.prototype.reportDistanceTo=function(t){var e,o,i,r,n=this.blockReceiver();return n?(i=n.rotationCenter(),r=i,"mouse-pointer"===this.inputOption(t)&&(r=n.world().hand.position()),o=n.parentThatIsA(StageMorph),e=this.getOtherObject(t,n,o),e&&(r=e.rotationCenter()),i.distanceTo(r)/o.scale):0},Process.prototype.reportAttributeOf=function(t,e){var o,i,r=this.blockReceiver();if(r&&(i=r.parentThatIsA(StageMorph),o=i.name===e?i:this.getOtherObject(e,r,i))){if(t instanceof Context)return this.reportContextFor(t,o);if(isString(t))return o.variables.getVar(t);switch(this.inputOption(t)){case"x position":return o.xPosition?o.xPosition():"";case"y position":return o.yPosition?o.yPosition():"";case"direction":return o.direction?o.direction():"";case"costume #":return o.getCostumeIdx();case"costume name":return o.costume?o.costume.name:localize(o instanceof SpriteMorph?"Turtle":"Empty");case"size":return o.getScale?o.getScale():""}}return""},Process.prototype.reportContextFor=function(t,e){var o=copy(t);return o.receiver=e,o.outerContext&&(o.outerContext=copy(o.outerContext),o.outerContext.receiver=e),o},Process.prototype.reportMouseX=function(){var t,e;return this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&(e=t.world()))?(e.hand.position().x-t.center().x)/t.scale:0},Process.prototype.reportMouseY=function(){var t,e;return this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&(e=t.world()))?(t.center().y-e.hand.position().y)/t.scale:0},Process.prototype.reportMouseDown=function(){var t;return this.homeContext.receiver&&(t=this.homeContext.receiver.world())?"left"===t.hand.mouseButton:!1},Process.prototype.reportKeyPressed=function(t){var e;return this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(StageMorph))?void 0!==e.keysPressed[t]:!1},Process.prototype.doResetTimer=function(){var t;this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph),t&&t.resetTimer())},Process.prototype.reportTimer=function(){var t;return this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph))?t.getTimer():0};var dateMap={year:"getFullYear",month:"getMonth",date:"getDate","day of week":"getDay",hour:"getHours",minute:"getMinutes",second:"getSeconds","time in milliseconds":"getTime"};Process.prototype.reportDate=function(t){var e=this.inputOption(t),o=new Date,i=dateMap[e],r=o[i]();return dateMap[e]?(("month"===e||"day of week"===e)&&(r+=1),r):""},Process.prototype.doMapCodeOrHeader=function(t,e,o){if("code"===this.inputOption(e))return this.doMapCode(t,o);if("header"===this.inputOption(e))return this.doMapHeader(t,o);throw new Error(" '"+e+"'\nis not a valid option")},Process.prototype.doMapHeader=function(t,e){return t instanceof Context&&t.expression instanceof SyntaxElementMorph?t.expression.mapHeader(e||""):void 0},Process.prototype.doMapCode=function(t,e){return t instanceof Context&&t.expression instanceof SyntaxElementMorph?t.expression.mapCode(e||""):void 0},Process.prototype.doMapStringCode=function(t){StageMorph.prototype.codeMappings.string=t||"<#1>"},Process.prototype.doMapListCode=function(t,e,o){var i="",r="delim";"parameters"===this.inputOption(e)?i="parms_":"variables"===this.inputOption(e)&&(i="tempvars_"),"list"===this.inputOption(t)?r="list":"item"===this.inputOption(t)&&(r="item"),StageMorph.prototype.codeMappings[i+r]=o||""},Process.prototype.reportMappedCode=function(t){return t instanceof Context&&t.expression instanceof SyntaxElementMorph?t.expression.mappedCode():""},Process.prototype.doRest=function(t){var e=this.reportTempo();this.doWait(60/e*t)},Process.prototype.reportTempo=function(){var t;return this.homeContext.receiver&&(t=this.homeContext.receiver.parentThatIsA(StageMorph))?t.getTempo():0},Process.prototype.doChangeTempo=function(t){var e;this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(StageMorph),e&&e.changeTempo(t))},Process.prototype.doSetTempo=function(t){var e;this.homeContext.receiver&&(e=this.homeContext.receiver.parentThatIsA(StageMorph),e&&e.setTempo(t))},Process.prototype.doPlayNote=function(t,e){var o=this.reportTempo();this.doPlayNoteForSecs(parseFloat(t||"0"),60/o*parseFloat(e||"0"))},Process.prototype.doPlayNoteForSecs=function(t,e){return this.context.startTime||(this.context.startTime=Date.now(),this.context.activeNote=new Note(t),this.context.activeNote.play()),Date.now()-this.context.startTime>=1e3*e?(this.context.activeNote&&(this.context.activeNote.stop(),this.context.activeNote=null),null):(this.pushContext("doYield"),void this.pushContext())},Process.prototype.inputOption=function(t){return t instanceof Array?t[0]:t},Process.prototype.pushContext=function(t,e){var o=this.context?this.context.upvars:null;this.context=new Context(this.context,t,e||(this.context?this.context.outerContext:null),this.context?this.context.receiver:this.homeContext.receiver),o&&(this.context.upvars=new UpvarReference(o))},Process.prototype.popContext=function(){this.context&&this.context.stopMusic(),this.context=this.context?this.context.parentContext:null},Process.prototype.returnValueToParentContext=function(t){if(void 0!==t){var e=this.context?this.context.parentContext||this.homeContext:this.homeContext;e.addInput(t)}},Process.prototype.reportStackSize=function(){return this.context?this.context.stackSize():0},Process.prototype.reportFrameCount=function(){return this.frameCount},Context.prototype.toString=function(){var t=this.isLambda?"\u03bb-":"",e=this.expression;return e instanceof Array&&e.length>0&&(e="["+e[0]+"]"),t+"Context >> "+e+" "+this.variables},Context.prototype.image=function(){var t,e,o=new RingMorph;return this.expression instanceof Morph?(t=this.expression.fullCopy(),this.isContinuation&&(e=detect(t.allInputs(),function(t){return 1===t.bindingID}),e&&t.revertToDefaultInput(e,!0)),o.embed(t,this.inputs),o.fullImage()):this.expression instanceof Array?(t=this.expression[this.pc].fullCopy(),t instanceof RingMorph&&!t.contents()?t.fullImage():(o.embed(t,this.isContinuation?[]:this.inputs),o.fullImage())):newCanvas()},Context.prototype.continuation=function(){var t;if(this.expression instanceof Array)t=this;else{if(!this.parentContext)return new Context(null,"doStop");t=this.parentContext}return t=t.copyForContinuation(),t.isContinuation=!0,t},Context.prototype.copyForContinuation=function(){var t=copy(this),e=t,o=!(this.expression instanceof Array);if(o)for(e.prepareContinuationForBinding();e.parentContext;)e.parentContext=copy(e.parentContext),e=e.parentContext,e.inputs=[];return t},Context.prototype.copyForContinuationCall=function(){var t=copy(this),e=t,o=!(this.expression instanceof Array);if(o)for(this.expression=this.expression.fullCopy(),this.inputs=[];e.parentContext;)e.parentContext=copy(e.parentContext),e=e.parentContext,e.inputs=[];return t},Context.prototype.prepareContinuationForBinding=function(){var t,e=this.inputs.length;this.expression=this.expression.fullCopy(),t=this.expression.inputs()[e],t&&(this.inputs=[],t.bindingID=1,this.emptySlots=1)},Context.prototype.addInput=function(t){this.inputs.push(t)},Context.prototype.stopMusic=function(){this.activeNote&&(this.activeNote.stop(),this.activeNote=null)},Context.prototype.stackSize=function(){return this.parentContext?1+this.parentContext.stackSize():1},VariableFrame.prototype.toString=function(){return"a VariableFrame {"+this.names()+"}"},VariableFrame.prototype.copy=function(){var t=new VariableFrame(this.parentFrame);return t.vars=copy(this.vars),t},VariableFrame.prototype.deepCopy=function(){var t;return t=new VariableFrame(this.parentFrame?this.parentFrame.deepCopy():this.parentFrame),t.vars=copy(this.vars),t},VariableFrame.prototype.find=function(t){var e=this.silentFind(t);if(e)return e;throw new Error("a variable of name '"+t+"'\ndoes not exist in this context")},VariableFrame.prototype.silentFind=function(t){return void 0!==this.vars[t]?this:this.parentFrame?this.parentFrame.silentFind(t):null},VariableFrame.prototype.setVar=function(t,e){var o=this.find(t);o&&(o.vars[t]=e)},VariableFrame.prototype.changeVar=function(t,e){var o,i=this.find(t);i&&(o=parseFloat(i.vars[t]),i.vars[t]=isNaN(o)?e:o+parseFloat(e))},VariableFrame.prototype.getVar=function(t,e){var o,i,r=this.silentFind(t);if(r)return o=r.vars[t],0===o?0:o===!1?!1:""===o?"":o||0;if("number"==typeof t)return"";if(e&&(i=e.find(t)))return i.getVar(t);throw new Error("a variable of name '"+t+"'\ndoes not exist in this context")},VariableFrame.prototype.addVar=function(t,e){this.vars[t]=0===e?0:e===!1?!1:""===e?"":e||null},VariableFrame.prototype.deleteVar=function(t){var e=this.find(t);e&&delete e.vars[t]},VariableFrame.prototype.names=function(){var t,e=[];for(t in this.vars)Object.prototype.hasOwnProperty.call(this.vars,t)&&e.push(t);return e},VariableFrame.prototype.allNamesDict=function(){function t(t,e){var o;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=o)}for(var e={},o=this;o;)t(o.vars,e),o=o.parentFrame;return e},VariableFrame.prototype.allNames=function(){var t,e=[],o=this.allNamesDict();for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&e.push(t);return e},UpvarReference.prototype.addReference=function(t,e,o){this.vars[t]=[e,o]},UpvarReference.prototype.find=function(t){return void 0!==this.vars[t]?this:this.parentFrame?this.parentFrame.find(t):null},UpvarReference.prototype.getVar=function(t){var e=this.vars[t][0],o=this.vars[t][1],i=o.vars[e];return 0===i?0:i||0},UpvarReference.prototype.toString=function(){return"an UpvarReference {"+this.names()+"}"},UpvarReference.prototype.names=VariableFrame.prototype.names,UpvarReference.prototype.allNames=VariableFrame.prototype.allNames,UpvarReference.prototype.allNamesDict=VariableFrame.prototype.allNamesDict,modules.objects="2014-February-11";var SpriteMorph,StageMorph,SpriteBubbleMorph,Costume,SVG_Costume,CostumeEditorMorph,Sound,Note,CellMorph,WatcherMorph,StagePrompterMorph,Note,SpriteHighlightMorph;SpriteMorph.prototype=new PenMorph,SpriteMorph.prototype.constructor=SpriteMorph,SpriteMorph.uber=PenMorph.prototype,SpriteMorph.prototype.categories=["motion","control","looks","sensing","sound","operators","pen","variables","lists","other"],SpriteMorph.prototype.blockColor={motion:new Color(74,108,212),looks:new Color(143,86,227),sound:new Color(207,74,217),pen:new Color(0,161,120),control:new Color(230,168,34),sensing:new Color(4,148,220),operators:new Color(98,194,19),variables:new Color(243,118,29),lists:new Color(217,77,17),other:new Color(150,150,150)},SpriteMorph.prototype.paletteColor=new Color(55,55,55),SpriteMorph.prototype.paletteTextColor=new Color(230,230,230),SpriteMorph.prototype.sliderColor=SpriteMorph.prototype.paletteColor.lighter(30),SpriteMorph.prototype.isCachingPrimitives=!0,SpriteMorph.prototype.enableNesting=!0,SpriteMorph.prototype.useFlatLineEnds=!1,SpriteMorph.prototype.highlightColor=new Color(250,200,130),SpriteMorph.prototype.highlightBorder=8,SpriteMorph.prototype.bubbleColor=new Color(255,255,255),SpriteMorph.prototype.bubbleFontSize=14,SpriteMorph.prototype.bubbleFontIsBold=!0,SpriteMorph.prototype.bubbleCorner=10,SpriteMorph.prototype.bubbleBorder=3,SpriteMorph.prototype.bubbleBorderColor=new Color(190,190,190),SpriteMorph.prototype.bubbleMaxTextWidth=130,SpriteMorph.prototype.initBlocks=function(){SpriteMorph.prototype.blocks={forward:{type:"command",category:"motion",spec:"move %n steps",defaults:[10]},turn:{type:"command",category:"motion",spec:"turn %clockwise %n degrees",defaults:[15]},turnLeft:{type:"command",category:"motion",spec:"turn %counterclockwise %n degrees",defaults:[15]},setHeading:{type:"command",category:"motion",spec:"point in direction %dir"},doFaceTowards:{type:"command",category:"motion",spec:"point towards %dst"},gotoXY:{type:"command",category:"motion",spec:"go to x: %n y: %n",defaults:[0,0]},doGotoObject:{type:"command",category:"motion",spec:"go to %dst"},doGlide:{type:"command",category:"motion",spec:"glide %n secs to x: %n y: %n",defaults:[1,0,0]},changeXPosition:{type:"command",category:"motion",spec:"change x by %n",defaults:[10]},setXPosition:{type:"command",category:"motion",spec:"set x to %n",defaults:[0]},changeYPosition:{type:"command",category:"motion",spec:"change y by %n",defaults:[10]},setYPosition:{type:"command",category:"motion",spec:"set y to %n",defaults:[0]},bounceOffEdge:{type:"command",category:"motion",spec:"if on edge, bounce"},xPosition:{type:"reporter",category:"motion",spec:"x position"},yPosition:{type:"reporter",category:"motion",spec:"y position"},direction:{type:"reporter",category:"motion",spec:"direction"},doSwitchToCostume:{type:"command",category:"looks",spec:"switch to costume %cst"},doWearNextCostume:{type:"command",category:"looks",spec:"next costume"},getCostumeIdx:{type:"reporter",category:"looks",spec:"costume #"},doSayFor:{type:"command",category:"looks",spec:"say %s for %n secs",defaults:[localize("Hello!"),2]},bubble:{type:"command",category:"looks",spec:"say %s",defaults:[localize("Hello!")]},doThinkFor:{type:"command",category:"looks",spec:"think %s for %n secs",defaults:[localize("Hmm..."),2]},doThink:{type:"command",category:"looks",spec:"think %s",defaults:[localize("Hmm...")]},changeEffect:{type:"command",category:"looks",spec:"change %eff effect by %n",defaults:[null,25]},setEffect:{type:"command",category:"looks",spec:"set %eff effect to %n",defaults:[null,0]},clearEffects:{type:"command",category:"looks",spec:"clear graphic effects"},changeScale:{type:"command",category:"looks",spec:"change size by %n",defaults:[10]},setScale:{type:"command",category:"looks",spec:"set size to %n %",defaults:[100]},getScale:{type:"reporter",category:"looks",spec:"size"},show:{type:"command",category:"looks",spec:"show"},hide:{type:"command",category:"looks",spec:"hide"},comeToFront:{type:"command",category:"looks",spec:"go to front"},goBack:{type:"command",category:"looks",spec:"go back %n layers",defaults:[1]},alert:{type:"command",category:"looks",spec:"alert %mult%s"},log:{type:"command",category:"looks",spec:"console log %mult%s"},playSound:{type:"command",category:"sound",spec:"play sound %snd"},doPlaySoundUntilDone:{type:"command",category:"sound",spec:"play sound %snd until done"},doStopAllSounds:{type:"command",category:"sound",spec:"stop all sounds"},doRest:{type:"command",category:"sound",spec:"rest for %n beats",defaults:[.2]},doPlayNote:{type:"command",category:"sound",spec:"play note %n for %n beats",defaults:[60,.5]},doChangeTempo:{type:"command",category:"sound",spec:"change tempo by %n",defaults:[20]},doSetTempo:{type:"command",category:"sound",spec:"set tempo to %n bpm",defaults:[60]},getTempo:{type:"reporter",category:"sound",spec:"tempo"},clear:{type:"command",category:"pen",spec:"clear"},down:{type:"command",category:"pen",spec:"pen down"},up:{type:"command",category:"pen",spec:"pen up"},setColor:{type:"command",category:"pen",spec:"set pen color to %clr"},changeHue:{type:"command",category:"pen",spec:"change pen color by %n",defaults:[10]},setHue:{type:"command",category:"pen",spec:"set pen color to %n",defaults:[0]},changeBrightness:{type:"command",category:"pen",spec:"change pen shade by %n",defaults:[10]},setBrightness:{type:"command",category:"pen",spec:"set pen shade to %n",defaults:[100]},changeSize:{type:"command",category:"pen",spec:"change pen size by %n",defaults:[1]},setSize:{type:"command",category:"pen",spec:"set pen size to %n",defaults:[1]},doStamp:{type:"command",category:"pen",spec:"stamp"},receiveGo:{type:"hat",category:"control",spec:"when %greenflag clicked (without broadcasting)"},receiveGoThenBroadcastFinished:{type:"hat",category:"control",spec:"when %greenflag clicked"},receiveKey:{type:"hat",category:"control",spec:"when %keyHat key pressed"},receiveClick:{type:"hat",category:"control",spec:"when I am clicked"},receiveMessage:{type:"hat",category:"control",spec:"when I receive %msgHat"},receiveFinished:{type:"hat",category:"control",spec:"when I receive finished"},doSendMissionSolved:{type:"command",category:"control",spec:"mission is solved"},doBroadcast:{type:"command",category:"control",spec:"broadcast %msg"},doBroadcastAndWait:{type:"command",category:"control",spec:"broadcast %msg and wait"},getLastMessage:{type:"reporter",category:"control",spec:"message"},doWait:{type:"command",category:"control",spec:"wait %n secs",defaults:[1]},doWaitUntil:{type:"command",category:"control",spec:"wait until %b"},doForever:{type:"command",category:"control",spec:"forever %c"},doRepeat:{type:"command",category:"control",spec:"repeat %n %c",defaults:[10]},doUntil:{type:"command",category:"control",spec:"repeat until %b %c"},doIf:{type:"command",category:"control",spec:"if %b %c"},doIfElse:{type:"command",category:"control",spec:"if %b %c else %c"},doStopThis:{type:"command",category:"control",spec:"stop %stopChoices"},doStopOthers:{type:"command",category:"control",spec:"stop %stopOthersChoices"},doRun:{type:"command",category:"control",spec:"run %cmdRing %inputs"},fork:{type:"command",category:"control",spec:"launch %cmdRing %inputs"},evaluate:{type:"reporter",category:"control",spec:"call %repRing %inputs"},doReport:{type:"command",category:"control",spec:"report %s"},doCallCC:{type:"command",category:"control",spec:"run %cmdRing w/continuation"},reportCallCC:{type:"reporter",category:"control",spec:"call %cmdRing w/continuation"},doWarp:{type:"command",category:"other",spec:"warp %c"},receiveOnClone:{type:"hat",category:"control",spec:"when I start as a clone"},createClone:{type:"command",category:"control",spec:"create a clone of %cln"},removeClone:{type:"command",category:"control",spec:"delete this clone"},doPauseAll:{type:"command",category:"control",spec:"pause all %pause"},reportTouchingObject:{type:"predicate",category:"sensing",spec:"touching %col ?"},reportTouchingColor:{type:"predicate",category:"sensing",spec:"touching %clr ?"},reportColorIsTouchingColor:{type:"predicate",category:"sensing",spec:"color %clr is touching %clr ?"},colorFiltered:{type:"reporter",category:"sensing",spec:"filtered for %clr"},reportStackSize:{type:"reporter",category:"sensing",spec:"stack size"},reportFrameCount:{type:"reporter",category:"sensing",spec:"frames"},doAsk:{type:"command",category:"sensing",spec:"ask %s and wait",defaults:[localize("what's your name?")]},reportLastAnswer:{type:"reporter",category:"sensing",spec:"answer"},getLastAnswer:{type:"reporter",category:"sensing",spec:"answer"},reportMouseX:{type:"reporter",category:"sensing",spec:"mouse x"},reportMouseY:{type:"reporter",category:"sensing",spec:"mouse y"},reportMouseDown:{type:"predicate",category:"sensing",spec:"mouse down?"},reportKeyPressed:{type:"predicate",category:"sensing",spec:"key %key pressed?"},reportDistanceTo:{type:"reporter",category:"sensing",spec:"distance to %dst"},doResetTimer:{type:"command",category:"sensing",spec:"reset timer"},reportTimer:{type:"reporter",category:"sensing",spec:"timer"},getTimer:{type:"reporter",category:"sensing",spec:"timer"},reportAttributeOf:{type:"reporter",category:"sensing",spec:"%att of %spr",defaults:[["costume #"]]},reportURL:{type:"reporter",category:"sensing",spec:"http:// %s",defaults:["snap.berkeley.edu"]},reportIsFastTracking:{type:"predicate",category:"sensing",spec:"turbo mode?"},doSetFastTracking:{type:"command",category:"sensing",spec:"set turbo mode to %b"},reportDate:{type:"reporter",category:"sensing",spec:"current %dates"},reifyScript:{type:"ring",category:"other",spec:"%rc %ringparms"},reifyReporter:{type:"ring",category:"other",spec:"%rr %ringparms"},reifyPredicate:{type:"ring",category:"other",spec:"%rp %ringparms"},reportSum:{type:"reporter",category:"operators",spec:"%n + %n"},reportDifference:{type:"reporter",category:"operators",spec:"%n \u2212 %n"},reportProduct:{type:"reporter",category:"operators",spec:"%n \xd7 %n"},reportQuotient:{type:"reporter",category:"operators",spec:"%n / %n"},reportRound:{type:"reporter",category:"operators",spec:"round %n"},reportMonadic:{type:"reporter",category:"operators",spec:"%fun of %n",defaults:[null,10]},reportModulus:{type:"reporter",category:"operators",spec:"%n mod %n"},reportRandom:{type:"reporter",category:"operators",spec:"pick random %n to %n",defaults:[1,10]},reportLessThan:{type:"predicate",category:"operators",spec:"%s < %s"},reportEquals:{type:"predicate",category:"operators",spec:"%s = %s"},reportGreaterThan:{type:"predicate",category:"operators",spec:"%s > %s"},reportAnd:{type:"predicate",category:"operators",spec:"%b and %b"},reportOr:{type:"predicate",category:"operators",spec:"%b or %b"},reportNot:{type:"predicate",category:"operators",spec:"not %b"},reportTrue:{type:"predicate",category:"operators",spec:"true"},reportFalse:{type:"predicate",category:"operators",spec:"false"},reportJoinWords:{type:"reporter",category:"operators",spec:"join %words",defaults:[localize("hello")+" ",localize("world")]},reportLetter:{type:"reporter",category:"operators",spec:"letter %n of %s",defaults:[1,localize("world")]},reportStringSize:{type:"reporter",category:"operators",spec:"length of %s",defaults:[localize("world")]},reportUnicode:{type:"reporter",category:"operators",spec:"unicode of %s",defaults:["a"]},reportUnicodeAsLetter:{type:"reporter",category:"operators",spec:"unicode %n as letter",defaults:[65]},reportIsA:{type:"predicate",category:"operators",spec:"is %s a %typ ?",defaults:[5]},reportIsIdentical:{type:"predicate",category:"operators",spec:"is %s identical to %s ?"},reportTextSplit:{type:"reporter",category:"operators",spec:"split %s by %delim",defaults:[localize("hello")+" "+localize("world")," "]},reportTypeOf:{type:"reporter",category:"operators",spec:"type of %s",defaults:[5]},reportTextFunction:{type:"reporter",category:"operators",spec:"%txtfun of %s",defaults:[null,"Abelson & Sussman"]},doSetVar:{type:"command",category:"variables",spec:"set %var to %s",defaults:[null,0]},doChangeVar:{type:"command",category:"variables",spec:"change %var by %n",defaults:[null,1]},doShowVar:{type:"command",category:"variables",spec:"show variable %var"},doHideVar:{type:"command",category:"variables",spec:"hide variable %var"},doDeclareVariables:{type:"command",category:"other",spec:"script variables %scriptVars"},reportNewList:{type:"reporter",category:"lists",spec:"list %exp"},reportCONS:{type:"reporter",category:"lists",spec:"%s in front of %l"},reportListItem:{type:"reporter",category:"lists",spec:"item %idx of %l",defaults:[1]},reportCDR:{type:"reporter",category:"lists",spec:"all but first of %l"},reportListLength:{type:"reporter",category:"lists",spec:"length of %l"},reportListContainsItem:{type:"predicate",category:"lists",spec:"%l contains %s",defaults:[null,localize("thing")]},doAddToList:{type:"command",category:"lists",spec:"add %s to %l",defaults:[localize("thing")]},doDeleteFromList:{type:"command",category:"lists",spec:"delete %ida of %l",defaults:[1]},doInsertInList:{type:"command",category:"lists",spec:"insert %s at %idx of %l",defaults:[localize("thing"),1]},doReplaceInList:{type:"command",category:"lists",spec:"replace item %idx of %l with %s",defaults:[1,null,localize("thing")]},reportMap:{type:"reporter",category:"lists",spec:"map %repRing over %l"},doMapCodeOrHeader:{type:"command",category:"other",spec:"map %cmdRing to %codeKind %code"},doMapStringCode:{type:"command",category:"other",spec:"map String to code %code",defaults:["<#1>"]},doMapListCode:{type:"command",category:"other",spec:"map %codeListPart of %codeListKind to code %code"},reportMappedCode:{type:"reporter",category:"other",spec:"code of %cmdRing"}}},SpriteMorph.prototype.initBlocks(),SpriteMorph.prototype.initBlockMigrations=function(){SpriteMorph.prototype.blockMigrations={doStopAll:{selector:"doStopThis",inputs:[["all"]]},doStop:{selector:"doStopThis",inputs:[["this script"]]},doStopBlock:{selector:"doStopThis",inputs:[["this block"]]}}},SpriteMorph.prototype.initBlockMigrations(),SpriteMorph.prototype.blockAlternatives={turn:["turnLeft"],turnLeft:["turn"],changeXPosition:["changeYPosition","setXPosition","setYPosition"],setXPosition:["setYPosition","changeXPosition","changeYPosition"],changeYPosition:["changeXPosition","setYPosition","setXPosition"],setYPosition:["setXPosition","changeYPosition","changeXPosition"],xPosition:["yPosition"],yPosition:["xPosition"],doSayFor:["doThinkFor"],doThinkFor:["doSayFor"],bubble:["doThink"],doThink:["bubble"],show:["hide"],hide:["show"],changeEffect:["setEffect"],setEffect:["changeEffect"],changeScale:["setScale"],setScale:["changeScale"],playSound:["doPlaySoundUntilDone"],doPlaySoundUntilDone:["playSound"],doChangeTempo:["doSetTempo"],doSetTempo:["doChangeTempo"],clear:["down","up","doStamp"],down:["up","clear","doStamp"],up:["down","clear","doStamp"],doStamp:["clear","down","up"],changeHue:["setHue","changeBrightness","setBrightness"],setHue:["changeHue","changeBrightness","setBrightness"],changeBrightness:["setBrightness","setHue","changeHue"],setBrightness:["changeBrightness","setHue","changeHue"],changeSize:["setSize"],setSize:["changeSize"],receiveGo:["receiveClick"],receiveClick:["receiveGo"],doBroadcast:["doBroadcastAndWait"],doBroadcastAndWait:["doBroadcast"],getLastAnswer:["getTimer"],getTimer:["getLastAnswer"],reportMouseX:["reportMouseY"],reportMouseY:["reportMouseX"],reportSum:["reportDifference","reportProduct","reportQuotient"],reportDifference:["reportSum","reportProduct","reportQuotient"],reportProduct:["reportDifference","reportSum","reportQuotient"],reportQuotient:["reportDifference","reportProduct","reportSum"],reportLessThan:["reportEquals","reportGreaterThan"],reportEquals:["reportLessThan","reportGreaterThan"],reportGreaterThan:["reportEquals","reportLessThan"],reportAnd:["reportOr"],reportOr:["reportAnd"],reportTrue:["reportFalse"],reportFalse:["reportTrue"],doSetVar:["doChangeVar"],doChangeVar:["doSetVar"],doShowVar:["doHideVar"],doHideVar:["doShowVar"]},SpriteMorph.prototype.init=function(t){this.name=localize("Sprite"),this.variables=new VariableFrame(t||null,this),this.scripts=new ScriptsMorph(this),this.customBlocks=[],this.costumes=new List,this.costume=null,this.sounds=new List,this.normalExtent=new Point(60,60),this.scale=1,this.rotationStyle=1,this.version=Date.now(),this.isClone=!1,this.cloneOriginName="",this.parts=[],this.anchor=null,this.nestingScale=1,this.rotatesWithAnchor=!0,this.blocksCache={},this.paletteCache={},this.rotationOffset=new Point,this.idx=0,this.wasWarped=!1,SpriteMorph.uber.init.call(this),this.isDraggable=!0,this.isDown=!1,this.heading=90,this.changed(),this.drawNew(),this.changed()
},SpriteMorph.prototype.fullCopy=function(){var t,e=SpriteMorph.uber.fullCopy.call(this),o=[];return e.stopTalking(),e.color=this.color.copy(),e.blocksCache={},e.paletteCache={},e.scripts=this.scripts.fullCopy(),e.scripts.owner=e,e.variables=this.variables.copy(),e.variables.owner=e,e.customBlocks=[],this.customBlocks.forEach(function(o){t=o.copyAndBindTo(e),e.customBlocks.push(t),e.allBlockInstances(o).forEach(function(e){e.definition=t})}),this.costumes.asArray().forEach(function(t){o.push(t.copy())}),e.costumes=new List(o),o=[],this.sounds.asArray().forEach(function(t){o.push(t)}),e.sounds=new List(o),e.parts=[],e.anchor=null,e.nestingScale=1,e.rotatesWithAnchor=!0,e},SpriteMorph.prototype.setName=function(t){this.name=t||this.name,this.version=Date.now()},SpriteMorph.prototype.drawNew=function(){var t,e,o,i,r,n,s,a,h,l,p,c=this,d=this.center(),u=this.costume&&"function"==typeof this.costume.loaded,f=this.parent instanceof StageMorph?this.parent.scale:1,g=[];if(this.isWarped)return void(this.wantsRedraw=!0);if(t=this.rotationStyle?this.heading:90,2===this.rotationStyle&&(t=90,(this.heading>180&&this.heading<360||this.heading<0&&this.heading>-180)&&(e=!0)),this.costume&&!u)i=e?this.costume.flipped():this.costume,g=i.bounds().corners().map(function(e){return e.rotateBy(radians(t-90),c.costume.center())}),n=g[0],a=g[0],g.forEach(function(t){n=n.min(t),a=a.max(t)}),h=n.corner(a).extent().multiplyBy(this.scale*f),s=new Point(0,0).rotateBy(radians(-(t-90)),i.center()).subtract(n),this.image=newCanvas(h),this.silentSetExtent(h),l=this.image.getContext("2d"),l.scale(this.scale*f,this.scale*f),l.translate(s.x,s.y),l.rotate(radians(t-90)),l.drawImage(i.contents,0,0),this.setCenter(d,!0),this.rotationOffset=s.translateBy(i.rotationCenter).rotateBy(radians(-(t-90)),s).scaleBy(this.scale*f);else if(t=e?-90:t,r=Math.min(Math.max(this.normalExtent.x*this.scale*f,5),1e3),this.silentSetExtent(new Point(r,r)),this.image=newCanvas(this.extent()),this.setCenter(d,!0),SpriteMorph.uber.drawNew.call(this,t),this.rotationOffset=this.extent().divideBy(2),u)return o=this.costume,p=setInterval(function(){c.wearCostume(o),clearInterval(p)},100),c.wearCostume(null);this.version=Date.now()},SpriteMorph.prototype.endWarp=function(){if(this.isWarped=!1,this.wantsRedraw){var t=this.xPosition(),e=this.yPosition();this.drawNew(),this.silentGotoXY(t,e,!0),this.wantsRedraw=!1}this.parent.changed()},SpriteMorph.prototype.rotationCenter=function(){return this.position().add(this.rotationOffset)},SpriteMorph.prototype.colorFiltered=function(t){var e,o,i,r,n,s=new Morph,a=this.extent();for(o=this.image.getContext("2d").getImageData(0,0,a.x,a.y),s.image=newCanvas(a),s.bounds=this.bounds.copy(),e=s.image.getContext("2d"),n=e.createImageData(a.x,a.y),r=0;r<a.x*a.y*4;r+=4)i=new Color(o.data[r],o.data[r+1],o.data[r+2]),i.eq(t)&&(n.data[r]=o.data[r],n.data[r+1]=o.data[r+1],n.data[r+2]=o.data[r+2],n.data[r+3]=255);return e.putImageData(n,0,0),s},SpriteMorph.prototype.blockForSelector=function(t,e){var o,i,r,n,s,a;if(o=this.blockMigrations[t],i=this.blocks[o?o.selector:t],!i)return null;if(r="command"===i.type?new CommandBlockMorph:"hat"===i.type?new HatBlockMorph:"ring"===i.type?new RingMorph:new ReporterBlockMorph("predicate"===i.type),r.color=this.blockColor[i.category],r.category=i.category,r.selector=t,contains(["reifyReporter","reifyPredicate"],r.selector)&&(r.isStatic=!0),r.setSpec(localize(i.spec)),e&&i.defaults||o&&o.inputs)if(n=o?o.inputs:i.defaults,r.defaults=n,s=r.inputs(),s[0]instanceof MultiArgMorph)s[0].setContents(n),s[0].defaults=n;else for(a=0;a<n.length;a+=1)null!==n[a]&&s[a].setContents(n[a]);return r},SpriteMorph.prototype.variableBlock=function(t){var e=new ReporterBlockMorph(!1);return e.selector="reportGetVar",e.color=this.blockColor.variables,e.category="variables",e.setSpec(t),e.isDraggable=!0,e},SpriteMorph.prototype.blockTemplates=function(t){function e(t){if(StageMorph.prototype.hiddenPrimitives[t])return null;var e=SpriteMorph.prototype.blockForSelector(t,!0);return e.isTemplate=!0,e}function o(t){var e=SpriteMorph.prototype.variableBlock(t);return e.isDraggable=!1,e.isTemplate=!0,e}function i(t){if(StageMorph.prototype.hiddenPrimitives[t])return null;var e=SpriteMorph.prototype.blocks[t];return new ToggleMorph("checkbox",this,function(){p.toggleWatcher(t,localize(e.spec),p.blockColor[e.category])},null,function(){return p.showingWatcher(t)},null)}function r(t){return new ToggleMorph("checkbox",this,function(){p.toggleVariableWatcher(t)},null,function(){return p.showingVariableWatcher(t)},null)}function n(){var t=new MenuMorph(this);return t.addItem("help...","showHelp"),t}var s,a,h,l=[],p=this,c=t||"motion";return"motion"===c?(l.push(e("forward")),l.push(e("turn")),l.push(e("turnLeft")),l.push("-"),l.push(e("setHeading")),l.push(e("doFaceTowards")),l.push("-"),l.push(e("gotoXY")),l.push(e("doGotoObject")),l.push(e("doGlide")),l.push("-"),l.push(e("changeXPosition")),l.push(e("setXPosition")),l.push(e("changeYPosition")),l.push(e("setYPosition")),l.push("-"),l.push(e("bounceOffEdge")),l.push("-"),l.push(i("xPosition")),l.push(e("xPosition")),l.push(i("yPosition")),l.push(e("yPosition")),l.push(i("direction")),l.push(e("direction"))):"looks"===c?(l.push(e("doSwitchToCostume")),l.push(e("doWearNextCostume")),l.push(i("getCostumeIdx")),l.push(e("getCostumeIdx")),l.push("-"),l.push(e("doSayFor")),l.push(e("bubble")),l.push(e("doThinkFor")),l.push(e("doThink")),l.push("-"),l.push(e("changeEffect")),l.push(e("setEffect")),l.push(e("clearEffects")),l.push("-"),l.push(e("changeScale")),l.push(e("setScale")),l.push(i("getScale")),l.push(e("getScale")),l.push("-"),l.push(e("show")),l.push(e("hide")),l.push("-"),l.push(e("comeToFront")),l.push(e("goBack")),this.world().isDevMode&&(l.push("-"),h=new TextMorph(localize("development mode \ndebugging primitives:")),h.fontSize=9,h.setColor(this.paletteTextColor),l.push(h),l.push("-"),l.push(e("log")),l.push(e("alert")))):"sound"===c?(l.push(e("playSound")),l.push(e("doPlaySoundUntilDone")),l.push(e("doStopAllSounds")),l.push("-"),l.push(e("doRest")),l.push("-"),l.push(e("doPlayNote")),l.push("-"),l.push(e("doChangeTempo")),l.push(e("doSetTempo")),l.push(i("getTempo")),l.push(e("getTempo"))):"pen"===c?(l.push(e("clear")),l.push("-"),l.push(e("down")),l.push(e("up")),l.push("-"),l.push(e("setColor")),l.push(e("changeHue")),l.push(e("setHue")),l.push("-"),l.push(e("changeBrightness")),l.push(e("setBrightness")),l.push("-"),l.push(e("changeSize")),l.push(e("setSize")),l.push("-"),l.push(e("doStamp"))):"control"===c?(l.push(e("receiveGo")),l.push(e("receiveGoThenBroadcastFinished")),l.push(e("receiveKey")),l.push(e("receiveClick")),l.push(e("receiveMessage")),l.push(e("receiveFinished")),l.push("-"),l.push(e("doSendMissionSolved")),l.push(e("doBroadcast")),l.push(e("doBroadcastAndWait")),l.push(i("getLastMessage")),l.push(e("getLastMessage")),l.push("-"),l.push(e("doWarp")),l.push("-"),l.push(e("doWait")),l.push(e("doWaitUntil")),l.push("-"),l.push(e("doForever")),l.push(e("doRepeat")),l.push(e("doUntil")),l.push("-"),l.push(e("doIf")),l.push(e("doIfElse")),l.push("-"),l.push(e("doReport")),l.push("-"),l.push(e("doStopThis")),l.push(e("doStopOthers")),l.push("-"),l.push(e("doRun")),l.push(e("fork")),l.push(e("evaluate")),l.push("-"),l.push(e("doCallCC")),l.push(e("reportCallCC")),l.push("-"),l.push(e("receiveOnClone")),l.push(e("createClone")),l.push(e("removeClone")),l.push("-"),l.push(e("doPauseAll"))):"sensing"===c?(l.push(e("reportTouchingObject")),l.push(e("reportTouchingColor")),l.push(e("reportColorIsTouchingColor")),l.push("-"),l.push(e("doAsk")),l.push(i("getLastAnswer")),l.push(e("getLastAnswer")),l.push("-"),l.push(i("reportMouseX")),l.push(e("reportMouseX")),l.push(i("reportMouseY")),l.push(e("reportMouseY")),l.push(e("reportMouseDown")),l.push("-"),l.push(e("reportKeyPressed")),l.push("-"),l.push(e("reportDistanceTo")),l.push("-"),l.push(e("doResetTimer")),l.push(i("getTimer")),l.push(e("getTimer")),l.push("-"),l.push(e("reportAttributeOf")),l.push("-"),l.push(e("reportURL")),l.push("-"),l.push(e("reportIsFastTracking")),l.push(e("doSetFastTracking")),l.push("-"),l.push(e("reportDate")),this.world().isDevMode&&(l.push("-"),h=new TextMorph(localize("development mode \ndebugging primitives:")),h.fontSize=9,h.setColor(this.paletteTextColor),l.push(h),l.push("-"),l.push(e("colorFiltered")),l.push(e("reportStackSize")),l.push(e("reportFrameCount")))):"operators"===c?(l.push(e("reifyScript")),l.push(e("reifyReporter")),l.push(e("reifyPredicate")),l.push("#"),l.push("-"),l.push(e("reportSum")),l.push(e("reportDifference")),l.push(e("reportProduct")),l.push(e("reportQuotient")),l.push("-"),l.push(e("reportModulus")),l.push(e("reportRound")),l.push(e("reportMonadic")),l.push(e("reportRandom")),l.push("-"),l.push(e("reportLessThan")),l.push(e("reportEquals")),l.push(e("reportGreaterThan")),l.push("-"),l.push(e("reportAnd")),l.push(e("reportOr")),l.push(e("reportNot")),l.push("-"),l.push(e("reportTrue")),l.push(e("reportFalse")),l.push("-"),l.push(e("reportJoinWords")),l.push(e("reportTextSplit")),l.push(e("reportLetter")),l.push(e("reportStringSize")),l.push("-"),l.push(e("reportUnicode")),l.push(e("reportUnicodeAsLetter")),l.push("-"),l.push(e("reportIsA")),l.push(e("reportIsIdentical")),this.world().isDevMode&&(l.push("-"),h=new TextMorph("development mode \ndebugging primitives:"),h.fontSize=9,h.setColor(this.paletteTextColor),l.push(h),l.push("-"),l.push(e("reportTypeOf")),l.push(e("reportTextFunction")))):"variables"===c&&(a=new PushButtonMorph(null,function(){new VariableDialogMorph(null,function(t){t&&!p.variables.silentFind(t[0])&&(p.addVariable(t[0],t[1]),p.toggleVariableWatcher(t[0],t[1]),p.blocksCache[c]=null,p.paletteCache[c]=null,p.parentThatIsA(IDE_Morph).refreshPalette())},p).prompt("Variable name",null,p.world())},"Make a variable"),a.userMenu=n,a.selector="addVariable",a.showHelp=BlockMorph.prototype.showHelp,l.push(a),this.variables.allNames().length>0&&(a=new PushButtonMorph(null,function(){var t=new MenuMorph(p.deleteVariable,null,p);p.variables.allNames().forEach(function(e){t.addItem(e,e)}),t.popUpAtHand(p.world())},"Delete a variable"),a.userMenu=n,a.selector="deleteVariable",a.showHelp=BlockMorph.prototype.showHelp,l.push(a)),l.push("-"),s=this.variables.allNames(),s.length>0&&(s.forEach(function(t){l.push(r(t)),l.push(o(t))}),l.push("-")),l.push(e("doSetVar")),l.push(e("doChangeVar")),l.push(e("doShowVar")),l.push(e("doHideVar")),l.push(e("doDeclareVariables")),l.push("="),l.push(e("reportNewList")),l.push("-"),l.push(e("reportCONS")),l.push(e("reportListItem")),l.push(e("reportCDR")),l.push("-"),l.push(e("reportListLength")),l.push(e("reportListContainsItem")),l.push("-"),l.push(e("doAddToList")),l.push(e("doDeleteFromList")),l.push(e("doInsertInList")),l.push(e("doReplaceInList")),this.world().isDevMode&&(l.push("-"),h=new TextMorph(localize("development mode \ndebugging primitives:")),h.fontSize=9,h.setColor(this.paletteTextColor),l.push(h),l.push("-"),l.push(e("reportMap"))),l.push("="),StageMorph.prototype.enableCodeMapping&&(l.push(e("doMapCodeOrHeader")),l.push(e("doMapStringCode")),l.push(e("doMapListCode")),l.push("-"),l.push(e("reportMappedCode")),l.push("=")),a=new PushButtonMorph(null,function(){var t=p.parentThatIsA(IDE_Morph),e=p.parentThatIsA(StageMorph);new BlockDialogMorph(null,function(o){""!==o.spec&&(o.isGlobal?e.globalBlocks.push(o):p.customBlocks.push(o),t.flushPaletteCache(),t.refreshPalette(),new BlockEditorMorph(o,p).popUp())},p).prompt("Make a block",null,p.world())},"Make a block"),a.userMenu=n,a.selector="addCustomBlock",a.showHelp=BlockMorph.prototype.showHelp,l.push(a)),l},SpriteMorph.prototype.palette=function(t){return this.paletteCache[t]||(this.paletteCache[t]=this.freshPalette(t)),this.paletteCache[t]},SpriteMorph.prototype.freshPalette=function(t){var e,o=new ScrollFrameMorph(null,null,this.sliderColor),i=SyntaxElementMorph.prototype.fontSize,r=0,n=5,s=0,a=!1,h=this,l=this.parentThatIsA(StageMorph),p=Morph.prototype.trackChanges;return Morph.prototype.trackChanges=!1,o.owner=this,o.padding=i/2,o.color=this.paletteColor,o.growth=new Point(0,MorphicPreferences.scrollBarSize),o.userMenu=function(){function e(){var e=SpriteMorph.prototype.blocks,o=StageMorph.prototype.hiddenPrimitives;return Object.keys(o).some(function(o){return e[o].category===t||contains(s[t]||[],o)})}function i(){return o.contents.children.some(function(t){return contains(Object.keys(SpriteMorph.prototype.blocks),t.selector)})}var r=new MenuMorph,n=this.parentThatIsA(IDE_Morph),s={operators:["reifyScript","reifyReporter","reifyPredicate"],control:["doWarp"],variables:["doDeclareVariables","reportNewList","reportCONS","reportListItem","reportCDR","reportListLength","reportListContainsItem","doAddToList","doDeleteFromList","doInsertInList","doReplaceInList"]};return"STUDENT"!==h.world().role&&(i()&&r.addItem("hide primitives",function(){var e=SpriteMorph.prototype.blocks;Object.keys(e).forEach(function(o){e[o].category===t&&(StageMorph.prototype.hiddenPrimitives[o]=!0)}),(s[t]||[]).forEach(function(t){StageMorph.prototype.hiddenPrimitives[t]=!0}),n.flushBlocksCache(t),n.refreshPalette()}),e()&&r.addItem("show primitives",function(){var e=StageMorph.prototype.hiddenPrimitives,o=SpriteMorph.prototype.blocks;Object.keys(e).forEach(function(e){o[e].category===t&&delete StageMorph.prototype.hiddenPrimitives[e]}),(s[t]||[]).forEach(function(t){delete StageMorph.prototype.hiddenPrimitives[t]}),n.flushBlocksCache(t),n.refreshPalette()})),r},e=this.blocksCache[t],e||(e=h.blockTemplates(t),this.isCachingPrimitives&&(h.blocksCache[t]=e)),e.forEach(function(t){if(null!==t)if("-"===t){if(a)return;n+=.8*i,a=!0}else if("="===t){if(a)return;n+=1.6*i,a=!0}else"#"===t?(r=0,n=s):(a=!1,0===r&&(n+=.3*i),t.setPosition(new Point(r,n)),o.addContents(t),t instanceof ToggleMorph||t instanceof RingMorph?(r=t.right()+i/2,s=t.bottom()):(t.fixLayout&&t.fixLayout(),r=0,n+=t.height()))}),l&&(n+=1.6*i,l.globalBlocks.forEach(function(e){var s;(e.category===t||"variables"===t&&contains(["lists","other"],e.category))&&(s=e.templateInstance(),n+=.3*i,s.setPosition(new Point(r,n)),o.addContents(s),r=0,n+=s.height())})),n+=1.6*i,this.customBlocks.forEach(function(e){var s;(e.category===t||"variables"===t&&contains(["lists","other"],e.category))&&(s=e.templateInstance(),n+=.3*i,s.setPosition(new Point(r,n)),o.addContents(s),r=0,n+=s.height())}),Morph.prototype.trackChanges=p,o},SpriteMorph.prototype.addVariable=function(t,e){var o=this.parentThatIsA(IDE_Morph);e?(this.variables.parentFrame.addVar(t),o&&o.flushBlocksCache("variables")):(this.variables.addVar(t),this.blocksCache.variables=null)},SpriteMorph.prototype.deleteVariable=function(t){var e=this.parentThatIsA(IDE_Morph);this.deleteVariableWatcher(t),this.variables.deleteVar(t),e&&(e.flushBlocksCache("variables"),e.refreshPalette())},SpriteMorph.prototype.addCostume=function(t){t.name||(t.name="costume"+(this.costumes.length()+1)),this.costumes.add(t)},SpriteMorph.prototype.wearCostume=function(t){var e=this.xPosition?this.xPosition():null,o=this.yPosition?this.yPosition():null,i=this.isWarped;i&&this.endWarp(),this.changed(),this.costume=t,this.drawNew(),this.changed(),i&&this.startWarp(),null!==e&&this.silentGotoXY(e,o,!0),this.positionTalkBubble&&this.positionTalkBubble(),this.version=Date.now()},SpriteMorph.prototype.getCostumeIdx=function(){return this.costumes.asArray().indexOf(this.costume)+1},SpriteMorph.prototype.doWearNextCostume=function(){var t,e=this.costumes.asArray();e.length>1&&(t=e.indexOf(this.costume),t>-1&&(t+=1,t>e.length-1&&(t=0),this.wearCostume(e[t])))},SpriteMorph.prototype.doWearPreviousCostume=function(){var t,e=this.costumes.asArray();e.length>1&&(t=e.indexOf(this.costume),t>-1&&(t-=1,0>t&&(t=e.length-1),this.wearCostume(e[t])))},SpriteMorph.prototype.doSwitchToCostume=function(t){var e,o,i=this.costumes.asArray();if(contains([localize("Turtle"),localize("Empty")],t instanceof Array?t[0]:null))o=null;else{if(-1===t)return void this.doWearPreviousCostume();o=detect(i,function(e){return e.name===t}),null===o&&(e=parseFloat(t),o=0===e?null:i[e-1]||null)}this.wearCostume(o)},SpriteMorph.prototype.addSound=function(t,e){this.sounds.add(new Sound(t,e))},SpriteMorph.prototype.playSound=function(t){var e,o=this.parentThatIsA(StageMorph),i=detect(this.sounds.asArray(),function(e){return e.name===t});return i?(e=i.play(),o&&(o.activeSounds.push(e),o.activeSounds=o.activeSounds.filter(function(t){return!t.ended&&!t.terminated})),e):void 0},SpriteMorph.prototype.userMenu=function(){var t=this.parentThatIsA(IDE_Morph),e=new MenuMorph(this);return t&&t.isAppMode?(e.addItem("help","nop"),e):(e.addItem("duplicate","duplicate"),e.addItem("delete","remove"),e.addItem("edit","edit"),e.addLine(),this.anchor&&e.addItem(localize("detach from")+" "+this.anchor.name,"detachFromAnchor"),this.parts.length&&e.addItem("detach all parts","detachAllParts"),e.addItem("export...","exportSprite"),e)},SpriteMorph.prototype.exportSprite=function(){var t=this.parentThatIsA(IDE_Morph);t&&t.exportSprite(this)},SpriteMorph.prototype.edit=function(){var t=this.parentThatIsA(IDE_Morph);t&&t.selectSprite(this)},SpriteMorph.prototype.showOnStage=function(){var t=this.parentThatIsA(StageMorph);t&&(this.keepWithin(t),t.add(this)),this.show()},SpriteMorph.prototype.duplicate=function(){var t=this.parentThatIsA(IDE_Morph);t&&t.duplicateSprite(this)},SpriteMorph.prototype.remove=function(){var t=this.parentThatIsA(IDE_Morph);t&&t.removeSprite(this)},SpriteMorph.prototype.createClone=function(){var t,e,o=this.parentThatIsA(StageMorph);if(o){if(o.cloneCount>300)return;o.cloneCount+=1,t=this.fullCopy(),t.isClone=!0,t.name="",t.cloneOriginName=this.isClone?this.cloneOriginName:this.name,o.add(t),e=t.allHatBlocksFor("__clone__init__"),e.forEach(function(t){o.threads.startProcess(t,o.isThreadSafe)})}},SpriteMorph.prototype.removeClone=function(){this.isClone&&(this.parent.threads.stopAllForReceiver(this),this.destroy(),this.parent.cloneCount-=1)},SpriteMorph.prototype.setColor=function(t){var e=this.xPosition(),o=this.yPosition();this.color.eq(t)||(this.color=t,this.drawNew(),this.gotoXY(e,o))},SpriteMorph.prototype.getHue=function(){return 100*this.color.hsv()[0]},SpriteMorph.prototype.setHue=function(t){var e=this.color.hsv(),o=this.xPosition(),i=this.yPosition();e[0]=Math.max(Math.min(+t||0,100),0)/100,e[1]=1,this.color.set_hsv.apply(this.color,e),this.costume||(this.drawNew(),this.changed()),this.gotoXY(o,i)},SpriteMorph.prototype.changeHue=function(t){this.setHue(this.getHue()+(+t||0))},SpriteMorph.prototype.getBrightness=function(){return 100*this.color.hsv()[2]},SpriteMorph.prototype.setBrightness=function(t){var e=this.color.hsv(),o=this.xPosition(),i=this.yPosition();e[1]=1,e[2]=Math.max(Math.min(+t||0,100),0)/100,this.color.set_hsv.apply(this.color,e),this.costume||(this.drawNew(),this.changed()),this.gotoXY(o,i)},SpriteMorph.prototype.changeBrightness=function(t){this.setBrightness(this.getBrightness()+(+t||0))},SpriteMorph.prototype.comeToFront=function(){this.parent&&(this.parent.add(this),this.changed())},SpriteMorph.prototype.goBack=function(t){var e,o=+t||0;return this.parent?(e=this.parent.children.indexOf(this),o>e?null:(this.parent.removeChild(this),this.parent.children.splice(e-o,null,this),void this.parent.changed())):null},SpriteMorph.prototype.overlappingImage=function(t){var e=this.bounds.intersect(t.bounds),o=newCanvas(e.extent()),i=o.getContext("2d");return e.width()<1||e.height()<1?newCanvas(new Point(1,1)):(i.drawImage(this.image,this.left()-e.left(),this.top()-e.top()),i.globalCompositeOperation="source-in",i.drawImage(t.image,t.left()-e.left(),t.top()-e.top()),o)},SpriteMorph.prototype.doStamp=function(){var t=this.parent,e=t.penTrails().getContext("2d"),o=this.isWarped;o&&this.endWarp(),e.save(),e.scale(1/t.scale,1/t.scale),e.drawImage(this.image,this.left()-t.left(),this.top()-t.top()),e.restore(),this.changed(),o&&this.startWarp()},SpriteMorph.prototype.clear=function(){this.parent.clearPenTrails()},SpriteMorph.prototype.setSize=function(t){isNaN(t)||(this.size=Math.min(Math.max(+t,1e-4),1e3))},SpriteMorph.prototype.changeSize=function(t){this.setSize(this.size+(+t||0))},SpriteMorph.prototype.getScale=function(){return 100*this.scale},SpriteMorph.prototype.setScale=function(t){var e,o,i=this.xPosition(),r=this.yPosition(),n=this.isWarped;n&&this.endWarp(),e=(+t||0)/100,o=e/this.nestingScale,this.nestingScale=e,this.scale=Math.max(e,.01),this.changed(),this.drawNew(),this.changed(),n&&this.startWarp(),this.silentGotoXY(i,r,!0),this.positionTalkBubble(),this.parts.forEach(function(t){var e=t.xPosition()-i,n=t.yPosition()-r;t.setScale(100*t.scale*o),t.silentGotoXY(i+e*o,r+n*o)})},SpriteMorph.prototype.changeScale=function(t){this.setScale(this.getScale()+(+t||0))},SpriteMorph.prototype.setEffect=function(t,e){var o=t instanceof Array?t[0]:null;"ghost"===o&&(this.alpha=1-Math.min(Math.max(+e||0,0),100)/100,this.changed())},SpriteMorph.prototype.getGhostEffect=function(){return 100*(1-this.alpha)},SpriteMorph.prototype.changeEffect=function(t,e){var o=t instanceof Array?t[0]:null;"ghost"===o&&this.setEffect(t,this.getGhostEffect()+(+e||0))},SpriteMorph.prototype.clearEffects=function(){this.setEffect(["ghost"],0)},SpriteMorph.prototype.stopTalking=function(){var t=this.talkBubble();t&&t.destroy()},SpriteMorph.prototype.doThink=function(t){this.bubble(t,!0)},SpriteMorph.prototype.bubble=function(t,e,o){var i,r=this.parentThatIsA(StageMorph);this.stopTalking(),""===t||isNil(t)||(i=new SpriteBubbleMorph(t,r?r.scale:1,e,o),this.add(i),this.positionTalkBubble())},SpriteMorph.prototype.talkBubble=function(){return detect(this.children,function(t){return t instanceof SpeechBubbleMorph})},SpriteMorph.prototype.positionTalkBubble=function(){var t=this.parentThatIsA(StageMorph),e=t?t.scale:1,o=this.talkBubble(),i=this.center().y;if(!o)return null;for(o.show(),o.isPointingRight||(o.isPointingRight=!0,o.drawNew(),o.changed()),o.setLeft(this.right()),o.setBottom(this.top());!this.isTouching(o)&&o.bottom()<i;)o.silentMoveBy(new Point(-1,1).scaleBy(e));return t?(o.right()>t.right()&&(o.isPointingRight=!1,o.drawNew(),o.setRight(this.center().x)),o.keepWithin(t),void o.changed()):null},SpriteMorph.prototype.prepareToBeGrabbed=function(t){var e=this.talkBubble();return e?(this.removeShadow(),e.hide(),this.bounds.containsPoint(t.position())||this.setCenter(t.position()),void this.addShadow()):null},SpriteMorph.prototype.justDropped=function(){this.positionTalkBubble()},SpriteMorph.prototype.drawLine=function(t,e){var o=this.parent.bounds.origin,i=this.parent.scale,r=this.parent.penTrails().getContext("2d"),n=t.subtract(o).divideBy(i),s=e.subtract(o).divideBy(i),a=n.multiplyBy(i).add(o),h=s.multiplyBy(i).add(o),l=a.rectangle(h).expandBy(Math.max(this.size*i/2,1)).intersect(this.parent.visibleBounds()).spread();this.isDown&&(r.lineWidth=this.size,r.strokeStyle=this.color.toString(),this.useFlatLineEnds?(r.lineCap="butt",r.lineJoin="miter"):(r.lineCap="round",r.lineJoin="round"),r.beginPath(),r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),this.isWarped===!1&&this.world().broken.push(l))},SpriteMorph.prototype.moveBy=function(t,e){var o=this.isDown&&!e&&this.parent?this.rotationCenter():null;SpriteMorph.uber.moveBy.call(this,t),o&&this.drawLine(o,this.rotationCenter()),e||this.parts.forEach(function(e){e.moveBy(t)})},SpriteMorph.prototype.slideBackTo=function(t,e){var o=e||5,i=t.origin.position().add(t.position),r=-(this.left()-i.x)/o,n=-(this.top()-i.y)/o,s=0,a=this.step,h=this.fps,l=this;this.fps=0,this.step=function(){l.moveBy(new Point(r,n)),s+=1,s===o&&(t.origin.add(l),t.origin.reactToDropOf&&t.origin.reactToDropOf(l),l.step=a,l.fps=h)}},SpriteMorph.prototype.setCenter=function(t,e){var o=t.subtract(this.center());this.moveBy(o,e)},SpriteMorph.prototype.nestingBounds=function(){var t;return t=this.bounds,this.parts.forEach(function(e){e.isVisible&&(t=t.merge(e.nestingBounds()))}),t},Morph.prototype.setPosition=function(t,e){var o=t.subtract(this.topLeft());(0!==o.x||0!==o.y)&&this.moveBy(o,e)},SpriteMorph.prototype.forward=function(t){var e,o=t*this.parent.scale||0;e=o>=0?this.position().distanceAngle(o,this.heading):this.position().distanceAngle(Math.abs(o),this.heading-180),this.setPosition(e),this.positionTalkBubble()},SpriteMorph.prototype.setHeading=function(t){var e=this.xPosition(),o=this.yPosition(),i=t-this.heading;this.changed(),SpriteMorph.uber.setHeading.call(this,t),this.silentGotoXY(e,o,!0),this.positionTalkBubble(),this.parts.forEach(function(t){var r=new Point(t.xPosition(),t.yPosition()),n=r.rotateBy(radians(i),new Point(e,o));t.rotatesWithAnchor&&t.turn(i),t.gotoXY(n.x,n.y)})},SpriteMorph.prototype.faceToXY=function(t,e){var o=(t-this.xPosition())*this.parent.scale,i=(e-this.yPosition())*this.parent.scale,r=Math.abs(o)<.001?0>i?90:270:Math.round((o>=0?0:180)-57.2957795131*Math.atan(i/o));this.setHeading(r+90)},SpriteMorph.prototype.turn=function(t){this.setHeading(this.heading+(+t||0))},SpriteMorph.prototype.turnLeft=function(t){this.setHeading(this.heading-(+t||0))},SpriteMorph.prototype.xPosition=function(){var t=this.parentThatIsA(StageMorph);return!t&&this.parent.grabOrigin&&(t=this.parent.grabOrigin.origin),t?(this.rotationCenter().x-t.center().x)/t.scale:this.rotationCenter().x},SpriteMorph.prototype.yPosition=function(){var t=this.parentThatIsA(StageMorph);return!t&&this.parent.grabOrigin&&(t=this.parent.grabOrigin.origin),t?(t.center().y-this.rotationCenter().y)/t.scale:this.rotationCenter().y},SpriteMorph.prototype.direction=function(){return this.heading},SpriteMorph.prototype.penSize=function(){return this.size},SpriteMorph.prototype.gotoXY=function(t,e,o){var i,r,n,s=this.parentThatIsA(StageMorph);i=s.center().x+(+t||0)*s.scale,r=s.center().y-(+e||0)*s.scale,n=new Point(i,r).subtract(this.costume?this.rotationOffset:this.extent().divideBy(2)),this.setPosition(n,o),this.positionTalkBubble()},SpriteMorph.prototype.silentGotoXY=function(t,e,o){var i=this.isDown;this.isDown=!1,this.gotoXY(t,e,o),this.isDown=i},SpriteMorph.prototype.setXPosition=function(t){this.gotoXY(+t||0,this.yPosition())},SpriteMorph.prototype.changeXPosition=function(t){this.setXPosition(this.xPosition()+(+t||0))},SpriteMorph.prototype.setYPosition=function(t){this.gotoXY(this.xPosition(),+t||0)},SpriteMorph.prototype.changeYPosition=function(t){this.setYPosition(this.yPosition()+(+t||0))},SpriteMorph.prototype.glide=function(t,e,o,i,r){var n,s,a;s=new Point(e,o),n=Math.max(Math.min(i/t,1),0),a=r.add(s.subtract(r).multiplyBy(n)),this.gotoXY(a.x,a.y)},SpriteMorph.prototype.bounceOffEdge=function(){var t,e,o=this.parentThatIsA(StageMorph),i=this.nestingBounds();return o?o.bounds.containsRectangle(i)?null:(t=Math.cos(radians(this.heading-90)),e=-Math.sin(radians(this.heading-90)),i.left()<o.left()&&(t=Math.abs(t)),i.right()>o.right()&&(t=-Math.abs(t)),i.top()<o.top()&&(e=-Math.abs(e)),i.bottom()>o.bottom()&&(e=Math.abs(e)),this.setHeading(degrees(Math.atan2(-e,t))+90),this.setPosition(this.position().add(i.amountToTranslateWithin(o.bounds))),void this.positionTalkBubble()):null},SpriteMorph.prototype.allMessageNames=function(){var t=[];return this.scripts.allChildren().forEach(function(e){var o;e.selector&&contains(["receiveMessage","doBroadcast","doBroadcastAndWait"],e.selector)&&(o=e.inputs()[0].evaluate(),isString(o)&&""!==o&&(contains(t,o)||t.push(o)))}),t},SpriteMorph.prototype.allHatBlocksFor=function(t){var e=this.parentThatIsA(StageMorph).threads;return this.scripts.children.filter(function(o){var i;if(o.selector){if("receiveMessage"===o.selector)return i=o.inputs()[0].evaluate(),i===t||i instanceof Array&&t!==e.finishedMessage;if("receiveFinished"===o.selector)return t===e.finishedMessage;if("receiveGo"===o.selector||"receiveGoThenBroadcastFinished"===o.selector)return"__shout__go__"===t;if("receiveOnClone"===o.selector)return"__clone__init__"===t;if("receiveClick"===o.selector)return"__click__"===t}return!1})},SpriteMorph.prototype.allHatBlocksForKey=function(t){return this.scripts.children.filter(function(e){return e.selector&&"receiveKey"===e.selector?e.inputs()[0].evaluate()[0]===t:!1})},SpriteMorph.prototype.mouseClickLeft=function(){var t=this.parentThatIsA(StageMorph),e=this.allHatBlocksFor("__click__"),o=[];return e.forEach(function(e){o.push(t.threads.startProcess(e,t.isThreadSafe))}),o},SpriteMorph.prototype.getTimer=function(){var t=this.parentThatIsA(StageMorph);return t?t.getTimer():0},SpriteMorph.prototype.getTempo=function(){var t=this.parentThatIsA(StageMorph);return t?t.getTempo():0},SpriteMorph.prototype.getLastMessage=function(){var t=this.parentThatIsA(StageMorph);return t?t.getLastMessage():""},SpriteMorph.prototype.getLastAnswer=function(){return this.parentThatIsA(StageMorph).lastAnswer},SpriteMorph.prototype.reportMouseX=function(){var t=this.parentThatIsA(StageMorph);return t?t.reportMouseX():0},SpriteMorph.prototype.reportMouseY=function(){var t=this.parentThatIsA(StageMorph);return t?t.reportMouseY():0},SpriteMorph.prototype.findVariableWatcher=function(t){var e=this.parentThatIsA(StageMorph),o=this;return null===e?null:detect(e.children,function(e){return e instanceof WatcherMorph&&(e.target===o.variables||e.target===o.variables.parentFrame)&&e.getter===t})},SpriteMorph.prototype.toggleVariableWatcher=function(t,e){var o,i,r=this.parentThatIsA(StageMorph);return null===r?null:(o=this.findVariableWatcher(t),null!==o?void(o.isVisible?o.hide():(o.show(),o.fixLayout(),o.keepWithin(r))):(o=new WatcherMorph(t,this.blockColor.variables,e?this.variables.parentFrame:this.variables,t),o.setPosition(r.position().add(10)),i=r.watchers(o.left()),i.length>0&&o.setTop(i[i.length-1].bottom()),r.add(o),o.fixLayout(),void o.keepWithin(r)))},SpriteMorph.prototype.showingVariableWatcher=function(t){var e,o=this.parentThatIsA(StageMorph);return null===o?!1:(e=this.findVariableWatcher(t),e?e.isVisible:!1)},SpriteMorph.prototype.deleteVariableWatcher=function(t){var e,o=this.parentThatIsA(StageMorph);return null===o?null:(e=this.findVariableWatcher(t),void(null!==e&&e.destroy()))},SpriteMorph.prototype.toggleWatcher=function(t,e,o){var i,r,n=this.parentThatIsA(StageMorph);if(n){if(i=this.watcherFor(n,t))return void(i.isVisible?i.hide():(i.show(),i.fixLayout(),i.keepWithin(n)));i=new WatcherMorph(e,o,WatcherMorph.prototype.isGlobal(t)?n:this,t),i.setPosition(n.position().add(10)),r=n.watchers(i.left()),r.length>0&&i.setTop(r[r.length-1].bottom()),n.add(i),i.fixLayout(),i.keepWithin(n)}},SpriteMorph.prototype.showingWatcher=function(t){var e,o=this.parentThatIsA(StageMorph);return null===o?!1:(e=this.watcherFor(o,t),e?e.isVisible:!1)},SpriteMorph.prototype.watcherFor=function(t,e){var o=this;return detect(t.children,function(i){return i instanceof WatcherMorph&&i.getter===e&&i.target===(i.isGlobal(e)?t:o)})},SpriteMorph.prototype.deleteAllBlockInstances=function(t){this.allBlockInstances(t).forEach(function(t){t.deleteBlock()}),this.customBlocks.forEach(function(t){t.body&&t.body.expression.isCorpse&&(t.body=null)})},SpriteMorph.prototype.allBlockInstances=function(t){var e,o,i,r=[];return t.isGlobal?(e=this.parentThatIsA(StageMorph),o=e.children.filter(function(t){return t instanceof SpriteMorph}),o.push(e),o.forEach(function(e){r=r.concat(e.allLocalBlockInstances(t))}),i=[],e.globalBlocks.forEach(function(e){e.body&&e.body.expression.allChildren().forEach(function(e){e.definition&&e.definition===t&&i.push(e)})}),r.concat(i)):this.allLocalBlockInstances(t)},SpriteMorph.prototype.allLocalBlockInstances=function(t){var e,o,i,r,n;return e=this.scripts.allChildren().filter(function(e){return e.definition&&e.definition===t}),o=[],this.customBlocks.forEach(function(e){e.body&&e.body.expression.allChildren().forEach(function(e){e.definition&&e.definition===t&&o.push(e)})}),i=this.allEditorBlockInstances(t),r=this.paletteBlockInstance(t),n=e.concat(o).concat(i),r&&n.push(r),n},SpriteMorph.prototype.allEditorBlockInstances=function(t){var e=[],o=this.world();return o?(this.world().children.forEach(function(o){o instanceof BlockEditorMorph&&o.body.contents.allChildren().forEach(function(o){o.isPrototype||o instanceof PrototypeHatBlockMorph||o.definition!==t||e.push(o)})}),e):[]},SpriteMorph.prototype.paletteBlockInstance=function(t){var e=this.parentThatIsA(IDE_Morph);return e?detect(e.palette.contents.children,function(e){return e.definition===t}):null},SpriteMorph.prototype.usesBlockInstance=function(t){var e,o=detect(this.scripts.allChildren(),function(e){return e.definition&&e.definition===t});return o?!0:(e=[],this.customBlocks.forEach(function(o){o.body&&o.body.expression.allChildren().forEach(function(o){o.definition&&o.definition===t&&e.push(o)})}),e.length>0)},SpriteMorph.prototype.doubleDefinitionsFor=function(t){var e,o,i,r=t.blockSpec();
if(t.isGlobal){if(i=this.parentThatIsA(StageMorph),!i)return[];e=i.globalBlocks}else e=this.customBlocks;return o=e.indexOf(t),-1===o?[]:e.filter(function(t,e){return t.blockSpec()===r&&e!==o})},SpriteMorph.prototype.replaceDoubleDefinitionsFor=function(t){var e,o,i=this.doubleDefinitionsFor(t),r=this;i.forEach(function(e){r.allBlockInstances(e).forEach(function(e){e.definition=t,e.refresh()})}),t.isGlobal?(e=this.parentThatIsA(StageMorph),e.globalBlocks=e.globalBlocks.filter(function(t){return!contains(i,t)})):this.customBlocks=this.customBlocks.filter(function(t){return!contains(i,t)}),o=this.parentThatIsA(IDE_Morph),o&&(o.flushPaletteCache(),o.refreshPalette())},SpriteMorph.prototype.thumbnail=function(t){var e=this.image,o=Math.min(t.x/e.width,t.y/e.height),i=(t.x-e.width*o)/2,r=(t.y-e.height*o)/2,n=newCanvas(t),s=n.getContext("2d");return s.save(),e.width&&e.height&&(s.scale(o,o),s.drawImage(e,Math.floor(i/o),Math.floor(r/o))),n},SpriteMorph.prototype.fullThumbnail=function(t){var e=this.thumbnail(t),o=e.getContext("2d"),i=t.divideBy(3),r=0;for(o.restore(),this.anchor&&o.drawImage(this.anchor.thumbnail(i),0,0),r=0;3>r;r+=1)this.parts[r]&&o.drawImage(this.parts[r].thumbnail(i),r*i.x,t.y-i.y);return e},SpriteMorph.prototype.booleanMorph=function(t){var e=new ReporterBlockMorph(!0);return e.color=SpriteMorph.prototype.blockColor.operators,e.setSpec(localize(t.toString())),e},SpriteMorph.prototype.attachPart=function(t){var e=Date.now();t.anchor&&t.anchor.detachPart(t),this.parts.push(t),this.version=e,t.anchor=this,this.allParts().forEach(function(t){t.nestingScale=t.scale}),t.version=e},SpriteMorph.prototype.detachPart=function(t){var e,o=this.parts.indexOf(t);-1!==o&&(e=Date.now(),this.parts.splice(o,1),this.version=e,t.anchor=null,t.version=e)},SpriteMorph.prototype.detachAllParts=function(){var t=Date.now();this.parts.forEach(function(e){e.anchor=null,e.version=t}),this.parts=[],this.version=t},SpriteMorph.prototype.detachFromAnchor=function(){this.anchor&&this.anchor.detachPart(this)},SpriteMorph.prototype.allParts=function(){var t=[this];return this.parts.forEach(function(e){t=t.concat(e.allParts())}),t},SpriteMorph.prototype.allAnchors=function(){var t=[this];return null!==this.anchor&&(t=t.concat(this.anchor.allAnchors())),t},SpriteMorph.prototype.addHighlight=function(t){var e,o=!this.isVisible;return o&&this.show(),e=this.highlight(t?t.color:this.highlightColor,this.highlightBorder),this.addBack(e),this.fullChanged(),o&&this.hide(),e},SpriteMorph.prototype.removeHighlight=function(){var t=this.getHighlight();return null!==t&&(this.fullChanged(),this.removeChild(t)),t},SpriteMorph.prototype.toggleHighlight=function(){this.getHighlight()?this.removeHighlight():this.addHighlight()},SpriteMorph.prototype.highlight=function(t,e){var o,i=new SpriteHighlightMorph,r=this.bounds,n=e;return i.setExtent(r.extent().add(2*n)),i.color=t,i.image=this.highlightImage(t,e),o=i.image.getContext("2d"),o.drawImage(this.highlightImage(new Color(255,255,255),4),e-4,e-4),o.drawImage(this.highlightImage(new Color(50,50,50),2),e-2,e-2),o.drawImage(this.highlightImage(new Color(255,255,255),1),e-1,e-1),i.setPosition(r.origin.subtract(new Point(n,n))),i},SpriteMorph.prototype.highlightImage=function(t,e){var o,i,r,n,s;return o=this.extent(),i=this.image,r=newCanvas(o.add(2*e)),n=r.getContext("2d"),n.drawImage(i,0,0),n.drawImage(i,e,0),n.drawImage(i,2*e,0),n.drawImage(i,2*e,e),n.drawImage(i,2*e,2*e),n.drawImage(i,e,2*e),n.drawImage(i,0,2*e),n.drawImage(i,0,e),n.globalCompositeOperation="destination-out",n.drawImage(i,e,e),s=newCanvas(o.add(2*e)),n=s.getContext("2d"),n.drawImage(r,0,0),n.globalCompositeOperation="source-atop",n.fillStyle=t.toString(),n.fillRect(0,0,s.width,s.height),s},SpriteMorph.prototype.getHighlight=function(){var t;return t=this.children.slice(0).reverse().filter(function(t){return t instanceof SpriteHighlightMorph}),0!==t.length?t[0]:null},SpriteMorph.prototype.mouseEnterDragging=function(){var t;this.enableNesting&&(t=this.world().hand.children[0],this.wantsDropOf(t)&&this.addHighlight())},SpriteMorph.prototype.mouseLeave=function(){this.enableNesting&&this.removeHighlight()},SpriteMorph.prototype.wantsDropOf=function(t){return this.enableNesting&&t instanceof SpriteIconMorph&&!contains(t.object.allParts(),this)},SpriteMorph.prototype.reactToDropOf=function(t,e){this.removeHighlight(),this.attachPart(t.object),this.world().add(t),t.slideBackTo(e.grabOrigin)},SpriteHighlightMorph.prototype=new Morph,SpriteHighlightMorph.prototype.constructor=SpriteHighlightMorph,SpriteHighlightMorph.uber=Morph.prototype,StageMorph.prototype=new FrameMorph,StageMorph.prototype.constructor=StageMorph,StageMorph.uber=FrameMorph.prototype,StageMorph.prototype.dimensions=new Point(480,360),StageMorph.prototype.frameRate=0,StageMorph.prototype.isCachingPrimitives=SpriteMorph.prototype.isCachingPrimitives,StageMorph.prototype.sliderColor=SpriteMorph.prototype.sliderColor,StageMorph.prototype.paletteTextColor=SpriteMorph.prototype.paletteTextColor,StageMorph.prototype.hiddenPrimitives={},StageMorph.prototype.codeMappings={},StageMorph.prototype.codeHeaders={},StageMorph.prototype.enableCodeMapping=!1,StageMorph.prototype.init=function(t){this.name=localize("Stage"),this.threads=new ThreadManager,this.variables=new VariableFrame(t||null,this),this.scripts=new ScriptsMorph(this),this.customBlocks=[],this.globalBlocks=[],this.costumes=new List,this.costume=null,this.sounds=new List,this.version=Date.now(),this.isFastTracked=!1,this.cloneCount=0,this.timerStart=Date.now(),this.tempo=60,this.lastMessage="",this.watcherUpdateFrequency=2,this.lastWatcherUpdate=Date.now(),this.scale=1,this.keysPressed={},this.blocksCache={},this.paletteCache={},this.lastAnswer=null,this.activeSounds=[],this.trailsCanvas=null,this.isThreadSafe=!1,StageMorph.uber.init.call(this),this.acceptsDrops=!1,this.setColor(new Color(255,255,255)),this.fps=this.frameRate},StageMorph.prototype.setScale=function(t){var e,o,i=t/this.scale,r=this.position(),n=Morph.prototype.trackChanges,s=this;1!==i&&(Morph.prototype.trackChanges=!1,this.scale=t,this.setExtent(this.dimensions.multiplyBy(t)),this.children.forEach(function(n){e=n.position().subtract(r),n.drawNew(),n.setPosition(e.multiplyBy(i).add(r),!0),n instanceof SpriteMorph?(o=n.talkBubble(),o&&(o.setScale(t),n.positionTalkBubble())):n instanceof StagePrompterMorph&&(n.setWidth(s.scale<1?s.width()-10:s.dimensions.x-20),n.fixLayout(),n.setCenter(s.center()),n.setBottom(s.bottom()))}),Morph.prototype.trackChanges=n,this.changed())},StageMorph.prototype.drawNew=function(){var t;StageMorph.uber.drawNew.call(this),this.costume&&(t=this.image.getContext("2d"),t.scale(this.scale,this.scale),t.drawImage(this.costume.contents,(this.width()/this.scale-this.costume.width())/2,(this.height()/this.scale-this.costume.height())/2))},StageMorph.prototype.drawOn=function(t,e){var o,i,r,n,s,a,h,l,p,c,d;if(!this.isVisible)return null;if(o=e||this.bounds,i=o.intersect(this.bounds).round(),i.extent().gt(new Point(0,0))){if(r=this.position().neg(),n=i.copy().translateBy(r).round(),s=t.getContext("2d"),s.globalAlpha=this.alpha,l=n.left(),p=n.top(),a=Math.min(n.width(),this.image.width-l),h=Math.min(n.height(),this.image.height-p),1>a||1>h)return null;s.drawImage(this.image,n.left(),n.top(),a,h,i.left(),i.top(),a,h),c=a/this.scale,d=h/this.scale,s.save(),s.scale(this.scale,this.scale),s.drawImage(this.penTrails(),n.left()/this.scale,n.top()/this.scale,c,d,i.left()/this.scale,i.top()/this.scale,c,d),s.restore()}},StageMorph.prototype.clearPenTrails=function(){this.trailsCanvas=newCanvas(this.dimensions),this.changed()},StageMorph.prototype.penTrails=function(){return this.trailsCanvas||(this.trailsCanvas=newCanvas(this.dimensions)),this.trailsCanvas},StageMorph.prototype.penTrailsMorph=function(){var t,e=new Morph,o=this.penTrails();return e.bounds=this.bounds.copy(),e.image=newCanvas(this.extent()),t=e.image.getContext("2d"),t.drawImage(o,0,0,o.width,o.height,0,0,this.image.width,this.image.height),e},StageMorph.prototype.colorFiltered=function(t,e){var o,i,r,n,s,a=new Morph,h=this.extent(),l=this.thumbnail(h,e);for(i=l.getContext("2d").getImageData(0,0,h.x,h.y),a.bounds=this.bounds.copy(),a.image=newCanvas(h),o=a.image.getContext("2d"),s=o.createImageData(h.x,h.y),n=0;n<h.x*h.y*4;n+=4)r=new Color(i.data[n],i.data[n+1],i.data[n+2]),r.eq(t)&&(s.data[n]=i.data[n],s.data[n+1]=i.data[n+1],s.data[n+2]=i.data[n+2],s.data[n+3]=255);return o.putImageData(s,0,0),a},StageMorph.prototype.watchers=function(t){return this.children.filter(function(e){return e instanceof WatcherMorph?t?e.left()===t:e.isVisible:!1})},StageMorph.prototype.resetTimer=function(){this.timerStart=Date.now()},StageMorph.prototype.getTimer=function(){var t=Math.floor((Date.now()-this.timerStart)/100);return t/10},StageMorph.prototype.setTempo=function(t){this.tempo=Math.max(20,+t||0)},StageMorph.prototype.changeTempo=function(t){this.setTempo(this.getTempo()+(+t||0))},StageMorph.prototype.getTempo=function(){return+this.tempo},StageMorph.prototype.getLastMessage=function(){return this.lastMessage||""},StageMorph.prototype.reportMouseX=function(){var t=this.world();return t?(t.hand.position().x-this.center().x)/this.scale:0},StageMorph.prototype.reportMouseY=function(){var t=this.world();return t?(this.center().y-t.hand.position().y)/this.scale:0},StageMorph.prototype.wantsDropOf=function(t){return t instanceof SpriteMorph||t instanceof WatcherMorph||t instanceof ListWatcherMorph||t instanceof SpriteIconMorph},StageMorph.prototype.reactToDropOf=function(t,e){t instanceof SpriteIconMorph&&(t.object.anchor&&t.object.anchor.detachPart(t.object),this.world().add(t),t.slideBackTo(e.grabOrigin))},StageMorph.prototype.step=function(){var t,e,o,i=this.world();if(null===i.keyboardReceiver&&(i.keyboardReceiver=this),null===i.currentKey&&(this.keyPressed=null),this.isFastTracked&&this.threads.processes.length){for(this.children.forEach(function(t){t instanceof SpriteMorph&&(t.wasWarped=t.isWarped,t.isWarped||t.startWarp())});Date.now()-this.lastTime<100;)this.threads.step();this.children.forEach(function(t){t instanceof SpriteMorph&&(t.wasWarped||t.endWarp())}),this.changed()}else this.threads.step();t=Date.now(),e=t-this.lastWatcherUpdate,o=1e3/this.watcherUpdateFrequency-e,1>o&&(this.watchers().forEach(function(t){t.update()}),this.lastWatcherUpdate=Date.now())},StageMorph.prototype.developersMenu=function(){var t=this,e=StageMorph.uber.developersMenu.call(this);return e.addItem("stop",function(){t.threads.stopAll()},"terminate all running threads"),e},StageMorph.prototype.processKeyDown=function(t){this.processKeyEvent(t,this.fireKeyEvent)},StageMorph.prototype.processKeyUp=function(t){this.processKeyEvent(t,this.removePressedKey)},StageMorph.prototype.processKeyEvent=function(t,e){var o;switch(t.keyCode){case 13:o="enter",(t.ctrlKey||t.metaKey)&&(o="ctrl enter");break;case 27:o="esc";break;case 32:o="space";break;case 37:o="left arrow";break;case 39:o="right arrow";break;case 38:o="up arrow";break;case 40:o="down arrow";break;default:o=String.fromCharCode(t.keyCode||t.charCode)}e.call(this,o)},StageMorph.prototype.fireKeyEvent=function(t){var e=t.toLowerCase(),o=[],i=[],r=this;return this.keysPressed[e]=!0,"ctrl enter"===e?this.fireGreenFlagEvent():"esc"===e?this.fireStopAllEvent():(this.children.concat(this).forEach(function(t){(t instanceof SpriteMorph||t instanceof StageMorph)&&(o=o.concat(t.allHatBlocksForKey(e)))}),o.forEach(function(t){i.push(r.threads.startProcess(t,r.isThreadSafe))}),i)},StageMorph.prototype.removePressedKey=function(t){delete this.keysPressed[t.toLowerCase()]},StageMorph.prototype.processKeyPress=function(t){nop(t)},StageMorph.prototype.inspectKeyEvent=CursorMorph.prototype.inspectKeyEvent,StageMorph.prototype.fireGreenFlagEvent=function(){var t=[],e=[],o=this.parentThatIsA(IDE_Morph),i=this;return this.children.concat(this).forEach(function(t){(t instanceof SpriteMorph||t instanceof StageMorph)&&(e=e.concat(t.allHatBlocksFor("__shout__go__")))}),e.forEach(function(e){t.push(i.threads.startProcess(e,i.isThreadSafe))}),o&&o.controlBar.pauseButton.refresh(),t},StageMorph.prototype.fireStopAllEvent=function(){var t=this.parentThatIsA(IDE_Morph);this.threads.resumeAll(this.stage),this.keysPressed={},this.threads.stopAll(),this.stopAllActiveSounds(),this.children.forEach(function(t){t.stopTalking&&t.stopTalking()}),this.removeAllClones(),t&&t.nextSteps([nop,function(){t.controlBar.pauseButton.refresh()}])},StageMorph.prototype.removeAllClones=function(){var t=this,e=this.children.filter(function(t){return t.isClone});e.forEach(function(e){t.threads.stopAllForReceiver(e),e.destroy()}),this.cloneCount=0},StageMorph.prototype.blockTemplates=function(t){function e(t){if(l.hiddenPrimitives[t])return null;var e=SpriteMorph.prototype.blockForSelector(t,!0);return e.isTemplate=!0,e}function o(t){var e=SpriteMorph.prototype.variableBlock(t);return e.isDraggable=!1,e.isTemplate=!0,e}function i(t){if(l.hiddenPrimitives[t])return null;var e=SpriteMorph.prototype.blocks[t];return new ToggleMorph("checkbox",this,function(){l.toggleWatcher(t,localize(e.spec),l.blockColor[e.category])},null,function(){return l.showingWatcher(t)},null)}function r(t){return new ToggleMorph("checkbox",this,function(){l.toggleVariableWatcher(t)},null,function(){return l.showingVariableWatcher(t)},null)}var n,s,a,h=[],l=this,p=t||"motion";return"motion"===p?(a=new TextMorph(localize("Stage selected:\nno motion primitives")),a.fontSize=9,a.setColor(this.paletteTextColor),h.push(a)):"looks"===p?(h.push(e("doSwitchToCostume")),h.push(e("doWearNextCostume")),h.push(i("getCostumeIdx")),h.push(e("getCostumeIdx")),h.push("-"),h.push(e("changeEffect")),h.push(e("setEffect")),h.push(e("clearEffects")),this.world().isDevMode&&(h.push("-"),a=new TextMorph(localize("development mode \ndebugging primitives:")),a.fontSize=9,a.setColor(this.paletteTextColor),h.push(a),h.push("-"),h.push(e("log")),h.push(e("alert")))):"sound"===p?(h.push(e("playSound")),h.push(e("doPlaySoundUntilDone")),h.push(e("doStopAllSounds")),h.push("-"),h.push(e("doRest")),h.push("-"),h.push(e("doPlayNote")),h.push("-"),h.push(e("doChangeTempo")),h.push(e("doSetTempo")),h.push(i("getTempo")),h.push(e("getTempo"))):"pen"===p?h.push(e("clear")):"control"===p?(h.push(e("receiveGo")),h.push(e("receiveGoThenBroadcastFinished")),h.push(e("receiveKey")),h.push(e("receiveClick")),h.push(e("receiveMessage")),h.push(e("receiveFinished")),h.push("-"),h.push(e("doSendMissionSolved")),h.push(e("doBroadcast")),h.push(e("doBroadcastAndWait")),h.push(i("getLastMessage")),h.push(e("getLastMessage")),h.push("-"),h.push(e("doWarp")),h.push("-"),h.push(e("doWait")),h.push(e("doWaitUntil")),h.push("-"),h.push(e("doForever")),h.push(e("doRepeat")),h.push(e("doUntil")),h.push("-"),h.push(e("doIf")),h.push(e("doIfElse")),h.push("-"),h.push(e("doReport")),h.push("-"),h.push(e("doStopThis")),h.push(e("doStopOthers")),h.push("-"),h.push(e("doRun")),h.push(e("fork")),h.push(e("evaluate")),h.push("-"),h.push(e("doCallCC")),h.push(e("reportCallCC")),h.push("-"),h.push(e("createClone")),h.push("-"),h.push(e("doPauseAll"))):"sensing"===p?(h.push(e("doAsk")),h.push(i("getLastAnswer")),h.push(e("getLastAnswer")),h.push("-"),h.push(i("reportMouseX")),h.push(e("reportMouseX")),h.push(i("reportMouseY")),h.push(e("reportMouseY")),h.push(e("reportMouseDown")),h.push("-"),h.push(e("reportKeyPressed")),h.push("-"),h.push(e("doResetTimer")),h.push(i("getTimer")),h.push(e("getTimer")),h.push("-"),h.push(e("reportAttributeOf")),h.push("-"),h.push(e("reportURL")),h.push("-"),h.push(e("reportIsFastTracking")),h.push(e("doSetFastTracking")),h.push("-"),h.push(e("reportDate")),this.world().isDevMode&&(h.push("-"),a=new TextMorph(localize("development mode \ndebugging primitives:")),a.fontSize=9,a.setColor(this.paletteTextColor),h.push(a),h.push("-"),h.push(e("colorFiltered")),h.push(e("reportStackSize")),h.push(e("reportFrameCount")))):"operators"===p?(h.push(e("reifyScript")),h.push(e("reifyReporter")),h.push(e("reifyPredicate")),h.push("#"),h.push("-"),h.push(e("reportSum")),h.push(e("reportDifference")),h.push(e("reportProduct")),h.push(e("reportQuotient")),h.push("-"),h.push(e("reportModulus")),h.push(e("reportRound")),h.push(e("reportMonadic")),h.push(e("reportRandom")),h.push("-"),h.push(e("reportLessThan")),h.push(e("reportEquals")),h.push(e("reportGreaterThan")),h.push("-"),h.push(e("reportAnd")),h.push(e("reportOr")),h.push(e("reportNot")),h.push("-"),h.push(e("reportTrue")),h.push(e("reportFalse")),h.push("-"),h.push(e("reportJoinWords")),h.push(e("reportTextSplit")),h.push(e("reportLetter")),h.push(e("reportStringSize")),h.push("-"),h.push(e("reportUnicode")),h.push(e("reportUnicodeAsLetter")),h.push("-"),h.push(e("reportIsA")),h.push(e("reportIsIdentical")),this.world().isDevMode&&(h.push("-"),a=new TextMorph("development mode \ndebugging primitives:"),a.fontSize=9,a.setColor(this.paletteTextColor),h.push(a),h.push("-"),h.push(e("reportTypeOf")),h.push(e("reportTextFunction")))):"variables"===p&&(s=new PushButtonMorph(null,function(){new VariableDialogMorph(null,function(t){t&&!l.variables.silentFind(t[0])&&(l.addVariable(t[0],t[1]),l.toggleVariableWatcher(t[0],t[1]),l.blocksCache[p]=null,l.paletteCache[p]=null,l.parentThatIsA(IDE_Morph).refreshPalette())},l).prompt("Variable name",null,l.world())},"Make a variable"),h.push(s),this.variables.allNames().length>0&&(s=new PushButtonMorph(null,function(){var t=new MenuMorph(l.deleteVariable,null,l);l.variables.allNames().forEach(function(e){t.addItem(e,e)}),t.popUpAtHand(l.world())},"Delete a variable"),h.push(s)),h.push("-"),n=this.variables.allNames(),n.length>0&&(n.forEach(function(t){h.push(r(t)),h.push(o(t))}),h.push("-")),h.push(e("doSetVar")),h.push(e("doChangeVar")),h.push(e("doShowVar")),h.push(e("doHideVar")),h.push(e("doDeclareVariables")),h.push("="),h.push(e("reportNewList")),h.push("-"),h.push(e("reportCONS")),h.push(e("reportListItem")),h.push(e("reportCDR")),h.push("-"),h.push(e("reportListLength")),h.push(e("reportListContainsItem")),h.push("-"),h.push(e("doAddToList")),h.push(e("doDeleteFromList")),h.push(e("doInsertInList")),h.push(e("doReplaceInList")),this.world().isDevMode&&(h.push("-"),a=new TextMorph(localize("development mode \ndebugging primitives:")),a.fontSize=9,a.setColor(this.paletteTextColor),h.push(a),h.push("-"),h.push(e("reportMap"))),h.push("="),StageMorph.prototype.enableCodeMapping&&(h.push(e("doMapCodeOrHeader")),h.push(e("doMapStringCode")),h.push(e("doMapListCode")),h.push("-"),h.push(e("reportMappedCode")),h.push("=")),s=new PushButtonMorph(null,function(){var t=l.parentThatIsA(IDE_Morph);new BlockDialogMorph(null,function(e){""!==e.spec&&(e.isGlobal?l.globalBlocks.push(e):l.customBlocks.push(e),t.flushPaletteCache(),t.refreshPalette(),new BlockEditorMorph(e,l).popUp())},l).prompt("Make a block",null,l.world())},"Make a block"),h.push(s)),h},StageMorph.prototype.clear=function(){this.clearPenTrails()},StageMorph.prototype.userMenu=function(){var t=this.parentThatIsA(IDE_Morph),e=new MenuMorph(this),o=16===this.world().currentKey,i=this;return t&&t.isAppMode?(e.addItem("help","nop"),e):(e.addItem("edit","edit"),e.addItem("show all","showAll"),e.addItem("pic...",function(){window.open(i.fullImageClassic().toDataURL())},"open a new window\nwith a picture of the stage"),o&&(e.addLine(),e.addItem("turn pen trails into new costume...",function(){var e=new Costume(i.trailsCanvas,Date.now().toString()).copy();t.currentSprite.addCostume(e),t.currentSprite.wearCostume(e),t.hasChangedMedia=!0},"turn all pen trails and stamps\ninto a new costume for the\ncurrently selected sprite",new Color(100,0,0))),e)},StageMorph.prototype.showAll=function(){var t=this;this.children.forEach(function(e){e.show(),e.keepWithin(t),e.fixLayout&&e.fixLayout()})},StageMorph.prototype.edit=SpriteMorph.prototype.edit,StageMorph.prototype.thumbnail=function(t,e){var o,i,r=this,n=this.image,s=Math.min(t.x/n.width,t.y/n.height),a=newCanvas(t),h=a.getContext("2d");return h.scale(s,s),h.drawImage(n,0,0),h.drawImage(this.penTrails(),0,0,this.dimensions.x*this.scale,this.dimensions.y*this.scale),this.children.forEach(function(t){t!==e&&(o=t.fullBounds(),i=t.fullImage(),i.width&&i.height&&h.drawImage(t.fullImage(),o.origin.x-r.bounds.origin.x,o.origin.y-r.bounds.origin.y))}),a},StageMorph.prototype.createClone=nop,StageMorph.prototype.categories=SpriteMorph.prototype.categories,StageMorph.prototype.blockColor=SpriteMorph.prototype.blockColor,StageMorph.prototype.paletteColor=SpriteMorph.prototype.paletteColor,StageMorph.prototype.setName=SpriteMorph.prototype.setName,StageMorph.prototype.palette=SpriteMorph.prototype.palette,StageMorph.prototype.freshPalette=SpriteMorph.prototype.freshPalette,StageMorph.prototype.showingWatcher=SpriteMorph.prototype.showingWatcher,StageMorph.prototype.addVariable=SpriteMorph.prototype.addVariable,StageMorph.prototype.deleteVariable=SpriteMorph.prototype.deleteVariable,StageMorph.prototype.blockForSelector=SpriteMorph.prototype.blockForSelector,StageMorph.prototype.findVariableWatcher=SpriteMorph.prototype.findVariableWatcher,StageMorph.prototype.toggleVariableWatcher=SpriteMorph.prototype.toggleVariableWatcher,StageMorph.prototype.showingVariableWatcher=SpriteMorph.prototype.showingVariableWatcher,StageMorph.prototype.deleteVariableWatcher=SpriteMorph.prototype.deleteVariableWatcher,StageMorph.prototype.addCostume=SpriteMorph.prototype.addCostume,StageMorph.prototype.wearCostume=SpriteMorph.prototype.wearCostume,StageMorph.prototype.getCostumeIdx=SpriteMorph.prototype.getCostumeIdx,StageMorph.prototype.doWearNextCostume=SpriteMorph.prototype.doWearNextCostume,StageMorph.prototype.doWearPreviousCostume=SpriteMorph.prototype.doWearPreviousCostume,StageMorph.prototype.doSwitchToCostume=SpriteMorph.prototype.doSwitchToCostume,StageMorph.prototype.setEffect=SpriteMorph.prototype.setEffect,StageMorph.prototype.getGhostEffect=SpriteMorph.prototype.getGhostEffect,StageMorph.prototype.changeEffect=SpriteMorph.prototype.changeEffect,StageMorph.prototype.clearEffects=SpriteMorph.prototype.clearEffects,StageMorph.prototype.addSound=SpriteMorph.prototype.addSound,StageMorph.prototype.playSound=SpriteMorph.prototype.playSound,StageMorph.prototype.stopAllActiveSounds=function(){this.activeSounds.forEach(function(t){t.pause()}),this.activeSounds=[]},StageMorph.prototype.pauseAllActiveSounds=function(){this.activeSounds.forEach(function(t){t.pause()})},StageMorph.prototype.resumeAllActiveSounds=function(){this.activeSounds.forEach(function(t){t.play()})},StageMorph.prototype.toggleWatcher=SpriteMorph.prototype.toggleWatcher,StageMorph.prototype.showingWatcher=SpriteMorph.prototype.showingWatcher,StageMorph.prototype.watcherFor=SpriteMorph.prototype.watcherFor,StageMorph.prototype.getLastAnswer=SpriteMorph.prototype.getLastAnswer,StageMorph.prototype.allMessageNames=SpriteMorph.prototype.allMessageNames,StageMorph.prototype.allHatBlocksFor=SpriteMorph.prototype.allHatBlocksFor,StageMorph.prototype.allHatBlocksForKey=SpriteMorph.prototype.allHatBlocksForKey,StageMorph.prototype.mouseClickLeft=SpriteMorph.prototype.mouseClickLeft,StageMorph.prototype.deleteAllBlockInstances=SpriteMorph.prototype.deleteAllBlockInstances,StageMorph.prototype.allBlockInstances=SpriteMorph.prototype.allBlockInstances,StageMorph.prototype.allLocalBlockInstances=SpriteMorph.prototype.allLocalBlockInstances,StageMorph.prototype.allEditorBlockInstances=SpriteMorph.prototype.allEditorBlockInstances,StageMorph.prototype.paletteBlockInstance=SpriteMorph.prototype.paletteBlockInstance,StageMorph.prototype.usesBlockInstance=SpriteMorph.prototype.usesBlockInstance,StageMorph.prototype.doubleDefinitionsFor=SpriteMorph.prototype.doubleDefinitionsFor,StageMorph.prototype.replaceDoubleDefinitionsFor=SpriteMorph.prototype.replaceDoubleDefinitionsFor,SpriteBubbleMorph.prototype=new SpeechBubbleMorph,SpriteBubbleMorph.prototype.constructor=SpriteBubbleMorph,SpriteBubbleMorph.uber=SpeechBubbleMorph.prototype,SpriteBubbleMorph.prototype.init=function(t,e,o,i){var r=SpriteMorph.prototype;this.scale=e||1,this.data=t,this.isQuestion=i,SpriteBubbleMorph.uber.init.call(this,this.dataAsMorph(t),r.bubbleColor,null,null,i?r.blockColor.sensing:r.bubbleBorderColor,null,o)},SpriteBubbleMorph.prototype.dataAsMorph=function(t){var e,o,i,r,n,s=SpriteMorph.prototype;return t instanceof Morph?e=t:isString(t)?(o=!0,e=new TextMorph(t,s.bubbleFontSize*this.scale,null,s.bubbleFontIsBold,!1,"center")):"boolean"==typeof t?(i=s.booleanMorph(t).fullImage(),e=new Morph,e.silentSetWidth(i.width),e.silentSetHeight(i.height),e.image=i):t instanceof HTMLCanvasElement?(e=new Morph,e.silentSetWidth(t.width),e.silentSetHeight(t.height),e.image=t):t instanceof List?(e=new ListWatcherMorph(t),e.isDraggable=!1,e.update(!0),e.step=e.update):t instanceof Context?(i=t.image(),e=new Morph,e.silentSetWidth(i.width),e.silentSetHeight(i.height),e.image=i):e=new TextMorph(t.toString(),s.bubbleFontSize*this.scale,null,s.bubbleFontIsBold,!1,"center"),e instanceof TextMorph?(n=Math.max(e.width(),2*s.bubbleCorner*this.scale),o&&(n=Math.min(n,s.bubbleMaxTextWidth*this.scale)),e.setWidth(n)):t instanceof List||(r=newCanvas(e.extent().multiplyBy(this.scale)),r.getContext("2d").drawImage(e.image,0,0,r.width,r.height),e.image=r,e.bounds=e.bounds.scaleBy(this.scale)),e},SpriteBubbleMorph.prototype.setScale=function(t){this.scale=t,this.changed(),this.drawNew(),this.changed()},SpriteBubbleMorph.prototype.drawNew=function(){var t=SpriteMorph.prototype;this.edge=t.bubbleCorner*this.scale,this.border=t.bubbleBorder*this.scale,this.padding=t.bubbleCorner/2*this.scale,this.contentsMorph&&this.contentsMorph.destroy(),this.contentsMorph=this.dataAsMorph(this.data),this.add(this.contentsMorph),this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2),SpeechBubbleMorph.uber.drawNew.call(this),this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))},SpriteBubbleMorph.prototype.fixLayout=function(){var t=SpriteMorph.prototype;this.changed(),this.edge=t.bubbleCorner*this.scale,this.border=t.bubbleBorder*this.scale,this.padding=t.bubbleCorner/2*this.scale,this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2),SpeechBubbleMorph.uber.drawNew.call(this),this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1))),this.changed()},Costume.prototype.maxExtent=StageMorph.prototype.dimensions,Costume.prototype.toString=function(){return"a Costume("+this.name+")"},Costume.prototype.extent=function(){return new Point(this.contents.width,this.contents.height)},Costume.prototype.center=function(){return this.extent().divideBy(2)},Costume.prototype.width=function(){return this.contents.width},Costume.prototype.height=function(){return this.contents.height},Costume.prototype.bounds=function(){return new Rectangle(0,0,this.width(),this.height())},Costume.prototype.shrinkWrap=function(){var t=this.boundingBox(),e=t.extent(),o=newCanvas(e),i=o.getContext("2d");i.drawImage(this.contents,t.origin.x,t.origin.y,e.x,e.y,0,0,e.x,e.y),this.rotationCenter=this.rotationCenter.subtract(t.origin),this.contents=o,this.version=Date.now()},Costume.prototype.boundingBox=function(){function t(t,e){return c.data[e*h*4+4*t+3]}function e(){for(s=0;h>=s;s+=1)for(n=0;l>=n;n+=1)if(t(s,n))return s;return 0}function o(){for(n=0;l>=n;n+=1)for(s=0;l>=s;s+=1)if(t(s,n))return n;return 0}function i(){for(s=h;s>=0;s-=1)for(n=l;n>=0;n-=1)if(t(s,n))return Math.min(s+1,h);return h}function r(){for(n=l;n>=0;n-=1)for(s=h;s>=0;s-=1)if(t(s,n))return Math.min(n+1,l);return l}var n,s,a=this.contents,h=a.width,l=a.height,p=a.getContext("2d"),c=p.getImageData(0,0,h,l);return new Rectangle(e(),o(),i(),r())},Costume.prototype.copy=function(){var t,e,o=newCanvas(this.extent());return e=o.getContext("2d"),e.drawImage(this.contents,0,0),t=new Costume(o,this.name?copy(this.name):null),t.rotationCenter=this.rotationCenter.copy(),t},Costume.prototype.flipped=function(){var t,e=newCanvas(this.extent()),o=e.getContext("2d");return o.translate(this.width(),0),o.scale(-1,1),o.drawImage(this.contents,0,0),t=new Costume(e,new Point(this.width()-this.rotationCenter.x,this.rotationCenter.y))},Costume.prototype.edit=function(t,e,o,i,r){var n=this,s=new PaintEditorMorph;s.oncancel=i||nop,s.openIn(t,o?newCanvas(StageMorph.prototype.dimensions):this.contents,o?new Point(240,180):this.rotationCenter,function(o,i){n.contents=o,n.rotationCenter=i,e.currentSprite instanceof SpriteMorph&&n.shrinkWrap(),n.version=Date.now(),t.changed(),e&&(e.currentSprite.wearCostume(n),e.hasChangedMedia=!0),(r||nop)()})},Costume.prototype.editRotationPointOnly=function(t){var e,o,i,r=new CostumeEditorMorph(this);e=function(){r.accept()},o=new DialogBoxMorph(this,e),i=new TextMorph(localize("click or drag crosshairs to move the rotation center"),o.fontSize,o.fontStyle,!0,!1,"center",null,null,new Point(1,1),new Color(255,255,255)),o.labelString="Costume Editor",o.createLabel(),o.setPicture(r),o.addBody(i),o.addButton("ok","Ok"),o.addButton("cancel","Cancel"),o.fixLayout(),o.drawNew(),o.fixLayout(),o.popUp(t)},Costume.prototype.shrinkToFit=function(t){(t.x<this.width()||t.y<this.height())&&(this.contents=this.thumbnail(t))},Costume.prototype.thumbnail=function(t){var e=this.contents,o=Math.min(t.x/e.width,t.y/e.height),i=(t.x-e.width*o)/2,r=(t.y-e.height*o)/2,n=newCanvas(t),s=n.getContext("2d");return e&&e.width+e.height!==0?(s.scale(o,o),s.drawImage(e,Math.floor(i/o),Math.floor(r/o)),n):n},Costume.prototype.isTainted=function(){try{this.contents.getContext("2d").getImageData(0,0,this.contents.width,this.contents.height)}catch(t){return!0}return!1},SVG_Costume.prototype=new Costume,SVG_Costume.prototype.constructor=SVG_Costume,SVG_Costume.uber=Costume.prototype,SVG_Costume.prototype.toString=function(){return"an SVG_Costume("+this.name+")"},SVG_Costume.prototype.copy=function(){var t,e=new Image;return e.src=this.contents.src,t=new SVG_Costume(e,this.name?copy(this.name):null),t.rotationCenter=this.rotationCenter.copy(),t},SVG_Costume.prototype.shrinkToFit=function(t){nop(t)},CostumeEditorMorph.prototype=new Morph,CostumeEditorMorph.prototype.constructor=CostumeEditorMorph,CostumeEditorMorph.uber=Morph.prototype,CostumeEditorMorph.prototype.size=Costume.prototype.maxExtent,CostumeEditorMorph.prototype.init=function(t){this.costume=t||new Costume,this.rotationCenter=this.costume.rotationCenter.copy(),this.margin=new Point(0,0),CostumeEditorMorph.uber.init.call(this),this.noticesTransparentClick=!0},CostumeEditorMorph.prototype.accept=function(){this.costume.rotationCenter=this.rotationCenter.copy(),this.costume.version=Date.now()},CostumeEditorMorph.prototype.drawNew=function(){var t,e;this.margin=this.size.subtract(this.costume.extent()).divideBy(2),t=this.rotationCenter.add(this.margin),this.silentSetExtent(this.size),this.image=newCanvas(this.extent()),this.cachedTexture||(this.cachedTexture=this.createTexture()),this.drawCachedTexture(),e=this.image.getContext("2d"),e.drawImage(this.costume.contents,this.margin.x,this.margin.y),e.globalAlpha=.5,e.fillStyle="white",e.beginPath(),e.arc(t.x,t.y,20,radians(0),radians(360),!1),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.arc(t.x,t.y,10,radians(0),radians(360),!1),e.stroke(),e.beginPath(),e.moveTo(0,t.y),e.lineTo(this.costume.width()+2*this.margin.x,t.y),e.stroke(),e.beginPath(),e.moveTo(t.x,0),e.lineTo(t.x,this.costume.height()+2*this.margin.y),e.stroke()},CostumeEditorMorph.prototype.createTexture=function(){var t=5,e=newCanvas(new Point(2*t,2*t)),o=e.getContext("2d"),i=new Color(230,230,230);return o.fillStyle="white",o.fillRect(0,0,2*t,2*t),o.fillStyle=i.toString(),o.fillRect(0,0,t,t),o.fillRect(t,t,t,t),e},CostumeEditorMorph.prototype.mouseDownLeft=function(t){this.rotationCenter=t.subtract(this.position().add(this.margin)),this.drawNew(),this.changed()},CostumeEditorMorph.prototype.mouseMove=CostumeEditorMorph.prototype.mouseDownLeft,Sound.prototype.play=function(){var t=document.createElement("audio");return t.src=this.audio.src,t.play(),t},Sound.prototype.copy=function(){var t,e=document.createElement("audio");return e.src=this.audio.src,t=new Sound(e,this.name?copy(this.name):null)},Sound.prototype.toDataURL=function(){return this.audio.src},Note.prototype.audioContext=null,Note.prototype.gainNode=null,Note.prototype.setupContext=function(){if(!this.audioContext){var t=function(){var t=window.AudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext||window.webkitAudioContext;
return t.prototype.hasOwnProperty("createGain")||(t.prototype.createGain=t.prototype.createGainNode),t}();if(!t)throw new Error("Web Audio API is not supported\nin this browser");Note.prototype.audioContext=new t,Note.prototype.gainNode=Note.prototype.audioContext.createGain(),Note.prototype.gainNode.gain.value=.25}},Note.prototype.play=function(){this.oscillator=this.audioContext.createOscillator(),this.oscillator.start||(this.oscillator.start=this.oscillator.noteOn),this.oscillator.stop||(this.oscillator.stop=this.oscillator.noteOff),this.oscillator.type=0,this.oscillator.frequency.value=440*Math.pow(2,(this.pitch-69)/12),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),this.oscillator.start(0)},Note.prototype.stop=function(){this.oscillator&&(this.oscillator.stop(0),this.oscillator=null)},CellMorph.prototype=new BoxMorph,CellMorph.prototype.constructor=CellMorph,CellMorph.uber=BoxMorph.prototype,CellMorph.prototype.init=function(t,e,o,i){this.contents=0===t?0:t===!1?!1:t||"",this.isEditable=isNil(o)?!1:!0,this.idx=o||null,this.parentCell=i||null,CellMorph.uber.init.call(this,SyntaxElementMorph.prototype.corner,1.000001,new Color(255,255,255)),this.color=e||new Color(255,140,0),this.isBig=!1,this.drawNew()},CellMorph.prototype.big=function(){this.isBig=!0,this.changed(),this.drawNew(),this.changed()},CellMorph.prototype.normal=function(){this.isBig=!1,this.changed(),this.drawNew(),this.changed()},CellMorph.prototype.isCircular=function(t){return this.parentCell?t instanceof List?this.contents===t||this.parentCell.isCircular(t):this.parentCell.isCircular(this.contents):!1},CellMorph.prototype.fixLayout=function(){var t;this.changed(),this.drawNew(),this.changed(),this.parent&&this.parent.fixLayout?this.parent.fixLayout():(t=this.parentThatIsA(ListWatcherMorph),t&&t.fixLayout())},CellMorph.prototype.drawNew=function(){var t,e,o,i=SyntaxElementMorph.prototype.fontSize,r=this.contentsMorph instanceof ListWatcherMorph&&this.contentsMorph.list===this.contents;return this.isBig&&(i=1.5*i),this.contentsMorph&&!r&&this.contentsMorph.destroy(),r||(this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?(e=this.contents.length>500?this.contents.slice(0,500)+"...":this.contents,this.contentsMorph=new TextMorph(e,i,null,!0,!1,"left"),this.isEditable&&(this.contentsMorph.isEditable=!0,this.contentsMorph.enableSelecting()),this.contentsMorph.setColor(new Color(255,255,255))):"boolean"==typeof this.contents?this.contentsMorph=SpriteMorph.prototype.booleanMorph.call(null,this.contents):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):this.contents instanceof Context?(o=this.contents.image(),this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(o.width),this.contentsMorph.silentSetHeight(o.height),this.contentsMorph.image=o):this.contents instanceof List?this.isCircular()?(this.contentsMorph=new TextMorph("(...)",i,null,!1,!0,"center"),this.contentsMorph.setColor(new Color(255,255,255))):(this.contentsMorph=new ListWatcherMorph(this.contents,this),this.contentsMorph.isDraggable=!1):(this.contentsMorph=new TextMorph(isNil(this.contents)?"":this.contents.toString(),i,null,!0,!1,"center"),this.isEditable&&(this.contentsMorph.isEditable=!0,this.contentsMorph.enableSelecting()),this.contentsMorph.setColor(new Color(255,255,255))),this.add(this.contentsMorph)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border),this.silentSetWidth(Math.max(this.contentsMorph.width()+2*this.edge,this.contents instanceof Context||this.contents instanceof List?0:3.5*SyntaxElementMorph.prototype.fontSize)),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),0===this.edge&&0===this.border?(BoxMorph.uber.drawNew.call(this),null):(t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),this.border>0&&!MorphicPreferences.isFlat&&(t.lineWidth=this.border,t.strokeStyle=this.borderColor.toString(),t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke(),t.shadowOffsetX=this.border,t.shadowOffsetY=this.border,t.shadowBlur=this.border,t.shadowColor=this.color.darker(80).toString(),this.drawShadow(t,this.edge,this.border/2)),void(r||this.contentsMorph.setCenter(this.center())))},CellMorph.prototype.drawShadow=function(t,e,o){var i=e+o,r=this.width(),n=this.height();t.beginPath(),t.moveTo(0,n-i),t.lineTo(0,i),t.stroke(),t.beginPath(),t.arc(i,i,e,radians(-180),radians(-90),!1),t.stroke(),t.beginPath(),t.moveTo(i,0),t.lineTo(r-i,0),t.stroke()},CellMorph.prototype.layoutChanged=function(){var t,e=SyntaxElementMorph.prototype.fontSize,o=this.parentThatIsA(ListWatcherMorph);return this.isBig&&(e=1.5*e),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border),this.silentSetWidth(Math.max(this.contentsMorph.width()+2*this.edge,this.contents instanceof Context||this.contents instanceof List?0:2*this.height())),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),0===this.edge&&0===this.border?(BoxMorph.uber.drawNew.call(this),null):(t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),this.border>0&&!MorphicPreferences.isFlat&&(t.lineWidth=this.border,t.strokeStyle=this.borderColor.toString(),t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke(),t.shadowOffsetX=this.border,t.shadowOffsetY=this.border,t.shadowBlur=this.border,t.shadowColor=this.color.darker(80).toString(),this.drawShadow(t,this.edge,this.border/2)),this.contentsMorph.setCenter(this.center()),void(o&&o.fixLayout()))},CellMorph.prototype.reactToEdit=function(t){var e;isNil(this.idx)||(e=this.parentThatIsA(ListWatcherMorph),e&&e.list.put(t.text,this.idx))},CellMorph.prototype.mouseClickLeft=function(t){this.isEditable&&this.contentsMorph instanceof TextMorph?this.contentsMorph.selectAllAndEdit():this.escalateEvent("mouseClickLeft",t)},WatcherMorph.prototype=new BoxMorph,WatcherMorph.prototype.constructor=WatcherMorph,WatcherMorph.uber=BoxMorph.prototype,WatcherMorph.prototype.init=function(t,e,o,i,r){this.labelText=t||"",this.version=null,this.objName="",WatcherMorph.uber.init.call(this,SyntaxElementMorph.prototype.rounding,1.000001,new Color(120,120,120)),this.color=new Color(220,220,220),this.readoutColor=e,this.style="normal",this.target=o||null,this.getter=i||null,this.currentValue=null,this.labelMorph=null,this.sliderMorph=null,this.cellMorph=null,this.isDraggable=!0,this.fixLayout(),this.update(),r&&this.hide()},WatcherMorph.prototype.isTemporary=function(){var t=this.parentThatIsA(StageMorph);return this.target instanceof VariableFrame?t&&this.target===t.variables.parentFrame?!1:null===this.target.owner:!1},WatcherMorph.prototype.object=function(){return this.target instanceof VariableFrame?this.target.owner:this.target},WatcherMorph.prototype.isGlobal=function(t){return contains(["getLastAnswer","getLastMessage","getTempo","getTimer","reportMouseX","reportMouseY"],t)},WatcherMorph.prototype.setSliderMin=function(t){this.target instanceof VariableFrame&&(this.sliderMorph.setSize(1),this.sliderMorph.setStart(t),this.sliderMorph.setSize(this.sliderMorph.rangeSize()/5))},WatcherMorph.prototype.setSliderMax=function(t){this.target instanceof VariableFrame&&(this.sliderMorph.setSize(1),this.sliderMorph.setStop(t),this.sliderMorph.setSize(this.sliderMorph.rangeSize()/5))},WatcherMorph.prototype.update=function(){var t,e;this.target&&this.getter&&(this.updateLabel(),t=this.target instanceof VariableFrame?this.target.vars[this.getter]:this.target[this.getter](),e=+t,"boolean"==typeof t||isNaN(e)||(t=Math.round(1e9*t)/1e9),t!==this.currentValue&&(this.changed(),this.cellMorph.contents=t,this.cellMorph.drawNew(),isNaN(t)||(this.sliderMorph.value=t,this.sliderMorph.drawNew()),this.fixLayout(),this.currentValue=t)),this.cellMorph.contentsMorph instanceof ListWatcherMorph&&this.cellMorph.contentsMorph.update()},WatcherMorph.prototype.updateLabel=function(){var t=this.object();t&&!this.isGlobal(this.getter)&&t.version!==this.version&&(this.objName=t.name?t.name+" ":" ",this.labelMorph&&(this.labelMorph.destroy(),this.labelMorph=null,this.fixLayout()))},WatcherMorph.prototype.fixLayout=function(){var t,e=SyntaxElementMorph.prototype.fontSize,o=this;return this.changed(),null===this.labelMorph&&(this.labelMorph=new StringMorph(this.objName+this.labelText,e,null,!0,!1,!1,MorphicPreferences.isFlat?new Point:new Point(1,1),new Color(255,255,255)),this.add(this.labelMorph)),null===this.cellMorph&&(this.cellMorph=new CellMorph("",this.readoutColor),this.add(this.cellMorph)),null===this.sliderMorph&&(this.sliderMorph=new SliderMorph(0,100,0,20,"horizontal"),this.sliderMorph.alpha=1,this.sliderMorph.button.color=this.color.darker(),this.sliderMorph.color=this.color.lighter(60),this.sliderMorph.button.highlightColor=this.color.darker(),this.sliderMorph.button.highlightColor.b+=50,this.sliderMorph.button.pressColor=this.color.darker(),this.sliderMorph.button.pressColor.b+=100,this.sliderMorph.setHeight(e),this.sliderMorph.action=function(t){o.target.vars[o.getter]=Math.round(t)},this.add(this.sliderMorph)),t=this.cellMorph.contents instanceof List,t&&(this.style="normal"),"large"===this.style?(this.labelMorph.hide(),this.sliderMorph.hide(),this.cellMorph.big(),this.cellMorph.setPosition(this.position()),void this.setExtent(this.cellMorph.extent().subtract(1))):(this.labelMorph.show(),this.sliderMorph.show(),this.cellMorph.normal(),this.labelMorph.setPosition(this.position().add(new Point(this.edge,this.border+SyntaxElementMorph.prototype.typeInPadding))),t?this.cellMorph.setPosition(this.labelMorph.bottomLeft().add(new Point(0,SyntaxElementMorph.prototype.typeInPadding))):(this.cellMorph.setPosition(this.labelMorph.topRight().add(new Point(e/3,0))),this.labelMorph.setTop(this.cellMorph.top()+(this.cellMorph.height()-this.labelMorph.height())/2)),"slider"===this.style?(this.sliderMorph.silentSetPosition(new Point(this.labelMorph.left(),this.cellMorph.bottom()+SyntaxElementMorph.prototype.typeInPadding)),this.sliderMorph.setWidth(this.cellMorph.right()-this.labelMorph.left()),this.silentSetHeight(this.cellMorph.height()+this.sliderMorph.height()+2*this.border+3*SyntaxElementMorph.prototype.typeInPadding)):(this.sliderMorph.hide(),this.bounds.corner.y=this.cellMorph.bottom()+this.border+SyntaxElementMorph.prototype.typeInPadding),this.bounds.corner.x=Math.max(this.cellMorph.right(),this.labelMorph.right())+this.edge+SyntaxElementMorph.prototype.typeInPadding,this.drawNew(),void this.changed())},WatcherMorph.prototype.userMenu=function(){var t=this,e=new MenuMorph(this),o="\u25cf",i="\u25cb";return e.addItem(("normal"===this.style?o:i)+" "+localize("normal"),"styleNormal"),e.addItem(("large"===this.style?o:i)+" "+localize("large"),"styleLarge"),this.target instanceof VariableFrame&&(e.addItem(("slider"===this.style?o:i)+" "+localize("slider"),"styleSlider"),e.addLine(),e.addItem("slider min...","userSetSliderMin"),e.addItem("slider max...","userSetSliderMax"),e.addLine(),e.addItem("import...",function(){var e=document.createElement("input"),o=t.parentThatIsA(IDE_Morph);o.filePicker&&(document.body.removeChild(o.filePicker),o.filePicker=null),e.type="file",e.style.color="transparent",e.style.backgroundColor="transparent",e.style.border="none",e.style.outline="none",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="0px",e.style.height="0px",e.addEventListener("change",function(){function i(e){var o=new FileReader;o.onloadend=function(e){t.target.setVar(t.getter,e.target.result)},o.readAsText(e)}var r,n;if(document.body.removeChild(e),o.filePicker=null,e.files.length>0)for(n=0;n<e.files.length;n+=1)r=e.files[n],0===r.type.indexOf("text")&&i(r)},!1),document.body.appendChild(e),o.filePicker=e,e.click()}),!this.currentValue||!isString(this.currentValue)&&isNaN(+this.currentValue)||e.addItem("export...",function(){window.open("data:text/plain,"+encodeURIComponent(this.currentValue.toString()))})),e},WatcherMorph.prototype.setStyle=function(t){this.style=t,this.fixLayout()},WatcherMorph.prototype.styleNormal=function(){this.setStyle("normal")},WatcherMorph.prototype.styleLarge=function(){this.setStyle("large")},WatcherMorph.prototype.styleSlider=function(){this.setStyle("slider")},WatcherMorph.prototype.userSetSliderMin=function(){new DialogBoxMorph(this,this.setSliderMin,this).prompt("Slider minimum value",this.sliderMorph.start.toString(),this.world(),null,null,null,!0)},WatcherMorph.prototype.userSetSliderMax=function(){new DialogBoxMorph(this,this.setSliderMax,this).prompt("Slider maximum value",this.sliderMorph.stop.toString(),this.world(),null,null,null,!0)},WatcherMorph.prototype.drawNew=function(){var t,e;return this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),MorphicPreferences.isFlat||0===this.edge&&0===this.border?void BoxMorph.uber.drawNew.call(this):(e=t.createLinearGradient(0,0,0,this.height()),e.addColorStop(0,this.color.lighter().toString()),e.addColorStop(1,this.color.darker().toString()),t.fillStyle=e,t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),void(this.border>0&&(e=t.createLinearGradient(0,0,0,this.height()),e.addColorStop(0,this.borderColor.lighter().toString()),e.addColorStop(1,this.borderColor.darker().toString()),t.lineWidth=this.border,t.strokeStyle=e,t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke())))},StagePrompterMorph.prototype=new BoxMorph,StagePrompterMorph.prototype.constructor=StagePrompterMorph,StagePrompterMorph.uber=BoxMorph.prototype,StagePrompterMorph.prototype.init=function(t){var e=this;this.isDone=!1,this.label=t?new StringMorph(t,SpriteMorph.prototype.bubbleFontSize,null,SpriteMorph.prototype.bubbleFontIsBold,!1,"left"):null,this.inputField=new InputFieldMorph,this.button=new PushButtonMorph(null,function(){e.accept()},"\u2713"),StagePrompterMorph.uber.init.call(this,SyntaxElementMorph.prototype.rounding,SpriteMorph.prototype.bubbleBorder,SpriteMorph.prototype.blockColor.sensing),this.color=new Color(255,255,255),this.label&&this.add(this.label),this.add(this.inputField),this.add(this.button),this.setWidth(StageMorph.prototype.dimensions.x-20),this.fixLayout()},StagePrompterMorph.prototype.fixLayout=function(){var t=0;this.label&&(this.label.setPosition(new Point(this.left()+this.edge,this.top()+this.edge)),t=this.label.bottom()-this.top()),this.inputField.setPosition(new Point(this.left()+this.edge,this.top()+t+this.edge)),this.inputField.setWidth(this.width()-2*this.edge-this.button.width()-this.border),this.button.setCenter(this.inputField.center()),this.button.setLeft(this.inputField.right()+this.border),this.setHeight(this.inputField.bottom()-this.top()+this.edge)},StagePrompterMorph.prototype.mouseClickLeft=function(){this.inputField.edit()},StagePrompterMorph.prototype.accept=function(){this.isDone=!0},function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function o(t){var e=t.length,o=ne.type(t);return"function"===o||ne.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===o||0===e||"number"==typeof e&&e>0&&e-1 in t}function i(t,e,o){if(ne.isFunction(e))return ne.grep(t,function(t,i){return!!e.call(t,i,t)!==o});if(e.nodeType)return ne.grep(t,function(t){return t===e!==o});if("string"==typeof e){if(ue.test(e))return ne.filter(e,t,o);e=ne.filter(e,t)}return ne.grep(t,function(t){return ne.inArray(t,e)>=0!==o})}function r(t,e){do t=t[e];while(t&&1!==t.nodeType);return t}function n(t){var e=Se[t]={};return ne.each(t.match(we)||[],function(t,o){e[o]=!0}),e}function s(){ge.addEventListener?(ge.removeEventListener("DOMContentLoaded",a,!1),t.removeEventListener("load",a,!1)):(ge.detachEvent("onreadystatechange",a),t.detachEvent("onload",a))}function a(){(ge.addEventListener||"load"===event.type||"complete"===ge.readyState)&&(s(),ne.ready())}function h(t,e,o){if(void 0===o&&1===t.nodeType){var i="data-"+e.replace(Be,"-$1").toLowerCase();if(o=t.getAttribute(i),"string"==typeof o){try{o="true"===o?!0:"false"===o?!1:"null"===o?null:+o+""===o?+o:ke.test(o)?ne.parseJSON(o):o}catch(r){}ne.data(t,e,o)}else o=void 0}return o}function l(t){var e;for(e in t)if(("data"!==e||!ne.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function p(t,e,o,i){if(ne.acceptData(t)){var r,n,s=ne.expando,a=t.nodeType,h=a?ne.cache:t,l=a?t[s]:t[s]&&s;if(l&&h[l]&&(i||h[l].data)||void 0!==o||"string"!=typeof e)return l||(l=a?t[s]=$.pop()||ne.guid++:s),h[l]||(h[l]=a?{}:{toJSON:ne.noop}),("object"==typeof e||"function"==typeof e)&&(i?h[l]=ne.extend(h[l],e):h[l].data=ne.extend(h[l].data,e)),n=h[l],i||(n.data||(n.data={}),n=n.data),void 0!==o&&(n[ne.camelCase(e)]=o),"string"==typeof e?(r=n[e],null==r&&(r=n[ne.camelCase(e)])):r=n,r}}function c(t,e,o){if(ne.acceptData(t)){var i,r,n=t.nodeType,s=n?ne.cache:t,a=n?t[ne.expando]:ne.expando;if(s[a]){if(e&&(i=o?s[a]:s[a].data)){ne.isArray(e)?e=e.concat(ne.map(e,ne.camelCase)):e in i?e=[e]:(e=ne.camelCase(e),e=e in i?[e]:e.split(" ")),r=e.length;for(;r--;)delete i[e[r]];if(o?!l(i):!ne.isEmptyObject(i))return}(o||(delete s[a].data,l(s[a])))&&(n?ne.cleanData([t],!0):ie.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function d(){return!0}function u(){return!1}function f(){try{return ge.activeElement}catch(t){}}function g(t){var e=Oe.split("|"),o=t.createDocumentFragment();if(o.createElement)for(;e.length;)o.createElement(e.pop());return o}function m(t,e){var o,i,r=0,n=typeof t.getElementsByTagName!==xe?t.getElementsByTagName(e||"*"):typeof t.querySelectorAll!==xe?t.querySelectorAll(e||"*"):void 0;if(!n)for(n=[],o=t.childNodes||t;null!=(i=o[r]);r++)!e||ne.nodeName(i,e)?n.push(i):ne.merge(n,m(i,e));return void 0===e||e&&ne.nodeName(t,e)?ne.merge([t],n):n}function y(t){Le.test(t.type)&&(t.defaultChecked=t.checked)}function M(t,e){return ne.nodeName(t,"table")&&ne.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function b(t){return t.type=(null!==ne.find.attr(t,"type"))+"/"+t.type,t}function w(t){var e=$e.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function S(t,e){for(var o,i=0;null!=(o=t[i]);i++)ne._data(o,"globalEval",!e||ne._data(e[i],"globalEval"))}function C(t,e){if(1===e.nodeType&&ne.hasData(t)){var o,i,r,n=ne._data(t),s=ne._data(e,n),a=n.events;if(a){delete s.handle,s.events={};for(o in a)for(i=0,r=a[o].length;r>i;i++)ne.event.add(e,o,a[o][i])}s.data&&(s.data=ne.extend({},s.data))}}function v(t,e){var o,i,r;if(1===e.nodeType){if(o=e.nodeName.toLowerCase(),!ie.noCloneEvent&&e[ne.expando]){r=ne._data(e);for(i in r.events)ne.removeEvent(e,i,r.handle);e.removeAttribute(ne.expando)}"script"===o&&e.text!==t.text?(b(e).text=t.text,w(e)):"object"===o?(e.parentNode&&(e.outerHTML=t.outerHTML),ie.html5Clone&&t.innerHTML&&!ne.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===o&&Le.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===o?e.defaultSelected=e.selected=t.defaultSelected:("input"===o||"textarea"===o)&&(e.defaultValue=t.defaultValue)}}function x(e,o){var i=ne(o.createElement(e)).appendTo(o.body),r=t.getDefaultComputedStyle?t.getDefaultComputedStyle(i[0]).display:ne.css(i[0],"display");return i.detach(),r}function k(t){var e=ge,o=to[t];return o||(o=x(t,e),"none"!==o&&o||(Ze=(Ze||ne("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=(Ze[0].contentWindow||Ze[0].contentDocument).document,e.write(),e.close(),o=x(t,e),Ze.detach()),to[t]=o),o}function B(t,e){return{get:function(){var o=t();if(null!=o)return o?void delete this.get:(this.get=e).apply(this,arguments)}}}function P(t,e){if(e in t)return e;for(var o=e.charAt(0).toUpperCase()+e.slice(1),i=e,r=fo.length;r--;)if(e=fo[r]+o,e in t)return e;return i}function T(t,e){for(var o,i,r,n=[],s=0,a=t.length;a>s;s++)i=t[s],i.style&&(n[s]=ne._data(i,"olddisplay"),o=i.style.display,e?(n[s]||"none"!==o||(i.style.display=""),""===i.style.display&&Ie(i)&&(n[s]=ne._data(i,"olddisplay",k(i.nodeName)))):n[s]||(r=Ie(i),(o&&"none"!==o||!r)&&ne._data(i,"olddisplay",r?o:ne.css(i,"display"))));for(s=0;a>s;s++)i=t[s],i.style&&(e&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=e?n[s]||"":"none"));return t}function I(t,e,o){var i=lo.exec(e);return i?Math.max(0,i[1]-(o||0))+(i[2]||"px"):e}function E(t,e,o,i,r){for(var n=o===(i?"border":"content")?4:"width"===e?1:0,s=0;4>n;n+=2)"margin"===o&&(s+=ne.css(t,o+Te[n],!0,r)),i?("content"===o&&(s-=ne.css(t,"padding"+Te[n],!0,r)),"margin"!==o&&(s-=ne.css(t,"border"+Te[n]+"Width",!0,r))):(s+=ne.css(t,"padding"+Te[n],!0,r),"padding"!==o&&(s+=ne.css(t,"border"+Te[n]+"Width",!0,r)));return s}function L(t,e,o){var i=!0,r="width"===e?t.offsetWidth:t.offsetHeight,n=eo(t),s=ie.boxSizing()&&"border-box"===ne.css(t,"boxSizing",!1,n);if(0>=r||null==r){if(r=oo(t,e,n),(0>r||null==r)&&(r=t.style[e]),ro.test(r))return r;i=s&&(ie.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+E(t,e,o||(s?"border":"content"),i,n)+"px"}function D(t,e,o,i,r){return new D.prototype.init(t,e,o,i,r)}function F(){return setTimeout(function(){go=void 0}),go=ne.now()}function A(t,e){var o,i={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)o=Te[r],i["margin"+o]=i["padding"+o]=t;return e&&(i.opacity=i.width=t),i}function N(t,e,o){for(var i,r=(So[e]||[]).concat(So["*"]),n=0,s=r.length;s>n;n++)if(i=r[n].call(o,e,t))return i}function R(t,e,o){var i,r,n,s,a,h,l,p,c=this,d={},u=t.style,f=t.nodeType&&Ie(t),g=ne._data(t,"fxshow");o.queue||(a=ne._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,h=a.empty.fire,a.empty.fire=function(){a.unqueued||h()}),a.unqueued++,c.always(function(){c.always(function(){a.unqueued--,ne.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(o.overflow=[u.overflow,u.overflowX,u.overflowY],l=ne.css(t,"display"),p=k(t.nodeName),"none"===l&&(l=p),"inline"===l&&"none"===ne.css(t,"float")&&(ie.inlineBlockNeedsLayout&&"inline"!==p?u.zoom=1:u.display="inline-block")),o.overflow&&(u.overflow="hidden",ie.shrinkWrapBlocks()||c.always(function(){u.overflow=o.overflow[0],u.overflowX=o.overflow[1],u.overflowY=o.overflow[2]}));for(i in e)if(r=e[i],yo.exec(r)){if(delete e[i],n=n||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!g||void 0===g[i])continue;f=!0}d[i]=g&&g[i]||ne.style(t,i)}if(!ne.isEmptyObject(d)){g?"hidden"in g&&(f=g.hidden):g=ne._data(t,"fxshow",{}),n&&(g.hidden=!f),f?ne(t).show():c.done(function(){ne(t).hide()}),c.done(function(){var e;ne._removeData(t,"fxshow");for(e in d)ne.style(t,e,d[e])});for(i in d)s=N(f?g[i]:0,i,c),i in g||(g[i]=s.start,f&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function O(t,e){var o,i,r,n,s;for(o in t)if(i=ne.camelCase(o),r=e[i],n=t[o],ne.isArray(n)&&(r=n[1],n=t[o]=n[0]),o!==i&&(t[i]=n,delete t[o]),s=ne.cssHooks[i],s&&"expand"in s){n=s.expand(n),delete t[i];for(o in n)o in t||(t[o]=n[o],e[o]=r)}else e[i]=r}function z(t,e,o){var i,r,n=0,s=wo.length,a=ne.Deferred().always(function(){delete h.elem}),h=function(){if(r)return!1;for(var e=go||F(),o=Math.max(0,l.startTime+l.duration-e),i=o/l.duration||0,n=1-i,s=0,h=l.tweens.length;h>s;s++)l.tweens[s].run(n);return a.notifyWith(t,[l,n,o]),1>n&&h?o:(a.resolveWith(t,[l]),!1)},l=a.promise({elem:t,props:ne.extend({},e),opts:ne.extend(!0,{specialEasing:{}},o),originalProperties:e,originalOptions:o,startTime:go||F(),duration:o.duration,tweens:[],createTween:function(e,o){var i=ne.Tween(t,l.opts,e,o,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(i),i},stop:function(e){var o=0,i=e?l.tweens.length:0;if(r)return this;for(r=!0;i>o;o++)l.tweens[o].run(1);return e?a.resolveWith(t,[l,e]):a.rejectWith(t,[l,e]),this}}),p=l.props;for(O(p,l.opts.specialEasing);s>n;n++)if(i=wo[n].call(l,t,p,l.opts))return i;return ne.map(p,N,l),ne.isFunction(l.opts.start)&&l.opts.start.call(t,l),ne.fx.timer(ne.extend(h,{elem:t,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function j(t){return function(e,o){"string"!=typeof e&&(o=e,e="*");var i,r=0,n=e.toLowerCase().match(we)||[];if(ne.isFunction(o))for(;i=n[r++];)"+"===i.charAt(0)?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(o)):(t[i]=t[i]||[]).push(o)}}function H(t,e,o,i){function r(a){var h;return n[a]=!0,ne.each(t[a]||[],function(t,a){var l=a(e,o,i);return"string"!=typeof l||s||n[l]?s?!(h=l):void 0:(e.dataTypes.unshift(l),r(l),!1)}),h}var n={},s=t===Go;return r(e.dataTypes[0])||!n["*"]&&r("*")}function W(t,e){var o,i,r=ne.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:o||(o={}))[i]=e[i]);return o&&ne.extend(!0,t,o),t}function _(t,e,o){for(var i,r,n,s,a=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(s in a)if(a[s]&&a[s].test(r)){h.unshift(s);break}if(h[0]in o)n=h[0];else{for(s in o){if(!h[0]||t.converters[s+" "+h[0]]){n=s;break}i||(i=s)}n=n||i}return n?(n!==h[0]&&h.unshift(n),o[n]):void 0}function V(t,e,o,i){var r,n,s,a,h,l={},p=t.dataTypes.slice();if(p[1])for(s in t.converters)l[s.toLowerCase()]=t.converters[s];for(n=p.shift();n;)if(t.responseFields[n]&&(o[t.responseFields[n]]=e),!h&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),h=n,n=p.shift())if("*"===n)n=h;else if("*"!==h&&h!==n){if(s=l[h+" "+n]||l["* "+n],!s)for(r in l)if(a=r.split(" "),a[1]===n&&(s=l[h+" "+a[0]]||l["* "+a[0]])){s===!0?s=l[r]:l[r]!==!0&&(n=a[0],p.unshift(a[1]));break}if(s!==!0)if(s&&t["throws"])e=s(e);else try{e=s(e)}catch(c){return{state:"parsererror",error:s?c:"No conversion from "+h+" to "+n}}}return{state:"success",data:e}}function U(t,e,o,i){var r;if(ne.isArray(e))ne.each(e,function(e,r){o||Ko.test(t)?i(t,r):U(t+"["+("object"==typeof r?e:"")+"]",r,o,i)});else if(o||"object"!==ne.type(e))i(t,e);else for(r in e)U(t+"["+r+"]",e[r],o,i)}function G(){try{return new t.XMLHttpRequest}catch(e){}}function q(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function X(t){return ne.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var $=[],K=$.slice,Y=$.concat,J=$.push,Q=$.indexOf,Z={},te=Z.toString,ee=Z.hasOwnProperty,oe="".trim,ie={},re="1.11.0",ne=function(t,e){return new ne.fn.init(t,e)},se=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ae=/^-ms-/,he=/-([\da-z])/gi,le=function(t,e){return e.toUpperCase()};ne.fn=ne.prototype={jquery:re,constructor:ne,selector:"",length:0,toArray:function(){return K.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:K.call(this)},pushStack:function(t){var e=ne.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return ne.each(this,t,e)},map:function(t){return this.pushStack(ne.map(this,function(e,o){return t.call(e,o,e)}))},slice:function(){return this.pushStack(K.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,o=+t+(0>t?e:0);return this.pushStack(o>=0&&e>o?[this[o]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:J,sort:$.sort,splice:$.splice},ne.extend=ne.fn.extend=function(){var t,e,o,i,r,n,s=arguments[0]||{},a=1,h=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||ne.isFunction(s)||(s={}),a===h&&(s=this,a--);h>a;a++)if(null!=(r=arguments[a]))for(i in r)t=s[i],o=r[i],s!==o&&(l&&o&&(ne.isPlainObject(o)||(e=ne.isArray(o)))?(e?(e=!1,n=t&&ne.isArray(t)?t:[]):n=t&&ne.isPlainObject(t)?t:{},s[i]=ne.extend(l,n,o)):void 0!==o&&(s[i]=o));return s},ne.extend({expando:"jQuery"+(re+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===ne.type(t)},isArray:Array.isArray||function(t){return"array"===ne.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return t-parseFloat(t)>=0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==ne.type(t)||t.nodeType||ne.isWindow(t))return!1;try{if(t.constructor&&!ee.call(t,"constructor")&&!ee.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(o){return!1}if(ie.ownLast)for(e in t)return ee.call(t,e);for(e in t);return void 0===e||ee.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?Z[te.call(t)]||"object":typeof t},globalEval:function(e){e&&ne.trim(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(ae,"ms-").replace(he,le)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,i){var r,n=0,s=t.length,a=o(t);if(i){if(a)for(;s>n&&(r=e.apply(t[n],i),r!==!1);n++);else for(n in t)if(r=e.apply(t[n],i),r===!1)break}else if(a)for(;s>n&&(r=e.call(t[n],n,t[n]),r!==!1);n++);else for(n in t)if(r=e.call(t[n],n,t[n]),r===!1)break;return t},trim:oe&&!oe.call("\ufeff\xa0")?function(t){return null==t?"":oe.call(t)}:function(t){return null==t?"":(t+"").replace(se,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(o(Object(t))?ne.merge(i,"string"==typeof t?[t]:t):J.call(i,t)),i},inArray:function(t,e,o){var i;if(e){if(Q)return Q.call(e,t,o);for(i=e.length,o=o?0>o?Math.max(0,i+o):o:0;i>o;o++)if(o in e&&e[o]===t)return o}return-1},merge:function(t,e){for(var o=+e.length,i=0,r=t.length;o>i;)t[r++]=e[i++];if(o!==o)for(;void 0!==e[i];)t[r++]=e[i++];return t.length=r,t},grep:function(t,e,o){for(var i,r=[],n=0,s=t.length,a=!o;s>n;n++)i=!e(t[n],n),i!==a&&r.push(t[n]);return r},map:function(t,e,i){var r,n=0,s=t.length,a=o(t),h=[];if(a)for(;s>n;n++)r=e(t[n],n,i),null!=r&&h.push(r);else for(n in t)r=e(t[n],n,i),null!=r&&h.push(r);return Y.apply([],h)},guid:1,proxy:function(t,e){var o,i,r;return"string"==typeof e&&(r=t[e],e=t,t=r),ne.isFunction(t)?(o=K.call(arguments,2),i=function(){return t.apply(e||this,o.concat(K.call(arguments)))},i.guid=t.guid=t.guid||ne.guid++,i):void 0},now:function(){return+new Date},support:ie}),ne.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){Z["[object "+e+"]"]=e.toLowerCase()});var pe=function(t){function e(t,e,o,i){var r,n,s,a,h,l,c,f,g,m;if((e?e.ownerDocument||e:H)!==D&&L(e),e=e||D,o=o||[],!t||"string"!=typeof t)return o;if(1!==(a=e.nodeType)&&9!==a)return[];if(A&&!i){if(r=Me.exec(t))if(s=r[1]){if(9===a){if(n=e.getElementById(s),!n||!n.parentNode)return o;if(n.id===s)return o.push(n),o}else if(e.ownerDocument&&(n=e.ownerDocument.getElementById(s))&&z(e,n)&&n.id===s)return o.push(n),o}else{if(r[2])return Z.apply(o,e.getElementsByTagName(t)),o;if((s=r[3])&&v.getElementsByClassName&&e.getElementsByClassName)return Z.apply(o,e.getElementsByClassName(s)),o}if(v.qsa&&(!N||!N.test(t))){if(f=c=j,g=e,m=9===a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(l=d(t),(c=e.getAttribute("id"))?f=c.replace(we,"\\$&"):e.setAttribute("id",f),f="[id='"+f+"'] ",h=l.length;h--;)l[h]=f+u(l[h]);g=be.test(t)&&p(e.parentNode)||e,m=l.join(",")}if(m)try{return Z.apply(o,g.querySelectorAll(m)),o}catch(y){}finally{c||e.removeAttribute("id")}}}return S(t.replace(he,"$1"),e,o,i)}function o(){function t(o,i){return e.push(o+" ")>x.cacheLength&&delete t[e.shift()],t[o+" "]=i}var e=[];return t}function i(t){return t[j]=!0,t}function r(t){var e=D.createElement("div");try{return!!t(e)}catch(o){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function n(t,e){for(var o=t.split("|"),i=t.length;i--;)x.attrHandle[o[i]]=e}function s(t,e){var o=e&&t,i=o&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||$)-(~t.sourceIndex||$);if(i)return i;if(o)for(;o=o.nextSibling;)if(o===e)return-1;return t?1:-1}function a(t){return function(e){var o=e.nodeName.toLowerCase();return"input"===o&&e.type===t}}function h(t){return function(e){var o=e.nodeName.toLowerCase();return("input"===o||"button"===o)&&e.type===t}}function l(t){return i(function(e){return e=+e,i(function(o,i){for(var r,n=t([],o.length,e),s=n.length;s--;)o[r=n[s]]&&(o[r]=!(i[r]=o[r]))})})}function p(t){return t&&typeof t.getElementsByTagName!==X&&t}function c(){}function d(t,o){var i,r,n,s,a,h,l,p=U[t+" "];if(p)return o?0:p.slice(0);for(a=t,h=[],l=x.preFilter;a;){(!i||(r=le.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),h.push(n=[])),i=!1,(r=pe.exec(a))&&(i=r.shift(),n.push({value:i,type:r[0].replace(he," ")}),a=a.slice(i.length));
for(s in x.filter)!(r=fe[s].exec(a))||l[s]&&!(r=l[s](r))||(i=r.shift(),n.push({value:i,type:s,matches:r}),a=a.slice(i.length));if(!i)break}return o?a.length:a?e.error(t):U(t,h).slice(0)}function u(t){for(var e=0,o=t.length,i="";o>e;e++)i+=t[e].value;return i}function f(t,e,o){var i=e.dir,r=o&&"parentNode"===i,n=_++;return e.first?function(e,o,n){for(;e=e[i];)if(1===e.nodeType||r)return t(e,o,n)}:function(e,o,s){var a,h,l=[W,n];if(s){for(;e=e[i];)if((1===e.nodeType||r)&&t(e,o,s))return!0}else for(;e=e[i];)if(1===e.nodeType||r){if(h=e[j]||(e[j]={}),(a=h[i])&&a[0]===W&&a[1]===n)return l[2]=a[2];if(h[i]=l,l[2]=t(e,o,s))return!0}}}function g(t){return t.length>1?function(e,o,i){for(var r=t.length;r--;)if(!t[r](e,o,i))return!1;return!0}:t[0]}function m(t,e,o,i,r){for(var n,s=[],a=0,h=t.length,l=null!=e;h>a;a++)(n=t[a])&&(!o||o(n,i,r))&&(s.push(n),l&&e.push(a));return s}function y(t,e,o,r,n,s){return r&&!r[j]&&(r=y(r)),n&&!n[j]&&(n=y(n,s)),i(function(i,s,a,h){var l,p,c,d=[],u=[],f=s.length,g=i||w(e||"*",a.nodeType?[a]:a,[]),y=!t||!i&&e?g:m(g,d,t,a,h),M=o?n||(i?t:f||r)?[]:s:y;if(o&&o(y,M,a,h),r)for(l=m(M,u),r(l,[],a,h),p=l.length;p--;)(c=l[p])&&(M[u[p]]=!(y[u[p]]=c));if(i){if(n||t){if(n){for(l=[],p=M.length;p--;)(c=M[p])&&l.push(y[p]=c);n(null,M=[],l,h)}for(p=M.length;p--;)(c=M[p])&&(l=n?ee.call(i,c):d[p])>-1&&(i[l]=!(s[l]=c))}}else M=m(M===s?M.splice(f,M.length):M),n?n(null,s,M,h):Z.apply(s,M)})}function M(t){for(var e,o,i,r=t.length,n=x.relative[t[0].type],s=n||x.relative[" "],a=n?1:0,h=f(function(t){return t===e},s,!0),l=f(function(t){return ee.call(e,t)>-1},s,!0),p=[function(t,o,i){return!n&&(i||o!==T)||((e=o).nodeType?h(t,o,i):l(t,o,i))}];r>a;a++)if(o=x.relative[t[a].type])p=[f(g(p),o)];else{if(o=x.filter[t[a].type].apply(null,t[a].matches),o[j]){for(i=++a;r>i&&!x.relative[t[i].type];i++);return y(a>1&&g(p),a>1&&u(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(he,"$1"),o,i>a&&M(t.slice(a,i)),r>i&&M(t=t.slice(i)),r>i&&u(t))}p.push(o)}return g(p)}function b(t,o){var r=o.length>0,n=t.length>0,s=function(i,s,a,h,l){var p,c,d,u=0,f="0",g=i&&[],y=[],M=T,b=i||n&&x.find.TAG("*",l),w=W+=null==M?1:Math.random()||.1,S=b.length;for(l&&(T=s!==D&&s);f!==S&&null!=(p=b[f]);f++){if(n&&p){for(c=0;d=t[c++];)if(d(p,s,a)){h.push(p);break}l&&(W=w)}r&&((p=!d&&p)&&u--,i&&g.push(p))}if(u+=f,r&&f!==u){for(c=0;d=o[c++];)d(g,y,s,a);if(i){if(u>0)for(;f--;)g[f]||y[f]||(y[f]=J.call(h));y=m(y)}Z.apply(h,y),l&&!i&&y.length>0&&u+o.length>1&&e.uniqueSort(h)}return l&&(W=w,T=M),g};return r?i(s):s}function w(t,o,i){for(var r=0,n=o.length;n>r;r++)e(t,o[r],i);return i}function S(t,e,o,i){var r,n,s,a,h,l=d(t);if(!i&&1===l.length){if(n=l[0]=l[0].slice(0),n.length>2&&"ID"===(s=n[0]).type&&v.getById&&9===e.nodeType&&A&&x.relative[n[1].type]){if(e=(x.find.ID(s.matches[0].replace(Se,Ce),e)||[])[0],!e)return o;t=t.slice(n.shift().value.length)}for(r=fe.needsContext.test(t)?0:n.length;r--&&(s=n[r],!x.relative[a=s.type]);)if((h=x.find[a])&&(i=h(s.matches[0].replace(Se,Ce),be.test(n[0].type)&&p(e.parentNode)||e))){if(n.splice(r,1),t=i.length&&u(n),!t)return Z.apply(o,i),o;break}}return P(t,l)(i,e,!A,o,be.test(t)&&p(e.parentNode)||e),o}var C,v,x,k,B,P,T,I,E,L,D,F,A,N,R,O,z,j="sizzle"+-new Date,H=t.document,W=0,_=0,V=o(),U=o(),G=o(),q=function(t,e){return t===e&&(E=!0),0},X="undefined",$=1<<31,K={}.hasOwnProperty,Y=[],J=Y.pop,Q=Y.push,Z=Y.push,te=Y.slice,ee=Y.indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(this[e]===t)return e;return-1},oe="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ne=re.replace("w","w#"),se="\\["+ie+"*("+re+")"+ie+"*(?:([*^$|!~]?=)"+ie+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ne+")|)|)"+ie+"*\\]",ae=":("+re+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+se.replace(3,8)+")*)|.*)\\)|)",he=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),le=new RegExp("^"+ie+"*,"+ie+"*"),pe=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),ce=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),de=new RegExp(ae),ue=new RegExp("^"+ne+"$"),fe={ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re.replace("w","w*")+")"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+ae),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+oe+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},ge=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ye=/^[^{]+\{\s*\[native \w/,Me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,be=/[+~]/,we=/'|\\/g,Se=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Ce=function(t,e,o){var i="0x"+e-65536;return i!==i||o?e:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)};try{Z.apply(Y=te.call(H.childNodes),H.childNodes),Y[H.childNodes.length].nodeType}catch(ve){Z={apply:Y.length?function(t,e){Q.apply(t,te.call(e))}:function(t,e){for(var o=t.length,i=0;t[o++]=e[i++];);t.length=o-1}}}v=e.support={},B=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},L=e.setDocument=function(t){var e,o=t?t.ownerDocument||t:H,i=o.defaultView;return o!==D&&9===o.nodeType&&o.documentElement?(D=o,F=o.documentElement,A=!B(o),i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",function(){L()},!1):i.attachEvent&&i.attachEvent("onunload",function(){L()})),v.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),v.getElementsByTagName=r(function(t){return t.appendChild(o.createComment("")),!t.getElementsByTagName("*").length}),v.getElementsByClassName=ye.test(o.getElementsByClassName)&&r(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),v.getById=r(function(t){return F.appendChild(t).id=j,!o.getElementsByName||!o.getElementsByName(j).length}),v.getById?(x.find.ID=function(t,e){if(typeof e.getElementById!==X&&A){var o=e.getElementById(t);return o&&o.parentNode?[o]:[]}},x.filter.ID=function(t){var e=t.replace(Se,Ce);return function(t){return t.getAttribute("id")===e}}):(delete x.find.ID,x.filter.ID=function(t){var e=t.replace(Se,Ce);return function(t){var o=typeof t.getAttributeNode!==X&&t.getAttributeNode("id");return o&&o.value===e}}),x.find.TAG=v.getElementsByTagName?function(t,e){return typeof e.getElementsByTagName!==X?e.getElementsByTagName(t):void 0}:function(t,e){var o,i=[],r=0,n=e.getElementsByTagName(t);if("*"===t){for(;o=n[r++];)1===o.nodeType&&i.push(o);return i}return n},x.find.CLASS=v.getElementsByClassName&&function(t,e){return typeof e.getElementsByClassName!==X&&A?e.getElementsByClassName(t):void 0},R=[],N=[],(v.qsa=ye.test(o.querySelectorAll))&&(r(function(t){t.innerHTML="<select t=''><option selected=''></option></select>",t.querySelectorAll("[t^='']").length&&N.push("[*^$]="+ie+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||N.push("\\["+ie+"*(?:value|"+oe+")"),t.querySelectorAll(":checked").length||N.push(":checked")}),r(function(t){var e=o.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&N.push("name"+ie+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),N.push(",.*:")})),(v.matchesSelector=ye.test(O=F.webkitMatchesSelector||F.mozMatchesSelector||F.oMatchesSelector||F.msMatchesSelector))&&r(function(t){v.disconnectedMatch=O.call(t,"div"),O.call(t,"[s!='']:x"),R.push("!=",ae)}),N=N.length&&new RegExp(N.join("|")),R=R.length&&new RegExp(R.join("|")),e=ye.test(F.compareDocumentPosition),z=e||ye.test(F.contains)?function(t,e){var o=9===t.nodeType?t.documentElement:t,i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(o.contains?o.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},q=e?function(t,e){if(t===e)return E=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!v.sortDetached&&e.compareDocumentPosition(t)===i?t===o||t.ownerDocument===H&&z(H,t)?-1:e===o||e.ownerDocument===H&&z(H,e)?1:I?ee.call(I,t)-ee.call(I,e):0:4&i?-1:1)}:function(t,e){if(t===e)return E=!0,0;var i,r=0,n=t.parentNode,a=e.parentNode,h=[t],l=[e];if(!n||!a)return t===o?-1:e===o?1:n?-1:a?1:I?ee.call(I,t)-ee.call(I,e):0;if(n===a)return s(t,e);for(i=t;i=i.parentNode;)h.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;h[r]===l[r];)r++;return r?s(h[r],l[r]):h[r]===H?-1:l[r]===H?1:0},o):D},e.matches=function(t,o){return e(t,null,null,o)},e.matchesSelector=function(t,o){if((t.ownerDocument||t)!==D&&L(t),o=o.replace(ce,"='$1']"),!(!v.matchesSelector||!A||R&&R.test(o)||N&&N.test(o)))try{var i=O.call(t,o);if(i||v.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(r){}return e(o,D,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==D&&L(t),z(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==D&&L(t);var o=x.attrHandle[e.toLowerCase()],i=o&&K.call(x.attrHandle,e.toLowerCase())?o(t,e,!A):void 0;return void 0!==i?i:v.attributes||!A?t.getAttribute(e):(i=t.getAttributeNode(e))&&i.specified?i.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,o=[],i=0,r=0;if(E=!v.detectDuplicates,I=!v.sortStable&&t.slice(0),t.sort(q),E){for(;e=t[r++];)e===t[r]&&(i=o.push(r));for(;i--;)t.splice(o[i],1)}return I=null,t},k=e.getText=function(t){var e,o="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)o+=k(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[i++];)o+=k(e);return o},x=e.selectors={cacheLength:50,createPseudo:i,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Se,Ce),t[3]=(t[4]||t[5]||"").replace(Se,Ce),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,o=!t[5]&&t[2];return fe.CHILD.test(t[0])?null:(t[3]&&void 0!==t[4]?t[2]=t[4]:o&&de.test(o)&&(e=d(o,!0))&&(e=o.indexOf(")",o.length-e)-o.length)&&(t[0]=t[0].slice(0,e),t[2]=o.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Se,Ce).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=V[t+" "];return e||(e=new RegExp("(^|"+ie+")"+t+"("+ie+"|$)"))&&V(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==X&&t.getAttribute("class")||"")})},ATTR:function(t,o,i){return function(r){var n=e.attr(r,t);return null==n?"!="===o:o?(n+="","="===o?n===i:"!="===o?n!==i:"^="===o?i&&0===n.indexOf(i):"*="===o?i&&n.indexOf(i)>-1:"$="===o?i&&n.slice(-i.length)===i:"~="===o?(" "+n+" ").indexOf(i)>-1:"|="===o?n===i||n.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(t,e,o,i,r){var n="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===i&&0===r?function(t){return!!t.parentNode}:function(e,o,h){var l,p,c,d,u,f,g=n!==s?"nextSibling":"previousSibling",m=e.parentNode,y=a&&e.nodeName.toLowerCase(),M=!h&&!a;if(m){if(n){for(;g;){for(c=e;c=c[g];)if(a?c.nodeName.toLowerCase()===y:1===c.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&M){for(p=m[j]||(m[j]={}),l=p[t]||[],u=l[0]===W&&l[1],d=l[0]===W&&l[2],c=u&&m.childNodes[u];c=++u&&c&&c[g]||(d=u=0)||f.pop();)if(1===c.nodeType&&++d&&c===e){p[t]=[W,u,d];break}}else if(M&&(l=(e[j]||(e[j]={}))[t])&&l[0]===W)d=l[1];else for(;(c=++u&&c&&c[g]||(d=u=0)||f.pop())&&((a?c.nodeName.toLowerCase()!==y:1!==c.nodeType)||!++d||(M&&((c[j]||(c[j]={}))[t]=[W,d]),c!==e)););return d-=r,d===i||d%i===0&&d/i>=0}}},PSEUDO:function(t,o){var r,n=x.pseudos[t]||x.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return n[j]?n(o):n.length>1?(r=[t,t,"",o],x.setFilters.hasOwnProperty(t.toLowerCase())?i(function(t,e){for(var i,r=n(t,o),s=r.length;s--;)i=ee.call(t,r[s]),t[i]=!(e[i]=r[s])}):function(t){return n(t,0,r)}):n}},pseudos:{not:i(function(t){var e=[],o=[],r=P(t.replace(he,"$1"));return r[j]?i(function(t,e,o,i){for(var n,s=r(t,null,i,[]),a=t.length;a--;)(n=s[a])&&(t[a]=!(e[a]=n))}):function(t,i,n){return e[0]=t,r(e,null,n,o),!o.pop()}}),has:i(function(t){return function(o){return e(t,o).length>0}}),contains:i(function(t){return function(e){return(e.textContent||e.innerText||k(e)).indexOf(t)>-1}}),lang:i(function(t){return ue.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(Se,Ce).toLowerCase(),function(e){var o;do if(o=A?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return o=o.toLowerCase(),o===t||0===o.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var o=t.location&&t.location.hash;return o&&o.slice(1)===e.id},root:function(t){return t===F},focus:function(t){return t===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!x.pseudos.empty(t)},header:function(t){return me.test(t.nodeName)},input:function(t){return ge.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:l(function(){return[0]}),last:l(function(t,e){return[e-1]}),eq:l(function(t,e,o){return[0>o?o+e:o]}),even:l(function(t,e){for(var o=0;e>o;o+=2)t.push(o);return t}),odd:l(function(t,e){for(var o=1;e>o;o+=2)t.push(o);return t}),lt:l(function(t,e,o){for(var i=0>o?o+e:o;--i>=0;)t.push(i);return t}),gt:l(function(t,e,o){for(var i=0>o?o+e:o;++i<e;)t.push(i);return t})}},x.pseudos.nth=x.pseudos.eq;for(C in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[C]=a(C);for(C in{submit:!0,reset:!0})x.pseudos[C]=h(C);return c.prototype=x.filters=x.pseudos,x.setFilters=new c,P=e.compile=function(t,e){var o,i=[],r=[],n=G[t+" "];if(!n){for(e||(e=d(t)),o=e.length;o--;)n=M(e[o]),n[j]?i.push(n):r.push(n);n=G(t,b(r,i))}return n},v.sortStable=j.split("").sort(q).join("")===j,v.detectDuplicates=!!E,L(),v.sortDetached=r(function(t){return 1&t.compareDocumentPosition(D.createElement("div"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||n("type|href|height|width",function(t,e,o){return o?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),v.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||n("value",function(t,e,o){return o||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||n(oe,function(t,e,o){var i;return o?void 0:t[e]===!0?e.toLowerCase():(i=t.getAttributeNode(e))&&i.specified?i.value:null}),e}(t);ne.find=pe,ne.expr=pe.selectors,ne.expr[":"]=ne.expr.pseudos,ne.unique=pe.uniqueSort,ne.text=pe.getText,ne.isXMLDoc=pe.isXML,ne.contains=pe.contains;var ce=ne.expr.match.needsContext,de=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ue=/^.[^:#\[\.,]*$/;ne.filter=function(t,e,o){var i=e[0];return o&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?ne.find.matchesSelector(i,t)?[i]:[]:ne.find.matches(t,ne.grep(e,function(t){return 1===t.nodeType}))},ne.fn.extend({find:function(t){var e,o=[],i=this,r=i.length;if("string"!=typeof t)return this.pushStack(ne(t).filter(function(){for(e=0;r>e;e++)if(ne.contains(i[e],this))return!0}));for(e=0;r>e;e++)ne.find(t,i[e],o);return o=this.pushStack(r>1?ne.unique(o):o),o.selector=this.selector?this.selector+" "+t:t,o},filter:function(t){return this.pushStack(i(this,t||[],!1))},not:function(t){return this.pushStack(i(this,t||[],!0))},is:function(t){return!!i(this,"string"==typeof t&&ce.test(t)?ne(t):t||[],!1).length}});var fe,ge=t.document,me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ye=ne.fn.init=function(t,e){var o,i;if(!t)return this;if("string"==typeof t){if(o="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:me.exec(t),!o||!o[1]&&e)return!e||e.jquery?(e||fe).find(t):this.constructor(e).find(t);if(o[1]){if(e=e instanceof ne?e[0]:e,ne.merge(this,ne.parseHTML(o[1],e&&e.nodeType?e.ownerDocument||e:ge,!0)),de.test(o[1])&&ne.isPlainObject(e))for(o in e)ne.isFunction(this[o])?this[o](e[o]):this.attr(o,e[o]);return this}if(i=ge.getElementById(o[2]),i&&i.parentNode){if(i.id!==o[2])return fe.find(t);this.length=1,this[0]=i}return this.context=ge,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):ne.isFunction(t)?"undefined"!=typeof fe.ready?fe.ready(t):t(ne):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),ne.makeArray(t,this))};ye.prototype=ne.fn,fe=ne(ge);var Me=/^(?:parents|prev(?:Until|All))/,be={children:!0,contents:!0,next:!0,prev:!0};ne.extend({dir:function(t,e,o){for(var i=[],r=t[e];r&&9!==r.nodeType&&(void 0===o||1!==r.nodeType||!ne(r).is(o));)1===r.nodeType&&i.push(r),r=r[e];return i},sibling:function(t,e){for(var o=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&o.push(t);return o}}),ne.fn.extend({has:function(t){var e,o=ne(t,this),i=o.length;return this.filter(function(){for(e=0;i>e;e++)if(ne.contains(this,o[e]))return!0})},closest:function(t,e){for(var o,i=0,r=this.length,n=[],s=ce.test(t)||"string"!=typeof t?ne(t,e||this.context):0;r>i;i++)for(o=this[i];o&&o!==e;o=o.parentNode)if(o.nodeType<11&&(s?s.index(o)>-1:1===o.nodeType&&ne.find.matchesSelector(o,t))){n.push(o);break}return this.pushStack(n.length>1?ne.unique(n):n)},index:function(t){return t?"string"==typeof t?ne.inArray(this[0],ne(t)):ne.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(ne.unique(ne.merge(this.get(),ne(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),ne.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return ne.dir(t,"parentNode")},parentsUntil:function(t,e,o){return ne.dir(t,"parentNode",o)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return ne.dir(t,"nextSibling")},prevAll:function(t){return ne.dir(t,"previousSibling")},nextUntil:function(t,e,o){return ne.dir(t,"nextSibling",o)},prevUntil:function(t,e,o){return ne.dir(t,"previousSibling",o)},siblings:function(t){return ne.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return ne.sibling(t.firstChild)},contents:function(t){return ne.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:ne.merge([],t.childNodes)}},function(t,e){ne.fn[t]=function(o,i){var r=ne.map(this,e,o);return"Until"!==t.slice(-5)&&(i=o),i&&"string"==typeof i&&(r=ne.filter(i,r)),this.length>1&&(be[t]||(r=ne.unique(r)),Me.test(t)&&(r=r.reverse())),this.pushStack(r)}});var we=/\S+/g,Se={};ne.Callbacks=function(t){t="string"==typeof t?Se[t]||n(t):ne.extend({},t);var e,o,i,r,s,a,h=[],l=!t.once&&[],p=function(n){for(o=t.memory&&n,i=!0,s=a||0,a=0,r=h.length,e=!0;h&&r>s;s++)if(h[s].apply(n[0],n[1])===!1&&t.stopOnFalse){o=!1;break}e=!1,h&&(l?l.length&&p(l.shift()):o?h=[]:c.disable())},c={add:function(){if(h){var i=h.length;!function n(e){ne.each(e,function(e,o){var i=ne.type(o);"function"===i?t.unique&&c.has(o)||h.push(o):o&&o.length&&"string"!==i&&n(o)})}(arguments),e?r=h.length:o&&(a=i,p(o))}return this},remove:function(){return h&&ne.each(arguments,function(t,o){for(var i;(i=ne.inArray(o,h,i))>-1;)h.splice(i,1),e&&(r>=i&&r--,s>=i&&s--)}),this},has:function(t){return t?ne.inArray(t,h)>-1:!(!h||!h.length)},empty:function(){return h=[],r=0,this},disable:function(){return h=l=o=void 0,this},disabled:function(){return!h},lock:function(){return l=void 0,o||c.disable(),this},locked:function(){return!l},fireWith:function(t,o){return!h||i&&!l||(o=o||[],o=[t,o.slice?o.slice():o],e?l.push(o):p(o)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},ne.extend({Deferred:function(t){var e=[["resolve","done",ne.Callbacks("once memory"),"resolved"],["reject","fail",ne.Callbacks("once memory"),"rejected"],["notify","progress",ne.Callbacks("memory")]],o="pending",i={state:function(){return o},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return ne.Deferred(function(o){ne.each(e,function(e,n){var s=ne.isFunction(t[e])&&t[e];r[n[1]](function(){var t=s&&s.apply(this,arguments);t&&ne.isFunction(t.promise)?t.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[n[0]+"With"](this===i?o.promise():this,s?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?ne.extend(t,i):i}},r={};return i.pipe=i.then,ne.each(e,function(t,n){var s=n[2],a=n[3];i[n[1]]=s.add,a&&s.add(function(){o=a},e[1^t][2].disable,e[2][2].lock),r[n[0]]=function(){return r[n[0]+"With"](this===r?i:this,arguments),this},r[n[0]+"With"]=s.fireWith}),i.promise(r),t&&t.call(r,r),r},when:function(t){var e,o,i,r=0,n=K.call(arguments),s=n.length,a=1!==s||t&&ne.isFunction(t.promise)?s:0,h=1===a?t:ne.Deferred(),l=function(t,o,i){return function(r){o[t]=this,i[t]=arguments.length>1?K.call(arguments):r,i===e?h.notifyWith(o,i):--a||h.resolveWith(o,i)}};if(s>1)for(e=new Array(s),o=new Array(s),i=new Array(s);s>r;r++)n[r]&&ne.isFunction(n[r].promise)?n[r].promise().done(l(r,i,n)).fail(h.reject).progress(l(r,o,e)):--a;return a||h.resolveWith(i,n),h.promise()}});var Ce;ne.fn.ready=function(t){return ne.ready.promise().done(t),this},ne.extend({isReady:!1,readyWait:1,holdReady:function(t){t?ne.readyWait++:ne.ready(!0)},ready:function(t){if(t===!0?!--ne.readyWait:!ne.isReady){if(!ge.body)return setTimeout(ne.ready);ne.isReady=!0,t!==!0&&--ne.readyWait>0||(Ce.resolveWith(ge,[ne]),ne.fn.trigger&&ne(ge).trigger("ready").off("ready"))}}}),ne.ready.promise=function(e){if(!Ce)if(Ce=ne.Deferred(),"complete"===ge.readyState)setTimeout(ne.ready);else if(ge.addEventListener)ge.addEventListener("DOMContentLoaded",a,!1),t.addEventListener("load",a,!1);else{ge.attachEvent("onreadystatechange",a),t.attachEvent("onload",a);var o=!1;try{o=null==t.frameElement&&ge.documentElement}catch(i){}o&&o.doScroll&&!function r(){if(!ne.isReady){try{o.doScroll("left")}catch(t){return setTimeout(r,50)}s(),ne.ready()}}()}return Ce.promise(e)};var ve,xe="undefined";for(ve in ne(ie))break;ie.ownLast="0"!==ve,ie.inlineBlockNeedsLayout=!1,ne(function(){var t,e,o=ge.getElementsByTagName("body")[0];o&&(t=ge.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",e=ge.createElement("div"),o.appendChild(t).appendChild(e),typeof e.style.zoom!==xe&&(e.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(ie.inlineBlockNeedsLayout=3===e.offsetWidth)&&(o.style.zoom=1)),o.removeChild(t),t=e=null)}),function(){var t=ge.createElement("div");if(null==ie.deleteExpando){ie.deleteExpando=!0;try{delete t.test}catch(e){ie.deleteExpando=!1}}t=null}(),ne.acceptData=function(t){var e=ne.noData[(t.nodeName+" ").toLowerCase()],o=+t.nodeType||1;return 1!==o&&9!==o?!1:!e||e!==!0&&t.getAttribute("classid")===e};var ke=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Be=/([A-Z])/g;ne.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return t=t.nodeType?ne.cache[t[ne.expando]]:t[ne.expando],!!t&&!l(t)},data:function(t,e,o){return p(t,e,o)},removeData:function(t,e){return c(t,e)},_data:function(t,e,o){return p(t,e,o,!0)},_removeData:function(t,e){return c(t,e,!0)}}),ne.fn.extend({data:function(t,e){var o,i,r,n=this[0],s=n&&n.attributes;if(void 0===t){if(this.length&&(r=ne.data(n),1===n.nodeType&&!ne._data(n,"parsedAttrs"))){for(o=s.length;o--;)i=s[o].name,0===i.indexOf("data-")&&(i=ne.camelCase(i.slice(5)),h(n,i,r[i]));ne._data(n,"parsedAttrs",!0)}return r}return"object"==typeof t?this.each(function(){ne.data(this,t)}):arguments.length>1?this.each(function(){ne.data(this,t,e)}):n?h(n,t,ne.data(n,t)):void 0},removeData:function(t){return this.each(function(){ne.removeData(this,t)})}}),ne.extend({queue:function(t,e,o){var i;return t?(e=(e||"fx")+"queue",i=ne._data(t,e),o&&(!i||ne.isArray(o)?i=ne._data(t,e,ne.makeArray(o)):i.push(o)),i||[]):void 0},dequeue:function(t,e){e=e||"fx";var o=ne.queue(t,e),i=o.length,r=o.shift(),n=ne._queueHooks(t,e),s=function(){ne.dequeue(t,e)};"inprogress"===r&&(r=o.shift(),i--),r&&("fx"===e&&o.unshift("inprogress"),delete n.stop,r.call(t,s,n)),!i&&n&&n.empty.fire()},_queueHooks:function(t,e){var o=e+"queueHooks";return ne._data(t,o)||ne._data(t,o,{empty:ne.Callbacks("once memory").add(function(){ne._removeData(t,e+"queue"),ne._removeData(t,o)})})}}),ne.fn.extend({queue:function(t,e){var o=2;return"string"!=typeof t&&(e=t,t="fx",o--),arguments.length<o?ne.queue(this[0],t):void 0===e?this:this.each(function(){var o=ne.queue(this,t,e);ne._queueHooks(this,t),"fx"===t&&"inprogress"!==o[0]&&ne.dequeue(this,t)})},dequeue:function(t){return this.each(function(){ne.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var o,i=1,r=ne.Deferred(),n=this,s=this.length,a=function(){--i||r.resolveWith(n,[n])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)o=ne._data(n[s],t+"queueHooks"),o&&o.empty&&(i++,o.empty.add(a));return a(),r.promise(e)}});var Pe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Te=["Top","Right","Bottom","Left"],Ie=function(t,e){return t=e||t,"none"===ne.css(t,"display")||!ne.contains(t.ownerDocument,t)},Ee=ne.access=function(t,e,o,i,r,n,s){var a=0,h=t.length,l=null==o;if("object"===ne.type(o)){r=!0;for(a in o)ne.access(t,e,a,o[a],!0,n,s)}else if(void 0!==i&&(r=!0,ne.isFunction(i)||(s=!0),l&&(s?(e.call(t,i),e=null):(l=e,e=function(t,e,o){return l.call(ne(t),o)})),e))for(;h>a;a++)e(t[a],o,s?i:i.call(t[a],a,e(t[a],o)));return r?t:l?e.call(t):h?e(t[0],o):n},Le=/^(?:checkbox|radio)$/i;!function(){var t=ge.createDocumentFragment(),e=ge.createElement("div"),o=ge.createElement("input");if(e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a>",ie.leadingWhitespace=3===e.firstChild.nodeType,ie.tbody=!e.getElementsByTagName("tbody").length,ie.htmlSerialize=!!e.getElementsByTagName("link").length,ie.html5Clone="<:nav></:nav>"!==ge.createElement("nav").cloneNode(!0).outerHTML,o.type="checkbox",o.checked=!0,t.appendChild(o),ie.appendChecked=o.checked,e.innerHTML="<textarea>x</textarea>",ie.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,t.appendChild(e),e.innerHTML="<input type='radio' checked='checked' name='t'/>",ie.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,ie.noCloneEvent=!0,e.attachEvent&&(e.attachEvent("onclick",function(){ie.noCloneEvent=!1}),e.cloneNode(!0).click()),null==ie.deleteExpando){ie.deleteExpando=!0;try{delete e.test}catch(i){ie.deleteExpando=!1}}t=e=o=null}(),function(){var e,o,i=ge.createElement("div");for(e in{submit:!0,change:!0,focusin:!0})o="on"+e,(ie[e+"Bubbles"]=o in t)||(i.setAttribute(o,"t"),ie[e+"Bubbles"]=i.attributes[o].expando===!1);i=null}();var De=/^(?:input|select|textarea)$/i,Fe=/^key/,Ae=/^(?:mouse|contextmenu)|click/,Ne=/^(?:focusinfocus|focusoutblur)$/,Re=/^([^.]*)(?:\.(.+)|)$/;ne.event={global:{},add:function(t,e,o,i,r){var n,s,a,h,l,p,c,d,u,f,g,m=ne._data(t);if(m){for(o.handler&&(h=o,o=h.handler,r=h.selector),o.guid||(o.guid=ne.guid++),(s=m.events)||(s=m.events={}),(p=m.handle)||(p=m.handle=function(t){return typeof ne===xe||t&&ne.event.triggered===t.type?void 0:ne.event.dispatch.apply(p.elem,arguments)},p.elem=t),e=(e||"").match(we)||[""],a=e.length;a--;)n=Re.exec(e[a])||[],u=g=n[1],f=(n[2]||"").split(".").sort(),u&&(l=ne.event.special[u]||{},u=(r?l.delegateType:l.bindType)||u,l=ne.event.special[u]||{},c=ne.extend({type:u,origType:g,data:i,handler:o,guid:o.guid,selector:r,needsContext:r&&ne.expr.match.needsContext.test(r),namespace:f.join(".")},h),(d=s[u])||(d=s[u]=[],d.delegateCount=0,l.setup&&l.setup.call(t,i,f,p)!==!1||(t.addEventListener?t.addEventListener(u,p,!1):t.attachEvent&&t.attachEvent("on"+u,p))),l.add&&(l.add.call(t,c),c.handler.guid||(c.handler.guid=o.guid)),r?d.splice(d.delegateCount++,0,c):d.push(c),ne.event.global[u]=!0);t=null}},remove:function(t,e,o,i,r){var n,s,a,h,l,p,c,d,u,f,g,m=ne.hasData(t)&&ne._data(t);if(m&&(p=m.events)){for(e=(e||"").match(we)||[""],l=e.length;l--;)if(a=Re.exec(e[l])||[],u=g=a[1],f=(a[2]||"").split(".").sort(),u){for(c=ne.event.special[u]||{},u=(i?c.delegateType:c.bindType)||u,d=p[u]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),h=n=d.length;n--;)s=d[n],!r&&g!==s.origType||o&&o.guid!==s.guid||a&&!a.test(s.namespace)||i&&i!==s.selector&&("**"!==i||!s.selector)||(d.splice(n,1),s.selector&&d.delegateCount--,c.remove&&c.remove.call(t,s));h&&!d.length&&(c.teardown&&c.teardown.call(t,f,m.handle)!==!1||ne.removeEvent(t,u,m.handle),delete p[u])}else for(u in p)ne.event.remove(t,u+e[l],o,i,!0);ne.isEmptyObject(p)&&(delete m.handle,ne._removeData(t,"events"))}},trigger:function(e,o,i,r){var n,s,a,h,l,p,c,d=[i||ge],u=ee.call(e,"type")?e.type:e,f=ee.call(e,"namespace")?e.namespace.split("."):[];if(a=p=i=i||ge,3!==i.nodeType&&8!==i.nodeType&&!Ne.test(u+ne.event.triggered)&&(u.indexOf(".")>=0&&(f=u.split("."),u=f.shift(),f.sort()),s=u.indexOf(":")<0&&"on"+u,e=e[ne.expando]?e:new ne.Event(u,"object"==typeof e&&e),e.isTrigger=r?2:3,e.namespace=f.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),o=null==o?[e]:ne.makeArray(o,[e]),l=ne.event.special[u]||{},r||!l.trigger||l.trigger.apply(i,o)!==!1)){if(!r&&!l.noBubble&&!ne.isWindow(i)){for(h=l.delegateType||u,Ne.test(h+u)||(a=a.parentNode);a;a=a.parentNode)d.push(a),p=a;p===(i.ownerDocument||ge)&&d.push(p.defaultView||p.parentWindow||t)}for(c=0;(a=d[c++])&&!e.isPropagationStopped();)e.type=c>1?h:l.bindType||u,n=(ne._data(a,"events")||{})[e.type]&&ne._data(a,"handle"),n&&n.apply(a,o),n=s&&a[s],n&&n.apply&&ne.acceptData(a)&&(e.result=n.apply(a,o),e.result===!1&&e.preventDefault());if(e.type=u,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),o)===!1)&&ne.acceptData(i)&&s&&i[u]&&!ne.isWindow(i)){p=i[s],p&&(i[s]=null),ne.event.triggered=u;try{i[u]()}catch(g){}ne.event.triggered=void 0,p&&(i[s]=p)}return e.result}},dispatch:function(t){t=ne.event.fix(t);var e,o,i,r,n,s=[],a=K.call(arguments),h=(ne._data(this,"events")||{})[t.type]||[],l=ne.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,t)!==!1){for(s=ne.event.handlers.call(this,t,h),e=0;(r=s[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,n=0;(i=r.handlers[n++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(i.namespace))&&(t.handleObj=i,t.data=i.data,o=((ne.event.special[i.origType]||{}).handle||i.handler).apply(r.elem,a),void 0!==o&&(t.result=o)===!1&&(t.preventDefault(),t.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,t),t.result}},handlers:function(t,e){var o,i,r,n,s=[],a=e.delegateCount,h=t.target;if(a&&h.nodeType&&(!t.button||"click"!==t.type))for(;h!=this;h=h.parentNode||this)if(1===h.nodeType&&(h.disabled!==!0||"click"!==t.type)){for(r=[],n=0;a>n;n++)i=e[n],o=i.selector+" ",void 0===r[o]&&(r[o]=i.needsContext?ne(o,this).index(h)>=0:ne.find(o,this,null,[h]).length),r[o]&&r.push(i);r.length&&s.push({elem:h,handlers:r})}return a<e.length&&s.push({elem:this,handlers:e.slice(a)}),s},fix:function(t){if(t[ne.expando])return t;var e,o,i,r=t.type,n=t,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Ae.test(r)?this.mouseHooks:Fe.test(r)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,t=new ne.Event(n),e=i.length;e--;)o=i[e],t[o]=n[o];return t.target||(t.target=n.srcElement||ge),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,s.filter?s.filter(t,n):t
},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var o,i,r,n=e.button,s=e.fromElement;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||ge,r=i.documentElement,o=i.body,t.pageX=e.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),!t.relatedTarget&&s&&(t.relatedTarget=s===t.target?e.toElement:s),t.which||void 0===n||(t.which=1&n?1:2&n?3:4&n?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==f()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){return this===f()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return ne.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(t){return ne.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,o,i){var r=ne.extend(new ne.Event,o,{type:t,isSimulated:!0,originalEvent:{}});i?ne.event.trigger(r,null,e):ne.event.dispatch.call(e,r),r.isDefaultPrevented()&&o.preventDefault()}},ne.removeEvent=ge.removeEventListener?function(t,e,o){t.removeEventListener&&t.removeEventListener(e,o,!1)}:function(t,e,o){var i="on"+e;t.detachEvent&&(typeof t[i]===xe&&(t[i]=null),t.detachEvent(i,o))},ne.Event=function(t,e){return this instanceof ne.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&(t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault())?d:u):this.type=t,e&&ne.extend(this,e),this.timeStamp=t&&t.timeStamp||ne.now(),void(this[ne.expando]=!0)):new ne.Event(t,e)},ne.Event.prototype={isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=d,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=d,t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d,this.stopPropagation()}},ne.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){ne.event.special[t]={delegateType:e,bindType:e,handle:function(t){var o,i=this,r=t.relatedTarget,n=t.handleObj;return(!r||r!==i&&!ne.contains(i,r))&&(t.type=n.origType,o=n.handler.apply(this,arguments),t.type=e),o}}}),ie.submitBubbles||(ne.event.special.submit={setup:function(){return ne.nodeName(this,"form")?!1:void ne.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,o=ne.nodeName(e,"input")||ne.nodeName(e,"button")?e.form:void 0;o&&!ne._data(o,"submitBubbles")&&(ne.event.add(o,"submit._submit",function(t){t._submit_bubble=!0}),ne._data(o,"submitBubbles",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&ne.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){return ne.nodeName(this,"form")?!1:void ne.event.remove(this,"._submit")}}),ie.changeBubbles||(ne.event.special.change={setup:function(){return De.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ne.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),ne.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),ne.event.simulate("change",this,t,!0)})),!1):void ne.event.add(this,"beforeactivate._change",function(t){var e=t.target;De.test(e.nodeName)&&!ne._data(e,"changeBubbles")&&(ne.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||ne.event.simulate("change",this.parentNode,t,!0)}),ne._data(e,"changeBubbles",!0))})},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ne.event.remove(this,"._change"),!De.test(this.nodeName)}}),ie.focusinBubbles||ne.each({focus:"focusin",blur:"focusout"},function(t,e){var o=function(t){ne.event.simulate(e,t.target,ne.event.fix(t),!0)};ne.event.special[e]={setup:function(){var i=this.ownerDocument||this,r=ne._data(i,e);r||i.addEventListener(t,o,!0),ne._data(i,e,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this,r=ne._data(i,e)-1;r?ne._data(i,e,r):(i.removeEventListener(t,o,!0),ne._removeData(i,e))}}}),ne.fn.extend({on:function(t,e,o,i,r){var n,s;if("object"==typeof t){"string"!=typeof e&&(o=o||e,e=void 0);for(n in t)this.on(n,e,o,t[n],r);return this}if(null==o&&null==i?(i=e,o=e=void 0):null==i&&("string"==typeof e?(i=o,o=void 0):(i=o,o=e,e=void 0)),i===!1)i=u;else if(!i)return this;return 1===r&&(s=i,i=function(t){return ne().off(t),s.apply(this,arguments)},i.guid=s.guid||(s.guid=ne.guid++)),this.each(function(){ne.event.add(this,t,i,o,e)})},one:function(t,e,o,i){return this.on(t,e,o,i,1)},off:function(t,e,o){var i,r;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,ne(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return(e===!1||"function"==typeof e)&&(o=e,e=void 0),o===!1&&(o=u),this.each(function(){ne.event.remove(this,t,o,e)})},trigger:function(t,e){return this.each(function(){ne.event.trigger(t,e,this)})},triggerHandler:function(t,e){var o=this[0];return o?ne.event.trigger(t,e,o,!0):void 0}});var Oe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ze=/ jQuery\d+="(?:null|\d+)"/g,je=new RegExp("<(?:"+Oe+")[\\s/>]","i"),He=/^\s+/,We=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,_e=/<([\w:]+)/,Ve=/<tbody/i,Ue=/<|&#?\w+;/,Ge=/<(?:script|style|link)/i,qe=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/^$|\/(?:java|ecma)script/i,$e=/^true\/(.*)/,Ke=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ye={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ie.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Je=g(ge),Qe=Je.appendChild(ge.createElement("div"));Ye.optgroup=Ye.option,Ye.tbody=Ye.tfoot=Ye.colgroup=Ye.caption=Ye.thead,Ye.th=Ye.td,ne.extend({clone:function(t,e,o){var i,r,n,s,a,h=ne.contains(t.ownerDocument,t);if(ie.html5Clone||ne.isXMLDoc(t)||!je.test("<"+t.nodeName+">")?n=t.cloneNode(!0):(Qe.innerHTML=t.outerHTML,Qe.removeChild(n=Qe.firstChild)),!(ie.noCloneEvent&&ie.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||ne.isXMLDoc(t)))for(i=m(n),a=m(t),s=0;null!=(r=a[s]);++s)i[s]&&v(r,i[s]);if(e)if(o)for(a=a||m(t),i=i||m(n),s=0;null!=(r=a[s]);s++)C(r,i[s]);else C(t,n);return i=m(n,"script"),i.length>0&&S(i,!h&&m(t,"script")),i=a=r=null,n},buildFragment:function(t,e,o,i){for(var r,n,s,a,h,l,p,c=t.length,d=g(e),u=[],f=0;c>f;f++)if(n=t[f],n||0===n)if("object"===ne.type(n))ne.merge(u,n.nodeType?[n]:n);else if(Ue.test(n)){for(a=a||d.appendChild(e.createElement("div")),h=(_e.exec(n)||["",""])[1].toLowerCase(),p=Ye[h]||Ye._default,a.innerHTML=p[1]+n.replace(We,"<$1></$2>")+p[2],r=p[0];r--;)a=a.lastChild;if(!ie.leadingWhitespace&&He.test(n)&&u.push(e.createTextNode(He.exec(n)[0])),!ie.tbody)for(n="table"!==h||Ve.test(n)?"<table>"!==p[1]||Ve.test(n)?0:a:a.firstChild,r=n&&n.childNodes.length;r--;)ne.nodeName(l=n.childNodes[r],"tbody")&&!l.childNodes.length&&n.removeChild(l);for(ne.merge(u,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=d.lastChild}else u.push(e.createTextNode(n));for(a&&d.removeChild(a),ie.appendChecked||ne.grep(m(u,"input"),y),f=0;n=u[f++];)if((!i||-1===ne.inArray(n,i))&&(s=ne.contains(n.ownerDocument,n),a=m(d.appendChild(n),"script"),s&&S(a),o))for(r=0;n=a[r++];)Xe.test(n.type||"")&&o.push(n);return a=null,d},cleanData:function(t,e){for(var o,i,r,n,s=0,a=ne.expando,h=ne.cache,l=ie.deleteExpando,p=ne.event.special;null!=(o=t[s]);s++)if((e||ne.acceptData(o))&&(r=o[a],n=r&&h[r])){if(n.events)for(i in n.events)p[i]?ne.event.remove(o,i):ne.removeEvent(o,i,n.handle);h[r]&&(delete h[r],l?delete o[a]:typeof o.removeAttribute!==xe?o.removeAttribute(a):o[a]=null,$.push(r))}}}),ne.fn.extend({text:function(t){return Ee(this,function(t){return void 0===t?ne.text(this):this.empty().append((this[0]&&this[0].ownerDocument||ge).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=M(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=M(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var o,i=t?ne.filter(t,this):this,r=0;null!=(o=i[r]);r++)e||1!==o.nodeType||ne.cleanData(m(o)),o.parentNode&&(e&&ne.contains(o.ownerDocument,o)&&S(m(o,"script")),o.parentNode.removeChild(o));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&ne.cleanData(m(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&ne.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return ne.clone(this,t,e)})},html:function(t){return Ee(this,function(t){var e=this[0]||{},o=0,i=this.length;if(void 0===t)return 1===e.nodeType?e.innerHTML.replace(ze,""):void 0;if(!("string"!=typeof t||Ge.test(t)||!ie.htmlSerialize&&je.test(t)||!ie.leadingWhitespace&&He.test(t)||Ye[(_e.exec(t)||["",""])[1].toLowerCase()])){t=t.replace(We,"<$1></$2>");try{for(;i>o;o++)e=this[o]||{},1===e.nodeType&&(ne.cleanData(m(e,!1)),e.innerHTML=t);e=0}catch(r){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,ne.cleanData(m(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=Y.apply([],t);var o,i,r,n,s,a,h=0,l=this.length,p=this,c=l-1,d=t[0],u=ne.isFunction(d);if(u||l>1&&"string"==typeof d&&!ie.checkClone&&qe.test(d))return this.each(function(o){var i=p.eq(o);u&&(t[0]=d.call(this,o,i.html())),i.domManip(t,e)});if(l&&(a=ne.buildFragment(t,this[0].ownerDocument,!1,this),o=a.firstChild,1===a.childNodes.length&&(a=o),o)){for(n=ne.map(m(a,"script"),b),r=n.length;l>h;h++)i=a,h!==c&&(i=ne.clone(i,!0,!0),r&&ne.merge(n,m(i,"script"))),e.call(this[h],i,h);if(r)for(s=n[n.length-1].ownerDocument,ne.map(n,w),h=0;r>h;h++)i=n[h],Xe.test(i.type||"")&&!ne._data(i,"globalEval")&&ne.contains(s,i)&&(i.src?ne._evalUrl&&ne._evalUrl(i.src):ne.globalEval((i.text||i.textContent||i.innerHTML||"").replace(Ke,"")));a=o=null}return this}}),ne.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){ne.fn[t]=function(t){for(var o,i=0,r=[],n=ne(t),s=n.length-1;s>=i;i++)o=i===s?this:this.clone(!0),ne(n[i])[e](o),J.apply(r,o.get());return this.pushStack(r)}});var Ze,to={};!function(){var t,e,o=ge.createElement("div"),i="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";o.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=o.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",ie.opacity=/^0.5/.test(t.style.opacity),ie.cssFloat=!!t.style.cssFloat,o.style.backgroundClip="content-box",o.cloneNode(!0).style.backgroundClip="",ie.clearCloneStyle="content-box"===o.style.backgroundClip,t=o=null,ie.shrinkWrapBlocks=function(){var t,o,r,n;if(null==e){if(t=ge.getElementsByTagName("body")[0],!t)return;n="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",o=ge.createElement("div"),r=ge.createElement("div"),t.appendChild(o).appendChild(r),e=!1,typeof r.style.zoom!==xe&&(r.style.cssText=i+";width:1px;padding:1px;zoom:1",r.innerHTML="<div></div>",r.firstChild.style.width="5px",e=3!==r.offsetWidth),t.removeChild(o),t=o=r=null}return e}}();var eo,oo,io=/^margin/,ro=new RegExp("^("+Pe+")(?!px)[a-z%]+$","i"),no=/^(top|right|bottom|left)$/;t.getComputedStyle?(eo=function(t){return t.ownerDocument.defaultView.getComputedStyle(t,null)},oo=function(t,e,o){var i,r,n,s,a=t.style;return o=o||eo(t),s=o?o.getPropertyValue(e)||o[e]:void 0,o&&(""!==s||ne.contains(t.ownerDocument,t)||(s=ne.style(t,e)),ro.test(s)&&io.test(e)&&(i=a.width,r=a.minWidth,n=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=o.width,a.width=i,a.minWidth=r,a.maxWidth=n)),void 0===s?s:s+""}):ge.documentElement.currentStyle&&(eo=function(t){return t.currentStyle},oo=function(t,e,o){var i,r,n,s,a=t.style;return o=o||eo(t),s=o?o[e]:void 0,null==s&&a&&a[e]&&(s=a[e]),ro.test(s)&&!no.test(e)&&(i=a.left,r=t.runtimeStyle,n=r&&r.left,n&&(r.left=t.currentStyle.left),a.left="fontSize"===e?"1em":s,s=a.pixelLeft+"px",a.left=i,n&&(r.left=n)),void 0===s?s:s+""||"auto"}),function(){function e(){var e,o,i=ge.getElementsByTagName("body")[0];i&&(e=ge.createElement("div"),o=ge.createElement("div"),e.style.cssText=l,i.appendChild(e).appendChild(o),o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",ne.swap(i,null!=i.style.zoom?{zoom:1}:{},function(){r=4===o.offsetWidth}),n=!0,s=!1,a=!0,t.getComputedStyle&&(s="1%"!==(t.getComputedStyle(o,null)||{}).top,n="4px"===(t.getComputedStyle(o,null)||{width:"4px"}).width),i.removeChild(e),o=i=null)}var o,i,r,n,s,a,h=ge.createElement("div"),l="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",p="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",o=h.getElementsByTagName("a")[0],o.style.cssText="float:left;opacity:.5",ie.opacity=/^0.5/.test(o.style.opacity),ie.cssFloat=!!o.style.cssFloat,h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",ie.clearCloneStyle="content-box"===h.style.backgroundClip,o=h=null,ne.extend(ie,{reliableHiddenOffsets:function(){if(null!=i)return i;var t,e,o,r=ge.createElement("div"),n=ge.getElementsByTagName("body")[0];if(n)return r.setAttribute("className","t"),r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=ge.createElement("div"),t.style.cssText=l,n.appendChild(t).appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=r.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",o=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",i=o&&0===e[0].offsetHeight,n.removeChild(t),r=n=null,i},boxSizing:function(){return null==r&&e(),r},boxSizingReliable:function(){return null==n&&e(),n},pixelPosition:function(){return null==s&&e(),s},reliableMarginRight:function(){var e,o,i,r;if(null==a&&t.getComputedStyle){if(e=ge.getElementsByTagName("body")[0],!e)return;o=ge.createElement("div"),i=ge.createElement("div"),o.style.cssText=l,e.appendChild(o).appendChild(i),r=i.appendChild(ge.createElement("div")),r.style.cssText=i.style.cssText=p,r.style.marginRight=r.style.width="0",i.style.width="1px",a=!parseFloat((t.getComputedStyle(r,null)||{}).marginRight),e.removeChild(o)}return a}})}(),ne.swap=function(t,e,o,i){var r,n,s={};for(n in e)s[n]=t.style[n],t.style[n]=e[n];r=o.apply(t,i||[]);for(n in e)t.style[n]=s[n];return r};var so=/alpha\([^)]*\)/i,ao=/opacity\s*=\s*([^)]*)/,ho=/^(none|table(?!-c[ea]).+)/,lo=new RegExp("^("+Pe+")(.*)$","i"),po=new RegExp("^([+-])=("+Pe+")","i"),co={position:"absolute",visibility:"hidden",display:"block"},uo={letterSpacing:0,fontWeight:400},fo=["Webkit","O","Moz","ms"];ne.extend({cssHooks:{opacity:{get:function(t,e){if(e){var o=oo(t,"opacity");return""===o?"1":o}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ie.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,o,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,n,s,a=ne.camelCase(e),h=t.style;if(e=ne.cssProps[a]||(ne.cssProps[a]=P(h,a)),s=ne.cssHooks[e]||ne.cssHooks[a],void 0===o)return s&&"get"in s&&void 0!==(r=s.get(t,!1,i))?r:h[e];if(n=typeof o,"string"===n&&(r=po.exec(o))&&(o=(r[1]+1)*r[2]+parseFloat(ne.css(t,e)),n="number"),null!=o&&o===o&&("number"!==n||ne.cssNumber[a]||(o+="px"),ie.clearCloneStyle||""!==o||0!==e.indexOf("background")||(h[e]="inherit"),!(s&&"set"in s&&void 0===(o=s.set(t,o,i)))))try{h[e]="",h[e]=o}catch(l){}}},css:function(t,e,o,i){var r,n,s,a=ne.camelCase(e);return e=ne.cssProps[a]||(ne.cssProps[a]=P(t.style,a)),s=ne.cssHooks[e]||ne.cssHooks[a],s&&"get"in s&&(n=s.get(t,!0,o)),void 0===n&&(n=oo(t,e,i)),"normal"===n&&e in uo&&(n=uo[e]),""===o||o?(r=parseFloat(n),o===!0||ne.isNumeric(r)?r||0:n):n}}),ne.each(["height","width"],function(t,e){ne.cssHooks[e]={get:function(t,o,i){return o?0===t.offsetWidth&&ho.test(ne.css(t,"display"))?ne.swap(t,co,function(){return L(t,e,i)}):L(t,e,i):void 0},set:function(t,o,i){var r=i&&eo(t);return I(t,o,i?E(t,e,i,ie.boxSizing()&&"border-box"===ne.css(t,"boxSizing",!1,r),r):0)}}}),ie.opacity||(ne.cssHooks.opacity={get:function(t,e){return ao.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var o=t.style,i=t.currentStyle,r=ne.isNumeric(e)?"alpha(opacity="+100*e+")":"",n=i&&i.filter||o.filter||"";o.zoom=1,(e>=1||""===e)&&""===ne.trim(n.replace(so,""))&&o.removeAttribute&&(o.removeAttribute("filter"),""===e||i&&!i.filter)||(o.filter=so.test(n)?n.replace(so,r):n+" "+r)}}),ne.cssHooks.marginRight=B(ie.reliableMarginRight,function(t,e){return e?ne.swap(t,{display:"inline-block"},oo,[t,"marginRight"]):void 0}),ne.each({margin:"",padding:"",border:"Width"},function(t,e){ne.cssHooks[t+e]={expand:function(o){for(var i=0,r={},n="string"==typeof o?o.split(" "):[o];4>i;i++)r[t+Te[i]+e]=n[i]||n[i-2]||n[0];return r}},io.test(t)||(ne.cssHooks[t+e].set=I)}),ne.fn.extend({css:function(t,e){return Ee(this,function(t,e,o){var i,r,n={},s=0;if(ne.isArray(e)){for(i=eo(t),r=e.length;r>s;s++)n[e[s]]=ne.css(t,e[s],!1,i);return n}return void 0!==o?ne.style(t,e,o):ne.css(t,e)},t,e,arguments.length>1)},show:function(){return T(this,!0)},hide:function(){return T(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Ie(this)?ne(this).show():ne(this).hide()})}}),ne.Tween=D,D.prototype={constructor:D,init:function(t,e,o,i,r,n){this.elem=t,this.prop=o,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=n||(ne.cssNumber[o]?"":"px")},cur:function(){var t=D.propHooks[this.prop];return t&&t.get?t.get(this):D.propHooks._default.get(this)},run:function(t){var e,o=D.propHooks[this.prop];return this.pos=e=this.options.duration?ne.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),o&&o.set?o.set(this):D.propHooks._default.set(this),this}},D.prototype.init.prototype=D.prototype,D.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=ne.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){ne.fx.step[t.prop]?ne.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[ne.cssProps[t.prop]]||ne.cssHooks[t.prop])?ne.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},D.propHooks.scrollTop=D.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},ne.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},ne.fx=D.prototype.init,ne.fx.step={};var go,mo,yo=/^(?:toggle|show|hide)$/,Mo=new RegExp("^(?:([+-])=|)("+Pe+")([a-z%]*)$","i"),bo=/queueHooks$/,wo=[R],So={"*":[function(t,e){var o=this.createTween(t,e),i=o.cur(),r=Mo.exec(e),n=r&&r[3]||(ne.cssNumber[t]?"":"px"),s=(ne.cssNumber[t]||"px"!==n&&+i)&&Mo.exec(ne.css(o.elem,t)),a=1,h=20;if(s&&s[3]!==n){n=n||s[3],r=r||[],s=+i||1;do a=a||".5",s/=a,ne.style(o.elem,t,s+n);while(a!==(a=o.cur()/i)&&1!==a&&--h)}return r&&(s=o.start=+s||+i||0,o.unit=n,o.end=r[1]?s+(r[1]+1)*r[2]:+r[2]),o}]};ne.Animation=ne.extend(z,{tweener:function(t,e){ne.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var o,i=0,r=t.length;r>i;i++)o=t[i],So[o]=So[o]||[],So[o].unshift(e)},prefilter:function(t,e){e?wo.unshift(t):wo.push(t)}}),ne.speed=function(t,e,o){var i=t&&"object"==typeof t?ne.extend({},t):{complete:o||!o&&e||ne.isFunction(t)&&t,duration:t,easing:o&&e||e&&!ne.isFunction(e)&&e};return i.duration=ne.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in ne.fx.speeds?ne.fx.speeds[i.duration]:ne.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){ne.isFunction(i.old)&&i.old.call(this),i.queue&&ne.dequeue(this,i.queue)},i},ne.fn.extend({fadeTo:function(t,e,o,i){return this.filter(Ie).css("opacity",0).show().end().animate({opacity:e},t,o,i)},animate:function(t,e,o,i){var r=ne.isEmptyObject(t),n=ne.speed(e,o,i),s=function(){var e=z(this,ne.extend({},t),n);(r||ne._data(this,"finish"))&&e.stop(!0)};return s.finish=s,r||n.queue===!1?this.each(s):this.queue(n.queue,s)},stop:function(t,e,o){var i=function(t){var e=t.stop;delete t.stop,e(o)};return"string"!=typeof t&&(o=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",n=ne.timers,s=ne._data(this);if(r)s[r]&&s[r].stop&&i(s[r]);else for(r in s)s[r]&&s[r].stop&&bo.test(r)&&i(s[r]);for(r=n.length;r--;)n[r].elem!==this||null!=t&&n[r].queue!==t||(n[r].anim.stop(o),e=!1,n.splice(r,1));(e||!o)&&ne.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,o=ne._data(this),i=o[t+"queue"],r=o[t+"queueHooks"],n=ne.timers,s=i?i.length:0;for(o.finish=!0,ne.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=n.length;e--;)n[e].elem===this&&n[e].queue===t&&(n[e].anim.stop(!0),n.splice(e,1));for(e=0;s>e;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete o.finish})}}),ne.each(["toggle","show","hide"],function(t,e){var o=ne.fn[e];ne.fn[e]=function(t,i,r){return null==t||"boolean"==typeof t?o.apply(this,arguments):this.animate(A(e,!0),t,i,r)}}),ne.each({slideDown:A("show"),slideUp:A("hide"),slideToggle:A("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){ne.fn[t]=function(t,o,i){return this.animate(e,t,o,i)}}),ne.timers=[],ne.fx.tick=function(){var t,e=ne.timers,o=0;for(go=ne.now();o<e.length;o++)t=e[o],t()||e[o]!==t||e.splice(o--,1);e.length||ne.fx.stop(),go=void 0},ne.fx.timer=function(t){ne.timers.push(t),t()?ne.fx.start():ne.timers.pop()},ne.fx.interval=13,ne.fx.start=function(){mo||(mo=setInterval(ne.fx.tick,ne.fx.interval))},ne.fx.stop=function(){clearInterval(mo),mo=null},ne.fx.speeds={slow:600,fast:200,_default:400},ne.fn.delay=function(t,e){return t=ne.fx?ne.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,o){var i=setTimeout(e,t);o.stop=function(){clearTimeout(i)}})},function(){var t,e,o,i,r=ge.createElement("div");r.setAttribute("className","t"),r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=r.getElementsByTagName("a")[0],o=ge.createElement("select"),i=o.appendChild(ge.createElement("option")),e=r.getElementsByTagName("input")[0],t.style.cssText="top:1px",ie.getSetAttribute="t"!==r.className,ie.style=/top/.test(t.getAttribute("style")),ie.hrefNormalized="/a"===t.getAttribute("href"),ie.checkOn=!!e.value,ie.optSelected=i.selected,ie.enctype=!!ge.createElement("form").enctype,o.disabled=!0,ie.optDisabled=!i.disabled,e=ge.createElement("input"),e.setAttribute("value",""),ie.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ie.radioValue="t"===e.value,t=e=o=i=r=null}();var Co=/\r/g;ne.fn.extend({val:function(t){var e,o,i,r=this[0];{if(arguments.length)return i=ne.isFunction(t),this.each(function(o){var r;1===this.nodeType&&(r=i?t.call(this,o,ne(this).val()):t,null==r?r="":"number"==typeof r?r+="":ne.isArray(r)&&(r=ne.map(r,function(t){return null==t?"":t+""})),e=ne.valHooks[this.type]||ne.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))});if(r)return e=ne.valHooks[r.type]||ne.valHooks[r.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(o=e.get(r,"value"))?o:(o=r.value,"string"==typeof o?o.replace(Co,""):null==o?"":o)}}}),ne.extend({valHooks:{option:{get:function(t){var e=ne.find.attr(t,"value");return null!=e?e:ne.text(t)}},select:{get:function(t){for(var e,o,i=t.options,r=t.selectedIndex,n="select-one"===t.type||0>r,s=n?null:[],a=n?r+1:i.length,h=0>r?a:n?r:0;a>h;h++)if(o=i[h],!(!o.selected&&h!==r||(ie.optDisabled?o.disabled:null!==o.getAttribute("disabled"))||o.parentNode.disabled&&ne.nodeName(o.parentNode,"optgroup"))){if(e=ne(o).val(),n)return e;s.push(e)}return s},set:function(t,e){for(var o,i,r=t.options,n=ne.makeArray(e),s=r.length;s--;)if(i=r[s],ne.inArray(ne.valHooks.option.get(i),n)>=0)try{i.selected=o=!0}catch(a){i.scrollHeight}else i.selected=!1;return o||(t.selectedIndex=-1),r}}}}),ne.each(["radio","checkbox"],function(){ne.valHooks[this]={set:function(t,e){return ne.isArray(e)?t.checked=ne.inArray(ne(t).val(),e)>=0:void 0}},ie.checkOn||(ne.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var vo,xo,ko=ne.expr.attrHandle,Bo=/^(?:checked|selected)$/i,Po=ie.getSetAttribute,To=ie.input;ne.fn.extend({attr:function(t,e){return Ee(this,ne.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){ne.removeAttr(this,t)})}}),ne.extend({attr:function(t,e,o){var i,r,n=t.nodeType;if(t&&3!==n&&8!==n&&2!==n)return typeof t.getAttribute===xe?ne.prop(t,e,o):(1===n&&ne.isXMLDoc(t)||(e=e.toLowerCase(),i=ne.attrHooks[e]||(ne.expr.match.bool.test(e)?xo:vo)),void 0===o?i&&"get"in i&&null!==(r=i.get(t,e))?r:(r=ne.find.attr(t,e),null==r?void 0:r):null!==o?i&&"set"in i&&void 0!==(r=i.set(t,o,e))?r:(t.setAttribute(e,o+""),o):void ne.removeAttr(t,e))},removeAttr:function(t,e){var o,i,r=0,n=e&&e.match(we);if(n&&1===t.nodeType)for(;o=n[r++];)i=ne.propFix[o]||o,ne.expr.match.bool.test(o)?To&&Po||!Bo.test(o)?t[i]=!1:t[ne.camelCase("default-"+o)]=t[i]=!1:ne.attr(t,o,""),t.removeAttribute(Po?o:i)},attrHooks:{type:{set:function(t,e){if(!ie.radioValue&&"radio"===e&&ne.nodeName(t,"input")){var o=t.value;return t.setAttribute("type",e),o&&(t.value=o),e}}}}}),xo={set:function(t,e,o){return e===!1?ne.removeAttr(t,o):To&&Po||!Bo.test(o)?t.setAttribute(!Po&&ne.propFix[o]||o,o):t[ne.camelCase("default-"+o)]=t[o]=!0,o}},ne.each(ne.expr.match.bool.source.match(/\w+/g),function(t,e){var o=ko[e]||ne.find.attr;ko[e]=To&&Po||!Bo.test(e)?function(t,e,i){var r,n;return i||(n=ko[e],ko[e]=r,r=null!=o(t,e,i)?e.toLowerCase():null,ko[e]=n),r}:function(t,e,o){return o?void 0:t[ne.camelCase("default-"+e)]?e.toLowerCase():null}}),To&&Po||(ne.attrHooks.value={set:function(t,e,o){return ne.nodeName(t,"input")?void(t.defaultValue=e):vo&&vo.set(t,e,o)}}),Po||(vo={set:function(t,e,o){var i=t.getAttributeNode(o);return i||t.setAttributeNode(i=t.ownerDocument.createAttribute(o)),i.value=e+="","value"===o||e===t.getAttribute(o)?e:void 0}},ko.id=ko.name=ko.coords=function(t,e,o){var i;return o?void 0:(i=t.getAttributeNode(e))&&""!==i.value?i.value:null},ne.valHooks.button={get:function(t,e){var o=t.getAttributeNode(e);return o&&o.specified?o.value:void 0},set:vo.set},ne.attrHooks.contenteditable={set:function(t,e,o){vo.set(t,""===e?!1:e,o)}},ne.each(["width","height"],function(t,e){ne.attrHooks[e]={set:function(t,o){return""===o?(t.setAttribute(e,"auto"),o):void 0}}})),ie.style||(ne.attrHooks.style={get:function(t){return t.style.cssText||void 0},set:function(t,e){return t.style.cssText=e+""}});var Io=/^(?:input|select|textarea|button|object)$/i,Eo=/^(?:a|area)$/i;ne.fn.extend({prop:function(t,e){return Ee(this,ne.prop,t,e,arguments.length>1)},removeProp:function(t){return t=ne.propFix[t]||t,this.each(function(){try{this[t]=void 0,delete this[t]}catch(e){}})}}),ne.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,o){var i,r,n,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return n=1!==s||!ne.isXMLDoc(t),n&&(e=ne.propFix[e]||e,r=ne.propHooks[e]),void 0!==o?r&&"set"in r&&void 0!==(i=r.set(t,o,e))?i:t[e]=o:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=ne.find.attr(t,"tabindex");return e?parseInt(e,10):Io.test(t.nodeName)||Eo.test(t.nodeName)&&t.href?0:-1}}}}),ie.hrefNormalized||ne.each(["href","src"],function(t,e){ne.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),ie.optSelected||(ne.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}}),ne.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ne.propFix[this.toLowerCase()]=this}),ie.enctype||(ne.propFix.enctype="encoding");var Lo=/[\t\r\n\f]/g;ne.fn.extend({addClass:function(t){var e,o,i,r,n,s,a=0,h=this.length,l="string"==typeof t&&t;if(ne.isFunction(t))return this.each(function(e){ne(this).addClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(we)||[];h>a;a++)if(o=this[a],i=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(Lo," "):" ")){for(n=0;r=e[n++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");s=ne.trim(i),o.className!==s&&(o.className=s)}return this},removeClass:function(t){var e,o,i,r,n,s,a=0,h=this.length,l=0===arguments.length||"string"==typeof t&&t;if(ne.isFunction(t))return this.each(function(e){ne(this).removeClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(we)||[];h>a;a++)if(o=this[a],i=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(Lo," "):"")){for(n=0;r=e[n++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");s=t?ne.trim(i):"",o.className!==s&&(o.className=s)}return this},toggleClass:function(t,e){var o=typeof t;return"boolean"==typeof e&&"string"===o?e?this.addClass(t):this.removeClass(t):this.each(ne.isFunction(t)?function(o){ne(this).toggleClass(t.call(this,o,this.className,e),e)}:function(){if("string"===o)for(var e,i=0,r=ne(this),n=t.match(we)||[];e=n[i++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else(o===xe||"boolean"===o)&&(this.className&&ne._data(this,"__className__",this.className),this.className=this.className||t===!1?"":ne._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",o=0,i=this.length;i>o;o++)if(1===this[o].nodeType&&(" "+this[o].className+" ").replace(Lo," ").indexOf(e)>=0)return!0;return!1}}),ne.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){ne.fn[e]=function(t,o){return arguments.length>0?this.on(e,null,t,o):this.trigger(e)}}),ne.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,o){return this.on(t,null,e,o)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,o,i){return this.on(e,t,o,i)},undelegate:function(t,e,o){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",o)}});var Do=ne.now(),Fo=/\?/,Ao=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;ne.parseJSON=function(e){if(t.JSON&&t.JSON.parse)return t.JSON.parse(e+"");var o,i=null,r=ne.trim(e+"");return r&&!ne.trim(r.replace(Ao,function(t,e,r,n){return o&&e&&(i=0),0===i?t:(o=r||e,i+=!n-!r,"")
}))?Function("return "+r)():ne.error("Invalid JSON: "+e)},ne.parseXML=function(e){var o,i;if(!e||"string"!=typeof e)return null;try{t.DOMParser?(i=new DOMParser,o=i.parseFromString(e,"text/xml")):(o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(e))}catch(r){o=void 0}return o&&o.documentElement&&!o.getElementsByTagName("parsererror").length||ne.error("Invalid XML: "+e),o};var No,Ro,Oo=/#.*$/,zo=/([?&])_=[^&]*/,jo=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ho=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Wo=/^(?:GET|HEAD)$/,_o=/^\/\//,Vo=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Uo={},Go={},qo="*/".concat("*");try{Ro=location.href}catch(Xo){Ro=ge.createElement("a"),Ro.href="",Ro=Ro.href}No=Vo.exec(Ro.toLowerCase())||[],ne.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ro,type:"GET",isLocal:Ho.test(No[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qo,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ne.parseJSON,"text xml":ne.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?W(W(t,ne.ajaxSettings),e):W(ne.ajaxSettings,t)},ajaxPrefilter:j(Uo),ajaxTransport:j(Go),ajax:function(t,e){function o(t,e,o,i){var r,p,y,M,w,C=e;2!==b&&(b=2,a&&clearTimeout(a),l=void 0,s=i||"",S.readyState=t>0?4:0,r=t>=200&&300>t||304===t,o&&(M=_(c,S,o)),M=V(c,M,S,r),r?(c.ifModified&&(w=S.getResponseHeader("Last-Modified"),w&&(ne.lastModified[n]=w),w=S.getResponseHeader("etag"),w&&(ne.etag[n]=w)),204===t||"HEAD"===c.type?C="nocontent":304===t?C="notmodified":(C=M.state,p=M.data,y=M.error,r=!y)):(y=C,(t||!C)&&(C="error",0>t&&(t=0))),S.status=t,S.statusText=(e||C)+"",r?f.resolveWith(d,[p,C,S]):f.rejectWith(d,[S,C,y]),S.statusCode(m),m=void 0,h&&u.trigger(r?"ajaxSuccess":"ajaxError",[S,c,r?p:y]),g.fireWith(d,[S,C]),h&&(u.trigger("ajaxComplete",[S,c]),--ne.active||ne.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var i,r,n,s,a,h,l,p,c=ne.ajaxSetup({},e),d=c.context||c,u=c.context&&(d.nodeType||d.jquery)?ne(d):ne.event,f=ne.Deferred(),g=ne.Callbacks("once memory"),m=c.statusCode||{},y={},M={},b=0,w="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(2===b){if(!p)for(p={};e=jo.exec(s);)p[e[1].toLowerCase()]=e[2];e=p[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(t,e){var o=t.toLowerCase();return b||(t=M[o]=M[o]||t,y[t]=e),this},overrideMimeType:function(t){return b||(c.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>b)for(e in t)m[e]=[m[e],t[e]];else S.always(t[S.status]);return this},abort:function(t){var e=t||w;return l&&l.abort(e),o(0,e),this}};if(f.promise(S).complete=g.add,S.success=S.done,S.error=S.fail,c.url=((t||c.url||Ro)+"").replace(Oo,"").replace(_o,No[1]+"//"),c.type=e.method||e.type||c.method||c.type,c.dataTypes=ne.trim(c.dataType||"*").toLowerCase().match(we)||[""],null==c.crossDomain&&(i=Vo.exec(c.url.toLowerCase()),c.crossDomain=!(!i||i[1]===No[1]&&i[2]===No[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(No[3]||("http:"===No[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=ne.param(c.data,c.traditional)),H(Uo,c,e,S),2===b)return S;h=c.global,h&&0===ne.active++&&ne.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Wo.test(c.type),n=c.url,c.hasContent||(c.data&&(n=c.url+=(Fo.test(n)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=zo.test(n)?n.replace(zo,"$1_="+Do++):n+(Fo.test(n)?"&":"?")+"_="+Do++)),c.ifModified&&(ne.lastModified[n]&&S.setRequestHeader("If-Modified-Since",ne.lastModified[n]),ne.etag[n]&&S.setRequestHeader("If-None-Match",ne.etag[n])),(c.data&&c.hasContent&&c.contentType!==!1||e.contentType)&&S.setRequestHeader("Content-Type",c.contentType),S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+qo+"; q=0.01":""):c.accepts["*"]);for(r in c.headers)S.setRequestHeader(r,c.headers[r]);if(c.beforeSend&&(c.beforeSend.call(d,S,c)===!1||2===b))return S.abort();w="abort";for(r in{success:1,error:1,complete:1})S[r](c[r]);if(l=H(Go,c,e,S)){S.readyState=1,h&&u.trigger("ajaxSend",[S,c]),c.async&&c.timeout>0&&(a=setTimeout(function(){S.abort("timeout")},c.timeout));try{b=1,l.send(y,o)}catch(C){if(!(2>b))throw C;o(-1,C)}}else o(-1,"No Transport");return S},getJSON:function(t,e,o){return ne.get(t,e,o,"json")},getScript:function(t,e){return ne.get(t,void 0,e,"script")}}),ne.each(["get","post"],function(t,e){ne[e]=function(t,o,i,r){return ne.isFunction(o)&&(r=r||i,i=o,o=void 0),ne.ajax({url:t,type:e,dataType:r,data:o,success:i})}}),ne.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){ne.fn[e]=function(t){return this.on(e,t)}}),ne._evalUrl=function(t){return ne.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ne.fn.extend({wrapAll:function(t){if(ne.isFunction(t))return this.each(function(e){ne(this).wrapAll(t.call(this,e))});if(this[0]){var e=ne(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(ne.isFunction(t)?function(e){ne(this).wrapInner(t.call(this,e))}:function(){var e=ne(this),o=e.contents();o.length?o.wrapAll(t):e.append(t)})},wrap:function(t){var e=ne.isFunction(t);return this.each(function(o){ne(this).wrapAll(e?t.call(this,o):t)})},unwrap:function(){return this.parent().each(function(){ne.nodeName(this,"body")||ne(this).replaceWith(this.childNodes)}).end()}}),ne.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0||!ie.reliableHiddenOffsets()&&"none"===(t.style&&t.style.display||ne.css(t,"display"))},ne.expr.filters.visible=function(t){return!ne.expr.filters.hidden(t)};var $o=/%20/g,Ko=/\[\]$/,Yo=/\r?\n/g,Jo=/^(?:submit|button|image|reset|file)$/i,Qo=/^(?:input|select|textarea|keygen)/i;ne.param=function(t,e){var o,i=[],r=function(t,e){e=ne.isFunction(e)?e():null==e?"":e,i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=ne.ajaxSettings&&ne.ajaxSettings.traditional),ne.isArray(t)||t.jquery&&!ne.isPlainObject(t))ne.each(t,function(){r(this.name,this.value)});else for(o in t)U(o,t[o],e,r);return i.join("&").replace($o,"+")},ne.fn.extend({serialize:function(){return ne.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=ne.prop(this,"elements");return t?ne.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!ne(this).is(":disabled")&&Qo.test(this.nodeName)&&!Jo.test(t)&&(this.checked||!Le.test(t))}).map(function(t,e){var o=ne(this).val();return null==o?null:ne.isArray(o)?ne.map(o,function(t){return{name:e.name,value:t.replace(Yo,"\r\n")}}):{name:e.name,value:o.replace(Yo,"\r\n")}}).get()}}),ne.ajaxSettings.xhr=void 0!==t.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&G()||q()}:G;var Zo=0,ti={},ei=ne.ajaxSettings.xhr();t.ActiveXObject&&ne(t).on("unload",function(){for(var t in ti)ti[t](void 0,!0)}),ie.cors=!!ei&&"withCredentials"in ei,ei=ie.ajax=!!ei,ei&&ne.ajaxTransport(function(t){if(!t.crossDomain||ie.cors){var e;return{send:function(o,i){var r,n=t.xhr(),s=++Zo;if(n.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)n[r]=t.xhrFields[r];t.mimeType&&n.overrideMimeType&&n.overrideMimeType(t.mimeType),t.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(r in o)void 0!==o[r]&&n.setRequestHeader(r,o[r]+"");n.send(t.hasContent&&t.data||null),e=function(o,r){var a,h,l;if(e&&(r||4===n.readyState))if(delete ti[s],e=void 0,n.onreadystatechange=ne.noop,r)4!==n.readyState&&n.abort();else{l={},a=n.status,"string"==typeof n.responseText&&(l.text=n.responseText);try{h=n.statusText}catch(p){h=""}a||!t.isLocal||t.crossDomain?1223===a&&(a=204):a=l.text?200:404}l&&i(a,h,l,n.getAllResponseHeaders())},t.async?4===n.readyState?setTimeout(e):n.onreadystatechange=ti[s]=e:e()},abort:function(){e&&e(void 0,!0)}}}}),ne.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return ne.globalEval(t),t}}}),ne.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),ne.ajaxTransport("script",function(t){if(t.crossDomain){var e,o=ge.head||ne("head")[0]||ge.documentElement;return{send:function(i,r){e=ge.createElement("script"),e.async=!0,t.scriptCharset&&(e.charset=t.scriptCharset),e.src=t.url,e.onload=e.onreadystatechange=function(t,o){(o||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),e=null,o||r(200,"success"))},o.insertBefore(e,o.firstChild)},abort:function(){e&&e.onload(void 0,!0)}}}});var oi=[],ii=/(=)\?(?=&|$)|\?\?/;ne.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=oi.pop()||ne.expando+"_"+Do++;return this[t]=!0,t}}),ne.ajaxPrefilter("json jsonp",function(e,o,i){var r,n,s,a=e.jsonp!==!1&&(ii.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&ii.test(e.data)&&"data");return a||"jsonp"===e.dataTypes[0]?(r=e.jsonpCallback=ne.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(ii,"$1"+r):e.jsonp!==!1&&(e.url+=(Fo.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||ne.error(r+" was not called"),s[0]},e.dataTypes[0]="json",n=t[r],t[r]=function(){s=arguments},i.always(function(){t[r]=n,e[r]&&(e.jsonpCallback=o.jsonpCallback,oi.push(r)),s&&ne.isFunction(n)&&n(s[0]),s=n=void 0}),"script"):void 0}),ne.parseHTML=function(t,e,o){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(o=e,e=!1),e=e||ge;var i=de.exec(t),r=!o&&[];return i?[e.createElement(i[1])]:(i=ne.buildFragment([t],e,r),r&&r.length&&ne(r).remove(),ne.merge([],i.childNodes))};var ri=ne.fn.load;ne.fn.load=function(t,e,o){if("string"!=typeof t&&ri)return ri.apply(this,arguments);var i,r,n,s=this,a=t.indexOf(" ");return a>=0&&(i=t.slice(a,t.length),t=t.slice(0,a)),ne.isFunction(e)?(o=e,e=void 0):e&&"object"==typeof e&&(n="POST"),s.length>0&&ne.ajax({url:t,type:n,dataType:"html",data:e}).done(function(t){r=arguments,s.html(i?ne("<div>").append(ne.parseHTML(t)).find(i):t)}).complete(o&&function(t,e){s.each(o,r||[t.responseText,e,t])}),this},ne.expr.filters.animated=function(t){return ne.grep(ne.timers,function(e){return t===e.elem}).length};var ni=t.document.documentElement;ne.offset={setOffset:function(t,e,o){var i,r,n,s,a,h,l,p=ne.css(t,"position"),c=ne(t),d={};"static"===p&&(t.style.position="relative"),a=c.offset(),n=ne.css(t,"top"),h=ne.css(t,"left"),l=("absolute"===p||"fixed"===p)&&ne.inArray("auto",[n,h])>-1,l?(i=c.position(),s=i.top,r=i.left):(s=parseFloat(n)||0,r=parseFloat(h)||0),ne.isFunction(e)&&(e=e.call(t,o,a)),null!=e.top&&(d.top=e.top-a.top+s),null!=e.left&&(d.left=e.left-a.left+r),"using"in e?e.using.call(t,d):c.css(d)}},ne.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ne.offset.setOffset(this,t,e)});var e,o,i={top:0,left:0},r=this[0],n=r&&r.ownerDocument;if(n)return e=n.documentElement,ne.contains(e,r)?(typeof r.getBoundingClientRect!==xe&&(i=r.getBoundingClientRect()),o=X(n),{top:i.top+(o.pageYOffset||e.scrollTop)-(e.clientTop||0),left:i.left+(o.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}):i},position:function(){if(this[0]){var t,e,o={top:0,left:0},i=this[0];return"fixed"===ne.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),ne.nodeName(t[0],"html")||(o=t.offset()),o.top+=ne.css(t[0],"borderTopWidth",!0),o.left+=ne.css(t[0],"borderLeftWidth",!0)),{top:e.top-o.top-ne.css(i,"marginTop",!0),left:e.left-o.left-ne.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||ni;t&&!ne.nodeName(t,"html")&&"static"===ne.css(t,"position");)t=t.offsetParent;return t||ni})}}),ne.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var o=/Y/.test(e);ne.fn[t]=function(i){return Ee(this,function(t,i,r){var n=X(t);return void 0===r?n?e in n?n[e]:n.document.documentElement[i]:t[i]:void(n?n.scrollTo(o?ne(n).scrollLeft():r,o?r:ne(n).scrollTop()):t[i]=r)},t,i,arguments.length,null)}}),ne.each(["top","left"],function(t,e){ne.cssHooks[e]=B(ie.pixelPosition,function(t,o){return o?(o=oo(t,e),ro.test(o)?ne(t).position()[e]+"px":o):void 0})}),ne.each({Height:"height",Width:"width"},function(t,e){ne.each({padding:"inner"+t,content:e,"":"outer"+t},function(o,i){ne.fn[i]=function(i,r){var n=arguments.length&&(o||"boolean"!=typeof i),s=o||(i===!0||r===!0?"margin":"border");return Ee(this,function(e,o,i){var r;return ne.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===i?ne.css(e,o,s):ne.style(e,o,i,s)},e,n?i:void 0,n,null)}})}),ne.fn.size=function(){return this.length},ne.fn.andSelf=ne.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ne});var si=t.jQuery,ai=t.$;return ne.noConflict=function(e){return t.$===ne&&(t.$=ai),e&&t.jQuery===ne&&(t.jQuery=si),ne},typeof e===xe&&(t.jQuery=t.$=ne),ne}),function(t,e){t.rails!==e&&t.error("jquery-ujs has already been loaded!");var o,i=t(document);t.rails=o={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",buttonClickSelector:"button[data-remote]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(e){var o=t('meta[name="csrf-token"]').attr("content");o&&e.setRequestHeader("X-CSRF-Token",o)},refreshCSRFTokens:function(){var e=t("meta[name=csrf-token]").attr("content"),o=t("meta[name=csrf-param]").attr("content");t('form input[name="'+o+'"]').val(e)},fire:function(e,o,i){var r=t.Event(o);return e.trigger(r,i),r.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(i){var r,n,s,a,h,l,p,c;if(o.fire(i,"ajax:before")){if(a=i.data("cross-domain"),h=a===e?null:a,l=i.data("with-credentials")||null,p=i.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,i.is("form")){r=i.attr("method"),n=i.attr("action"),s=i.serializeArray();var d=i.data("ujs:submit-button");d&&(s.push(d),i.data("ujs:submit-button",null))}else i.is(o.inputChangeSelector)?(r=i.data("method"),n=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):i.is(o.buttonClickSelector)?(r=i.data("method")||"get",n=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):(r=i.data("method"),n=o.href(i),s=i.data("params")||null);c={type:r||"GET",data:s,dataType:p,beforeSend:function(t,r){return r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),o.fire(i,"ajax:beforeSend",[t,r])},success:function(t,e,o){i.trigger("ajax:success",[t,e,o])},complete:function(t,e){i.trigger("ajax:complete",[t,e])},error:function(t,e,o){i.trigger("ajax:error",[t,e,o])},crossDomain:h},l&&(c.xhrFields={withCredentials:l}),n&&(c.url=n);var u=o.ajax(c);return i.trigger("ajax:send",u),u}return!1},handleMethod:function(i){var r=o.href(i),n=i.data("method"),s=i.attr("target"),a=t("meta[name=csrf-token]").attr("content"),h=t("meta[name=csrf-param]").attr("content"),l=t('<form method="post" action="'+r+'"></form>'),p='<input name="_method" value="'+n+'" type="hidden" />';h!==e&&a!==e&&(p+='<input name="'+h+'" value="'+a+'" type="hidden" />'),s&&l.attr("target",s),l.hide().append(p).appendTo("body"),l.submit()},disableFormElements:function(e){e.find(o.disableSelector).each(function(){var e=t(this),o=e.is("button")?"html":"val";e.data("ujs:enable-with",e[o]()),e[o](e.data("disable-with")),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(o.enableSelector).each(function(){var e=t(this),o=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[o](e.data("ujs:enable-with")),e.prop("disabled",!1)})},allowAction:function(t){var e,i=t.data("confirm"),r=!1;return i?(o.fire(t,"confirm")&&(r=o.confirm(i),e=o.fire(t,"confirm:complete",[r])),r&&e):!0},blankInputs:function(e,o,i){var r,n,s=t(),a=o||"input,textarea",h=e.find(a);return h.each(function(){if(r=t(this),n=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):r.val(),!n==!i){if(r.is("input[type=radio]")&&h.filter('input[type=radio]:checked[name="'+r.attr("name")+'"]').length)return!0;s=s.add(r)}}),s.length?s:!1},nonBlankInputs:function(t,e){return o.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){t.data("ujs:enable-with",t.html()),t.html(t.data("disable-with")),t.bind("click.railsDisable",function(t){return o.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},o.fire(i,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,i){t.crossDomain||o.CSRFProtection(i)}),i.delegate(o.linkDisableSelector,"ajax:complete",function(){o.enableElement(t(this))}),i.delegate(o.linkClickSelector,"click.rails",function(i){var r=t(this),n=r.data("method"),s=r.data("params"),a=i.metaKey||i.ctrlKey;if(!o.allowAction(r))return o.stopEverything(i);if(!a&&r.is(o.linkDisableSelector)&&o.disableElement(r),r.data("remote")!==e){if(a&&(!n||"GET"===n)&&!s)return!0;var h=o.handleRemote(r);return h===!1?o.enableElement(r):h.error(function(){o.enableElement(r)}),!1}return r.data("method")?(o.handleMethod(r),!1):void 0}),i.delegate(o.buttonClickSelector,"click.rails",function(e){var i=t(this);return o.allowAction(i)?(o.handleRemote(i),!1):o.stopEverything(e)}),i.delegate(o.inputChangeSelector,"change.rails",function(e){var i=t(this);return o.allowAction(i)?(o.handleRemote(i),!1):o.stopEverything(e)}),i.delegate(o.formSubmitSelector,"submit.rails",function(i){var r=t(this),n=r.data("remote")!==e,s=o.blankInputs(r,o.requiredInputSelector),a=o.nonBlankInputs(r,o.fileInputSelector);if(!o.allowAction(r))return o.stopEverything(i);if(s&&r.attr("novalidate")==e&&o.fire(r,"ajax:aborted:required",[s]))return o.stopEverything(i);if(n){if(a){setTimeout(function(){o.disableFormElements(r)},13);var h=o.fire(r,"ajax:aborted:file",[a]);return h||setTimeout(function(){o.enableFormElements(r)},13),h}return o.handleRemote(r),!1}setTimeout(function(){o.disableFormElements(r)},13)}),i.delegate(o.formInputClickSelector,"click.rails",function(e){var i=t(this);if(!o.allowAction(i))return o.stopEverything(e);var r=i.attr("name"),n=r?{name:r,value:i.val()}:null;i.closest("form").data("ujs:submit-button",n)}),i.delegate(o.formSubmitSelector,"ajax:beforeSend.rails",function(e){this==e.target&&o.disableFormElements(t(this))}),i.delegate(o.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&o.enableFormElements(t(this))}),t(function(){o.refreshCSRFTokens()}))}(jQuery),function(){var t,e;t=window.jQuery||("function"==typeof require?require("jquery"):void 0),e=t(document),t.turbo={version:"2.0.2",isReady:!1,use:function(t,o){return e.off(".turbo").on(""+t+".turbo",this.onLoad).on(""+o+".turbo",this.onFetch)},addCallback:function(o){return t.turbo.isReady?o(t):e.on("turbo:ready",function(){return o(t)})},onLoad:function(){return t.turbo.isReady=!0,e.trigger("turbo:ready")},onFetch:function(){return t.turbo.isReady=!1},register:function(){return t(this.onLoad),t.fn.ready=this.addCallback}},t.turbo.register(),t.turbo.use("page:load","page:fetch")}.call(this),+function(t){"use strict";var e=function(o,i){this.options=t.extend({},e.DEFAULTS,i),this.$window=t(window).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(o),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};e.RESET="affix affix-top affix-bottom",e.DEFAULTS={offset:0},e.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(e.RESET).addClass("affix");var t=this.$window.scrollTop(),o=this.$element.offset();return this.pinnedOffset=o.top-t},e.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},e.prototype.checkPosition=function(){if(this.$element.is(":visible")){var o=t(document).height(),i=this.$window.scrollTop(),r=this.$element.offset(),n=this.options.offset,s=n.top,a=n.bottom;"object"!=typeof n&&(a=s=n),"function"==typeof s&&(s=n.top(this.$element)),"function"==typeof a&&(a=n.bottom(this.$element));var h=null!=this.unpin&&i+this.unpin<=r.top?!1:null!=a&&r.top+this.$element.height()>=o-a?"bottom":null!=s&&s>=i?"top":!1;if(this.affixed!==h){null!=this.unpin&&this.$element.css("top","");var l="affix"+(h?"-"+h:""),p=t.Event(l+".bs.affix");this.$element.trigger(p),p.isDefaultPrevented()||(this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(e.RESET).addClass(l).trigger(t.Event(l.replace("affix","affixed"))),"bottom"==h&&this.$element.offset({top:r.top}))}}};var o=t.fn.affix;t.fn.affix=function(o){return this.each(function(){var i=t(this),r=i.data("bs.affix"),n="object"==typeof o&&o;r||i.data("bs.affix",r=new e(this,n)),"string"==typeof o&&r[o]()})},t.fn.affix.Constructor=e,t.fn.affix.noConflict=function(){return t.fn.affix=o,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var e=t(this),o=e.data();o.offset=o.offset||{},o.offsetBottom&&(o.offset.bottom=o.offsetBottom),o.offsetTop&&(o.offset.top=o.offsetTop),e.affix(o)})})}(jQuery),+function(t){"use strict";var e='[data-dismiss="alert"]',o=function(o){t(o).on("click",e,this.close)};o.prototype.close=function(e){function o(){n.trigger("closed.bs.alert").remove()}var i=t(this),r=i.attr("data-target");r||(r=i.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var n=t(r);e&&e.preventDefault(),n.length||(n=i.hasClass("alert")?i:i.parent()),n.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(n.removeClass("in"),t.support.transition&&n.hasClass("fade")?n.one(t.support.transition.end,o).emulateTransitionEnd(150):o())};var i=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var i=t(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new o(this)),"string"==typeof e&&r[e].call(i)})},t.fn.alert.Constructor=o,t.fn.alert.noConflict=function(){return t.fn.alert=i,this},t(document).on("click.bs.alert.data-api",e,o.prototype.close)}(jQuery),+function(t){"use strict";var e=function(o,i){this.$element=t(o),this.options=t.extend({},e.DEFAULTS,i),this.isLoading=!1};e.DEFAULTS={loadingText:"loading..."},e.prototype.setState=function(e){var o="disabled",i=this.$element,r=i.is("input")?"val":"html",n=i.data();e+="Text",n.resetText||i.data("resetText",i[r]()),i[r](n[e]||this.options[e]),setTimeout(t.proxy(function(){"loadingText"==e?(this.isLoading=!0,i.addClass(o).attr(o,o)):this.isLoading&&(this.isLoading=!1,i.removeClass(o).removeAttr(o))},this),0)},e.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var o=this.$element.find("input");"radio"==o.prop("type")&&(o.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&o.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var o=t.fn.button;t.fn.button=function(o){return this.each(function(){var i=t(this),r=i.data("bs.button"),n="object"==typeof o&&o;r||i.data("bs.button",r=new e(this,n)),"toggle"==o?r.toggle():o&&r.setState(o)})},t.fn.button.Constructor=e,t.fn.button.noConflict=function(){return t.fn.button=o,this},t(document).on("click.bs.button.data-api","[data-toggle^=button]",function(e){var o=t(e.target);o.hasClass("btn")||(o=o.closest(".btn")),o.button("toggle"),e.preventDefault()})}(jQuery),+function(t){"use strict";var e=function(e,o){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=o,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",t.proxy(this.pause,this)).on("mouseleave",t.proxy(this.cycle,this))};e.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},e.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},e.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(".item"),this.$items.index(this.$active)},e.prototype.to=function(e){var o=this,i=this.getActiveIndex();return e>this.$items.length-1||0>e?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){o.to(e)}):i==e?this.pause().cycle():this.slide(e>i?"next":"prev",t(this.$items[e]))},e.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},e.prototype.next=function(){return this.sliding?void 0:this.slide("next")},e.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},e.prototype.slide=function(e,o){var i=this.$element.find(".item.active"),r=o||i[e](),n=this.interval,s="next"==e?"left":"right",a="next"==e?"first":"last",h=this;if(!r.length){if(!this.options.wrap)return;r=this.$element.find(".item")[a]()}if(r.hasClass("active"))return this.sliding=!1;var l=t.Event("slide.bs.carousel",{relatedTarget:r[0],direction:s});return this.$element.trigger(l),l.isDefaultPrevented()?void 0:(this.sliding=!0,n&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var e=t(h.$indicators.children()[h.getActiveIndex()]);e&&e.addClass("active")})),t.support.transition&&this.$element.hasClass("slide")?(r.addClass(e),r[0].offsetWidth,i.addClass(s),r.addClass(s),i.one(t.support.transition.end,function(){r.removeClass([e,s].join(" ")).addClass("active"),i.removeClass(["active",s].join(" ")),h.sliding=!1,setTimeout(function(){h.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*i.css("transition-duration").slice(0,-1))):(i.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),n&&this.cycle(),this)};var o=t.fn.carousel;t.fn.carousel=function(o){return this.each(function(){var i=t(this),r=i.data("bs.carousel"),n=t.extend({},e.DEFAULTS,i.data(),"object"==typeof o&&o),s="string"==typeof o?o:n.slide;r||i.data("bs.carousel",r=new e(this,n)),"number"==typeof o?r.to(o):s?r[s]():n.interval&&r.pause().cycle()})},t.fn.carousel.Constructor=e,t.fn.carousel.noConflict=function(){return t.fn.carousel=o,this},t(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(e){var o,i=t(this),r=t(i.attr("data-target")||(o=i.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,"")),n=t.extend({},r.data(),i.data()),s=i.attr("data-slide-to");s&&(n.interval=!1),r.carousel(n),(s=i.attr("data-slide-to"))&&r.data("bs.carousel").to(s),e.preventDefault()}),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var e=t(this);e.carousel(e.data())})})}(jQuery),+function(t){"use strict";var e=function(o,i){this.$element=t(o),this.options=t.extend({},e.DEFAULTS,i),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e=t.Event("show.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var o=this.$parent&&this.$parent.find("> .panel > .in");if(o&&o.length){var i=o.data("bs.collapse");if(i&&i.transitioning)return;o.collapse("hide"),i||o.data("bs.collapse",null)}var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0),this.transitioning=1;var n=function(e){return e&&e.target!=this.$element[0]?void this.$element.one(t.support.transition.end,t.proxy(n,this)):(this.$element.removeClass("collapsing").addClass("collapse in")[r]("auto"),this.transitioning=0,void this.$element.trigger("shown.bs.collapse"))};if(!t.support.transition)return n.call(this);var s=t.camelCase(["scroll",r].join("-"));this.$element.one(t.support.transition.end,t.proxy(n,this)).emulateTransitionEnd(350)[r](this.$element[0][s])}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var o=this.dimension();this.$element[o](this.$element[o]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var i=function(e){return e&&e.target!=this.$element[0]?void this.$element.one(t.support.transition.end,t.proxy(i,this)):(this.transitioning=0,void this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse"))};return t.support.transition?void this.$element[o](0).one(t.support.transition.end,t.proxy(i,this)).emulateTransitionEnd(350):i.call(this)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var o=t.fn.collapse;t.fn.collapse=function(o){return this.each(function(){var i=t(this),r=i.data("bs.collapse"),n=t.extend({},e.DEFAULTS,i.data(),"object"==typeof o&&o);!r&&n.toggle&&"show"==o&&(o=!o),r||i.data("bs.collapse",r=new e(this,n)),"string"==typeof o&&r[o]()})},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=o,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(e){var o,i=t(this),r=i.attr("data-target")||e.preventDefault()||(o=i.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,""),n=t(r),s=n.data("bs.collapse"),a=s?"toggle":i.data(),h=i.attr("data-parent"),l=h&&t(h);s&&s.transitioning||(l&&l.find('[data-toggle="collapse"][data-parent="'+h+'"]').not(i).addClass("collapsed"),i[n.hasClass("in")?"addClass":"removeClass"]("collapsed")),n.collapse(a)})}(jQuery),+function(t){"use strict";function e(e){t(i).remove(),t(r).each(function(){var i=o(t(this)),r={relatedTarget:this};i.hasClass("open")&&(i.trigger(e=t.Event("hide.bs.dropdown",r)),e.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",r))})}function o(e){var o=e.attr("data-target");o||(o=e.attr("href"),o=o&&/#[A-Za-z]/.test(o)&&o.replace(/.*(?=#[^\s]*$)/,""));var i=o&&t(o);return i&&i.length?i:e.parent()}var i=".dropdown-backdrop",r='[data-toggle="dropdown"]',n=function(e){t(e).on("click.bs.dropdown",this.toggle)};n.prototype.toggle=function(i){var r=t(this);if(!r.is(".disabled, :disabled")){var n=o(r),s=n.hasClass("open");if(e(),!s){"ontouchstart"in document.documentElement&&!n.closest(".navbar-nav").length&&t('<div class="dropdown-backdrop"/>').insertAfter(t(this)).on("click",e);var a={relatedTarget:this};if(n.trigger(i=t.Event("show.bs.dropdown",a)),i.isDefaultPrevented())return;r.trigger("focus"),n.toggleClass("open").trigger("shown.bs.dropdown",a)}return!1}},n.prototype.keydown=function(e){if(/(38|40|27)/.test(e.keyCode)){var i=t(this);if(e.preventDefault(),e.stopPropagation(),!i.is(".disabled, :disabled")){var n=o(i),s=n.hasClass("open");if(!s||s&&27==e.keyCode)return 27==e.which&&n.find(r).trigger("focus"),i.trigger("click");var a=" li:not(.divider):visible a",h=n.find('[role="menu"]'+a+', [role="listbox"]'+a);if(h.length){var l=h.index(h.filter(":focus"));
38==e.keyCode&&l>0&&l--,40==e.keyCode&&l<h.length-1&&l++,~l||(l=0),h.eq(l).trigger("focus")}}}};var s=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var o=t(this),i=o.data("bs.dropdown");i||o.data("bs.dropdown",i=new n(this)),"string"==typeof e&&i[e].call(o)})},t.fn.dropdown.Constructor=n,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=s,this},t(document).on("click.bs.dropdown.data-api",e).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,n.prototype.toggle).on("keydown.bs.dropdown.data-api",r+', [role="menu"], [role="listbox"]',n.prototype.keydown)}(jQuery),+function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype.show=function(){var e=this.element,o=e.closest("ul:not(.dropdown-menu)"),i=e.data("target");if(i||(i=e.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=o.find(".active:last a")[0],n=t.Event("show.bs.tab",{relatedTarget:r});if(e.trigger(n),!n.isDefaultPrevented()){var s=t(i);this.activate(e.parent("li"),o),this.activate(s,s.parent(),function(){e.trigger({type:"shown.bs.tab",relatedTarget:r})})}}},e.prototype.activate=function(e,o,i){function r(){n.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),i&&i()}var n=o.find("> .active"),s=i&&t.support.transition&&n.hasClass("fade");s?n.one(t.support.transition.end,r).emulateTransitionEnd(150):r(),n.removeClass("in")};var o=t.fn.tab;t.fn.tab=function(o){return this.each(function(){var i=t(this),r=i.data("bs.tab");r||i.data("bs.tab",r=new e(this)),"string"==typeof o&&r[o]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=o,this},t(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var o in e)if(void 0!==t.style[o])return{end:e[o]};return!1}t.fn.emulateTransitionEnd=function(e){var o=!1,i=this;t(this).one(t.support.transition.end,function(){o=!0});var r=function(){o||t(i).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e()})}(jQuery),+function(t){"use strict";function e(o,i){var r,n=t.proxy(this.process,this);this.$element=t(t(o).is("body")?window:o),this.$body=t("body"),this.$scrollElement=this.$element.on("scroll.bs.scrollspy",n),this.options=t.extend({},e.DEFAULTS,i),this.selector=(this.options.target||(r=t(o).attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=t([]),this.targets=t([]),this.activeTarget=null,this.refresh(),this.process()}e.DEFAULTS={offset:10},e.prototype.refresh=function(){var e=this.$element[0]==window?"offset":"position";this.offsets=t([]),this.targets=t([]);var o=this;this.$body.find(this.selector).map(function(){var i=t(this),r=i.data("target")||i.attr("href"),n=/^#./.test(r)&&t(r);return n&&n.length&&n.is(":visible")&&[[n[e]().top+(!t.isWindow(o.$scrollElement.get(0))&&o.$scrollElement.scrollTop()),r]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){o.offsets.push(this[0]),o.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,o=this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight),i=o-this.$scrollElement.height(),r=this.offsets,n=this.targets,s=this.activeTarget;if(e>=i)return s!=(t=n.last()[0])&&this.activate(t);if(s&&e<=r[0])return s!=(t=n[0])&&this.activate(t);for(t=r.length;t--;)s!=n[t]&&e>=r[t]&&(!r[t+1]||e<=r[t+1])&&this.activate(n[t])},e.prototype.activate=function(e){this.activeTarget=e,t(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var o=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',i=t(o).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")};var o=t.fn.scrollspy;t.fn.scrollspy=function(o){return this.each(function(){var i=t(this),r=i.data("bs.scrollspy"),n="object"==typeof o&&o;r||i.data("bs.scrollspy",r=new e(this,n)),"string"==typeof o&&r[o]()})},t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=o,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);e.scrollspy(e.data())})})}(jQuery),+function(t){"use strict";var e=function(e,o){this.options=o,this.$body=t(document.body),this.$element=t(e),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};e.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},e.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},e.prototype.show=function(e){var o=this,i=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.backdrop(function(){var i=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),i&&o.$element[0].offsetWidth,o.$element.addClass("in").attr("aria-hidden",!1),o.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});i?o.$element.find(".modal-dialog").one(t.support.transition.end,function(){o.$element.trigger("focus").trigger(r)}).emulateTransitionEnd(300):o.$element.trigger("focus").trigger(r)}))},e.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one(t.support.transition.end,t.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},e.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},e.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},e.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden.bs.modal")})},e.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},e.prototype.backdrop=function(e){var o=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=t.support.transition&&o;if(this.$backdrop=t('<div class="modal-backdrop '+o+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;i?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()):e&&e()},e.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},e.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0);this.scrollbarWidth&&this.$body.css("padding-right",t+this.scrollbarWidth)},e.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},e.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var o=t.fn.modal;t.fn.modal=function(o,i){return this.each(function(){var r=t(this),n=r.data("bs.modal"),s=t.extend({},e.DEFAULTS,r.data(),"object"==typeof o&&o);n||r.data("bs.modal",n=new e(this,s)),"string"==typeof o?n[o](i):s.show&&n.show(i)})},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=o,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var o=t(this),i=o.attr("href"),r=t(o.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),n=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(i)&&i},r.data(),o.data());o.is("a")&&e.preventDefault(),r.modal(n,this).one("hide",function(){o.is(":visible")&&o.trigger("focus")})})}(jQuery),+function(t){"use strict";var e=function(t,e){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",t,e)};e.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},e.prototype.init=function(e,o,i){this.enabled=!0,this.type=e,this.$element=t(o),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&t(this.options.viewport.selector||this.options.viewport);for(var r=this.options.trigger.split(" "),n=r.length;n--;){var s=r[n];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",h="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(h+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},e.prototype.getDelegateOptions=function(){var e={},o=this.getDefaults();return this._options&&t.each(this._options,function(t,i){o[t]!=i&&(e[t]=i)}),e},e.prototype.enter=function(e){var o=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(o.timeout),o.hoverState="in",o.options.delay&&o.options.delay.show?void(o.timeout=setTimeout(function(){"in"==o.hoverState&&o.show()},o.options.delay.show)):o.show()},e.prototype.leave=function(e){var o=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(o.timeout),o.hoverState="out",o.options.delay&&o.options.delay.hide?void(o.timeout=setTimeout(function(){"out"==o.hoverState&&o.hide()},o.options.delay.hide)):o.hide()},e.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(e),e.isDefaultPrevented())return;var o=this,i=this.tip();this.setContent(),this.options.animation&&i.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,n=/\s?auto?\s?/i,s=n.test(r);s&&(r=r.replace(n,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var a=this.getPosition(),h=i[0].offsetWidth,l=i[0].offsetHeight;if(s){var p=r,c=this.$element.parent(),d=this.getPosition(c);r="bottom"==r&&a.top+a.height+l-d.scroll>d.height?"top":"top"==r&&a.top-d.scroll-l<0?"bottom":"right"==r&&a.right+h>d.width?"left":"left"==r&&a.left-h<d.left?"right":r,i.removeClass(p).addClass(r)}var u=this.getCalculatedOffset(r,a,h,l);this.applyPlacement(u,r),this.hoverState=null;var f=function(){o.$element.trigger("shown.bs."+o.type)};t.support.transition&&this.$tip.hasClass("fade")?i.one(t.support.transition.end,f).emulateTransitionEnd(150):f()}},e.prototype.applyPlacement=function(e,o){var i=this.tip(),r=i[0].offsetWidth,n=i[0].offsetHeight,s=parseInt(i.css("margin-top"),10),a=parseInt(i.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top=e.top+s,e.left=e.left+a,t.offset.setOffset(i[0],t.extend({using:function(t){i.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),i.addClass("in");var h=i[0].offsetWidth,l=i[0].offsetHeight;"top"==o&&l!=n&&(e.top=e.top+n-l);var p=this.getViewportAdjustedDelta(o,e,h,l);p.left?e.left+=p.left:e.top+=p.top;var c=p.left?2*p.left-r+h:2*p.top-n+l,d=p.left?"left":"top",u=p.left?"offsetWidth":"offsetHeight";i.offset(e),this.replaceArrow(c,i[0][u],d)},e.prototype.replaceArrow=function(t,e,o){this.arrow().css(o,t?50*(1-t/e)+"%":"")},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},e.prototype.hide=function(){function e(){"in"!=o.hoverState&&i.detach(),o.$element.trigger("hidden.bs."+o.type)}var o=this,i=this.tip(),r=t.Event("hide.bs."+this.type);return this.$element.trigger(r),r.isDefaultPrevented()?void 0:(i.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?i.one(t.support.transition.end,e).emulateTransitionEnd(150):e(),this.hoverState=null,this)},e.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},e.prototype.hasContent=function(){return this.getTitle()},e.prototype.getPosition=function(e){e=e||this.$element;var o=e[0],i="BODY"==o.tagName;return t.extend({},"function"==typeof o.getBoundingClientRect?o.getBoundingClientRect():null,{scroll:i?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop(),width:i?t(window).width():e.outerWidth(),height:i?t(window).height():e.outerHeight()},i?{top:0,left:0}:e.offset())},e.prototype.getCalculatedOffset=function(t,e,o,i){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-o/2}:"top"==t?{top:e.top-i,left:e.left+e.width/2-o/2}:"left"==t?{top:e.top+e.height/2-i/2,left:e.left-o}:{top:e.top+e.height/2-i/2,left:e.left+e.width}},e.prototype.getViewportAdjustedDelta=function(t,e,o,i){var r={top:0,left:0};if(!this.$viewport)return r;var n=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-n-s.scroll,h=e.top+n-s.scroll+i;a<s.top?r.top=s.top-a:h>s.top+s.height&&(r.top=s.top+s.height-h)}else{var l=e.left-n,p=e.left+n+o;l<s.left?r.left=s.left-l:p>s.width&&(r.left=s.left+s.width-p)}return r},e.prototype.getTitle=function(){var t,e=this.$element,o=this.options;return t=e.attr("data-original-title")||("function"==typeof o.title?o.title.call(e[0]):o.title)},e.prototype.tip=function(){return this.$tip=this.$tip||t(this.options.template)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},e.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype.toggleEnabled=function(){this.enabled=!this.enabled},e.prototype.toggle=function(e){var o=e?t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;o.tip().hasClass("in")?o.leave(o):o.enter(o)},e.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var o=t.fn.tooltip;t.fn.tooltip=function(o){return this.each(function(){var i=t(this),r=i.data("bs.tooltip"),n="object"==typeof o&&o;(r||"destroy"!=o)&&(r||i.data("bs.tooltip",r=new e(this,n)),"string"==typeof o&&r[o]())})},t.fn.tooltip.Constructor=e,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=o,this}}(jQuery),+function(t){"use strict";var e=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");e.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),e.prototype.constructor=e,e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),o=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").empty()[this.options.html?"string"==typeof o?"html":"append":"text"](o),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},e.prototype.hasContent=function(){return this.getTitle()||this.getContent()},e.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},e.prototype.tip=function(){return this.$tip||(this.$tip=t(this.options.template)),this.$tip};var o=t.fn.popover;t.fn.popover=function(o){return this.each(function(){var i=t(this),r=i.data("bs.popover"),n="object"==typeof o&&o;(r||"destroy"!=o)&&(r||i.data("bs.popover",r=new e(this,n)),"string"==typeof o&&r[o]())})},t.fn.popover.Constructor=e,t.fn.popover.noConflict=function(){return t.fn.popover=o,this}}(jQuery),function(){var t,e,o,i,r,n,s,a,h,l,p,c,d,u,f,g,m,y,M,b,w,S,C,v,x,k,B,P,T,I,E,L,D,F,A,N,R,O,z,j,H,W,_,V,U,G,q,X,$,K=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1},Y={}.hasOwnProperty,J=function(t,e){function o(){this.constructor=t}for(var i in e)Y.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},Q=[].slice;T={},c=10,V=!1,g=null,P=null,A=null,f=null,X=null,b=function(t){var e;return t=new o(t),j(),p(),N(t),V&&(e=U(t.absolute))?(w(e),S(t)):S(t,_)},U=function(t){var e;return e=T[t],e&&!e.transitionCacheDisabled?e:void 0},m=function(t){return null==t&&(t=!0),V=t},S=function(t,e){return null==e&&(e=function(){return function(){}}(this)),G("page:fetch",{url:t.absolute}),null!=X&&X.abort(),X=new XMLHttpRequest,X.open("GET",t.withoutHashForIE10compatibility(),!0),X.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),X.setRequestHeader("X-XHR-Referer",A),X.onload=function(){var o;return G("page:receive"),(o=D())?(d.apply(null,M(o)),R(),e(),G("page:load")):document.location.href=t.absolute},X.onloadend=function(){return X=null},X.onerror=function(){return document.location.href=t.absolute},X.send()},w=function(t){return null!=X&&X.abort(),d(t.title,t.body),F(t),G("page:restore")},p=function(){var t;return t=new o(g.url),T[t.absolute]={url:t.relative,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime(),transitionCacheDisabled:null!=document.querySelector("[data-no-transition-cache]")},u(c)},E=function(t){return null==t&&(t=c),/^[\d]+$/.test(t)?c=parseInt(t):void 0},u=function(t){var e,o,i,r,n,s;for(i=Object.keys(T),e=i.map(function(t){return T[t].cachedAt}).sort(function(t,e){return e-t}),s=[],r=0,n=i.length;n>r;r++)o=i[r],T[o].cachedAt<=e[t]&&(G("page:expire",T[o]),s.push(delete T[o]));return s},d=function(e,o,i,r){return document.title=e,document.documentElement.replaceChild(o,document.body),null!=i&&t.update(i),r&&y(),g=window.history.state,G("page:change"),G("page:update")},y=function(){var t,e,o,i,r,n,s,a,h,l,p,c;for(n=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')),s=0,h=n.length;h>s;s++)if(r=n[s],""===(p=r.type)||"text/javascript"===p){for(e=document.createElement("script"),c=r.attributes,a=0,l=c.length;l>a;a++)t=c[a],e.setAttribute(t.name,t.value);e.appendChild(document.createTextNode(r.innerHTML)),i=r.parentNode,o=r.nextSibling,i.removeChild(r),i.insertBefore(e,o)}},H=function(t){return t.innerHTML=t.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi,""),t},N=function(t){return(t=new o(t)).absolute!==A?window.history.pushState({turbolinks:!0,url:t.absolute},"",t.absolute):void 0},R=function(){var t,e;return(t=X.getResponseHeader("X-XHR-Redirected-To"))?(t=new o(t),e=t.hasNoHash()?document.location.hash:"",window.history.replaceState(g,"",t.href+e)):void 0},j=function(){return A=document.location.href},z=function(){return window.history.replaceState({turbolinks:!0,url:document.location.href},"",document.location.href)},O=function(){return g=window.history.state},F=function(t){return window.scrollTo(t.positionX,t.positionY)},_=function(){return document.location.hash?document.location.href=document.location.href:window.scrollTo(0,0)},L=function(t){var e,o;return e=(null!=(o=document.cookie.match(new RegExp(t+"=(\\w+)")))?o[1].toUpperCase():void 0)||"",document.cookie=t+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/",e},G=function(t,e){var o;return o=document.createEvent("Events"),e&&(o.data=e),o.initEvent(t,!0,!0),document.dispatchEvent(o)},I=function(){return!G("page:before-change")},D=function(){var t,e,o,i,r,n;return e=function(){var t;return 400<=(t=X.status)&&600>t},n=function(){return X.getResponseHeader("Content-Type").match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)},i=function(t){var e,o,i,r,n;for(r=t.head.childNodes,n=[],o=0,i=r.length;i>o;o++)e=r[o],null!=("function"==typeof e.getAttribute?e.getAttribute("data-turbolinks-track"):void 0)&&n.push(e.getAttribute("src")||e.getAttribute("href"));return n},t=function(t){var e;return P||(P=i(document)),e=i(t),e.length!==P.length||r(e,P).length!==P.length},r=function(t,e){var o,i,r,n,s;for(t.length>e.length&&(n=[e,t],t=n[0],e=n[1]),s=[],i=0,r=t.length;r>i;i++)o=t[i],K.call(e,o)>=0&&s.push(o);return s},!e()&&n()&&(o=f(X.responseText),o&&!t(o))?o:void 0},M=function(e){var o;return o=e.querySelector("title"),[null!=o?o.textContent:void 0,H(e.body),t.get(e).token,"runScripts"]},t={get:function(t){var e;return null==t&&(t=document),{node:e=t.querySelector('meta[name="csrf-token"]'),token:null!=e&&"function"==typeof e.getAttribute?e.getAttribute("content"):void 0}},update:function(t){var e;return e=this.get(),null!=e.token&&null!=t&&e.token!==t?e.node.setAttribute("content",t):void 0}},r=function(){var t,e,o,i,r,n;e=function(t){return(new DOMParser).parseFromString(t,"text/html")},t=function(t){var e;return e=document.implementation.createHTMLDocument(""),e.documentElement.innerHTML=t,e},o=function(t){var e;return e=document.implementation.createHTMLDocument(""),e.open("replace"),e.write(t),e.close(),e};try{if(window.DOMParser)return r=e("<html><body><p>test"),e}catch(s){return i=s,r=t("<html><body><p>test"),t}finally{if(1!==(null!=r&&null!=(n=r.body)?n.childNodes.length:void 0))return o}},o=function(){function t(e){return this.original=null!=e?e:document.location.href,this.original.constructor===t?this.original:void this._parse()}return t.prototype.withoutHash=function(){return this.href.replace(this.hash,"")},t.prototype.withoutHashForIE10compatibility=function(){return this.withoutHash()},t.prototype.hasNoHash=function(){return 0===this.hash.length},t.prototype._parse=function(){var t;return(null!=this.link?this.link:this.link=document.createElement("a")).href=this.original,t=this.link,this.href=t.href,this.protocol=t.protocol,this.host=t.host,this.hostname=t.hostname,this.port=t.port,this.pathname=t.pathname,this.search=t.search,this.hash=t.hash,this.origin=[this.protocol,"//",this.hostname].join(""),0!==this.port.length&&(this.origin+=":"+this.port),this.relative=[this.pathname,this.search,this.hash].join(""),this.absolute=this.href},t}(),i=function(t){function e(t){return this.link=t,this.link.constructor===e?this.link:(this.original=this.link.href,void e.__super__.constructor.apply(this,arguments))}return J(e,t),e.HTML_EXTENSIONS=["html"],e.allowExtensions=function(){var t,o,i,r;for(o=1<=arguments.length?Q.call(arguments,0):[],i=0,r=o.length;r>i;i++)t=o[i],e.HTML_EXTENSIONS.push(t);return e.HTML_EXTENSIONS},e.prototype.shouldIgnore=function(){return this._crossOrigin()||this._anchored()||this._nonHtml()||this._optOut()||this._target()},e.prototype._crossOrigin=function(){return this.origin!==(new o).origin},e.prototype._anchored=function(){var t;return(this.hash&&this.withoutHash())===(t=new o).withoutHash()||this.href===t.href+"#"},e.prototype._nonHtml=function(){return this.pathname.match(/\.[a-z]+$/g)&&!this.pathname.match(new RegExp("\\.(?:"+e.HTML_EXTENSIONS.join("|")+")?$","g"))},e.prototype._optOut=function(){var t,e;for(e=this.link;!t&&e!==document;)t=null!=e.getAttribute("data-no-turbolink"),e=e.parentNode;return t},e.prototype._target=function(){return 0!==this.link.target.length},e}(o),e=function(){function t(t){this.event=t,this.event.defaultPrevented||(this._extractLink(),this._validForTurbolinks()&&(I()||q(this.link.href),this.event.preventDefault()))}return t.installHandlerLast=function(e){return e.defaultPrevented?void 0:(document.removeEventListener("click",t.handle,!1),document.addEventListener("click",t.handle,!1))},t.handle=function(e){return new t(e)},t.prototype._extractLink=function(){var t;for(t=this.event.target;t.parentNode&&"A"!==t.nodeName;)t=t.parentNode;return"A"===t.nodeName&&0!==t.href.length?this.link=new i(t):void 0},t.prototype._validForTurbolinks=function(){return null!=this.link&&!(this.link.shouldIgnore()||this._nonStandardClick())},t.prototype._nonStandardClick=function(){return this.event.which>1||this.event.metaKey||this.event.ctrlKey||this.event.shiftKey||this.event.altKey},t}(),l=function(t){return setTimeout(t,500)},x=function(){return document.addEventListener("DOMContentLoaded",function(){return G("page:change"),G("page:update")},!0)},B=function(){return"undefined"!=typeof jQuery?jQuery(document).on("ajaxSuccess",function(t,e){return jQuery.trim(e.responseText)?G("page:update"):void 0}):void 0},k=function(t){var e,i;return(null!=(i=t.state)?i.turbolinks:void 0)?(e=T[new o(t.state.url).absolute])?(p(),w(e)):q(t.target.location.href):void 0},v=function(){return z(),O(),f=r(),document.addEventListener("click",e.installHandlerLast,!0),l(function(){return window.addEventListener("popstate",k,!1)})},C=void 0!==window.history.state||navigator.userAgent.match(/Firefox\/2[6|7]/),a=window.history&&window.history.pushState&&window.history.replaceState&&C,n=!navigator.userAgent.match(/CriOS\//),W="GET"===($=L("request_method"))||""===$,h=a&&n&&W,s=document.addEventListener&&document.createEvent,s&&(x(),B()),h?(q=b,v()):q=function(t){return document.location.href=t},this.Turbolinks={visit:q,pagesCached:E,enableTransitionCache:m,allowLinkExtensions:i.allowExtensions,supported:h}}.call(this),modules.gui="2014-February-13";var IDE_Morph,ProjectDialogMorph,SpriteIconMorph,CostumeIconMorph,TurtleIconMorph,WardrobeMorph,SoundIconMorph,JukeboxMorph;IDE_Morph.prototype=new Morph,IDE_Morph.prototype.constructor=IDE_Morph,IDE_Morph.uber=Morph.prototype,IDE_Morph.prototype.setDefaultDesign=function(){MorphicPreferences.isFlat=!1,SpriteMorph.prototype.paletteColor=new Color(55,55,55),SpriteMorph.prototype.paletteTextColor=new Color(230,230,230),StageMorph.prototype.paletteTextColor=SpriteMorph.prototype.paletteTextColor,StageMorph.prototype.paletteColor=SpriteMorph.prototype.paletteColor,SpriteMorph.prototype.sliderColor=SpriteMorph.prototype.paletteColor.lighter(30),IDE_Morph.prototype.buttonContrast=30,IDE_Morph.prototype.backgroundColor=new Color(40,40,40),IDE_Morph.prototype.frameColor=SpriteMorph.prototype.paletteColor,IDE_Morph.prototype.groupColor=SpriteMorph.prototype.paletteColor.lighter(8),IDE_Morph.prototype.sliderColor=SpriteMorph.prototype.sliderColor,IDE_Morph.prototype.buttonLabelColor=new Color(255,255,255),IDE_Morph.prototype.tabColors=[IDE_Morph.prototype.groupColor.darker(40),IDE_Morph.prototype.groupColor.darker(60),IDE_Morph.prototype.groupColor],IDE_Morph.prototype.rotationStyleColors=IDE_Morph.prototype.tabColors,IDE_Morph.prototype.appModeColor=new Color,IDE_Morph.prototype.scriptsPaneTexture=window.getAsset("scriptsPaneTexture.gif"),IDE_Morph.prototype.padding=5,SpriteIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor,CostumeIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor,SoundIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor,TurtleIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor},IDE_Morph.prototype.setFlatDesign=function(){MorphicPreferences.isFlat=!0,SpriteMorph.prototype.paletteColor=new Color(255,255,255),SpriteMorph.prototype.paletteTextColor=new Color(70,70,70),StageMorph.prototype.paletteTextColor=SpriteMorph.prototype.paletteTextColor,StageMorph.prototype.paletteColor=SpriteMorph.prototype.paletteColor,SpriteMorph.prototype.sliderColor=SpriteMorph.prototype.paletteColor,IDE_Morph.prototype.buttonContrast=30,IDE_Morph.prototype.backgroundColor=new Color(200,200,200),IDE_Morph.prototype.frameColor=new Color(255,255,255),IDE_Morph.prototype.groupColor=new Color(230,230,230),IDE_Morph.prototype.sliderColor=SpriteMorph.prototype.sliderColor,IDE_Morph.prototype.buttonLabelColor=new Color(70,70,70),IDE_Morph.prototype.tabColors=[IDE_Morph.prototype.groupColor.lighter(60),IDE_Morph.prototype.groupColor.darker(10),IDE_Morph.prototype.groupColor],IDE_Morph.prototype.rotationStyleColors=[IDE_Morph.prototype.groupColor,IDE_Morph.prototype.groupColor.darker(10),IDE_Morph.prototype.groupColor.darker(30)],IDE_Morph.prototype.appModeColor=IDE_Morph.prototype.frameColor,IDE_Morph.prototype.scriptsPaneTexture=null,IDE_Morph.prototype.padding=1,SpriteIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor,CostumeIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor,SoundIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor,TurtleIconMorph.prototype.labelColor=IDE_Morph.prototype.buttonLabelColor},window.addLoadEvent(IDE_Morph.prototype.setDefaultDesign),IDE_Morph.prototype.init=function(t){MorphicPreferences.globalFontFamily="Helvetica, Arial",this.userLanguage=null,this.applySavedSettings(),this.cloudMsg=null,this.source="local",this.serializer=new SnapSerializer,this.globalVariables=new VariableFrame,this.currentSprite=new SpriteMorph(this.globalVariables),this.sprites=new List([this.currentSprite]),this.currentCategory="motion",this.currentTab="scripts",this.projectName="",this.projectNotes="",this.logo=null,this.controlBar=null,this.categories=null,this.palette=null,this.spriteBar=null,this.spriteEditor=null,this.stage=null,this.corralBar=null,this.corral=null,this.isAutoFill=t||!0,this.isAppMode=!1,this.isSmallStage=!1,this.filePicker=null,this.hasChangedMedia=!1,this.isAnimating=!0,this.stageRatio=1,this.loadNewProject=!1,this.shield=null,IDE_Morph.uber.init.call(this),this.color=this.backgroundColor},IDE_Morph.prototype.openIn=function(t){function e(t){try{var e=new XMLHttpRequest;if(e.open("GET",t,!1),e.send(),200===e.status)return e.responseText;throw new Error("unable to retrieve "+t)}catch(o){return}}function o(){var t;"#open:"===location.hash.substr(0,6)?(i=location.hash.substr(6),("%"===i.charAt(0)||i.search(/\%(?:[0-9a-f]{2})/i)>-1)&&(i=decodeURIComponent(i)),this.droppedText(contains(["project","blocks","sprites","snapdata"].map(function(t){return i.substr(0,8).indexOf(t)}),1)?i:e(i))):"#run:"===location.hash.substr(0,5)?(i=location.hash.substr(5),("%"===i.charAt(0)||i.search(/\%(?:[0-9a-f]{2})/i)>-1)&&(i=decodeURIComponent(i)),this.rawOpenProjectString("<project>"===i.substr(0,8)?i:e(i)),this.toggleAppMode(!0),this.runScripts()):"#present:"===location.hash.substr(0,9)?(this.shield=new Morph,this.shield.color=this.color,this.shield.setExtent(this.parent.extent()),this.parent.add(this.shield),n.showMessage("Fetching project\nfrom the cloud..."),t=SnapCloud.parseDict(location.hash.substr(9)),t.Username=t.Username.toLowerCase(),SnapCloud.getPublicProject(SnapCloud.encodeDict(t),function(t){var e;
n.nextSteps([function(){e=n.showMessage("Opening project...")},function(){0===t.indexOf("<snapdata")?n.rawOpenCloudDataString(t):0===t.indexOf("<project")&&n.rawOpenProjectString(t),n.hasChangedMedia=!0},function(){n.shield.destroy(),n.shield=null,e.destroy(),n.toggleAppMode(!0),n.runScripts()}])},this.cloudError())):"#lang:"===location.hash.substr(0,6)?(s=location.hash.substr(6),this.setLanguage(s),this.loadNewProject=!0):"#signup"===location.hash.substr(0,7)&&this.createCloudAccount()}var i,r,n=this,s=null;this.buildPanes(),t.add(this),t.userMenu=this.userMenu,localStorage&&(r=localStorage["-snap-user"],r&&(r=SnapCloud.parseResponse(r)[0],r&&(SnapCloud.username=r.username||null,SnapCloud.password=r.password||null))),SnapCloud.message=function(e){var o,i=new MenuMorph(null,e);i.popUpCenteredInWorld(t),o=setInterval(function(){i.destroy(),clearInterval(o)},2e3)},t.reactToDropOf=function(e){e instanceof DialogBoxMorph||(t.hand.grabOrigin?e.slideBackTo(t.hand.grabOrigin):t.hand.grab(e))},this.reactToWorldResize(t.bounds),this.userLanguage?this.setLanguage(this.userLanguage):o.call(this)},IDE_Morph.prototype.buildPanes=function(){this.createLogo(),this.createControlBar(),this.createCategories(),this.createPalette(),this.createStage(),this.createSpriteBar(),this.createSpriteEditor(),this.createCorralBar(),this.createCorral()},IDE_Morph.prototype.createLogo=function(){var t=this;this.logo&&this.logo.destroy(),this.logo=new Morph,this.logo.texture=getAsset("snap_logo_sm.png"),this.logo.drawNew=function(){this.image=newCanvas(this.extent());var e=this.image.getContext("2d"),o=e.createLinearGradient(0,0,this.width(),0);o.addColorStop(0,"black"),o.addColorStop(.5,t.frameColor.toString()),e.fillStyle=MorphicPreferences.isFlat?t.frameColor.toString():o,e.fillRect(0,0,this.width(),this.height()),this.texture&&this.drawTexture(this.texture)},this.logo.drawCachedTexture=function(){var t=this.image.getContext("2d");t.drawImage(this.cachedTexture,5,Math.round((this.height()-this.cachedTexture.height)/2)),this.changed()},this.logo.mouseClickLeft=function(){t.snapMenu()},this.logo.color=new Color,this.logo.setExtent(new Point(200,28)),this.add(this.logo)},IDE_Morph.prototype.createControlBar=function(){var t,e,o,i,r,n,s,a,h,l,p=5,c=[this.groupColor,this.frameColor.darker(50),this.frameColor.darker(50)],d=this;this.controlBar&&this.controlBar.destroy(),this.controlBar=new Morph,this.controlBar.color=this.frameColor,this.controlBar.setHeight(this.logo.height()),this.controlBar.mouseClickLeft=function(){this.world().fillPage()},this.add(this.controlBar),t=new ToggleButtonMorph(null,d,"toggleStageSize",[new SymbolMorph("smallStage",14),new SymbolMorph("normalStage",14)],function(){return d.isSmallStage}),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=this.buttonLabelColor,t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),t.refresh(),s=t,this.controlBar.add(s),this.controlBar.stageSizeButton=t,t=new ToggleButtonMorph(null,d,"toggleAppMode",[new SymbolMorph("fullScreen",14),new SymbolMorph("normalScreen",14)],function(){return d.isAppMode}),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=this.buttonLabelColor,t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),t.refresh(),a=t,this.controlBar.add(a),this.controlBar.appModeButton=a,t=new PushButtonMorph(this,"stopAllScripts",new SymbolMorph("octagon",14)),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=new Color(200,0,0),t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),e=t,this.controlBar.add(e),t=new ToggleButtonMorph(null,d,"togglePauseResume",[new SymbolMorph("pause",12),new SymbolMorph("pointRight",14)],function(){return d.isPaused()}),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=new Color(255,220,0),t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),t.refresh(),o=t,this.controlBar.add(o),this.controlBar.pauseButton=o,t=new PushButtonMorph(this,"pressStart",new SymbolMorph("flag",14)),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=new Color(0,200,0),t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),i=t,this.controlBar.add(i),this.controlBar.startButton=i,t=new PushButtonMorph(this,"projectMenu",new SymbolMorph("file",14)),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=this.buttonLabelColor,t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),r=t,this.controlBar.add(r),this.controlBar.projectButton=r,t=new PushButtonMorph(this,"settingsMenu",new SymbolMorph("gears",14)),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=this.buttonLabelColor,t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),n=t,this.controlBar.add(n),this.controlBar.settingsButton=n,t=new PushButtonMorph(this,"missionMenu",new SymbolMorph("robot",14)),t.corner=12,t.color=c[0],t.highlightColor=c[1],t.pressColor=c[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=c[1],t.labelColor=this.buttonLabelColor,t.contrast=this.buttonContrast,t.drawNew(),t.fixLayout(),h=t,this.controlBar.add(h),this.controlBar.infoMissionButton=h,this.controlBar.fixLayout=function(){l=this.right()-p,[e,o,i].forEach(function(t){t.setCenter(d.controlBar.center()),t.setRight(l),l-=t.width(),l-=p}),l=d.right()-StageMorph.prototype.dimensions.x*(d.isSmallStage?d.stageRatio:1),[s,a].forEach(function(t){l+=p,t.setCenter(d.controlBar.center()),t.setLeft(l),l+=t.width()}),n.setCenter(d.controlBar.center()),n.setLeft(this.left()),h.setCenter(d.controlBar.center()),h.setRight(n.left()-p),r.setCenter(d.controlBar.center()),r.setRight(h.left()-p),this.updateLabel()},this.controlBar.updateLabel=function(){var t=d.world().isDevMode?" - "+localize("development mode"):"";this.label&&this.label.destroy(),d.isAppMode||(this.label=new StringMorph((d.projectName||localize("untitled"))+t,14,"sans-serif",!0,!1,!1,MorphicPreferences.isFlat?null:new Point(2,1),d.frameColor.darker(d.buttonContrast)),this.label.color=d.buttonLabelColor,this.label.drawNew(),this.add(this.label),this.label.setCenter(this.center()),this.label.setLeft(this.settingsButton.right()+p))},"STUDENT"==world.role&&(this.controlBar.projectButton.hide(),this.controlBar.stageSizeButton.hide(),this.controlBar.appModeButton.hide())},IDE_Morph.prototype.createCategories=function(){function t(t){var e,i=75,r=[o.frameColor,o.frameColor.darker(50),SpriteMorph.prototype.blockColor[t]];return e=new ToggleButtonMorph(r,o,function(){o.currentCategory=t,o.categories.children.forEach(function(t){t.refresh()}),o.refreshPalette(!0)},t[0].toUpperCase().concat(t.slice(1)),function(){return o.currentCategory===t},null,null,null,i,!0),e.corner=8,e.padding=0,e.labelShadowOffset=new Point(-1,-1),e.labelShadowColor=r[1],e.labelColor=o.buttonLabelColor,e.fixLayout(),e.refresh(),o.categories.add(e),e}function e(){var t,e,i=o.categories.children[0].width(),r=o.categories.children[0].height(),n=3,s=Math.ceil(o.categories.children.length/2),a=(o.categories.width()-n-2*i)/3,h=2,l=o.categories.left(),p=o.categories.top(),c=0;o.categories.children.forEach(function(o){c+=1,t=Math.ceil(c/2),e=2-c%2,o.setPosition(new Point(l+(e*a+(e-1)*i),p+(t*h+(t-1)*r+n)))}),o.categories.setHeight((s+1)*h+s*r+2*n)}var o=this;this.categories&&this.categories.destroy(),this.categories=new Morph,this.categories.color=this.groupColor,this.categories.silentSetWidth(this.logo.width()),SpriteMorph.prototype.categories.forEach(function(e){contains(["lists","other"],e)||t(e)}),e(),this.add(this.categories)},IDE_Morph.prototype.createPalette=function(){var t=this;this.palette&&this.palette.destroy(),this.palette=this.currentSprite.palette(this.currentCategory),this.palette.isDraggable=!1,this.palette.acceptsDrops=!0,this.palette.contents.acceptsDrops=!1,this.palette.reactToDropOf=function(e){e instanceof DialogBoxMorph?t.world().add(e):e instanceof SpriteMorph?t.removeSprite(e):e instanceof SpriteIconMorph?(e.destroy(),t.removeSprite(e.object)):e instanceof CostumeIconMorph?(t.currentSprite.wearCostume(null),e.destroy()):e.destroy()},this.palette.setWidth(this.logo.width()),this.add(this.palette),this.palette.scrollX(this.palette.padding),this.palette.scrollY(this.palette.padding)},IDE_Morph.prototype.createStage=function(){this.stage&&this.stage.destroy(),StageMorph.prototype.frameRate=0,this.stage=new StageMorph(this.globalVariables),this.stage.setExtent(this.stage.dimensions),this.currentSprite instanceof SpriteMorph&&(this.currentSprite.setPosition(this.stage.center().subtract(this.currentSprite.extent().divideBy(2))),this.stage.add(this.currentSprite)),this.add(this.stage)},IDE_Morph.prototype.createSpriteBar=function(){function t(t){var e,o=p.rotationStyleColors;return e=new ToggleButtonMorph(o,p,function(){p.currentSprite instanceof SpriteMorph&&(p.currentSprite.rotationStyle=t,p.currentSprite.changed(),p.currentSprite.drawNew(),p.currentSprite.changed()),n.forEach(function(t){t.refresh()})},["\u2192","\u21bb","\u2194"][t],function(){return p.currentSprite instanceof SpriteMorph&&p.currentSprite.rotationStyle===t},null,localize(["don't rotate","can rotate","only face left/right"][t])),e.corner=8,e.labelMinExtent=new Point(11,11),e.padding=0,e.labelShadowOffset=new Point(-1,-1),e.labelShadowColor=o[1],e.labelColor=p.buttonLabelColor,e.fixLayout(),e.refresh(),n.push(e),e.setPosition(p.spriteBar.position().add(2)),e.setTop(e.top()+(n.length-1)*(e.height()+2)),p.spriteBar.add(e),p.currentSprite instanceof StageMorph&&e.hide(),e}var e,o,i,r,n=[],s=new Point(45,45),a=15,h=this.tabColors,l=new AlignmentMorph("row",2*-a),p=this;this.spriteBar&&this.spriteBar.destroy(),this.spriteBar=new Morph,this.spriteBar.color=this.frameColor,this.add(this.spriteBar),"STUDENT"!==world.role&&(t(1),t(2),t(0),this.rotationStyleButtons=n),i=new Morph,i.setExtent(s),i.image=this.currentSprite.thumbnail(s),"STUDENT"!==world.role&&i.setPosition(n[0].topRight().add(new Point(5,3))),this.spriteBar.add(i),i.fps=3,i.step=function(){i.version!==p.currentSprite.version&&(i.image=p.currentSprite.thumbnail(s),i.changed(),i.version=p.currentSprite.version)},e=new InputFieldMorph(this.currentSprite.name,void 0,void 0,"STUDENT"==world.role),e.setWidth(100),e.contrast=90,e.setPosition(i.topRight().add(new Point(10,3))),this.spriteBar.add(e),e.drawNew(),e.accept=function(){p.currentSprite.setName(e.getValue())},this.spriteBar.reactToEdit=function(){p.currentSprite.setName(e.getValue())},"STUDENT"!==world.role&&(o=new ToggleMorph("checkbox",null,function(){p.currentSprite.isDraggable=!p.currentSprite.isDraggable},localize("draggable"),function(){return p.currentSprite.isDraggable}),o.label.isBold=!1,o.label.setColor(this.buttonLabelColor),o.color=h[2],o.highlightColor=h[0],o.pressColor=h[1],o.tick.shadowOffset=MorphicPreferences.isFlat?new Point:new Point(-1,-1),o.tick.shadowColor=new Color,o.tick.color=this.buttonLabelColor,o.tick.isBold=!1,o.tick.drawNew(),o.setPosition(e.bottomLeft().add(2)),o.drawNew(),this.spriteBar.add(o),this.currentSprite instanceof StageMorph&&o.hide()),l.tabTo=function(t){var e;p.currentTab=t,this.children.forEach(function(t){t.refresh(),t.state&&(e=t)}),e.refresh(),p.createSpriteEditor(),p.fixLayout("tabEditor")},r=new TabMorph(h,null,function(){l.tabTo("scripts")},localize("Scripts"),function(){return"scripts"===p.currentTab}),r.padding=3,r.corner=a,r.edge=1,r.labelShadowOffset=new Point(-1,-1),r.labelShadowColor=h[1],r.labelColor=this.buttonLabelColor,r.drawNew(),r.fixLayout(),l.add(r),r=new TabMorph(h,null,function(){l.tabTo("costumes")},localize("Costumes"),function(){return"costumes"===p.currentTab}),r.padding=3,r.corner=a,r.edge=1,r.labelShadowOffset=new Point(-1,-1),r.labelShadowColor=h[1],r.labelColor=this.buttonLabelColor,r.drawNew(),r.fixLayout(),l.add(r),"STUDENT"==world.role&&r.hide(),r=new TabMorph(h,null,function(){l.tabTo("sounds")},localize("Sounds"),function(){return"sounds"===p.currentTab}),r.padding=3,r.corner=a,r.edge=1,r.labelShadowOffset=new Point(-1,-1),r.labelShadowColor=h[1],r.labelColor=this.buttonLabelColor,r.drawNew(),r.fixLayout(),l.add(r),"STUDENT"==world.role&&r.hide(),l.fixLayout(),l.children.forEach(function(t){t.refresh()}),this.spriteBar.tabBar=l,this.spriteBar.add(this.spriteBar.tabBar),this.spriteBar.fixLayout=function(){this.tabBar.setLeft(this.left()),this.tabBar.setBottom(this.bottom())}},IDE_Morph.prototype.createSpriteEditor=function(){var t=this.currentSprite.scripts,e=this;this.spriteEditor&&this.spriteEditor.destroy(),"scripts"===this.currentTab?(t.isDraggable=!1,t.color=this.groupColor,t.texture=this.scriptsPaneTexture,this.spriteEditor=new ScrollFrameMorph(t,null,this.sliderColor),this.spriteEditor.padding=10,this.spriteEditor.growth=50,this.spriteEditor.isDraggable=!1,this.spriteEditor.acceptsDrops=!1,this.spriteEditor.contents.acceptsDrops=!0,t.scrollFrame=this.spriteEditor,this.add(this.spriteEditor),this.spriteEditor.scrollX(this.spriteEditor.padding),this.spriteEditor.scrollY(this.spriteEditor.padding)):"costumes"===this.currentTab?(this.spriteEditor=new WardrobeMorph(this.currentSprite,this.sliderColor),this.spriteEditor.color=this.groupColor,this.add(this.spriteEditor),this.spriteEditor.updateSelection(),this.spriteEditor.acceptsDrops=!1,this.spriteEditor.contents.acceptsDrops=!1):"sounds"===this.currentTab?(this.spriteEditor=new JukeboxMorph(this.currentSprite,this.sliderColor),this.spriteEditor.color=this.groupColor,this.add(this.spriteEditor),this.spriteEditor.updateSelection(),this.spriteEditor.acceptDrops=!1,this.spriteEditor.contents.acceptsDrops=!1):(this.spriteEditor=new Morph,this.spriteEditor.color=this.groupColor,this.spriteEditor.acceptsDrops=!0,this.spriteEditor.reactToDropOf=function(t){t instanceof DialogBoxMorph?e.world().add(t):t instanceof SpriteMorph?e.removeSprite(t):t.destroy()},this.add(this.spriteEditor))},IDE_Morph.prototype.createCorralBar=function(){var t,e,o=5,i=[this.groupColor,this.frameColor.darker(50),this.frameColor.darker(50)];this.corralBar&&this.corralBar.destroy(),this.corralBar=new Morph,this.corralBar.color=this.frameColor,this.corralBar.setHeight(this.logo.height()),this.add(this.corralBar),t=new PushButtonMorph(this,"addNewSprite",new SymbolMorph("turtle",14)),t.corner=12,t.color=i[0],t.highlightColor=i[1],t.pressColor=i[2],t.labelMinExtent=new Point(36,18),t.padding=0,t.labelShadowOffset=new Point(-1,-1),t.labelShadowColor=i[1],t.labelColor=this.buttonLabelColor,t.contrast=this.buttonContrast,t.drawNew(),t.hint="add a new Turtle sprite",t.fixLayout(),t.setCenter(this.corralBar.center()),t.setLeft(this.corralBar.left()+o),this.corralBar.add(t),e=new PushButtonMorph(this,"paintNewSprite",new SymbolMorph("brush",15)),e.corner=12,e.color=i[0],e.highlightColor=i[1],e.pressColor=i[2],e.labelMinExtent=new Point(36,18),e.padding=0,e.labelShadowOffset=new Point(-1,-1),e.labelShadowColor=i[1],e.labelColor=this.buttonLabelColor,e.contrast=this.buttonContrast,e.drawNew(),e.hint="paint a new sprite",e.fixLayout(),e.setCenter(this.corralBar.center()),e.setLeft(this.corralBar.left()+o+t.width()+o),this.corralBar.add(e),"STUDENT"==world.role&&this.corralBar.hide()},IDE_Morph.prototype.createCorral=function(){var t,e,o=5,i=this;if(this.corral&&this.corral.destroy(),this.corral=new Morph,this.corral.color=this.groupColor,this.add(this.corral),this.corral.stageIcon=new SpriteIconMorph(this.stage),this.corral.stageIcon.isDraggable=!1,"STUDENT"!==world.role&&this.corral.add(this.corral.stageIcon),t=new ScrollFrameMorph(null,null,this.sliderColor),t.acceptsDrops=!1,t.contents.acceptsDrops=!1,t.contents.wantsDropOf=function(t){return t instanceof SpriteIconMorph},t.contents.reactToDropOf=function(t){i.corral.reactToDropOf(t)},t.alpha=0,"STUDENT"===world.role){var r=1;this.sprites.asArray().forEach(function(o){r>0&&(e=new SpriteIconMorph(o,e),e.isDraggable=!1,t.contents.add(e)),r--})}else this.sprites.asArray().forEach(function(o){e=new SpriteIconMorph(o,e),t.contents.add(e)});this.corral.frame=t,this.corral.add(t),this.corral.fixLayout=function(){this.stageIcon.setCenter(this.center()),this.stageIcon.setLeft(this.left()+o),this.frame.setLeft(this.stageIcon.right()+o),this.frame.setExtent(new Point(this.right()-this.frame.left(),this.height())),this.arrangeIcons(),this.refresh()},this.corral.arrangeIcons=function(){var t=this.frame.left(),e=this.frame.top(),o=this.frame.right(),i=this.frame.left();this.frame.contents.children.forEach(function(r){var n=r.width();t+n>o&&(t=i,e+=r.height()),r.setPosition(new Point(t,e)),t+=n}),this.frame.contents.adjustBounds()},this.corral.addSprite=function(t){this.frame.contents.add(new SpriteIconMorph(t)),this.fixLayout()},this.corral.refresh=function(){this.stageIcon.refresh(),this.frame.contents.children.forEach(function(t){t.refresh()})},this.corral.wantsDropOf=function(t){return t instanceof SpriteIconMorph},this.corral.reactToDropOf=function(t){var e=1,o=t.position();t.destroy(),this.frame.contents.children.forEach(function(t){(o.gt(t.position())||o.y>t.bottom())&&(e+=1)}),i.sprites.add(t.object,e),i.createCorral(),i.fixLayout()}},IDE_Morph.prototype.fixLayout=function(t){var e=this.padding;Morph.prototype.trackChanges=!1,"refreshPalette"!==t&&(this.controlBar.setPosition(this.logo.topRight()),this.controlBar.setWidth(this.right()-this.controlBar.left()),this.controlBar.fixLayout(),this.categories.setLeft(this.logo.left()),this.categories.setTop(this.logo.bottom())),this.palette.setLeft(this.logo.left()),this.palette.setTop(this.categories.bottom()),this.palette.setHeight(this.bottom()-this.palette.top()),"refreshPalette"!==t&&(this.isAppMode?(this.stage.setScale(Math.floor(10*Math.min((this.width()-2*e)/this.stage.dimensions.x,(this.height()-2*this.controlBar.height()-2*e)/this.stage.dimensions.y))/10),this.stage.setCenter(this.center())):(this.stage.setScale(this.isSmallStage?this.stageRatio:1),this.stage.setTop(this.logo.bottom()+e),this.stage.setRight(this.right())),this.spriteBar.setPosition(this.logo.bottomRight().add(e)),this.spriteBar.setExtent(new Point(Math.max(0,this.stage.left()-e-this.spriteBar.left()),this.categories.bottom()-this.spriteBar.top()-e)),this.spriteBar.fixLayout(),this.spriteEditor.isVisible&&(this.spriteEditor.setPosition(this.spriteBar.bottomLeft()),this.spriteEditor.setExtent(new Point(this.spriteBar.width(),this.bottom()-this.spriteEditor.top()))),this.corralBar.setLeft(this.stage.left()),this.corralBar.setTop(this.stage.bottom()+e),this.corralBar.setWidth(this.stage.width()),contains(["selectSprite","tabEditor"],t)||(this.corral.setPosition(this.corralBar.bottomLeft()),this.corral.setWidth(this.stage.width()),this.corral.setHeight(this.bottom()-this.corral.top()),this.corral.fixLayout())),Morph.prototype.trackChanges=!0,this.changed()},IDE_Morph.prototype.setProjectName=function(t){this.projectName=t.replace(/['"]/g,""),this.hasChangedMedia=!0,this.controlBar.updateLabel()},IDE_Morph.prototype.setExtent=function(t){var e,o,i=new Point(430,110);e=this.isAppMode?StageMorph.prototype.dimensions.add(this.controlBar.height()+10):i.add(this.isSmallStage?StageMorph.prototype.dimensions.divideBy(2):StageMorph.prototype.dimensions),o=t.max(e),IDE_Morph.uber.setExtent.call(this,o),this.fixLayout()},IDE_Morph.prototype.reactToWorldResize=function(t){this.isAutoFill&&(this.setPosition(t.origin),this.setExtent(t.extent())),this.filePicker&&(document.body.removeChild(this.filePicker),this.filePicker=null)},IDE_Morph.prototype.droppedImage=function(t,e){var o=new Costume(t,e?e.split(".")[0]:"");return o.isTainted()?void this.inform("Unable to import this image","The picture you wish to import has been\ntainted by a restrictive cross-origin policy\nmaking it unusable for costumes in Snap!. \n\nTry downloading this picture first to your\ncomputer, and import it from there."):(this.currentSprite.addCostume(o),this.currentSprite.wearCostume(o),this.spriteBar.tabBar.tabTo("costumes"),void(this.hasChangedMedia=!0))},IDE_Morph.prototype.droppedSVG=function(t,e){var o=new SVG_Costume(t,e.split(".")[0]);this.currentSprite.addCostume(o),this.currentSprite.wearCostume(o),this.spriteBar.tabBar.tabTo("costumes"),this.hasChangedMedia=!0,this.showMessage("SVG costumes are\nnot yet fully supported\nin every browser",2)},IDE_Morph.prototype.droppedAudio=function(t,e){this.currentSprite.addSound(t,e.split(".")[0]),this.spriteBar.tabBar.tabTo("sounds"),this.hasChangedMedia=!0},IDE_Morph.prototype.droppedText=function(t,e){var o=e?e.split(".")[0]:"";return 0===t.indexOf("<project")?this.openProjectString(t):0===t.indexOf("<snapdata")?this.openCloudDataString(t):0===t.indexOf("<blocks")?this.openBlocksString(t,o,!0):0===t.indexOf("<sprites")?this.openSpritesString(t):0===t.indexOf("<media")?this.openMediaString(t):void 0},IDE_Morph.prototype.droppedBinary=function(t,e){function o(t,e){var o=new sb.Reader,i=e.split(".")[0];o.onload=function(t){r.droppedText((new sb.XMLWriter).write(i,t))},o.readYPR(new Uint8Array(t))}var i=document.getElementById("ypr"),r=this,n=e.substring(e.length-3);"ypr"===n.toLowerCase()&&(i?o(t,e):(i=document.createElement("script"),i.id="ypr",i.onload=function(){o(t,e)},document.head.appendChild(i),i.src="ypr.js"))},IDE_Morph.prototype.refreshPalette=function(t){var e=this.palette.contents.top();this.createPalette(),this.fixLayout("refreshPalette"),t||this.palette.contents.setTop(e)},IDE_Morph.prototype.pressStart=function(){16===this.world().currentKey?this.toggleFastTracking():(this.stopAllScripts(),this.runScripts())},IDE_Morph.prototype.toggleFastTracking=function(){this.stage.isFastTracked?this.stopFastTracking():this.startFastTracking()},IDE_Morph.prototype.toggleVariableFrameRate=function(){StageMorph.prototype.frameRate?(StageMorph.prototype.frameRate=0,this.stage.fps=0):(StageMorph.prototype.frameRate=30,this.stage.fps=30)},IDE_Morph.prototype.startFastTracking=function(){this.stage.isFastTracked=!0,this.stage.fps=0,this.controlBar.startButton.labelString=new SymbolMorph("flash",14),this.controlBar.startButton.drawNew(),this.controlBar.startButton.fixLayout()},IDE_Morph.prototype.stopFastTracking=function(){this.stage.isFastTracked=!1,this.stage.fps=this.stage.frameRate,this.controlBar.startButton.labelString=new SymbolMorph("flag",14),this.controlBar.startButton.drawNew(),this.controlBar.startButton.fixLayout()},IDE_Morph.prototype.runScripts=function(){this.stage.fireGreenFlagEvent()},IDE_Morph.prototype.togglePauseResume=function(){this.stage.threads.isPaused()?this.stage.threads.resumeAll(this.stage):this.stage.threads.pauseAll(this.stage),this.controlBar.pauseButton.refresh()},IDE_Morph.prototype.isPaused=function(){return this.stage?this.stage.threads.isPaused():!1},IDE_Morph.prototype.stopAllScripts=function(){this.stage.fireStopAllEvent()},IDE_Morph.prototype.selectSprite=function(t){this.currentSprite=t,this.createPalette(),this.createSpriteBar(),this.createSpriteEditor(),this.corral.refresh(),this.fixLayout("selectSprite"),this.currentSprite.scripts.fixMultiArgs()},IDE_Morph.prototype.defaultDesign=function(){this.setDefaultDesign(),this.refreshIDE(),this.removeSetting("design")},IDE_Morph.prototype.flatDesign=function(){this.setFlatDesign(),this.refreshIDE(),this.saveSetting("design","flat")},IDE_Morph.prototype.refreshIDE=function(){var t;if(Process.prototype.isCatchingErrors)try{t=this.serializer.serialize(this.stage)}catch(e){this.showMessage("Serialization failed: "+e)}else t=this.serializer.serialize(this.stage);SpriteMorph.prototype.initBlocks(),this.buildPanes(),this.fixLayout(),this.loadNewProject?this.newProject():this.openProjectString(t)},IDE_Morph.prototype.applySavedSettings=function(){var t=this.getSetting("design"),e=this.getSetting("zoom"),o=this.getSetting("language"),i=this.getSetting("click"),r=this.getSetting("longform"),n=this.getSetting("plainprototype");"flat"===t?this.setFlatDesign():this.setDefaultDesign(),e&&(SyntaxElementMorph.prototype.setScale(e),CommentMorph.prototype.refreshScale(),SpriteMorph.prototype.initBlocks()),this.userLanguage=o&&"en"!==o?o:"STUDENT"==world.role?"fr":null,i&&!BlockMorph.prototype.snapSound&&BlockMorph.prototype.toggleSnapSound(),r&&(InputSlotDialogMorph.prototype.isLaunchingExpanded=!0),n&&(BlockLabelPlaceHolderMorph.prototype.plainLabel=!0)},IDE_Morph.prototype.saveSetting=function(t,e){localStorage&&(localStorage["-snap-setting-"+t]=e)},IDE_Morph.prototype.getSetting=function(t){return localStorage?localStorage["-snap-setting-"+t]:null},IDE_Morph.prototype.removeSetting=function(t){localStorage&&delete localStorage["-snap-setting-"+t]},IDE_Morph.prototype.addNewSprite=function(){var t=new SpriteMorph(this.globalVariables),e=Process.prototype.reportRandom;t.name=t.name+(this.corral.frame.contents.children.length+1),t.setCenter(this.stage.center()),this.stage.add(t),t.setHue(e.call(this,0,100)),t.setBrightness(e.call(this,50,100)),t.turn(e.call(this,1,360)),t.setXPosition(e.call(this,-220,220)),t.setYPosition(e.call(this,-160,160)),this.sprites.add(t),this.corral.addSprite(t),this.selectSprite(t)},IDE_Morph.prototype.paintNewSprite=function(){var t=new SpriteMorph(this.globalVariables),e=new Costume,o=this;t.name=t.name+(this.corral.frame.contents.children.length+1),t.setCenter(this.stage.center()),this.stage.add(t),this.sprites.add(t),this.corral.addSprite(t),this.selectSprite(t),e.edit(this.world(),this,!0,function(){o.removeSprite(t)},function(){t.addCostume(e),t.wearCostume(e)})},IDE_Morph.prototype.duplicateSprite=function(t){var e=t.fullCopy();e.name=t.name+"(2)",e.setPosition(this.world().hand.position()),this.stage.add(e),e.keepWithin(this.stage),this.sprites.add(e),this.corral.addSprite(e),this.selectSprite(e)},IDE_Morph.prototype.removeSprite=function(t){var e=this.sprites.asArray().indexOf(t)+1;t.destroy(),this.stage.watchers().forEach(function(e){e.object()===t&&e.destroy()}),1>e||(this.currentSprite=detect(this.stage.children,function(t){return t instanceof SpriteMorph})||this.stage,this.sprites.remove(this.sprites.asArray().indexOf(t)+1),this.createCorral(),this.fixLayout(),this.selectSprite(this.currentSprite))},IDE_Morph.prototype.userMenu=function(){var t=new MenuMorph(this);return t.addItem("help","nop"),t},IDE_Morph.prototype.snapMenu=function(){var t,e=this.world();t=new MenuMorph(this),"STUDENT"!=e.role&&(t.addItem("About...","aboutSnap"),t.addLine(),t.addItem("Reference manual",function(){window.open("help/SnapManual.pdf","SnapReferenceManual")}),t.addItem("Snap! website",function(){window.open("http://snap.berkeley.edu/","SnapWebsite")}),t.addItem("Download source",function(){window.open("http://snap.berkeley.edu/snapsource/snap.zip","SnapSource")})),e.isDevMode?(t.addLine(),t.addItem("Switch back to user mode","switchToUserMode","disable deep-Morphic\ncontext menus\nand show user-friendly ones",new Color(0,100,0))):16===e.currentKey&&(t.addLine(),t.addItem("Switch to dev mode","switchToDevMode","enable Morphic\ncontext menus\nand inspectors,\nnot user-friendly!",new Color(100,0,0))),t.popup(e,this.logo.bottomLeft())},IDE_Morph.prototype.settingsMenu=function(){function t(t,o,i,r,n,a){var h="\u2611 ",l="\u2610 ";(!a||s)&&e.addItem((i?h:l)+localize(t),o,i?r:n,a?new Color(100,0,0):null)}var e,o=this.stage,i=this.world(),r=this,n=this.controlBar.settingsButton.bottomLeft(),s=16===i.currentKey;e=new MenuMorph(this),e.addItem("Language...","languageMenu"),e.addItem("Zoom blocks...","userSetBlocksScale"),"STUDENT"!=i.role&&(e.addLine(),t("Blurred shadows","toggleBlurredShadows",useBlurredShadows,"uncheck to use solid drop\nshadows and highlights","check to use blurred drop\nshadows and highlights",!0),t("Zebra coloring","toggleZebraColoring",BlockMorph.prototype.zebraContrast,"uncheck to disable alternating\ncolors for nested block","check to enable alternating\ncolors for nested blocks",!0),t("Dynamic input labels","toggleDynamicInputLabels",SyntaxElementMorph.prototype.dynamicInputLabels,"uncheck to disable dynamic\nlabels for variadic inputs","check to enable dynamic\nlabels for variadic inputs",!0),t("Prefer empty slot drops","togglePreferEmptySlotDrops",ScriptsMorph.prototype.isPreferringEmptySlots,"uncheck to allow dropped\nreporters to kick out others","settings menu prefer empty slots hint",!0),t("Long form input dialog","toggleLongFormInputDialog",InputSlotDialogMorph.prototype.isLaunchingExpanded,"uncheck to use the input\ndialog in short form","check to always show slot\ntypes in the input dialog"),t("Virtual keyboard","toggleVirtualKeyboard",MorphicPreferences.useVirtualKeyboard,"uncheck to disable\nvirtual keyboard support\nfor mobile devices","check to enable\nvirtual keyboard support\nfor mobile devices",!0),t("Input sliders","toggleInputSliders",MorphicPreferences.useSliderForInput,"uncheck to disable\ninput sliders for\nentry fields","check to enable\ninput sliders for\nentry fields"),MorphicPreferences.useSliderForInput&&t("Execute on slider change","toggleSliderExecute",InputSlotMorph.prototype.executeOnSliderEdit,"uncheck to supress\nrunning scripts\nwhen moving the slider","check to run\nthe edited script\nwhen moving the slider"),t("Clicking sound",function(){BlockMorph.prototype.toggleSnapSound(),BlockMorph.prototype.snapSound?r.saveSetting("click",!0):r.removeSetting("click")},BlockMorph.prototype.snapSound,"uncheck to turn\nblock clicking\nsound off","check to turn\nblock clicking\nsound on"),t("Animations",function(){r.isAnimating=!r.isAnimating},r.isAnimating,"uncheck to disable\nIDE animations","check to enable\nIDE animations",!0),t("Turbo mode","toggleFastTracking",this.stage.isFastTracked,"uncheck to run scripts\nat normal speed","check to prioritize\nscript execution"),t("Rasterize SVGs",function(){MorphicPreferences.rasterizeSVGs=!MorphicPreferences.rasterizeSVGs},MorphicPreferences.rasterizeSVGs,"uncheck for smooth\nscaling of vector costumes","check to rasterize\nSVGs on import",!0),t("Flat design",function(){return MorphicPreferences.isFlat?r.defaultDesign():void r.flatDesign()},MorphicPreferences.isFlat,"uncheck for default\nGUI design","check for alternative\nGUI design",!1),t("Sprite Nesting",function(){SpriteMorph.prototype.enableNesting=!SpriteMorph.prototype.enableNesting},SpriteMorph.prototype.enableNesting,"uncheck to disable\nsprite composition","check to enable\nsprite composition",!0),e.addLine(),t("Thread safe scripts",function(){o.isThreadSafe=!o.isThreadSafe},this.stage.isThreadSafe,"uncheck to allow\nscript reentrance","check to disallow\nscript reentrance"),t("Prefer smooth animations","toggleVariableFrameRate",StageMorph.prototype.frameRate,"uncheck for greater speed\nat variable frame rates","check for smooth, predictable\nanimations across computers"),t("Codification support",function(){StageMorph.prototype.enableCodeMapping=!StageMorph.prototype.enableCodeMapping,r.currentSprite.blocksCache.variables=null,r.currentSprite.paletteCache.variables=null,r.refreshPalette()},StageMorph.prototype.enableCodeMapping,"uncheck to disable\nblock to text mapping features","check for block\nto text mapping features",!1),t("Clicking sound",function(){BlockMorph.prototype.toggleSnapSound(),BlockMorph.prototype.snapSound?r.saveSetting("click",!0):r.removeSetting("click")},BlockMorph.prototype.snapSound,"uncheck to turn\nblock clicking\nsound off","check to turn\nblock clicking\nsound on"),t("Animations",function(){r.isAnimating=!r.isAnimating},r.isAnimating,"uncheck to disable\nIDE animations","check to enable\nIDE animations",!0),t("Turbo mode","toggleFastTracking",this.stage.isFastTracked,"uncheck to run scripts\nat normal speed","check to prioritize\nscript execution"),t("Rasterize SVGs",function(){MorphicPreferences.rasterizeSVGs=!MorphicPreferences.rasterizeSVGs},MorphicPreferences.rasterizeSVGs,"uncheck for smooth\nscaling of vector costumes","check to rasterize\nSVGs on import",!0),t("Flat design",function(){return MorphicPreferences.isFlat?r.defaultDesign():void r.flatDesign()},MorphicPreferences.isFlat,"uncheck for default\nGUI design","check for alternative\nGUI design",!1),t("Sprite Nesting",function(){SpriteMorph.prototype.enableNesting=!SpriteMorph.prototype.enableNesting
},SpriteMorph.prototype.enableNesting,"uncheck to disable\nsprite composition","check to enable\nsprite composition",!0),e.addLine(),t("Thread safe scripts",function(){o.isThreadSafe=!o.isThreadSafe},this.stage.isThreadSafe,"uncheck to allow\nscript reentrance","check to disallow\nscript reentrance"),t("Prefer smooth animations","toggleVariableFrameRate",StageMorph.prototype.frameRate,"uncheck for greater speed\nat variable frame rates","check for smooth, predictable\nanimations across computers"),t("Flat line ends",function(){SpriteMorph.prototype.useFlatLineEnds=!SpriteMorph.prototype.useFlatLineEnds},SpriteMorph.prototype.useFlatLineEnds,"uncheck for round ends of lines","check for flat ends of lines"),t("Codification support",function(){StageMorph.prototype.enableCodeMapping=!StageMorph.prototype.enableCodeMapping,r.currentSprite.blocksCache.variables=null,r.currentSprite.paletteCache.variables=null,r.refreshPalette()},StageMorph.prototype.enableCodeMapping,"uncheck to disable\nblock to text mapping features","check for block\nto text mapping features",!1)),e.popup(i,n)},IDE_Morph.prototype.missionMenu=function(){var t,e=this,o=this.world(),i=this.controlBar.infoMissionButton.bottomLeft();t=new MenuMorph(this),"projects"!=document.location.pathname.split("/")[1]&&t.addItem(localize("Description"),"descriptionMission");var r=function(t,e){var o=!1;return t.forEach(function(t){o=o||t==e}),o};"TEACHER"===o.role&&r(window.location.href.split("/"),"programs")&&t.addItem(localize("mission is solved"),"sendMissionSolved"),"TEACHER"===o.role&&r(window.location.href.split("/"),"programs")&&t.addItem(localize("mission is corrected"),"sendMissionCorrected"),t.addItem(localize("Save project on server"),function(){e.projectName&&"Untitled"!=e.projectName?e.exportProjectToServer():e.prompt("Export Project As...",function(t){e.exportProjectToServer(t)},null,"exportProject")}),"projects"!=document.location.pathname.split("/")[1]?(t.addItem(localize("All courses list"),function(){e.goToURL("/courses")},localize("Redirection on the list of all courses")),t.addItem(localize("Reset the mission"),"resetMission",localize("Drop the current mission and open a fresh one"))):t.addItem(localize("All Projects list"),function(){e.goToURL("/projects")},localize("Redirection on the list of all projects")),t.popup(o,i)},IDE_Morph.prototype.projectMenu=function(){var t,e=this,o=this.world(),i=this.controlBar.projectButton.bottomLeft(),r=this.currentSprite instanceof SpriteMorph?"Costumes":"Backgrounds",n=16===o.currentKey;t=new MenuMorph(this),t.addItem("Project notes...","editProjectNotes"),t.addLine(),t.addItem("New",function(){e.confirm("Replace the current project with a new one?","New Project",function(){e.newProject()})}),t.addItem("Open...","openProjectsBrowser"),t.addItem("Save",function(){"examples"===e.source&&(e.source="local"),e.projectName?"local"===e.source?e.saveProject(e.projectName):e.saveProjectToCloud(e.projectName):e.saveProjectsBrowser()}),n&&t.addItem("Save to disk","saveProjectToDisk","experimental - store this project\nin your downloads folder",new Color(100,0,0)),t.addItem("Save As...","saveProjectsBrowser"),t.addLine(),t.addItem("Import...",function(){var t=document.createElement("input");e.filePicker&&(document.body.removeChild(e.filePicker),e.filePicker=null),t.type="file",t.style.color="transparent",t.style.backgroundColor="transparent",t.style.border="none",t.style.outline="none",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width="0px",t.style.height="0px",t.addEventListener("change",function(){document.body.removeChild(t),e.filePicker=null,o.hand.processDrop(t.files)},!1),document.body.appendChild(t),e.filePicker=t,t.click()},"file menu import hint"),t.addItem(n?"Export project as plain text...":"Export project...",function(){e.projectName?e.exportProject(e.projectName,n):e.prompt("Export Project As...",function(t){e.exportProject(t)},null,"exportProject")},"show project data as XML\nin a new browser window",n?new Color(100,0,0):null),t.addItem("Export blocks...",function(){e.exportGlobalBlocks()},"show global custom block definitions as XML\nin a new browser window"),"STUDENT"!=o.role&&(t.addLine(),t.addItem("Import tools",function(){e.droppedText(e.getURL("http://snap.berkeley.edu/snapsource/tools.xml"),"tools")},"load the official library of\npowerful blocks"),t.addItem("Libraries...",function(){function t(t){var o="http://snap.berkeley.edu/snapsource/libraries/"+t+".xml";e.droppedText(e.getURL(o),t)}var r=new MenuMorph(this,"Import library"),n="http://snap.berkeley.edu/snapsource/libraries/LIBRARIES";e.getURL(n).split("\n").forEach(function(e){e.length>0&&r.addItem(e.substring(e.indexOf("	")+1),function(){t(e.substring(0,e.indexOf("	")))})}),r.popup(o,i)},"Select categories of additional blocks to add to this project."),t.addLine(),t.addItem("Import tools",function(){e.droppedText(e.getURL("http://snap.berkeley.edu/snapsource/tools.xml"),"tools")},"load the official library of\npowerful blocks")),t.addItem(localize(r)+"...",function(){function t(t){var o=window.getAsset(n+"/"+t),i=new Image;i.onload=function(){var o=newCanvas(new Point(i.width,i.height));o.getContext("2d").drawImage(i,0,0),e.droppedImage(o,t)},i.src=o}var n=r,s=e.getCostumesList(n),a=new MenuMorph(e,localize("Import")+" "+localize(n));s.forEach(function(e){e.length>0&&a.addItem(e,function(){t(e)})}),a.popup(o,i)},"Select a costume from the media library"),t.addItem(localize("Sounds")+"...",function(){function t(t){var o="Sounds/"+t,i=new Audio;i.src=o,i.load(),e.droppedAudio(i,t)}var r=this.getCostumesList("Sounds"),n=new MenuMorph(this,"Import sound");r.forEach(function(e){e.length>0&&n.addItem(e,function(){t(e)})}),n.popup(o,i)},"Select a sound from the media library"),t.popup(o,i)},IDE_Morph.prototype.getCostumesList=function(t){var e;return e=window.getAsset(t),e.sort(function(t,e){return e>t?-1:1}),e},IDE_Morph.prototype.descriptionMission=function(){jQuery("#missionModal").modal("toggle")},IDE_Morph.prototype.goalMission=function(){"STUDENT"==world.role&&jQuery("#goalModal").modal("toggle")},IDE_Morph.prototype.goToURL=function(t){var e,o=(new DialogBoxMorph).withKey("Sauvegarde"),i=this,r=this.world(),n=localize("Do you want to save befor exit?");o.inform(localize("Save"),n,r),o.addButton(function(){i.projectName&&"Untitled"!=i.projectName?i.exportProjectToServer():i.prompt("Export Project As...",function(t){i.exportProjectToServer(t)},null,"exportProject"),window.location.href=window.location.protocol+"//"+window.location.host+t},localize("Yes")),o.addButton(function(){window.location.href=window.location.protocol+"//"+window.location.host+t},localize("non")),e=o.buttons.children[0],e.hide(),o.fixLayout(),o.drawNew()},IDE_Morph.prototype.resetMission=function(){var t=new XMLHttpRequest,e=this,o=window.location.pathname.split("/")[2],i="/initialization_program_missions/"+o;try{t.open("PUT",i,!1);var r=document.getElementsByName("csrf-token").item(0).content;t.setRequestHeader("X-CSRF-Token",r),t.send()}catch(n){e.showMessage(n)}location.reload(!0)},IDE_Morph.prototype.aboutSnap=function(){var t,e,o,i,r,n,s,a,h,l,p,c,d="",u=this.world();e="Snap! 4.0\nBuild Your Own Blocks\n\n--- beta ---\n\nCopyright \u24b8 2014 Jens M\xf6nig and Brian Harvey\njens@moenig.org, bh@cs.berkeley.edu\n\nSnap! is developed by the University of California, Berkeley\n          with support from the National Science Foundation and MioSoft.   \nThe design of Snap! is influenced and inspired by Scratch,\nfrom the Lifelong Kindergarten group at the MIT Media Lab\n\nfor more information see http://snap.berkeley.edu\nand http://scratch.mit.edu",o=localize("License")+"\n\nSnap! is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as\npublished by the Free Software Foundation, either version 3 of\nthe License, or (at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the\nGNU Affero General Public License along with this program.\nIf not, see http://www.gnu.org/licenses/",i=localize("Contributors")+"\n\nNathan Dinsmore: Saving/Loading, Snap-Logo Design, countless bugfixes\nKartik Chandra: Paint Editor\nIan Reynolds: UI Design, Event Bindings, Sound primitives\nIvan Motyashov: Initial Squeak Porting\nDavide Della Casa: Morphic Optimizations\nAchal Dave: Web Audio\nJoe Otto: Morphic Testing and Debugging";for(n in modules)Object.prototype.hasOwnProperty.call(modules,n)&&(d+="\n"+n+" ("+modules[n]+")");""!==d&&(d=localize("current module versions:")+" \n\nmorphic ("+morphicVersion+")"+d),r=localize("Translations")+"\n"+SnapTranslator.credits(),t=new DialogBoxMorph,t.inform("About Snap",e,u),s=t.buttons.children[0],c=t.addButton(function(){t.body.text=r,t.body.drawNew(),s.show(),a.show(),h.hide(),l.hide(),p.hide(),c.hide(),t.fixLayout(),t.drawNew(),t.setCenter(u.center())},"Translators..."),a=t.addButton(function(){t.body.text=e,t.body.drawNew(),s.show(),a.hide(),h.show(),l.show(),p.show(),c.hide(),t.fixLayout(),t.drawNew(),t.setCenter(u.center())},"Back..."),a.hide(),p=t.addButton(function(){t.body.text=o,t.body.drawNew(),s.show(),a.show(),h.hide(),l.hide(),p.hide(),c.hide(),t.fixLayout(),t.drawNew(),t.setCenter(u.center())},"License..."),h=t.addButton(function(){t.body.text=d,t.body.drawNew(),s.show(),a.show(),h.hide(),l.hide(),p.hide(),c.hide(),t.fixLayout(),t.drawNew(),t.setCenter(u.center())},"Modules..."),l=t.addButton(function(){t.body.text=i,t.body.drawNew(),s.show(),a.show(),c.show(),h.hide(),l.hide(),p.hide(),t.fixLayout(),t.drawNew(),t.setCenter(u.center())},"Credits..."),c.hide(),t.fixLayout(),t.drawNew()},IDE_Morph.prototype.editProjectNotes=function(){var t=(new DialogBoxMorph).withKey("projectNotes"),e=new ScrollFrameMorph,o=new TextMorph(this.projectNotes||""),i=t.ok,r=this,n=250,s=this.world();e.padding=6,e.setWidth(n),e.acceptsDrops=!1,e.contents.acceptsDrops=!1,o.setWidth(n-2*e.padding),o.setPosition(e.topLeft().add(e.padding)),o.enableSelecting(),o.isEditable=!0,e.setHeight(n),e.fixLayout=nop,e.edge=InputFieldMorph.prototype.edge,e.fontSize=InputFieldMorph.prototype.fontSize,e.typeInPadding=InputFieldMorph.prototype.typeInPadding,e.contrast=InputFieldMorph.prototype.contrast,e.drawNew=InputFieldMorph.prototype.drawNew,e.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,e.addContents(o),o.drawNew(),t.ok=function(){r.projectNotes=o.text,i.call(this)},t.justDropped=function(){o.edit()},t.labelString="Project Notes",t.createLabel(),t.addBody(e),e.drawNew(),t.addButton("ok","OK"),t.addButton("cancel","Cancel"),t.fixLayout(),t.drawNew(),t.popUp(s),t.setCenter(s.center()),o.edit()},IDE_Morph.prototype.newProject=function(){this.source=SnapCloud.username?"cloud":"local",this.stage&&this.stage.destroy(),"#lang:"!==location.hash.substr(0,6)&&(location.hash=""),this.globalVariables=new VariableFrame,this.currentSprite=new SpriteMorph(this.globalVariables),this.sprites=new List([this.currentSprite]),StageMorph.prototype.dimensions=new Point(480,360),StageMorph.prototype.hiddenPrimitives={},StageMorph.prototype.codeMappings={},StageMorph.prototype.codeHeaders={},StageMorph.prototype.enableCodeMapping=!1,SpriteMorph.prototype.useFlatLineEnds=!1,this.setProjectName(""),this.projectNotes="",this.createStage(),this.add(this.stage),this.createCorral(),this.selectSprite(this.stage.children[0]),this.fixLayout()},IDE_Morph.prototype.saveProject=function(t){var e=this;this.nextSteps([function(){e.showMessage("Saving...")},function(){e.rawSaveProject(t)}])},IDE_Morph.prototype.rawSaveProject=function(t){var e;if(t)if(this.setProjectName(t),Process.prototype.isCatchingErrors)try{localStorage["-snap-project-"+t]=e=this.serializer.serialize(this.stage),location.hash="#open:"+e,this.showMessage("Saved!",1)}catch(o){this.showMessage("Save failed: "+o)}else localStorage["-snap-project-"+t]=e=this.serializer.serialize(this.stage),location.hash="#open:"+e,this.showMessage("Saved!",1)},IDE_Morph.prototype.saveProjectToDisk=function(){var t,e=document.createElement("a");if(Process.prototype.isCatchingErrors)try{t=this.serializer.serialize(this.stage),e.setAttribute("href","data:text/xml,"+t),e.setAttribute("download",this.projectName+".xml"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}catch(o){this.showMessage("Saving failed: "+o)}else t=this.serializer.serialize(this.stage),e.setAttribute("href","data:text/xml,"+t),e.setAttribute("download",this.projectName+".xml"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},IDE_Morph.prototype.exportProject=function(t,e){var o,i;if(t)if(this.setProjectName(t),Process.prototype.isCatchingErrors)try{o=this.showMessage("Exporting"),i=encodeURIComponent(this.serializer.serialize(this.stage)),location.hash="#open:"+i,window.open("data:text/"+(e?"plain,"+i:"xml,"+i)),o.destroy(),this.showMessage(localize("Exported!"),1)}catch(r){this.showMessage("Export failed: "+r)}else o=this.showMessage("Exporting"),i=encodeURIComponent(this.serializer.serialize(this.stage)),location.hash="#open:"+i,window.open("data:text/"+(e?"plain,"+i:"xml,"+i)),o.destroy(),this.showMessage(localize("Exported!"),1)},IDE_Morph.prototype.exportProjectToServer=function(t,e){function o(t,e,o){try{var i=new XMLHttpRequest({responseType:"json"});o?i.open("POST",t,!1):i.open("PUT",t,!1);var r=document.getElementsByName("csrf-token").item(0).content;if(i.setRequestHeader("X-CSRF-Token",r),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Accept","application/json"),i.send(JSON.stringify(e)),200===i.status)return o&&(responseJSON=JSON.parse(i.responseText),history.pushState(null,"Projet : "+responseJSON.name,responseJSON.id)),i.responseText;throw new Error("unable to retrieve "+t)}catch(n){return}}var i,r,n;t&&this.setProjectName(t);try{i=this.serializer.serialize(this.stage);var s=document.location.pathname.split("/");"projects"===s[1]&&"new"===s[2]?(r={project:{name:world.children[0].projectName,source_code:i}},n=document.location.protocol+"//"+document.location.host+"/projects",o(n,r,!0)):(n=document.location.protocol+"//"+document.location.host+document.location.pathname,r="projects"===s[1]?{project:{name:world.children[0].projectName,source_code:i}}:e?{program:{source_code:i,state:e}}:{program:{source_code:i}},o(n,r,!1)),this.showMessage("Exported!",1)}catch(a){this.showMessage("Export failed: "+a)}},IDE_Morph.prototype.exportGlobalBlocks=function(){this.stage.globalBlocks.length>0?new BlockExportDialogMorph(this.serializer,this.stage.globalBlocks).popUp(this.world()):this.inform("Export blocks","this project doesn't have any\ncustom global blocks yet")},IDE_Morph.prototype.exportSprite=function(t){var e=this.serializer.serialize(t);window.open('data:text/xml,<sprites app="'+this.serializer.app+'" version="'+this.serializer.version+'">'+e+"</sprites>")},IDE_Morph.prototype.openProjectString=function(t){var e,o=this;this.nextSteps([function(){e=o.showMessage("Opening project...")},function(){o.rawOpenProjectString(t)},function(){e.destroy()}])},IDE_Morph.prototype.rawOpenProjectString=function(t){if(this.toggleAppMode(!1),this.spriteBar.tabBar.tabTo("scripts"),StageMorph.prototype.hiddenPrimitives={},StageMorph.prototype.codeMappings={},StageMorph.prototype.codeHeaders={},StageMorph.prototype.enableCodeMapping=!1,Process.prototype.isCatchingErrors)try{this.serializer.openProject(this.serializer.load(t),this)}catch(e){this.showMessage("Load failed: "+e)}else this.serializer.openProject(this.serializer.load(t),this);this.stopFastTracking()},IDE_Morph.prototype.openCloudDataString=function(t){var e,o=this;this.nextSteps([function(){e=o.showMessage("Opening project...")},function(){o.rawOpenCloudDataString(t)},function(){e.destroy()}])},IDE_Morph.prototype.rawOpenCloudDataString=function(t){var e;if(StageMorph.prototype.hiddenPrimitives={},StageMorph.prototype.codeMappings={},StageMorph.prototype.codeHeaders={},StageMorph.prototype.enableCodeMapping=!1,Process.prototype.isCatchingErrors)try{e=this.serializer.parse(t),this.serializer.loadMediaModel(e.childNamed("media")),this.serializer.openProject(this.serializer.loadProjectModel(e.childNamed("project")),this)}catch(o){this.showMessage("Load failed: "+o)}else e=this.serializer.parse(t),this.serializer.loadMediaModel(e.childNamed("media")),this.serializer.openProject(this.serializer.loadProjectModel(e.childNamed("project")),this);this.stopFastTracking()},IDE_Morph.prototype.openBlocksString=function(t,e,o){var i,r=this;this.nextSteps([function(){i=r.showMessage("Opening blocks...")},function(){r.rawOpenBlocksString(t,e,o)},function(){i.destroy()}])},IDE_Morph.prototype.rawOpenBlocksString=function(t,e,o){var i,r=this;if(Process.prototype.isCatchingErrors)try{i=this.serializer.loadBlocks(t,r.stage)}catch(n){this.showMessage("Load failed: "+n)}else i=this.serializer.loadBlocks(t,r.stage);o?(i.forEach(function(t){t.receiver=r.stage,r.stage.globalBlocks.push(t),r.stage.replaceDoubleDefinitionsFor(t)}),this.flushPaletteCache(),this.refreshPalette(),this.showMessage("Imported Blocks Module"+(e?": "+e:"")+".",2)):new BlockImportDialogMorph(i,this.stage,e).popUp()},IDE_Morph.prototype.openSpritesString=function(t){var e,o=this;this.nextSteps([function(){e=o.showMessage("Opening sprite...")},function(){o.rawOpenSpritesString(t)},function(){e.destroy()}])},IDE_Morph.prototype.rawOpenSpritesString=function(t){if(Process.prototype.isCatchingErrors)try{this.serializer.loadSprites(t,this)}catch(e){this.showMessage("Load failed: "+e)}else this.serializer.loadSprites(t,this)},IDE_Morph.prototype.openMediaString=function(t){if(Process.prototype.isCatchingErrors)try{this.serializer.loadMedia(t)}catch(e){this.showMessage("Load failed: "+e)}else this.serializer.loadMedia(t);this.showMessage("Imported Media Module.",2)},IDE_Morph.prototype.openProject=function(t){var e;t&&(this.showMessage("opening project\n"+t),this.setProjectName(t),e=localStorage["-snap-project-"+t],this.openProjectString(e),location.hash="#open:"+e)},IDE_Morph.prototype.switchToUserMode=function(){var t=this.world();t.isDevMode=!1,Process.prototype.isCatchingErrors=!0,this.controlBar.updateLabel(),this.isAutoFill=!0,this.isDraggable=!1,this.reactToWorldResize(t.bounds.copy()),this.siblings().forEach(function(e){e instanceof DialogBoxMorph?t.add(e):e.destroy()}),this.flushBlocksCache(),this.refreshPalette(),t.reactToDropOf=function(e){e instanceof DialogBoxMorph||t.hand.grab(e)},this.showMessage("entering user mode",1)},IDE_Morph.prototype.switchToDevMode=function(){var t=this.world();t.isDevMode=!0,Process.prototype.isCatchingErrors=!1,this.controlBar.updateLabel(),this.isAutoFill=!1,this.isDraggable=!0,this.setExtent(t.extent().subtract(100)),this.setPosition(t.position().add(20)),this.flushBlocksCache(),this.refreshPalette(),delete t.reactToDropOf,this.showMessage("entering development mode.\n\nerror catching is turned off,\nuse the browser's web console\nto see error messages.")},IDE_Morph.prototype.flushBlocksCache=function(t){t?(this.stage.blocksCache[t]=null,this.stage.children.forEach(function(e){e instanceof SpriteMorph&&(e.blocksCache[t]=null)})):(this.stage.blocksCache={},this.stage.children.forEach(function(t){t instanceof SpriteMorph&&(t.blocksCache={})})),this.flushPaletteCache(t)},IDE_Morph.prototype.flushPaletteCache=function(t){t?(this.stage.paletteCache[t]=null,this.stage.children.forEach(function(e){e instanceof SpriteMorph&&(e.paletteCache[t]=null)})):(this.stage.paletteCache={},this.stage.children.forEach(function(t){t instanceof SpriteMorph&&(t.paletteCache={})}))},IDE_Morph.prototype.toggleZebraColoring=function(){var t=[];BlockMorph.prototype.zebraContrast=BlockMorph.prototype.zebraContrast?0:40,this.stage.children.concat(this.stage).forEach(function(e){(e instanceof SpriteMorph||e instanceof StageMorph)&&(t=t.concat(e.scripts.children.filter(function(t){return t instanceof BlockMorph})))}),t.forEach(function(t){t.fixBlockColor(null,!0)})},IDE_Morph.prototype.toggleDynamicInputLabels=function(){var t;if(SyntaxElementMorph.prototype.dynamicInputLabels=!SyntaxElementMorph.prototype.dynamicInputLabels,Process.prototype.isCatchingErrors)try{t=this.serializer.serialize(this.stage)}catch(e){this.showMessage("Serialization failed: "+e)}else t=this.serializer.serialize(this.stage);SpriteMorph.prototype.initBlocks(),this.spriteBar.tabBar.tabTo("scripts"),this.createCategories(),this.createCorralBar(),this.openProjectString(t)},IDE_Morph.prototype.toggleBlurredShadows=function(){window.useBlurredShadows=!useBlurredShadows},IDE_Morph.prototype.toggleLongFormInputDialog=function(){InputSlotDialogMorph.prototype.isLaunchingExpanded=!InputSlotDialogMorph.prototype.isLaunchingExpanded,InputSlotDialogMorph.prototype.isLaunchingExpanded?this.saveSetting("longform",!0):this.removeSetting("longform")},IDE_Morph.prototype.togglePlainPrototypeLabels=function(){BlockLabelPlaceHolderMorph.prototype.plainLabel=!BlockLabelPlaceHolderMorph.prototype.plainLabel,BlockLabelPlaceHolderMorph.prototype.plainLabel?this.saveSetting("plainprototype",!0):this.removeSetting("plainprototype")},IDE_Morph.prototype.togglePreferEmptySlotDrops=function(){ScriptsMorph.prototype.isPreferringEmptySlots=!ScriptsMorph.prototype.isPreferringEmptySlots},IDE_Morph.prototype.toggleVirtualKeyboard=function(){MorphicPreferences.useVirtualKeyboard=!MorphicPreferences.useVirtualKeyboard},IDE_Morph.prototype.toggleInputSliders=function(){MorphicPreferences.useSliderForInput=!MorphicPreferences.useSliderForInput},IDE_Morph.prototype.toggleSliderExecute=function(){InputSlotMorph.prototype.executeOnSliderEdit=!InputSlotMorph.prototype.executeOnSliderEdit},IDE_Morph.prototype.toggleAppMode=function(t){var e=this.world(),o=[this.logo,this.controlBar.projectButton,this.controlBar.settingsButton,this.controlBar.stageSizeButton,this.corral,this.corralBar,this.spriteEditor,this.spriteBar,this.palette,this.categories],i=this.controlBar,r=this.corralBar;this.isAppMode=isNil(t)?!this.isAppMode:t,Morph.prototype.trackChanges=!1,this.isAppMode?(this.setColor(this.appModeColor),this.controlBar.setColor(this.color),this.controlBar.appModeButton.refresh(),o.forEach(function(t){t.hide()}),e.children.forEach(function(t){t instanceof DialogBoxMorph&&t.hide()})):(this.setColor(this.backgroundColor),this.controlBar.setColor(this.frameColor),o.forEach(function(t){"STUDENT"==e.role?t!=i.projectButton&&t!=i.settingsButton&&t!=i.stageSizeButton&&t!=r&&t.show():t.show()}),this.stage.setScale(1),e.children.forEach(function(t){t instanceof DialogBoxMorph&&t.show()}),e.allChildren().filter(function(t){return t instanceof ScrollFrameMorph}).forEach(function(t){t.adjustScrollBars()})),this.setExtent(this.world().extent())},IDE_Morph.prototype.toggleStageSize=function(t){function e(){i.stageRatio=1,i.step=function(){i.stageRatio-=(i.stageRatio-.5)/2,i.setExtent(r.extent()),i.stageRatio<.6&&(i.stageRatio=.5,i.setExtent(r.extent()),delete i.step)}}function o(){i.isSmallStage=!0,i.stageRatio=.5,i.step=function(){i.stageRatio+=(1-i.stageRatio)/2,i.setExtent(r.extent()),i.stageRatio>.9&&(i.isSmallStage=!1,i.setExtent(r.extent()),i.controlBar.stageSizeButton.refresh(),delete i.step)}}var i=this,r=this.world();this.isSmallStage=isNil(t)?!this.isSmallStage:t,this.isAnimating?this.isSmallStage?e():o():(this.isSmallStage&&(this.stageRatio=.5),this.setExtent(r.extent()))},IDE_Morph.prototype.openProjectsBrowser=function(){new ProjectDialogMorph(this,"open").popUp()},IDE_Morph.prototype.saveProjectsBrowser=function(){"examples"===this.source&&(this.source="local"),new ProjectDialogMorph(this,"save").popUp()},IDE_Morph.prototype.languageMenu=function(){var t=new MenuMorph(this),e=this.world(),o=this.controlBar.settingsButton.bottomLeft(),i=this;SnapTranslator.languages().forEach(function(e){t.addItem((SnapTranslator.language===e?"\u2713 ":"    ")+SnapTranslator.languageName(e),function(){i.setLanguage(e)})}),t.popup(e,o)},IDE_Morph.prototype.setLanguage=function(t,e){var o=document.getElementById("language"),i=window.getAsset("lang-"+t+".js"),r=this;return SnapTranslator.unload(),o&&document.head.removeChild(o),"en"===t?this.reflectLanguage("en",e):(o=document.createElement("script"),o.id="language",o.onload=function(){r.reflectLanguage(t,e)},document.head.appendChild(o),void(o.src=i))},IDE_Morph.prototype.reflectLanguage=function(t,e){var o;if(SnapTranslator.language=t,!this.loadNewProject)if(Process.prototype.isCatchingErrors)try{o=this.serializer.serialize(this.stage)}catch(i){this.showMessage("Serialization failed: "+i)}else o=this.serializer.serialize(this.stage);SpriteMorph.prototype.initBlocks(),this.spriteBar.tabBar.tabTo("scripts"),this.createCategories(),this.createCorralBar(),this.fixLayout(),this.loadNewProject?this.newProject():this.openProjectString(o),this.saveSetting("language",t),e&&e.call(this)},IDE_Morph.prototype.userSetBlocksScale=function(){var t,e,o,i,r,n=this;t=new CommandBlockMorph,t.color=SpriteMorph.prototype.blockColor.motion,t.setSpec(localize("build")),e=new CommandBlockMorph,e.color=SpriteMorph.prototype.blockColor.sound,e.setSpec(localize("your own")),t.nextBlock(e),e=new CommandBlockMorph,e.color=SpriteMorph.prototype.blockColor.operators,e.setSpec(localize("blocks")),t.bottomBlock().nextBlock(e),i=new FrameMorph,i.acceptsDrops=!1,i.texture=this.scriptsPaneTexture,i.setExtent(new Point(250,180)),t.setPosition(i.position().add(10)),i.add(t),o=new Morph,o.alpha=0,o.setExtent(i.extent()),o.setPosition(i.position()),i.add(o),r=function(e){t.blockSequence().forEach(function(t){t.setScale(e),t.drawNew(),t.setSpec(t.blockSpec)})},new DialogBoxMorph(null,function(t){n.setBlocksScale(t)}).withKey("zoomBlocks").prompt("Zoom blocks",SyntaxElementMorph.prototype.scale.toString(),this.world(),i,{"normal (1x)":1,"demo (1.2x)":1.2,"presentation (1.4x)":1.4,"big (2x)":2,"huge (4x)":4,"giant (8x)":8,"monstrous (10x)":10},!1,!0,1,12,r)},IDE_Morph.prototype.setBlocksScale=function(t){var e;if(Process.prototype.isCatchingErrors)try{e=this.serializer.serialize(this.stage)}catch(o){this.showMessage("Serialization failed: "+o)}else e=this.serializer.serialize(this.stage);SyntaxElementMorph.prototype.setScale(t),CommentMorph.prototype.refreshScale(),SpriteMorph.prototype.initBlocks(),this.spriteBar.tabBar.tabTo("scripts"),this.createCategories(),this.createCorralBar(),this.fixLayout(),this.openProjectString(e),this.saveSetting("zoom",t)},IDE_Morph.prototype.userSetStageSize=function(){new DialogBoxMorph(this,this.setStageExtent,this).promptVector("Stage size",StageMorph.prototype.dimensions,new Point(480,360),"Stage width","Stage height",this.world(),null,null)},IDE_Morph.prototype.setStageExtent=function(t){function e(){o.step=function(){var t=r.subtract(StageMorph.prototype.dimensions).divideBy(2);t.abs().lt(new Point(5,5))?(StageMorph.prototype.dimensions=r,delete o.step):StageMorph.prototype.dimensions=StageMorph.prototype.dimensions.add(t),o.stage.setExtent(StageMorph.prototype.dimensions),o.stage.clearPenTrails(),o.fixLayout(),this.setExtent(i.extent())}}var o=this,i=this.world(),r=t.max(new Point(480,180));this.stageRatio=1,this.isSmallStage=!1,this.controlBar.stageSizeButton.refresh(),this.setExtent(i.extent()),this.isAnimating?e():(StageMorph.prototype.dimensions=r,this.stage.setExtent(StageMorph.prototype.dimensions),this.stage.clearPenTrails(),this.fixLayout(),this.setExtent(i.extent()))},IDE_Morph.prototype.initializeCloud=function(){var t=this,e=this.world();new DialogBoxMorph(null,function(e){var o,i=hex_sha512(e.password);SnapCloud.login(e.username,i,function(){e.choice&&(o=SnapCloud.encodeDict({username:e.username,password:i}),localStorage["-snap-user"]=o),t.source="cloud",t.showMessage("now connected.",2)},t.cloudError())}).withKey("cloudlogin").promptCredentials("Sign in","login",null,null,null,null,"stay signed in on this computer\nuntil logging out",e,t.cloudIcon(),t.cloudMsg)},IDE_Morph.prototype.createCloudAccount=function(){var t=this,e=this.world();new DialogBoxMorph(null,function(o){SnapCloud.signup(o.username,o.email,function(o,i){(new DialogBoxMorph).inform(i,o+".\n\nAn e-mail with your password\nhas been sent to the address provided",e,t.cloudIcon(null,new Color(0,180,0)))},t.cloudError())}).withKey("cloudsignup").promptCredentials("Sign up","signup","http://snap.berkeley.edu/tos.html","Terms of Service...","http://snap.berkeley.edu/privacy.html","Privacy...","I have read and agree\nto the Terms of Service",e,t.cloudIcon(),t.cloudMsg)},IDE_Morph.prototype.resetCloudPassword=function(){var t=this,e=this.world();new DialogBoxMorph(null,function(o){SnapCloud.resetPassword(o.username,function(o,i){(new DialogBoxMorph).inform(i,o+".\n\nAn e-mail with a link to\nreset your password\nhas been sent to the address provided",e,t.cloudIcon(null,new Color(0,180,0)))},t.cloudError())}).withKey("cloudresetpassword").promptCredentials("Reset password","resetPassword",null,null,null,null,null,e,t.cloudIcon(),t.cloudMsg)},IDE_Morph.prototype.changeCloudPassword=function(){var t=this,e=this.world();new DialogBoxMorph(null,function(e){SnapCloud.changePassword(e.oldpassword,e.password,function(){t.logout(),t.showMessage("password has been changed.",2)},t.cloudError())}).withKey("cloudpassword").promptCredentials("Change Password","changePassword",null,null,null,null,null,e,t.cloudIcon(),t.cloudMsg)},IDE_Morph.prototype.logout=function(){var t=this;delete localStorage["-snap-user"],SnapCloud.logout(function(){SnapCloud.clear(),t.showMessage("disconnected.",2)},function(){SnapCloud.clear(),t.showMessage("disconnected.",2)})},IDE_Morph.prototype.saveProjectToCloud=function(t){var e=this;t&&(this.showMessage("Saving project\nto the cloud..."),this.setProjectName(t),SnapCloud.saveProject(this,function(){e.showMessage("saved.",2)},this.cloudError()))},IDE_Morph.prototype.exportProjectMedia=function(t){var e,o;if(this.serializer.isCollectingMedia=!0,t)if(this.setProjectName(t),Process.prototype.isCatchingErrors)try{e=this.showMessage("Exporting"),encodeURIComponent(this.serializer.serialize(this.stage)),o=encodeURIComponent(this.serializer.mediaXML(t)),window.open("data:text/xml,"+o),e.destroy(),this.showMessage("Exported!",1)}catch(i){this.serializer.isCollectingMedia=!1,this.showMessage("Export failed: "+i)}else e=this.showMessage("Exporting"),encodeURIComponent(this.serializer.serialize(this.stage)),o=encodeURIComponent(this.serializer.mediaXML()),window.open("data:text/xml,"+o),e.destroy(),this.showMessage("Exported!",1);this.serializer.isCollectingMedia=!1,this.serializer.flushMedia()},IDE_Morph.prototype.exportProjectNoMedia=function(t){var e,o;if(this.serializer.isCollectingMedia=!0,t)if(this.setProjectName(t),Process.prototype.isCatchingErrors)try{e=this.showMessage("Exporting"),o=encodeURIComponent(this.serializer.serialize(this.stage)),window.open("data:text/xml,"+o),e.destroy(),this.showMessage("Exported!",1)}catch(i){this.serializer.isCollectingMedia=!1,this.showMessage("Export failed: "+i)}else e=this.showMessage("Exporting"),o=encodeURIComponent(this.serializer.serialize(this.stage)),window.open("data:text/xml,"+o),e.destroy(),this.showMessage("Exported!",1);this.serializer.isCollectingMedia=!1,this.serializer.flushMedia()},IDE_Morph.prototype.exportProjectAsCloudData=function(t){var e,o,i,r;if(this.serializer.isCollectingMedia=!0,t)if(this.setProjectName(t),Process.prototype.isCatchingErrors)try{e=this.showMessage("Exporting"),o=encodeURIComponent(this.serializer.serialize(this.stage)),i=encodeURIComponent(this.serializer.mediaXML(t)),r=encodeURIComponent("<snapdata>")+o+i+encodeURIComponent("</snapdata>"),window.open("data:text/xml,"+r),e.destroy(),this.showMessage("Exported!",1)}catch(n){this.serializer.isCollectingMedia=!1,this.showMessage("Export failed: "+n)}else e=this.showMessage("Exporting"),o=encodeURIComponent(this.serializer.serialize(this.stage)),i=encodeURIComponent(this.serializer.mediaXML()),r=encodeURIComponent("<snapdata>")+o+i+encodeURIComponent("</snapdata>"),window.open("data:text/xml,"+r),e.destroy(),this.showMessage("Exported!",1);this.serializer.isCollectingMedia=!1,this.serializer.flushMedia()},IDE_Morph.prototype.cloudAcknowledge=function(){var t=this;return function(e,o){nop(e),(new DialogBoxMorph).inform("Cloud Connection","Successfully connected to:\nhttp://"+o,t.world(),t.cloudIcon(null,new Color(0,180,0)))}},IDE_Morph.prototype.cloudResponse=function(){var t=this;return function(e,o){var i=e;i.length>50&&(i=i.substring(0,50)+"..."),(new DialogBoxMorph).inform("Snap!Cloud","http://"+o+":\n\nresponds:\n"+i,t.world(),t.cloudIcon(null,new Color(0,180,0)))
}},IDE_Morph.prototype.cloudError=function(){function t(t){try{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(),200===e.status?e.responseText:null}catch(o){return null}}var e=this;return function(o,i){var r=o,n=t("http://snap.berkeley.edu/cloudmsg.txt");return e.shield&&(e.shield.destroy(),e.shield=null),n?void e.showMessage(n):(r.length>50&&(r=r.substring(0,50)+"..."),void(new DialogBoxMorph).inform("Snap!Cloud",(i?i+"\n":"")+r,e.world(),e.cloudIcon(null,new Color(180,0,0))))}},IDE_Morph.prototype.cloudIcon=function(t,e){var o=e||DialogBoxMorph.prototype.titleBarColor,i=MorphicPreferences.isFlat,r=new SymbolMorph(i?"cloud":"cloudGradient",t||50,o,i?null:new Point(-1,-1),o.darker(50));return i||r.addShadow(new Point(1,1),1,o.lighter(95)),r},IDE_Morph.prototype.setCloudURL=function(){new DialogBoxMorph(null,function(t){SnapCloud.url=t}).withKey("cloudURL").prompt("Cloud URL",SnapCloud.url,this.world(),null,{"Snap!Cloud":"https://snapcloud.miosoft.com/miocon/app/login?_app=SnapCloud","local network lab":"192.168.2.107:8087/miocon/app/login?_app=SnapCloud","local network office":"192.168.186.146:8087/miocon/app/login?_app=SnapCloud","localhost dev":"localhost/miocon/app/login?_app=SnapCloud"})},IDE_Morph.prototype.getURL=function(t){var e=new XMLHttpRequest,o=this;try{if(e.open("GET",t,!1),e.send(),200===e.status)return e.responseText;throw new Error("unable to retrieve "+t)}catch(i){return void o.showMessage(i)}},IDE_Morph.prototype.missionSolved=function(){this.sendMissionSolved(),this.goalMission()},IDE_Morph.prototype.sendMissionSolved=function(){var t=this.world(),e=3;t.program_needs_check&&"TEACHER"!=t.role&&(e=1),this.exportProjectToServer(!1,e)},IDE_Morph.prototype.sendMissionCorrected=function(){this.exportProjectToServer(!1,2)},IDE_Morph.prototype.showMessage=function(t,e){var o,i=new MenuMorph(null,t);return i.popUpCenteredInWorld(this.world()),e&&(o=setInterval(function(){i.destroy(),clearInterval(o)},1e3*e)),i},IDE_Morph.prototype.inform=function(t,e){(new DialogBoxMorph).inform(t,localize(e),this.world())},IDE_Morph.prototype.confirm=function(t,e,o){new DialogBoxMorph(null,o).askYesNo(e,localize(t),this.world())},IDE_Morph.prototype.prompt=function(t,e,o,i){new DialogBoxMorph(null,e).withKey(i).prompt(t,"",this.world(),null,o)},ProjectDialogMorph.prototype=new DialogBoxMorph,ProjectDialogMorph.prototype.constructor=ProjectDialogMorph,ProjectDialogMorph.uber=DialogBoxMorph.prototype,ProjectDialogMorph.prototype.init=function(t,e){var o=this;this.ide=t,this.task=e||"open",this.source=t.source||"local",this.projectList=[],this.handle=null,this.srcBar=null,this.nameField=null,this.listField=null,this.preview=null,this.notesText=null,this.notesField=null,this.deleteButton=null,this.shareButton=null,this.unshareButton=null,ProjectDialogMorph.uber.init.call(this,this,null,null),this.labelString="save"===this.task?"Save Project":"Open Project",this.createLabel(),this.key="project"+e,this.buildContents(),this.onNextStep=function(){o.setSource(o.source)}},ProjectDialogMorph.prototype.buildContents=function(){var t,e;this.addBody(new Morph),this.body.color=this.color,this.srcBar=new AlignmentMorph("column",this.padding/2),this.ide.cloudMsg&&(e=new TextMorph(this.ide.cloudMsg,10,null,!1,null,null,null,null,new Point(1,1),new Color(255,255,255)),e.refresh=nop,this.srcBar.add(e)),this.addSourceButton("cloud",localize("Cloud"),"cloud"),this.addSourceButton("local",localize("Browser"),"storage"),"open"===this.task&&this.addSourceButton("examples",localize("Examples"),"poster"),this.srcBar.fixLayout(),this.body.add(this.srcBar),"save"===this.task&&(this.nameField=new InputFieldMorph(this.ide.projectName),this.body.add(this.nameField)),this.listField=new ListMorph([]),this.fixListFieldItemColors(),this.listField.fixLayout=nop,this.listField.edge=InputFieldMorph.prototype.edge,this.listField.fontSize=InputFieldMorph.prototype.fontSize,this.listField.typeInPadding=InputFieldMorph.prototype.typeInPadding,this.listField.contrast=InputFieldMorph.prototype.contrast,this.listField.drawNew=InputFieldMorph.prototype.drawNew,this.listField.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,this.body.add(this.listField),this.preview=new Morph,this.preview.fixLayout=nop,this.preview.edge=InputFieldMorph.prototype.edge,this.preview.fontSize=InputFieldMorph.prototype.fontSize,this.preview.typeInPadding=InputFieldMorph.prototype.typeInPadding,this.preview.contrast=InputFieldMorph.prototype.contrast,this.preview.drawNew=function(){InputFieldMorph.prototype.drawNew.call(this),this.texture&&this.drawTexture(this.texture)},this.preview.drawCachedTexture=function(){var t=this.image.getContext("2d");t.drawImage(this.cachedTexture,this.edge,this.edge),this.changed()},this.preview.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,this.preview.setExtent(this.ide.serializer.thumbnailSize.add(2*this.preview.edge)),this.body.add(this.preview),this.preview.drawNew(),"save"===this.task&&(t=this.ide.stage.thumbnail(SnapSerializer.prototype.thumbnailSize),this.preview.texture=null,this.preview.cachedTexture=t,this.preview.drawCachedTexture()),this.notesField=new ScrollFrameMorph,this.notesField.fixLayout=nop,this.notesField.edge=InputFieldMorph.prototype.edge,this.notesField.fontSize=InputFieldMorph.prototype.fontSize,this.notesField.typeInPadding=InputFieldMorph.prototype.typeInPadding,this.notesField.contrast=InputFieldMorph.prototype.contrast,this.notesField.drawNew=InputFieldMorph.prototype.drawNew,this.notesField.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,this.notesField.acceptsDrops=!1,this.notesField.contents.acceptsDrops=!1,"open"===this.task?this.notesText=new TextMorph(""):(this.notesText=new TextMorph(this.ide.projectNotes),this.notesText.isEditable=!0,this.notesText.enableSelecting()),this.notesField.isTextLineWrapping=!0,this.notesField.padding=3,this.notesField.setContents(this.notesText),this.notesField.setWidth(this.preview.width()),this.body.add(this.notesField),"open"===this.task?(this.addButton("openProject","Open"),this.action="openProject"):(this.addButton("saveProject","Save"),this.action="saveProject"),this.shareButton=this.addButton("shareProject","Share"),this.unshareButton=this.addButton("unshareProject","Unshare"),this.shareButton.hide(),this.unshareButton.hide(),this.deleteButton=this.addButton("deleteProject","Delete"),this.addButton("cancel","Cancel"),this.setExtent(e?new Point(455,335).add(e.extent()):new Point(455,335)),this.fixLayout()},ProjectDialogMorph.prototype.popUp=function(t){var e=t||this.ide.world();e&&(ProjectDialogMorph.uber.popUp.call(this,e),this.handle=new HandleMorph(this,350,300,this.corner,this.corner))},ProjectDialogMorph.prototype.addSourceButton=function(t,e,o){var i,r=this,n=new StringMorph(e,10,null,!0,null,null,new Point(1,1),new Color(255,255,255)),s=new StringMorph(e,10,null,!0,null,null,new Point(-1,-1),this.titleBarColor.darker(50),new Color(255,255,255)),a=new Morph,h=new Morph;n.add(new SymbolMorph(o,24,this.titleBarColor.darker(20),new Point(1,1),this.titleBarColor.darker(50))),n.children[0].setCenter(n.center()),n.children[0].setBottom(n.top()-this.padding/2),a.image=n.fullImage(),a.bounds=n.fullBounds(),s.add(new SymbolMorph(o,24,new Color(255,255,255),new Point(-1,-1),this.titleBarColor.darker(50))),s.children[0].setCenter(s.center()),s.children[0].setBottom(s.top()-this.padding/2),h.image=s.fullImage(),h.bounds=s.fullBounds(),i=new ToggleButtonMorph(null,r,function(){r.setSource(t)},[a,h],function(){return r.source===t}),i.corner=this.buttonCorner,i.edge=this.buttonEdge,i.outline=this.buttonOutline,i.outlineColor=this.buttonOutlineColor,i.outlineGradient=this.buttonOutlineGradient,i.labelMinExtent=new Point(60,0),i.padding=this.buttonPadding,i.contrast=this.buttonContrast,i.pressColor=this.titleBarColor.darker(20),i.drawNew(),i.fixLayout(),i.refresh(),this.srcBar.add(i)},ProjectDialogMorph.prototype.fixListFieldItemColors=function(){var t=this;this.listField.contents.children[0].alpha=0,this.listField.contents.children[0].children.forEach(function(e){e.pressColor=t.titleBarColor.darker(20),e.color=new Color(0,0,0,0),e.noticesTransparentClick=!0})},ProjectDialogMorph.prototype.setSource=function(t){var e,o=this;switch(this.source=t,this.srcBar.children.forEach(function(t){t.refresh()}),this.source){case"cloud":return e=o.ide.showMessage("Updating\nproject list..."),this.projectList=[],void SnapCloud.getProjectList(function(t){o.installCloudProjectList(t),e.destroy()},function(t,i){e.destroy(),o.ide.cloudError().call(null,t,i)});case"examples":this.projectList=this.getExamplesProjectList();break;case"local":this.projectList=this.getLocalProjectList()}this.listField.destroy(),this.listField=new ListMorph(this.projectList,this.projectList.length>0?function(t){return t.name}:null,null,function(){o.ok()}),this.fixListFieldItemColors(),this.listField.fixLayout=nop,this.listField.edge=InputFieldMorph.prototype.edge,this.listField.fontSize=InputFieldMorph.prototype.fontSize,this.listField.typeInPadding=InputFieldMorph.prototype.typeInPadding,this.listField.contrast=InputFieldMorph.prototype.contrast,this.listField.drawNew=InputFieldMorph.prototype.drawNew,this.listField.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,this.listField.action="local"===this.source?function(t){var e,i;void 0!==t&&(o.nameField&&o.nameField.setContents(t.name||""),"open"===o.task&&(e=localStorage["-snap-project-"+t.name],i=o.ide.serializer.parse(e),o.notesText.text=i.childNamed("notes").contents||"",o.notesText.drawNew(),o.notesField.contents.adjustBounds(),o.preview.texture=i.childNamed("thumbnail").contents||null,o.preview.cachedTexture=null,o.preview.drawNew()),o.edit())}:function(t){var e,i;void 0!==t&&(o.nameField&&o.nameField.setContents(t.name||""),e=o.ide.getURL("http://snap.berkeley.edu/snapsource/Examples/"+t.name+".xml"),i=o.ide.serializer.parse(e),o.notesText.text=i.childNamed("notes").contents||"",o.notesText.drawNew(),o.notesField.contents.adjustBounds(),o.preview.texture=i.childNamed("thumbnail").contents||null,o.preview.cachedTexture=null,o.preview.drawNew(),o.edit())},this.body.add(this.listField),this.shareButton.hide(),this.unshareButton.hide(),"local"===this.source?this.deleteButton.show():this.deleteButton.hide(),this.buttons.fixLayout(),this.fixLayout(),"open"===this.task&&this.clearDetails()},ProjectDialogMorph.prototype.getLocalProjectList=function(){var t,e,o,i=[];for(t in localStorage)Object.prototype.hasOwnProperty.call(localStorage,t)&&"-snap-project-"===t.substr(0,14)&&(e=t.substr(14),o={name:e,thumb:null,notes:null},i.push(o));return i.sort(function(t,e){return t.name<e.name?-1:1}),i},ProjectDialogMorph.prototype.getExamplesProjectList=function(){var t,e=[];return t=this.ide.getURL("http://snap.berkeley.edu/snapsource/Examples/"),t.split("\n").forEach(function(t){var o,i,r,n=t.search(new RegExp('href=".*xml"'));n>0&&(o=t.search(new RegExp(".xml")),i=t.substring(n+6,o),r={name:i,thumb:null,notes:null},e.push(r))}),e.sort(function(t,e){return t.name<e.name?-1:1}),e},ProjectDialogMorph.prototype.installCloudProjectList=function(t){var e=this;this.projectList=t||[],this.projectList.sort(function(t,e){return t.ProjectName<e.ProjectName?-1:1}),this.listField.destroy(),this.listField=new ListMorph(this.projectList,this.projectList.length>0?function(t){return t.ProjectName}:null,[["bold",function(t){return"true"===t.Public}]],function(){e.ok()}),this.fixListFieldItemColors(),this.listField.fixLayout=nop,this.listField.edge=InputFieldMorph.prototype.edge,this.listField.fontSize=InputFieldMorph.prototype.fontSize,this.listField.typeInPadding=InputFieldMorph.prototype.typeInPadding,this.listField.contrast=InputFieldMorph.prototype.contrast,this.listField.drawNew=InputFieldMorph.prototype.drawNew,this.listField.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,this.listField.action=function(t){void 0!==t&&(e.nameField&&e.nameField.setContents(t.ProjectName||""),"open"===e.task&&(e.notesText.text=t.Notes||"",e.notesText.drawNew(),e.notesField.contents.adjustBounds(),e.preview.texture=t.Thumbnail||null,e.preview.cachedTexture=null,e.preview.drawNew()),"true"===t.Public?(e.shareButton.hide(),e.unshareButton.show()):(e.unshareButton.hide(),e.shareButton.show()),e.buttons.fixLayout(),e.fixLayout(),e.edit())},this.body.add(this.listField),this.shareButton.show(),this.unshareButton.hide(),this.deleteButton.show(),this.buttons.fixLayout(),this.fixLayout(),"open"===this.task&&this.clearDetails()},ProjectDialogMorph.prototype.clearDetails=function(){this.notesText.text="",this.notesText.drawNew(),this.notesField.contents.adjustBounds(),this.preview.texture=null,this.preview.cachedTexture=null,this.preview.drawNew()},ProjectDialogMorph.prototype.openProject=function(){var t,e=this.listField.selected;e&&(this.ide.source=this.source,"cloud"===this.source?this.openCloudProject(e):"examples"===this.source?(t=this.ide.getURL("http://snap.berkeley.edu/snapsource/Examples/"+e.name+".xml"),this.ide.openProjectString(t),this.destroy()):(this.ide.openProject(e.name),this.destroy()))},ProjectDialogMorph.prototype.openCloudProject=function(t){var e=this;e.ide.nextSteps([function(){e.ide.showMessage("Fetching project\nfrom the cloud...")},function(){e.rawOpenCloudProject(t)}])},ProjectDialogMorph.prototype.rawOpenCloudProject=function(t){var e=this;SnapCloud.reconnect(function(){SnapCloud.callService("getProject",function(o){SnapCloud.disconnect(),e.ide.source="cloud",e.ide.droppedText(o[0].SourceCode),"true"===t.Public&&(location.hash="#present:Username="+encodeURIComponent(SnapCloud.username)+"&ProjectName="+encodeURIComponent(t.ProjectName))},e.ide.cloudError(),[t.ProjectName])},e.ide.cloudError()),this.destroy()},ProjectDialogMorph.prototype.saveProject=function(){var t=this.nameField.contents().text.text,e=this.notesText.text,o=this;this.ide.projectNotes=e||this.ide.projectNotes,t&&("cloud"===this.source?detect(this.projectList,function(e){return e.ProjectName===t})?this.ide.confirm(localize("Are you sure you want to replace")+'\n"'+t+'"?',"Replace Project",function(){o.ide.setProjectName(t),o.saveCloudProject()}):(this.ide.setProjectName(t),o.saveCloudProject()):detect(this.projectList,function(e){return e.name===t})?this.ide.confirm(localize("Are you sure you want to replace")+'\n"'+t+'"?',"Replace Project",function(){o.ide.setProjectName(t),o.ide.source="local",o.ide.saveProject(t),o.destroy()}):(this.ide.setProjectName(t),o.ide.source="local",this.ide.saveProject(t),this.destroy()))},ProjectDialogMorph.prototype.saveCloudProject=function(){var t=this;this.ide.showMessage("Saving project\nto the cloud..."),SnapCloud.saveProject(this.ide,function(){t.ide.source="cloud",t.ide.showMessage("saved.",2)},this.ide.cloudError()),this.destroy()},ProjectDialogMorph.prototype.deleteProject=function(){var t,e,o,i=this;"cloud"===this.source?(t=this.listField.selected,t&&this.ide.confirm(localize("Are you sure you want to delete")+'\n"'+t.ProjectName+'"?',"Delete Project",function(){SnapCloud.reconnect(function(){SnapCloud.callService("deleteProject",function(){SnapCloud.disconnect(),i.ide.hasChangedMedia=!0,e=i.projectList.indexOf(t),i.projectList.splice(e,1),i.installCloudProjectList(i.projectList)},i.ide.cloudError(),[t.ProjectName])},i.ide.cloudError())})):this.listField.selected&&(o=this.listField.selected.name,this.ide.confirm(localize("Are you sure you want to delete")+'\n"'+o+'"?',"Delete Project",function(){delete localStorage["-snap-project-"+o],i.setSource(i.source)}))},ProjectDialogMorph.prototype.shareProject=function(){var t=this,e=this.listField.selected,o=this.listField.active;e&&this.ide.confirm(localize("Are you sure you want to publish")+'\n"'+e.ProjectName+'"?',"Share Project",function(){t.ide.showMessage("sharing\nproject..."),SnapCloud.reconnect(function(){SnapCloud.callService("publishProject",function(){SnapCloud.disconnect(),e.Public="true",o.label.isBold=!0,o.label.drawNew(),o.label.changed(),t.ide.showMessage("shared.",2)},t.ide.cloudError(),[e.ProjectName])},t.ide.cloudError())})},ProjectDialogMorph.prototype.unshareProject=function(){var t=this,e=this.listField.selected,o=this.listField.active;e&&this.ide.confirm(localize("Are you sure you want to unpublish")+'\n"'+e.ProjectName+'"?',"Unshare Project",function(){t.ide.showMessage("unsharing\nproject..."),SnapCloud.reconnect(function(){SnapCloud.callService("unpublishProject",function(){SnapCloud.disconnect(),e.Public="false",o.label.isBold=!1,o.label.drawNew(),o.label.changed(),t.ide.showMessage("unshared.",2)},t.ide.cloudError(),[e.ProjectName])},t.ide.cloudError())})},ProjectDialogMorph.prototype.edit=function(){this.nameField&&this.nameField.edit()},ProjectDialogMorph.prototype.fixLayout=function(){var t=fontHeight(this.titleFontSize)+2*this.titlePadding,e=this.padding/2,o=Morph.prototype.trackChanges;Morph.prototype.trackChanges=!1,this.buttons&&this.buttons.children.length>0&&this.buttons.fixLayout(),this.body&&(this.body.setPosition(this.position().add(new Point(this.padding,t+this.padding))),this.body.setExtent(new Point(this.width()-2*this.padding,this.height()-3*this.padding-t-this.buttons.height())),this.srcBar.setPosition(this.body.position()),this.nameField&&(this.nameField.setWidth(this.body.width()-this.srcBar.width()-6*this.padding),this.nameField.setLeft(this.srcBar.right()+3*this.padding),this.nameField.setTop(this.srcBar.top()),this.nameField.drawNew()),this.listField.setLeft(this.srcBar.right()+this.padding),this.listField.setWidth(this.body.width()-this.srcBar.width()-this.preview.width()-this.padding-e),this.listField.contents.children[0].adjustWidths(),this.nameField?(this.listField.setTop(this.nameField.bottom()+this.padding),this.listField.setHeight(this.body.height()-this.nameField.height()-this.padding)):(this.listField.setTop(this.body.top()),this.listField.setHeight(this.body.height())),this.preview.setRight(this.body.right()),this.preview.setTop(this.nameField?this.nameField.bottom()+this.padding:this.body.top()),this.notesField.setTop(this.preview.bottom()+e),this.notesField.setLeft(this.preview.left()),this.notesField.setHeight(this.body.bottom()-this.preview.bottom()-e)),this.label&&(this.label.setCenter(this.center()),this.label.setTop(this.top()+(t-this.label.height())/2)),this.buttons&&this.buttons.children.length>0&&(this.buttons.setCenter(this.center()),this.buttons.setBottom(this.bottom()-this.padding)),Morph.prototype.trackChanges=o,this.changed()},SpriteIconMorph.prototype=new ToggleButtonMorph,SpriteIconMorph.prototype.constructor=SpriteIconMorph,SpriteIconMorph.uber=ToggleButtonMorph.prototype,SpriteIconMorph.prototype.thumbSize=new Point(40,40),SpriteIconMorph.prototype.labelShadowOffset=null,SpriteIconMorph.prototype.labelShadowColor=null,SpriteIconMorph.prototype.labelColor=new Color(255,255,255),SpriteIconMorph.prototype.fontSize=9,SpriteIconMorph.prototype.init=function(t,e){var o,i,r,n=this;e||(o=[IDE_Morph.prototype.groupColor,IDE_Morph.prototype.frameColor,IDE_Morph.prototype.frameColor]),i=function(){var t=n.parentThatIsA(IDE_Morph);t&&t.selectSprite(n.object)},r=function(){var t=n.parentThatIsA(IDE_Morph);return t?t.currentSprite===n.object:!1},this.object=t||new SpriteMorph,this.version=this.object.version,this.thumbnail=null,this.rotationButton=null,SpriteIconMorph.uber.init.call(this,o,null,i,this.object.name,r,null,null,e),this.isDraggable=!0,this.createThumbnail(),this.padding=2,this.corner=8,this.fixLayout(),this.fps=1},SpriteIconMorph.prototype.createThumbnail=function(){this.thumbnail&&this.thumbnail.destroy(),this.thumbnail=new Morph,this.thumbnail.setExtent(this.thumbSize),this.object instanceof SpriteMorph?(this.thumbnail.image=this.object.fullThumbnail(this.thumbSize),this.createRotationButton()):this.thumbnail.image=this.object.thumbnail(this.thumbSize),this.add(this.thumbnail)},SpriteIconMorph.prototype.createLabel=function(){var t;this.label&&this.label.destroy(),t=new StringMorph(this.object.name,this.fontSize,this.fontStyle,!0,!1,!1,this.labelShadowOffset,this.labelShadowColor,this.labelColor),this.label=new FrameMorph,this.label.acceptsDrops=!1,this.label.alpha=0,this.label.setExtent(t.extent()),t.setPosition(this.label.position()),this.label.add(t),this.add(this.label)},SpriteIconMorph.prototype.createRotationButton=function(){var t,e=this;this.rotationButton&&(this.rotationButton.destroy(),this.roationButton=null),this.object.anchor&&(t=new ToggleButtonMorph(null,null,function(){e.object.rotatesWithAnchor=!e.object.rotatesWithAnchor},["\u2192","\u21bb"],function(){return e.object.rotatesWithAnchor}),t.corner=8,t.labelMinExtent=new Point(11,11),t.padding=0,t.pressColor=t.color,t.drawNew(),t.fixLayout(),t.refresh(),t.changed(),this.rotationButton=t,this.add(this.rotationButton))},SpriteIconMorph.prototype.step=function(){this.version!==this.object.version&&(this.createThumbnail(),this.createLabel(),this.fixLayout(),this.version=this.object.version,this.refresh())},SpriteIconMorph.prototype.fixLayout=function(){return this.thumbnail&&this.label?(this.setWidth(this.thumbnail.width()+2*this.outline+2*this.edge+2*this.padding),this.setHeight(this.thumbnail.height()+2*this.outline+2*this.edge+3*this.padding+this.label.height()),this.thumbnail.setCenter(this.center()),this.thumbnail.setTop(this.top()+this.outline+this.edge+this.padding),this.rotationButton&&(this.rotationButton.setTop(this.top()),this.rotationButton.setRight(this.right())),this.label.setWidth(Math.min(this.label.children[0].width(),this.thumbnail.width())),this.label.setCenter(this.center()),void this.label.setTop(this.thumbnail.bottom()+this.padding)):null},SpriteIconMorph.prototype.userMenu=function(){var t=new MenuMorph(this),e=this;return this.object instanceof StageMorph?(t.addItem("pic...",function(){window.open(e.object.fullImageClassic().toDataURL())},"open a new window\nwith a picture of the stage"),t):this.object instanceof SpriteMorph?(t.addItem("show","showSpriteOnStage"),"STUDENT"!=world.role&&(t.addItem("duplicate","duplicateSprite"),t.addItem("delete","removeSprite"),t.addLine(),this.object.anchor&&t.addItem(localize("detach from")+" "+this.object.anchor.name,function(){e.object.detachFromAnchor()}),this.object.parts.length&&t.addItem("detach all parts",function(){e.object.detachAllParts()}),t.addItem("export...","exportSprite")),t):null},SpriteIconMorph.prototype.duplicateSprite=function(){var t=this.parentThatIsA(IDE_Morph);t&&t.duplicateSprite(this.object)},SpriteIconMorph.prototype.removeSprite=function(){var t=this.parentThatIsA(IDE_Morph);t&&t.removeSprite(this.object)},SpriteIconMorph.prototype.exportSprite=function(){this.object.exportSprite()},SpriteIconMorph.prototype.showSpriteOnStage=function(){this.object.showOnStage()},SpriteIconMorph.prototype.createBackgrounds=function(){var t,e=this.extent();return this.template?(this.image=this.template.image,this.normalImage=this.template.normalImage,this.highlightImage=this.template.highlightImage,this.pressImage=this.template.pressImage,null):(this.normalImage=newCanvas(e),t=this.normalImage.getContext("2d"),this.drawBackground(t,this.color),this.highlightImage=newCanvas(e),t=this.highlightImage.getContext("2d"),this.drawBackground(t,this.highlightColor),this.pressImage=newCanvas(e),t=this.pressImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.pressColor),this.drawEdges(t,this.pressColor,this.pressColor.lighter(this.contrast),this.pressColor.darker(this.contrast)),void(this.image=this.normalImage))},SpriteIconMorph.prototype.prepareToBeGrabbed=function(){var t,e=this.parentThatIsA(IDE_Morph);this.mouseClickLeft(),e&&(t=e.sprites.asArray().indexOf(this.object),e.sprites.remove(t+1),e.createCorral(),e.fixLayout())},SpriteIconMorph.prototype.wantsDropOf=function(t){return t instanceof BlockMorph||t instanceof CostumeIconMorph||t instanceof SoundIconMorph},SpriteIconMorph.prototype.reactToDropOf=function(t,e){t instanceof BlockMorph?this.copyStack(t):t instanceof CostumeIconMorph?this.copyCostume(t.object):t instanceof SoundIconMorph&&this.copySound(t.object),this.world().add(t),t.slideBackTo(e.grabOrigin)},SpriteIconMorph.prototype.copyStack=function(t){var e=t.fullCopy(),o=Math.max(this.object.scripts.children.map(function(t){return t.fullBounds().bottom()}).concat([this.object.scripts.top()]));e.setPosition(new Point(this.object.scripts.left()+20,o+20)),this.object.scripts.add(e),e.allComments().forEach(function(t){t.align(e)}),this.object.scripts.adjustBounds(),e.allChildren().forEach(function(t){t.definition&&!t.definition.isGlobal&&t.deleteBlock()})},SpriteIconMorph.prototype.copyCostume=function(t){var e=t.copy();this.object.addCostume(e),this.object.wearCostume(e)},SpriteIconMorph.prototype.copySound=function(t){var e=t.copy();this.object.addSound(e.audio,e.name)},CostumeIconMorph.prototype=new ToggleButtonMorph,CostumeIconMorph.prototype.constructor=CostumeIconMorph,CostumeIconMorph.uber=ToggleButtonMorph.prototype,CostumeIconMorph.prototype.thumbSize=new Point(80,60),CostumeIconMorph.prototype.labelShadowOffset=null,CostumeIconMorph.prototype.labelShadowColor=null,CostumeIconMorph.prototype.labelColor=new Color(255,255,255),CostumeIconMorph.prototype.fontSize=9,CostumeIconMorph.prototype.init=function(t,e){var o,i,r,n=this;e||(o=[IDE_Morph.prototype.groupColor,IDE_Morph.prototype.frameColor,IDE_Morph.prototype.frameColor]),i=function(){var t=n.parentThatIsA(IDE_Morph),e=n.parentThatIsA(WardrobeMorph);t&&t.currentSprite.wearCostume(n.object),e&&e.updateSelection()},r=function(){var t=n.parentThatIsA(IDE_Morph);return t?t.currentSprite.costume===n.object:!1},this.object=t||new Costume,this.version=this.object.version,this.thumbnail=null,CostumeIconMorph.uber.init.call(this,o,null,i,this.object.name,r,null,null,e),this.isDraggable=!0,this.createThumbnail(),this.padding=2,this.corner=8,this.fixLayout(),this.fps=1},CostumeIconMorph.prototype.createThumbnail=SpriteIconMorph.prototype.createThumbnail,CostumeIconMorph.prototype.createLabel=SpriteIconMorph.prototype.createLabel,CostumeIconMorph.prototype.step=SpriteIconMorph.prototype.step,CostumeIconMorph.prototype.fixLayout=SpriteIconMorph.prototype.fixLayout,CostumeIconMorph.prototype.userMenu=function(){var t=new MenuMorph(this);return this.object instanceof Costume?(t.addItem("edit","editCostume"),16===this.world().currentKey&&t.addItem("edit rotation point only...","editRotationPointOnly",null,new Color(100,0,0)),t.addItem("rename","renameCostume"),t.addLine(),t.addItem("duplicate","duplicateCostume"),t.addItem("delete","removeCostume"),t.addLine(),t.addItem("export","exportCostume"),t):null},CostumeIconMorph.prototype.editCostume=function(){this.object instanceof SVG_Costume?this.object.editRotationPointOnly(this.world()):this.object.edit(this.world(),this.parentThatIsA(IDE_Morph))},CostumeIconMorph.prototype.editRotationPointOnly=function(){var t=this.parentThatIsA(IDE_Morph);this.object.editRotationPointOnly(this.world()),t.hasChangedMedia=!0},CostumeIconMorph.prototype.renameCostume=function(){var t=this.object,e=this.parentThatIsA(IDE_Morph);new DialogBoxMorph(null,function(o){o&&o!==t.name&&(t.name=o,t.version=Date.now(),e.hasChangedMedia=!0)}).prompt("rename costume",t.name,this.world())},CostumeIconMorph.prototype.duplicateCostume=function(){var t=this.parentThatIsA(WardrobeMorph),e=this.parentThatIsA(IDE_Morph),o=this.object.copy(),i=o.name.split(" ");"copy"===i[i.length-1]?o.name+=" 2":isNaN(i[i.length-1])?o.name=o.name+" copy":(i[i.length-1]=Number(i[i.length-1])+1,o.name=i.join(" ")),t.sprite.addCostume(o),t.updateList(),e&&e.currentSprite.wearCostume(o)},CostumeIconMorph.prototype.removeCostume=function(){var t=this.parentThatIsA(WardrobeMorph),e=this.parent.children.indexOf(this),o=this.parentThatIsA(IDE_Morph);t.removeCostumeAt(e-2),o.currentSprite.costume===this.object&&o.currentSprite.wearCostume(null)},CostumeIconMorph.prototype.exportCostume=function(){window.open(this.object instanceof SVG_Costume?this.object.contents.src:this.object.contents.toDataURL())},CostumeIconMorph.prototype.createBackgrounds=SpriteIconMorph.prototype.createBackgrounds,CostumeIconMorph.prototype.prepareToBeGrabbed=function(){this.mouseClickLeft(),this.removeCostume()},TurtleIconMorph.prototype=new ToggleButtonMorph,TurtleIconMorph.prototype.constructor=TurtleIconMorph,TurtleIconMorph.uber=ToggleButtonMorph.prototype,TurtleIconMorph.prototype.thumbSize=new Point(80,60),TurtleIconMorph.prototype.labelShadowOffset=null,TurtleIconMorph.prototype.labelShadowColor=null,TurtleIconMorph.prototype.labelColor=new Color(255,255,255),TurtleIconMorph.prototype.fontSize=9,TurtleIconMorph.prototype.init=function(t,e){var o,i,r,n=this;e||(o=[IDE_Morph.prototype.groupColor,IDE_Morph.prototype.frameColor,IDE_Morph.prototype.frameColor]),i=function(){var t=n.parentThatIsA(IDE_Morph),e=n.parentThatIsA(WardrobeMorph);t&&t.currentSprite.wearCostume(null),e&&e.updateSelection()},r=function(){var t=n.parentThatIsA(IDE_Morph);return t?null===t.currentSprite.costume:!1},this.object=t,this.version=this.object.version,this.thumbnail=null,TurtleIconMorph.uber.init.call(this,o,null,i,"default",r,null,null,e),this.isDraggable=!1,this.createThumbnail(),this.padding=2,this.corner=8,this.fixLayout()},TurtleIconMorph.prototype.createThumbnail=function(){var t=MorphicPreferences.isFlat;this.thumbnail&&this.thumbnail.destroy(),this.thumbnail=this.object instanceof SpriteMorph?new SymbolMorph("turtle",this.thumbSize.y,this.labelColor,t?null:new Point(-1,-1),new Color(0,0,0)):new SymbolMorph("stage",this.thumbSize.y,this.labelColor,t?null:new Point(-1,-1),new Color(0,0,0)),this.add(this.thumbnail)},TurtleIconMorph.prototype.createLabel=function(){var t;this.label&&this.label.destroy(),t=new StringMorph(localize(this.object instanceof SpriteMorph?"Turtle":"Empty"),this.fontSize,this.fontStyle,!0,!1,!1,this.labelShadowOffset,this.labelShadowColor,this.labelColor),this.label=new FrameMorph,this.label.acceptsDrops=!1,this.label.alpha=0,this.label.setExtent(t.extent()),t.setPosition(this.label.position()),this.label.add(t),this.add(this.label)},TurtleIconMorph.prototype.fixLayout=SpriteIconMorph.prototype.fixLayout,TurtleIconMorph.prototype.createBackgrounds=SpriteIconMorph.prototype.createBackgrounds,TurtleIconMorph.prototype.userMenu=function(){var t=this,e=new MenuMorph(this,"pen"),o="\u25cf",i="\u25cb";return this.object instanceof StageMorph?null:(e.addItem(("tip"===this.object.penPoint?o:i)+" "+localize("tip"),function(){t.object.penPoint="tip",t.object.changed(),t.object.drawNew(),t.object.changed()}),e.addItem(("middle"===this.object.penPoint?o:i)+" "+localize("middle"),function(){t.object.penPoint="middle",t.object.changed(),t.object.drawNew(),t.object.changed()}),e)},WardrobeMorph.prototype=new ScrollFrameMorph,WardrobeMorph.prototype.constructor=WardrobeMorph,WardrobeMorph.uber=ScrollFrameMorph.prototype,WardrobeMorph.prototype.init=function(t,e){this.sprite=t||new SpriteMorph,this.costumesVersion=null,this.spriteVersion=null,WardrobeMorph.uber.init.call(this,null,null,e),this.fps=2,this.updateList()},WardrobeMorph.prototype.updateList=function(){var t,e,o,i,r=this,n=this.left()+5,s=this.top()+5,a=4,h=Morph.prototype.trackChanges,l=this.contents.position();this.changed(),h=Morph.prototype.trackChanges,Morph.prototype.trackChanges=!1,this.contents.destroy(),this.contents=new FrameMorph(this),this.contents.acceptsDrops=!1,this.contents.reactToDropOf=function(t){r.reactToDropOf(t)},this.addBack(this.contents),t=new TurtleIconMorph(this.sprite),t.setPosition(new Point(n,s)),r.addContents(t),s=t.bottom()+a,i=new PushButtonMorph(this,"paintNew",new SymbolMorph("brush",15)),i.padding=0,i.corner=12,i.color=IDE_Morph.prototype.groupColor,i.highlightColor=IDE_Morph.prototype.frameColor.darker(50),i.pressColor=i.highlightColor,i.labelMinExtent=new Point(36,18),i.labelShadowOffset=new Point(-1,-1),i.labelShadowColor=i.highlightColor,i.labelColor=TurtleIconMorph.prototype.labelColor,i.contrast=this.buttonContrast,i.drawNew(),i.hint="Paint a new costume",i.setPosition(new Point(n,s)),i.fixLayout(),i.setCenter(t.center()),i.setLeft(t.right()+4*a),this.addContents(i),o=new TextMorph(localize("costumes tab help")),o.fontSize=9,o.setColor(SpriteMorph.prototype.paletteTextColor),o.setPosition(new Point(n,s)),this.addContents(o),s=o.bottom()+a,this.sprite.costumes.asArray().forEach(function(o){e=t=new CostumeIconMorph(o,e),t.setPosition(new Point(n,s)),r.addContents(t),s=t.bottom()+a}),this.costumesVersion=this.sprite.costumes.lastChanged,this.contents.setPosition(l),this.adjustScrollBars(),Morph.prototype.trackChanges=h,this.changed(),this.updateSelection()},WardrobeMorph.prototype.updateSelection=function(){this.contents.children.forEach(function(t){t.refresh&&t.refresh()}),this.spriteVersion=this.sprite.version
},WardrobeMorph.prototype.step=function(){this.costumesVersion!==this.sprite.costumes.lastChanged&&this.updateList(),this.spriteVersion!==this.sprite.version&&this.updateSelection()},WardrobeMorph.prototype.removeCostumeAt=function(t){this.sprite.costumes.remove(t),this.updateList()},WardrobeMorph.prototype.paintNew=function(){var t=new Costume(newCanvas(),"Untitled"),e=this.parentThatIsA(IDE_Morph),o=this;t.edit(this.world(),e,!0,null,function(){o.sprite.addCostume(t),o.updateList(),e&&e.currentSprite.wearCostume(t)})},WardrobeMorph.prototype.wantsDropOf=function(t){return t instanceof CostumeIconMorph},WardrobeMorph.prototype.reactToDropOf=function(t){var e=0,o=t.object,i=t.top();t.destroy(),this.contents.children.forEach(function(t){t instanceof CostumeIconMorph&&t.top()<i-4&&(e+=1)}),this.sprite.costumes.add(o,e+1),this.updateList(),t.mouseClickLeft()},SoundIconMorph.prototype=new ToggleButtonMorph,SoundIconMorph.prototype.constructor=SoundIconMorph,SoundIconMorph.uber=ToggleButtonMorph.prototype,SoundIconMorph.prototype.thumbSize=new Point(80,60),SoundIconMorph.prototype.labelShadowOffset=null,SoundIconMorph.prototype.labelShadowColor=null,SoundIconMorph.prototype.labelColor=new Color(255,255,255),SoundIconMorph.prototype.fontSize=9,SoundIconMorph.prototype.init=function(t,e){var o,i,r;e||(o=[IDE_Morph.prototype.groupColor,IDE_Morph.prototype.frameColor,IDE_Morph.prototype.frameColor]),i=function(){nop()},r=function(){return!1},this.object=t,this.version=this.object.version,this.thumbnail=null,SoundIconMorph.uber.init.call(this,o,null,i,this.object.name,r,null,null,e),this.isDraggable=!0,this.createThumbnail(),this.padding=2,this.corner=8,this.fixLayout(),this.fps=1},SoundIconMorph.prototype.createThumbnail=function(){var t;this.thumbnail&&this.thumbnail.destroy(),this.thumbnail=new Morph,this.thumbnail.setExtent(this.thumbSize),this.add(this.thumbnail),t=new StringMorph(this.createInfo(),"16","",!0,!1,!1,this.labelShadowOffset,this.labelShadowColor,new Color(200,200,200)),this.thumbnail.add(t),t.setCenter(new Point(40,15)),this.button=new PushButtonMorph(this,"toggleAudioPlaying",this.object.previewAudio?"Stop":"Play"),this.button.drawNew(),this.button.hint="Play sound",this.button.fixLayout(),this.thumbnail.add(this.button),this.button.setCenter(new Point(40,40))},SoundIconMorph.prototype.createInfo=function(){var t=Math.round(this.object.audio.duration||0),e=t%60;return Math.floor(t/60).toString()+":"+(10>e?"0":"")+e.toString()},SoundIconMorph.prototype.toggleAudioPlaying=function(){var t=this;this.object.previewAudio?(this.button.labelString="Play",this.button.hint="Play sound",this.object.previewAudio.pause(),this.object.previewAudio.terminated=!0,this.object.previewAudio=null):(this.button.labelString="Stop",this.button.hint="Stop sound",this.object.previewAudio=this.object.play(),this.object.previewAudio.addEventListener("ended",function(){t.audioHasEnded()},!1)),this.button.createLabel()},SoundIconMorph.prototype.audioHasEnded=function(){this.button.trigger(),this.button.mouseLeave()},SoundIconMorph.prototype.createLabel=SpriteIconMorph.prototype.createLabel,SoundIconMorph.prototype.fixLayout=SpriteIconMorph.prototype.fixLayout,SoundIconMorph.prototype.userMenu=function(){var t=new MenuMorph(this);return this.object instanceof Sound?(t.addItem("rename","renameSound"),t.addItem("delete","removeSound"),t):null},SoundIconMorph.prototype.renameSound=function(){var t=this.object,e=this.parentThatIsA(IDE_Morph),o=this;new DialogBoxMorph(null,function(i){i&&i!==t.name&&(t.name=i,t.version=Date.now(),o.createLabel(),o.fixLayout(),e.hasChangedMedia=!0)}).prompt("rename sound",t.name,this.world())},SoundIconMorph.prototype.removeSound=function(){var t=this.parentThatIsA(JukeboxMorph),e=this.parent.children.indexOf(this);t.removeSound(e)},SoundIconMorph.prototype.createBackgrounds=SpriteIconMorph.prototype.createBackgrounds,SoundIconMorph.prototype.createLabel=SpriteIconMorph.prototype.createLabel,SoundIconMorph.prototype.prepareToBeGrabbed=function(){this.removeSound()},JukeboxMorph.prototype=new ScrollFrameMorph,JukeboxMorph.prototype.constructor=JukeboxMorph,JukeboxMorph.uber=ScrollFrameMorph.prototype,JukeboxMorph.prototype.init=function(t,e){this.sprite=t||new SpriteMorph,this.costumesVersion=null,this.spriteVersion=null,JukeboxMorph.uber.init.call(this,null,null,e),this.acceptsDrops=!1,this.fps=2,this.updateList()},JukeboxMorph.prototype.updateList=function(){var t,e,o,i=this,r=this.left()+5,n=this.top()+5,s=4,a=Morph.prototype.trackChanges;this.changed(),a=Morph.prototype.trackChanges,Morph.prototype.trackChanges=!1,this.contents.destroy(),this.contents=new FrameMorph(this),this.contents.acceptsDrops=!1,this.contents.reactToDropOf=function(t){i.reactToDropOf(t)},this.addBack(this.contents),o=new TextMorph(localize("import a sound from your computer\nby dragging it into here")),o.fontSize=9,o.setColor(SpriteMorph.prototype.paletteTextColor),o.setPosition(new Point(r,n)),this.addContents(o),n=o.bottom()+s,this.sprite.sounds.asArray().forEach(function(o){e=t=new SoundIconMorph(o,e),t.setPosition(new Point(r,n)),i.addContents(t),n=t.bottom()+s}),Morph.prototype.trackChanges=a,this.changed(),this.updateSelection()},JukeboxMorph.prototype.updateSelection=function(){this.contents.children.forEach(function(t){t.refresh&&t.refresh()}),this.spriteVersion=this.sprite.version},JukeboxMorph.prototype.removeSound=function(t){this.sprite.sounds.remove(t),this.updateList()},JukeboxMorph.prototype.wantsDropOf=function(t){return t instanceof SoundIconMorph},JukeboxMorph.prototype.reactToDropOf=function(t){var e=0,o=t.object,i=t.top();t.destroy(),this.contents.children.forEach(function(t){t.top()<i-4&&(e+=1)}),this.sprite.sounds.add(o,e),this.updateList()},modules.paint="2014-February-05";var PaintEditorMorph,PaintCanvasMorph,PaintColorPickerMorph;PaintEditorMorph.prototype=new DialogBoxMorph,PaintEditorMorph.prototype.constructor=PaintEditorMorph,PaintEditorMorph.uber=DialogBoxMorph.prototype,PaintEditorMorph.prototype.padding=10,PaintEditorMorph.prototype.init=function(){this.paper=null,this.oncancel=null,PaintEditorMorph.uber.init.call(this),this.labelString="Paint Editor",this.createLabel(),this.buildContents()},PaintEditorMorph.prototype.buildContents=function(){var t=this;this.paper=new PaintCanvasMorph(function(){return t.shift}),this.paper.setExtent(StageMorph.prototype.dimensions),this.addBody(new AlignmentMorph("row",this.padding)),this.controls=new AlignmentMorph("column",this.padding),this.controls.alignment="left",this.edits=new AlignmentMorph("row",this.padding),this.buildEdits(),this.controls.add(this.edits),this.body.color=this.color,this.body.add(this.controls),this.body.add(this.paper),this.toolbox=new BoxMorph,this.toolbox.color=SpriteMorph.prototype.paletteColor.lighter(8),this.toolbox.borderColor=this.toolbox.color.lighter(40),MorphicPreferences.isFlat&&(this.toolbox.edge=0),this.buildToolbox(),this.controls.add(this.toolbox),this.propertiesControls={colorpicker:null,penSizeSlider:null,penSizeField:null,primaryColorButton:null,primaryColorViewer:null,constrain:null},this.populatePropertiesMenu(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.refreshToolButtons(),this.fixLayout(),this.drawNew()},PaintEditorMorph.prototype.buildToolbox=function(){var t={brush:"Paintbrush tool\n(free draw)",rectangle:"Stroked Rectangle\n(shift: square)",circle:"Stroked Ellipse\n(shift: circle)",eraser:"Eraser tool",crosshairs:"Set the rotation center",line:"Line tool\n(shift: vertical/horizontal)",rectangleSolid:"Filled Rectangle\n(shift: square)",circleSolid:"Filled Ellipse\n(shift: circle)",paintbucket:"Fill a region",pipette:"Pipette tool\n(pick a color anywhere)"},e=this,o=this.toolbox.left(),i=this.toolbox.top(),r=2,n=5,s=0,a=0;Object.keys(t).forEach(function(n){var h=e.toolButton(n,t[n]);h.setPosition(new Point(o+s,i+a)),s+=h.width()+r,"crosshairs"===n&&(s=0,a+=h.height()+r,e.paper.drawcrosshair()),e.toolbox[n]=h,e.toolbox.add(h)}),this.toolbox.bounds=this.toolbox.fullBounds().expandBy(2*n),this.toolbox.drawNew()},PaintEditorMorph.prototype.buildEdits=function(){var t=this.paper;this.edits.add(this.pushButton("undo",function(){t.undo()})),this.edits.add(this.pushButton("clear",function(){t.clearCanvas()})),this.edits.fixLayout()},PaintEditorMorph.prototype.openIn=function(t,e,o,i){this.oldim=e,this.oldrc=o.copy(),this.callback=i||nop,this.processKeyUp=function(){this.shift=!1,this.propertiesControls.constrain.refresh()},this.processKeyDown=function(){this.shift=16===this.world().currentKey,this.propertiesControls.constrain.refresh()},this.oldim&&(this.paper.centermerge(this.oldim,this.paper.paper),this.paper.rotationCenter=this.oldrc.add(new Point((this.paper.paper.width-this.oldim.width)/2,(this.paper.paper.height-this.oldim.height)/2)),this.paper.drawNew()),this.key="paint",this.popUp(t)},PaintEditorMorph.prototype.fixLayout=function(){var t=Morph.prototype.trackChanges;this.changed(),t=Morph.prototype.trackChanges,Morph.prototype.trackChanges=!1,this.paper&&(this.paper.buildContents(),this.paper.drawNew()),this.controls&&this.controls.fixLayout(),this.body&&this.body.fixLayout(),PaintEditorMorph.uber.fixLayout.call(this),Morph.prototype.trackChanges=t,this.changed()},PaintEditorMorph.prototype.refreshToolButtons=function(){this.toolbox.children.forEach(function(t){t.refresh()})},PaintEditorMorph.prototype.ok=function(){this.callback(this.paper.paper,this.paper.rotationCenter),this.destroy()},PaintEditorMorph.prototype.cancel=function(){this.oncancel&&this.oncancel(),this.destroy()},PaintEditorMorph.prototype.populatePropertiesMenu=function(){var t=this.controls,e=this,o=this.propertiesControls,i=new AlignmentMorph("row",this.padding);o.primaryColorViewer=new Morph,o.primaryColorViewer.setExtent(new Point(180,50)),o.primaryColorViewer.color=new Color(0,0,0),o.colorpicker=new PaintColorPickerMorph(new Point(180,100),function(t){var i,r,n=newCanvas(o.primaryColorViewer.extent()),s=n.getContext("2d");if(e.paper.settings.primarycolor=t,"transparent"===t)for(i=0;180>i;i+=5)for(r=0;15>r;r+=5)s.fillStyle=(r+i)/5%2===0?"rgba(0, 0, 0, 0.2)":"rgba(0, 0, 0, 0.5)",s.fillRect(i,r,5,5);else s.fillStyle=t.toString(),s.fillRect(0,0,180,15);s.strokeStyle="black",s.lineWidth=Math.min(e.paper.settings.linewidth,20),s.beginPath(),s.lineCap="round",s.moveTo(20,30),s.lineTo(160,30),s.stroke(),o.primaryColorViewer.image=n,o.primaryColorViewer.changed()}),o.colorpicker.action(new Color(0,0,0)),o.penSizeSlider=new SliderMorph(0,20,5,5),o.penSizeSlider.orientation="horizontal",o.penSizeSlider.setHeight(15),o.penSizeSlider.setWidth(150),o.penSizeSlider.action=function(t){o.penSizeField&&o.penSizeField.setContents(t),e.paper.settings.linewidth=t,o.colorpicker.action(e.paper.settings.primarycolor)},o.penSizeField=new InputFieldMorph("5",!0,null,!1),o.penSizeField.contents().minWidth=20,o.penSizeField.setWidth(25),o.penSizeField.accept=function(){var t=parseFloat(o.penSizeField.getValue());o.penSizeSlider.value=t,o.penSizeSlider.drawNew(),o.penSizeSlider.updateValue(),this.setContents(t),e.paper.settings.linewidth=t,this.world().keyboardReceiver=e,o.colorpicker.action(e.paper.settings.primarycolor)},i.add(o.penSizeSlider),i.add(o.penSizeField),i.color=e.color,i.fixLayout(),o.penSizeField.drawNew(),o.constrain=new ToggleMorph("checkbox",this,function(){e.shift=!e.shift},"Constrain proportions of shapes?\n(you can also hold shift)",function(){return e.shift}),t.add(o.colorpicker),t.add(o.primaryColorViewer),t.add(new TextMorph("Brush size")),t.add(i),t.add(o.constrain)},PaintEditorMorph.prototype.toolButton=function(t,e){var o,i=this;return o=new ToggleButtonMorph(null,this,function(){i.paper.currentTool=t,i.paper.toolChanged(t),i.refreshToolButtons(),"pipette"===t&&i.getUserColor()},new SymbolMorph(t,18),function(){return i.paper.currentTool===t}),o.hint=e,o.drawNew(),o.fixLayout(),o},PaintEditorMorph.prototype.pushButton=function(t,e,o){return new PushButtonMorph(this,e,t,null,o)},PaintEditorMorph.prototype.getUserColor=function(){var t=this,e=this.world(),o=e.hand,i=getDocumentPositionOf(e.worldCanvas),r=o.processMouseMove,n=o.processMouseDown,s=o.processMouseUp;o.processMouseMove=function(r){var n;o.setPosition(new Point(r.pageX-i.x,r.pageY-i.y)),n=e.getGlobalPixelColor(o.position()),n.a=255,t.propertiesControls.colorpicker.action(n)},o.processMouseDown=nop,o.processMouseUp=function(){t.paper.currentTool="brush",t.paper.toolChanged("brush"),t.refreshToolButtons(),o.processMouseMove=r,o.processMouseDown=n,o.processMouseUp=s}},PaintColorPickerMorph.prototype=new Morph,PaintColorPickerMorph.prototype.constructor=PaintColorPickerMorph,PaintColorPickerMorph.uber=Morph.prototype,PaintColorPickerMorph.prototype.init=function(t,e){this.setExtent(t||new Point(200,100)),this.action=e||nop,this.drawNew()},PaintColorPickerMorph.prototype.drawNew=function(){var t,e,o=0,i=0,r=newCanvas(this.extent()),n=r.getContext("2d");for(o=0;o<this.width();o+=1)for(i=0;i<this.height()-20;i+=1)n.fillStyle="hsl("+360*o/this.width()+",100%,"+100*i/(this.height()-20)+"%)",n.fillRect(o,i,1,1);for(o=0;o<this.width();o+=1)e=Math.floor(255*o/this.width()),n.fillStyle="rgb("+e+", "+e+", "+e+")",n.fillRect(o,this.height()-20,1,10);for(t=["black","white","gray"],o=0;o<t.length;o+=1)n.fillStyle=t[o],n.fillRect(o*this.width()/t.length,this.height()-10,this.width()/t.length,10);for(o=2*this.width()/3;o<this.width();o+=2)for(i=this.height()-10;i<this.height();i+=2)(o+i)/2%2===0&&(n.fillStyle="#DDD",n.fillRect(o,i,2,2));this.image=r},PaintColorPickerMorph.prototype.mouseDownLeft=function(t){this.action(t.subtract(this.position()).x>2*this.width()/3&&t.subtract(this.position()).y>this.height()-10?"transparent":this.getPixelColor(t))},PaintColorPickerMorph.prototype.mouseMove=PaintColorPickerMorph.prototype.mouseDownLeft,PaintCanvasMorph.prototype=new Morph,PaintCanvasMorph.prototype.constructor=PaintCanvasMorph,PaintCanvasMorph.uber=Morph.prototype,PaintCanvasMorph.prototype.init=function(t){this.rotationCenter=new Point(240,180),this.dragRect=null,this.previousDragPoint=null,this.currentTool="brush",this.dragRect=new Rectangle,this.mask=newCanvas(this.extent()),this.paper=newCanvas(this.extent()),this.erasermask=newCanvas(this.extent()),this.background=newCanvas(this.extent()),this.settings={primarycolor:new Color(0,0,0,255),secondarycolor:new Color(0,0,0,255),linewidth:3},this.brushBuffer=[],this.undoBuffer=[],this.isShiftPressed=t||function(){var t=this.world().currentKey;return 16===t},this.buildContents()},PaintCanvasMorph.prototype.cacheUndo=function(){var t=newCanvas(this.extent());this.merge(this.paper,t),this.undoBuffer.push(t)},PaintCanvasMorph.prototype.undo=function(){this.undoBuffer.length>0&&(this.paper=newCanvas(this.extent()),this.mask.width=this.mask.width+1-1,this.merge(this.undoBuffer.pop(),this.paper),this.drawNew(),this.changed())},PaintCanvasMorph.prototype.merge=function(t,e){e.getContext("2d").drawImage(t,0,0)},PaintCanvasMorph.prototype.centermerge=function(t,e){e.getContext("2d").drawImage(t,(e.width-t.width)/2,(e.height-t.height)/2)},PaintCanvasMorph.prototype.clearCanvas=function(){this.buildContents(),this.drawNew(),this.changed()},PaintCanvasMorph.prototype.toolChanged=function(t){this.mask=newCanvas(this.extent()),"crosshairs"===t&&this.drawcrosshair(),this.drawNew(),this.changed()},PaintCanvasMorph.prototype.drawcrosshair=function(t){var e=t||this.mask.getContext("2d"),o=this.rotationCenter;e.lineWidth=1,e.strokeStyle="black",e.clearRect(0,0,this.mask.width,this.mask.height),e.globalAlpha=.5,e.fillStyle="white",e.beginPath(),e.arc(o.x,o.y,20,radians(0),radians(360),!1),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.arc(o.x,o.y,10,radians(0),radians(360),!1),e.stroke(),e.beginPath(),e.moveTo(0,o.y),e.lineTo(this.mask.width,o.y),e.stroke(),e.beginPath(),e.moveTo(o.x,0),e.lineTo(o.x,this.mask.height),e.stroke(),this.drawNew(),this.changed()},PaintCanvasMorph.prototype.floodfill=function(t){var e,o,i,r,n=this.paper.width,s=this.paper.height,a=this.paper.getContext("2d"),h=a.getImageData(0,0,n,s),l=h.data,p=[Math.round(t.y)*n+t.x];if(o=function(t){var e=4*t;return[l[e],l[e+1],l[e+2],l[e+3]]},i=o(p[0]),r=function(t){return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]},(0!==i[3]||"transparent"!==this.settings.primarycolor)&&!(i[0]===this.settings.primarycolor.r&&i[1]===this.settings.primarycolor.g&&i[2]===this.settings.primarycolor.b&&i[3]===this.settings.primarycolor.a||0===i[3]&&0===this.settings.primarycolor.a)){for(;p.length>0;)e=p.pop(),r(o(e))&&(e%n>1&&(p.push(e+1),p.push(e-1)),e>0&&s*n>e&&(p.push(e+n),p.push(e-n))),"transparent"===this.settings.primarycolor?l[4*e+3]=0:(l[4*e]=this.settings.primarycolor.r,l[4*e+1]=this.settings.primarycolor.g,l[4*e+2]=this.settings.primarycolor.b,l[4*e+3]=this.settings.primarycolor.a);a.putImageData(h,0,0),this.drawNew(),this.changed()}},PaintCanvasMorph.prototype.mouseDownLeft=function(t){return this.cacheUndo(),this.dragRect.origin=t.subtract(this.bounds.origin),this.dragRect.corner=t.subtract(this.bounds.origin),this.previousDragPoint=this.dragRect.corner.copy(),"crosshairs"===this.currentTool?(this.rotationCenter=t.subtract(this.bounds.origin),void this.drawcrosshair()):"paintbucket"===this.currentTool?this.floodfill(t.subtract(this.bounds.origin)):void("transparent"===this.settings.primarycolor&&"crosshairs"!==this.currentTool&&(this.erasermask=newCanvas(this.extent()),this.merge(this.paper,this.erasermask)))},PaintCanvasMorph.prototype.mouseMove=function(t){function e(){return Math.max(Math.abs(c),Math.abs(d))*(c/Math.abs(c))}function o(){return Math.max(Math.abs(c),Math.abs(d))*(d/Math.abs(d))}if("paintbucket"!==this.currentTool){var i,r=t.subtract(this.bounds.origin),n=this.mask.getContext("2d"),s=this.paper.getContext("2d"),a=this.dragRect.origin.x,h=this.dragRect.origin.y,l=r.x,p=r.y,c=(l-a)/2,d=(p-h)/2,u=this.paper.width;switch(n.save(),this.brushBuffer.push([l,p]),n.lineWidth=this.settings.linewidth,n.clearRect(0,0,this.bounds.width(),this.bounds.height()),this.dragRect.corner=r.subtract(this.dragRect.origin),"transparent"===this.settings.primarycolor&&"crosshairs"!==this.currentTool?(this.merge(this.erasermask,this.mask),s.clearRect(0,0,this.bounds.width(),this.bounds.height()),n.globalCompositeOperation="destination-out"):(n.fillStyle=this.settings.primarycolor.toString(),n.strokeStyle=this.settings.primarycolor.toString()),this.currentTool){case"rectangle":this.isShiftPressed()?n.strokeRect(a,h,2*e(),2*o()):n.strokeRect(a,h,2*c,2*d);break;case"rectangleSolid":this.isShiftPressed()?n.fillRect(a,h,2*e(),2*o()):n.fillRect(a,h,2*c,2*d);break;case"brush":for(n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(this.brushBuffer[0][0],this.brushBuffer[0][1]),i=0;i<this.brushBuffer.length;i+=1)n.lineTo(this.brushBuffer[i][0],this.brushBuffer[i][1]);n.stroke();break;case"line":n.beginPath(),n.moveTo(a,h),this.isShiftPressed()?Math.abs(d)>Math.abs(c)?n.lineTo(a,p):n.lineTo(l,h):n.lineTo(l,p),n.stroke();break;case"circle":case"circleSolid":if(n.beginPath(),this.isShiftPressed())n.arc(a,h,new Point(a,h).distanceTo(new Point(l,p)),0,2*Math.PI,!1);else{for(i=0;u>i;i+=1)n.lineTo(i,2*d*Math.sqrt(2-Math.pow((i-a)/(2*c),2))+h);for(i=u;i>0;i-=1)n.lineTo(i,-2*d*Math.sqrt(2-Math.pow((i-a)/(2*c),2))+h)}n.closePath(),"circleSolid"===this.currentTool?n.fill():"circle"===this.currentTool&&n.stroke();break;case"crosshairs":this.rotationCenter=r.copy(),this.drawcrosshair(n);break;case"eraser":for(this.merge(this.paper,this.mask),n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.moveTo(this.brushBuffer[0][0],this.brushBuffer[0][1]),i=0;i<this.brushBuffer.length;i+=1)n.lineTo(this.brushBuffer[i][0],this.brushBuffer[i][1]);n.stroke(),n.restore(),this.paper=newCanvas(this.extent()),this.merge(this.mask,this.paper);break;default:nop()}this.previousDragPoint=r,this.drawNew(),this.changed(),n.restore()}},PaintCanvasMorph.prototype.mouseClickLeft=function(){"crosshairs"!==this.currentTool&&this.merge(this.mask,this.paper),this.brushBuffer=[]},PaintCanvasMorph.prototype.mouseLeaveDragging=PaintCanvasMorph.prototype.mouseClickLeft,PaintCanvasMorph.prototype.buildContents=function(){this.background=newCanvas(this.extent()),this.paper=newCanvas(this.extent()),this.mask=newCanvas(this.extent()),this.erasermask=newCanvas(this.extent());var t,e,o=this.background.getContext("2d");for(t=0;t<this.background.width;t+=5)for(e=0;e<this.background.height;e+=5)o.fillStyle=(t+e)/5%2===1?"rgba(255, 255, 255, 1)":"rgba(255, 255, 255, 0.3)",o.fillRect(t,e,5,5)},PaintCanvasMorph.prototype.drawNew=function(){var t=newCanvas(this.extent());this.merge(this.background,t),this.merge(this.paper,t),this.merge(this.mask,t),this.image=t,this.drawFrame()},PaintCanvasMorph.prototype.drawFrame=function(){var t,e;t=this.image.getContext("2d"),this.parent?(this.color=this.parent.color.lighter(.75*this.contrast),e=this.parent.color):e=new Color(120,120,120),t.fillStyle=this.color.toString(),this.cachedClr=e.toString(),this.cachedClrBright=e.lighter(this.contrast).toString(),this.cachedClrDark=e.darker(this.contrast).toString(),this.drawRectBorder(t)},PaintCanvasMorph.prototype.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,PaintCanvasMorph.prototype.edge=InputFieldMorph.prototype.edge,PaintCanvasMorph.prototype.fontSize=InputFieldMorph.prototype.fontSize,PaintCanvasMorph.prototype.typeInPadding=InputFieldMorph.prototype.typeInPadding,PaintCanvasMorph.prototype.contrast=InputFieldMorph.prototype.contrast,modules.lists="2014-January-09";var List,ListWatcherMorph;List.prototype.toString=function(){return"a List ["+this.asArray+"]"},List.prototype.changed=function(){this.lastChanged=Date.now()},List.prototype.cons=function(t,e){var o=new List;return o.first=isNil(t)?null:t,o.rest=e||null,o.isLinked=!0,o},List.prototype.cdr=function(){function t(e){return e>this.contents.length?new List:this.cons(this.at(e),t.call(this,e+1))}return this.isLinked?this.rest||new List:this.contents.length<2?new List:t.call(this,2)},List.prototype.add=function(t,e){var o=e||this.length()+1,i=0===t?0:t===!1?!1:t||null;this.becomeArray(),this.contents.splice(o-1,0,i),this.changed()},List.prototype.put=function(t,e){var o=0===t?0:t===!1?!1:t||null;this.becomeArray(),this.contents[e-1]=o,this.changed()},List.prototype.remove=function(t){this.becomeArray(),this.contents.splice(t-1,1),this.changed()},List.prototype.clear=function(){this.contents=[],this.first=null,this.rest=null,this.isLinked=!1,this.changed()},List.prototype.length=function(){return this.isLinked?(void 0===this.first?0:1)+(this.rest?this.rest.length():0):this.contents.length},List.prototype.at=function(t){var e,o=+t;return this.isLinked?1===o?this.first:this.rest.at(o-1):(e=this.contents[o-1],isNil(e)?"":e)},List.prototype.contains=function(t){if(this.isLinked){if(snapEquals(this.first,t))return!0;if(this.rest instanceof List)return this.rest.contains(t)}return this.contents.some(function(e){return snapEquals(e,t)})},List.prototype.asArray=function(){return this.becomeArray(),this.contents},List.prototype.asText=function(){var t,e,o="",i=this.length();for(e=1;i>=e;e+=1)t=this.at(e),t instanceof List?o=o.concat(t.asText()):(t=isNil(t)?"":t.toString(),o=o.concat(t));return o},List.prototype.becomeArray=function(){if(this.isLinked){var t=this;for(this.contents=[];t instanceof List&&t.length()>0;)this.contents.push(t.at(1)),t=t.cdr();this.isLinked=!1}},List.prototype.becomeLinked=function(){var t,e,o=this;if(!this.isLinked){for(e=this.length(),t=0;e>t;t+=1)o.first=this.contents[t],o.rest=new List,o.isLinked=!0,o=o.rest;this.contents=[],this.isLinked=!0}},List.prototype.equalTo=function(t){var e;if(!(t instanceof List))return!1;if(!this.isLinked&&!t.isLinked){if(0===this.length()&&0===t.length())return!0;if(this.length()!==t.length())return!1;for(e=0;e<this.length();e+=1)if(!snapEquals(this.contents[e],t.contents[e]))return!1;return!0}if(this.isLinked&&t.isLinked)return snapEquals(this.at(1),t.at(1))?this.cdr().equalTo(t.cdr()):!1;if(this.length()!==t.length())return!1;for(e=0;e<this.length();e+=1)if(!snapEquals(this.at(e),t.at(e)))return!1;return!0},ListWatcherMorph.prototype=new BoxMorph,ListWatcherMorph.prototype.constructor=ListWatcherMorph,ListWatcherMorph.uber=BoxMorph.prototype,ListWatcherMorph.prototype.cellColor=SpriteMorph.prototype.blockColor.lists,ListWatcherMorph.prototype.init=function(t,e){var o=this;this.list=t||new List,this.start=1,this.range=100,this.lastUpdated=Date.now(),this.lastCell=null,this.parentCell=e||null,this.label=new StringMorph(localize("length: ")+this.list.length(),SyntaxElementMorph.prototype.fontSize,null,!1,!1,!1,MorphicPreferences.isFlat?new Point:new Point(1,1),new Color(255,255,255)),this.label.mouseClickLeft=function(){o.startIndexMenu()},this.frame=new ScrollFrameMorph(null,10),this.frame.alpha=0,this.frame.acceptsDrops=!1,this.frame.contents.acceptsDrops=!1,this.handle=new HandleMorph(this,80,70,3,3),this.handle.setExtent(new Point(13,13)),this.arrow=new ArrowMorph("down",SyntaxElementMorph.prototype.fontSize),this.arrow.mouseClickLeft=function(){o.startIndexMenu()},this.arrow.setRight(this.handle.right()),this.arrow.setBottom(this.handle.top()),this.handle.add(this.arrow),this.plusButton=new PushButtonMorph(this.list,"add","+"),this.plusButton.padding=0,this.plusButton.edge=0,this.plusButton.outlineColor=this.color,this.plusButton.drawNew(),this.plusButton.fixLayout(),ListWatcherMorph.uber.init.call(this,SyntaxElementMorph.prototype.rounding,1.000001,new Color(120,120,120)),this.color=new Color(220,220,220),this.isDraggable=!0,this.setExtent(new Point(80,70).multiplyBy(SyntaxElementMorph.prototype.scale)),this.add(this.label),this.add(this.frame),this.add(this.plusButton),this.add(this.handle),this.handle.drawNew(),this.update(),this.fixLayout()},ListWatcherMorph.prototype.update=function(t){var e,o,i,r,n,s,a,h,l,p,c=1e3;if(this.frame.contents.children.forEach(function(t){t instanceof CellMorph&&t.contentsMorph instanceof ListWatcherMorph&&t.contentsMorph.update()}),this.lastUpdated===this.list.lastChanged&&!t)return null;for(this.updateLength(!0),this.start=Math.max(Math.min(this.start,Math.floor((this.list.length()-1)/this.range)*this.range+1),1),l=Math.min(this.start+this.range-1,this.list.length()),i=Math.min(3*(l-this.start+1),this.frame.contents.children.length),e=0;i>e;e+=3)o=this.start+e/3,n=this.frame.contents.children[e],a=this.frame.contents.children[e+1],h=this.frame.contents.children[e+2],s=this.list.at(o),n.contents!==s&&(n.contents=s,n.drawNew(),this.lastCell&&n.setLeft(this.lastCell.left())),this.lastCell=n,a.text!==o.toString()&&(a.text=o.toString(),a.drawNew()),h.action=o;for(r=3*(l-this.start+1);this.frame.contents.children.length>r;)this.frame.contents.children[r].destroy();if(i=r,e=this.frame.contents.children.length,p=Date.now(),i>e+1)for(e;i>e;e+=3){if(Date.now()-p>c)return this.fixLayout(),this.frame.contents.adjustBounds(),this.frame.contents.setLeft(this.frame.left()),null;o=this.start+e/3,a=new StringMorph(o.toString(),SyntaxElementMorph.prototype.fontSize,null,!1,!1,!1,MorphicPreferences.isFlat?new Point:new Point(1,1),new Color(255,255,255)),n=new CellMorph(this.list.at(o),this.cellColor,o,this.parentCell),h=new PushButtonMorph(this.list.remove,o,"-",this.list),h.padding=1,h.edge=0,h.corner=1,h.outlineColor=this.color.darker(),h.drawNew(),h.fixLayout(),this.frame.contents.add(n),this.lastCell?n.setPosition(this.lastCell.bottomLeft()):n.setTop(this.frame.contents.top()),this.lastCell=n,a.setCenter(n.center()),a.setRight(n.left()-2),this.frame.contents.add(a),this.frame.contents.add(h)}this.lastCell=null,this.fixLayout(),this.frame.contents.adjustBounds(),this.frame.contents.setLeft(this.frame.left()),this.updateLength(),this.lastUpdated=this.list.lastChanged},ListWatcherMorph.prototype.updateLength=function(t){this.label.text=localize("length: ")+this.list.length(),this.label.color=t?new Color(0,0,100):new Color(0,0,0),this.label.drawNew(),this.label.setCenter(this.center()),this.label.setBottom(this.bottom()-3)},ListWatcherMorph.prototype.startIndexMenu=function(){var t,e,o=this,i=Math.ceil(this.list.length()/this.range),r=new MenuMorph(function(t){o.setStartIndex(t)},null,o);for(r.addItem("1...",1),t=1;i>t;t+=1)e=100*t+1,r.addItem(e+"...",e);r.popUpAtHand(this.world())},ListWatcherMorph.prototype.setStartIndex=function(t){this.start=t,this.list.changed()},ListWatcherMorph.prototype.fixLayout=function(){Morph.prototype.trackChanges=!1,this.frame&&(this.arrangeCells(),this.frame.silentSetPosition(this.position().add(3)),this.frame.bounds.corner=this.bounds.corner.subtract(new Point(3,17)),this.frame.drawNew(),this.frame.contents.adjustBounds()),this.label.setCenter(this.center()),this.label.setBottom(this.bottom()-3),this.plusButton.setLeft(this.left()+3),this.plusButton.setBottom(this.bottom()-3),Morph.prototype.trackChanges=!0,this.changed(),this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},ListWatcherMorph.prototype.arrangeCells=function(){var t,e,o,i,r,n=this.frame.contents.children.length;for(t=0;n>t;t+=3)e=this.frame.contents.children[t],o=this.frame.contents.children[t+1],i=this.frame.contents.children[t+2],r&&e.setTop(r.bottom()),o&&(o.setTop(e.center().y-o.height()/2),o.setRight(e.left()-2)),i&&(i.setCenter(e.center()),i.setLeft(e.right()+2)),r=e;this.frame.contents.adjustBounds()},ListWatcherMorph.prototype.show=function(){ListWatcherMorph.uber.show.call(this),this.frame.contents.adjustBounds()},ListWatcherMorph.prototype.drawNew=function(){WatcherMorph.prototype.drawNew.call(this),this.fixLayout()},modules.byob="2014-January-10";var CustomBlockDefinition,CustomCommandBlockMorph,CustomReporterBlockMorph,BlockDialogMorph,BlockEditorMorph,PrototypeHatBlockMorph,BlockLabelFragment,BlockLabelFragmentMorph,BlockInputFragmentMorph,BlockLabelPlaceHolderMorph,InputSlotDialogMorph,VariableDialogMorph,JaggedBlockMorph,BlockExportDialogMorph,BlockImportDialogMorph;CustomBlockDefinition.prototype.blockInstance=function(){var t;return t="command"===this.type?new CustomCommandBlockMorph(this):new CustomReporterBlockMorph(this,"predicate"===this.type),t.isDraggable=!0,t},CustomBlockDefinition.prototype.templateInstance=function(){var t;return t=this.blockInstance(),t.refreshDefaults(),t.isDraggable=!1,t.isTemplate=!0,t},CustomBlockDefinition.prototype.prototypeInstance=function(){var t,e,o=this;return t="command"===this.type?new CustomCommandBlockMorph(this,!0):new CustomReporterBlockMorph(this,"predicate"===this.type,!0),t.parts().forEach(function(t){t instanceof BlockInputFragmentMorph&&(e=o.declarations[t.fragment.labelString],e&&(t.fragment.type=e[0],t.fragment.defaultValue=e[1],t.fragment.options=e[2],t.fragment.isReadOnly=e[3]||!1))}),t},CustomBlockDefinition.prototype.copyAndBindTo=function(t){var e=copy(this);return e.receiver=t,e.declarations=copy(this.declarations),e.body=Process.prototype.reify.call(null,this.body.expression,new List(this.inputNames())),e.body.outerContext=null,e},CustomBlockDefinition.prototype.blockSpec=function(){var t,e=this,o=[],i=this.parseSpec(this.spec);return i.forEach(function(i){t="%"===i[0]?e.typeOf(i.slice(1)):i,o.push(t),o.push(" ")}),"".concat.apply("",o).trim()},CustomBlockDefinition.prototype.helpSpec=function(){var t=[],e=this.parseSpec(this.spec);return e.forEach(function(e){"%"!==e[0]&&t.push(e)}),"".concat.apply("",t).replace(/\?/g,"")},CustomBlockDefinition.prototype.typeOf=function(t){return this.declarations[t]?this.declarations[t][0]:"%s"},CustomBlockDefinition.prototype.defaultValueOf=function(t){return this.declarations[t]?this.declarations[t][1]:""},CustomBlockDefinition.prototype.defaultValueOfInputIdx=function(t){var e=this.inputNames()[t];return this.defaultValueOf(e)},CustomBlockDefinition.prototype.dropDownMenuOfInputIdx=function(t){var e=this.inputNames()[t];return this.dropDownMenuOf(e)},CustomBlockDefinition.prototype.isReadOnlyInputIdx=function(t){var e=this.inputNames()[t];return this.isReadOnlyInput(e)},CustomBlockDefinition.prototype.inputOptionsOfIdx=function(t){var e=this.inputNames()[t];return this.inputOptionsOf(e)},CustomBlockDefinition.prototype.dropDownMenuOf=function(t){var e={};return this.declarations[t]&&this.declarations[t][2]?(this.declarations[t][2].split("\n").forEach(function(t){var o=t.split("=");e[o[0]]=isNil(o[1])?o[0]:o[1]}),e):null},CustomBlockDefinition.prototype.isReadOnlyInput=function(t){return this.declarations[t]&&this.declarations[t][3]===!0},CustomBlockDefinition.prototype.inputOptionsOf=function(t){return[this.dropDownMenuOf(t),this.isReadOnlyInput(t)]},CustomBlockDefinition.prototype.inputNames=function(){var t=[],e=this.parseSpec(this.spec);return e.forEach(function(e){"%"===e[0]&&t.push(e.slice(1))}),t},CustomBlockDefinition.prototype.parseSpec=function(t){var e,o,i=[],r="",n=!1;
for(e=0;e<t.length;e+=1)o=t[e],"'"===o?n=!n:" "!==o||n?r=r.concat(o):(i.push(r),r="");return i.push(r),i},CustomCommandBlockMorph.prototype=new CommandBlockMorph,CustomCommandBlockMorph.prototype.constructor=CustomCommandBlockMorph,CustomCommandBlockMorph.uber=CommandBlockMorph.prototype,CustomCommandBlockMorph.prototype.init=function(t,e){this.definition=t,this.isPrototype=e||!1,CustomCommandBlockMorph.uber.init.call(this),this.category=t.category,this.selector="evaluateCustomBlock",t&&this.refresh()},CustomCommandBlockMorph.prototype.refresh=function(){var t,e=this.definition,o=this.isPrototype?e.spec:e.blockSpec();this.setCategory(e.category),this.blockSpec!==o?(t=this.inputs(),this.setSpec(o),this.fixBlockColor(),this.fixLabelColor(),this.restoreInputs(t)):this.inputs().forEach(function(t,o){t instanceof InputSlotMorph&&t.setChoices.apply(t,e.inputOptionsOfIdx(o))}),this.inputs().forEach(function(t,o){t instanceof TemplateSlotMorph&&"\u2191"===t.contents()&&t.setContents(e.inputNames()[o])})},CustomCommandBlockMorph.prototype.restoreInputs=function(t){var e,o=0,i=this;this.isPrototype||this.inputs().forEach(function(r){e=t[o],e instanceof ReporterBlockMorph&&!(r instanceof TemplateSlotMorph)?i.silentReplaceInput(r,e):e instanceof InputSlotMorph&&r instanceof InputSlotMorph?r.setContents(e.evaluate()):e instanceof TemplateSlotMorph&&r instanceof TemplateSlotMorph?r.setContents(e.evaluate()):e instanceof CSlotMorph&&r instanceof CSlotMorph&&r.nestedBlock(e.evaluate()),o+=1})},CustomCommandBlockMorph.prototype.refreshDefaults=function(){var t=this.inputs(),e=0,o=this;t.forEach(function(t){t instanceof InputSlotMorph&&t.setContents(o.definition.defaultValueOfInputIdx(e)),e+=1})},CustomCommandBlockMorph.prototype.refreshPrototype=function(){var t,e,o,i,r=[],n=this,s=0;return this.isPrototype?(t=this.parentThatIsA(PrototypeHatBlockMorph),this.parts().forEach(function(t){t.fragment.isDeleted||(t.fragment.type?r.push(t.fragment):(o=n.definition.parseSpec(t.fragment.labelString),o.forEach(function(e){i=t.fragment.copy(),i.labelString=e,r.push(i)})))}),e=this.specFromFragments(),this instanceof CustomCommandBlockMorph&&("reporter"===t.type||"predicate"===t.type)?(n=new CustomReporterBlockMorph(this.definition,"predicate"===t.type,!0),t.silentReplaceInput(this,n)):this instanceof CustomReporterBlockMorph&&("command"===t.type?(n=new CustomCommandBlockMorph(this.definition,!0),t.silentReplaceInput(this,n)):(this.isPredicate="predicate"===t.type,this.drawNew())),n.setCategory(t.blockCategory||"other"),t.fixBlockColor(),n.setSpec(e),n.parts().forEach(function(t){t instanceof BlockLabelPlaceHolderMorph||(r[s]&&(t.fragment=r[s]),s+=1)}),this.refreshPrototypeSlotTypes(),void t.fixLayout()):null},CustomCommandBlockMorph.prototype.refreshPrototypeSlotTypes=function(){this.parts().forEach(function(t){t instanceof BlockInputFragmentMorph&&(t.template().instantiationSpec=t.contents(),t.setContents(t.fragment.defTemplateSpecFragment()))}),this.fixBlockColor(null,!0)},CustomCommandBlockMorph.prototype.inputFragmentNames=function(){var t=[];return this.parts().forEach(function(e){!e.fragment.isDeleted&&e.fragment.type&&t.push(e.fragment.labelString)}),t},CustomCommandBlockMorph.prototype.upvarFragmentNames=function(){var t=[];return this.parts().forEach(function(e){e.fragment.isDeleted||"%upvar"!==e.fragment.type||t.push(e.fragment.labelString)}),t},CustomCommandBlockMorph.prototype.upvarFragmentName=function(t){return this.upvarFragmentNames()[t]||"\u2191"},CustomCommandBlockMorph.prototype.specFromFragments=function(){var t="";return this.parts().forEach(function(e){e.fragment.isDeleted||(t=t+e.fragment.defSpecFragment()+" ")}),t.trim()},CustomCommandBlockMorph.prototype.blockSpecFromFragments=function(){var t="";return this.parts().forEach(function(e){e.fragment.isDeleted||(t=t+e.fragment.blockSpecFragment()+" ")}),t.trim()},CustomCommandBlockMorph.prototype.declarationsFromFragments=function(){var t={};return this.parts().forEach(function(e){e instanceof BlockInputFragmentMorph&&(t[e.fragment.labelString]=[e.fragment.type,e.fragment.defaultValue,e.fragment.options,e.fragment.isReadOnly])}),t},CustomCommandBlockMorph.prototype.parseSpec=function(t){return this.isPrototype?this.definition.parseSpec.call(this,t):CustomCommandBlockMorph.uber.parseSpec.call(this,t)},CustomCommandBlockMorph.prototype.mouseClickLeft=function(){return this.isPrototype?void this.edit():CustomCommandBlockMorph.uber.mouseClickLeft.call(this)},CustomCommandBlockMorph.prototype.edit=function(){var t,e,o=this;this.isPrototype?(t=this.definition.blockInstance(),t.addShadow(),e=this.parentThatIsA(PrototypeHatBlockMorph),new BlockDialogMorph(null,function(t){t&&(e.blockCategory=t.category,e.type=t.type,o.refreshPrototype())},o).openForChange("Change block",e.blockCategory,e.type,o.world(),t.fullImage(),o.isInUse())):new BlockEditorMorph(this.definition,this.receiver()).popUp()},CustomCommandBlockMorph.prototype.labelPart=function(t){var e;return this.isPrototype?("%"===t[0]&&t.length>1?e=new BlockInputFragmentMorph(t.slice(1)):(e=new BlockLabelFragmentMorph(t),e.fontSize=this.fontSize,e.color=new Color(255,255,255),e.isBold=!0,e.shadowColor=this.color.darker(this.labelContrast),e.shadowOffset=this.embossing,e.drawNew()),e):CustomCommandBlockMorph.uber.labelPart.call(this,t)},CustomCommandBlockMorph.prototype.placeHolder=function(){var t;return t=new BlockLabelPlaceHolderMorph,t.fontSize=1.4*this.fontSize,t.color=new Color(45,45,45),t.drawNew(),t},CustomCommandBlockMorph.prototype.attachTargets=function(){return this.isPrototype?[]:CustomCommandBlockMorph.uber.attachTargets.call(this)},CustomCommandBlockMorph.prototype.isInUse=function(){return this.receiver().usesBlockInstance(this.definition)},CustomCommandBlockMorph.prototype.userMenu=function(){var t;return this.isPrototype?(t=new MenuMorph(this),t.addItem("script pic...",function(){window.open(this.topBlock().fullImage().toDataURL())},"open a new window\nwith a picture of this script")):(t=this.constructor.uber.userMenu.call(this),t?"STUDENT"!=world.role&&t.addLine():t=new MenuMorph(this),"STUDENT"!=world.role&&t.addItem("delete block definition...","deleteBlockDefinition")),"STUDENT"!=world.role&&t.addItem("edit...","edit"),t},CustomCommandBlockMorph.prototype.exportBlockDefinition=function(){var t=(new SnapSerializer).serialize(this.definition);window.open("data:text/xml,"+encodeURIComponent(t))},CustomCommandBlockMorph.prototype.deleteBlockDefinition=function(){var t,e,o,i,r,n=this;return this.isPrototype?null:(r=n.definition.blockInstance(),r.addShadow(),void new DialogBoxMorph(this,function(){e=n.receiver(),e.deleteAllBlockInstances(n.definition),n.definition.isGlobal?(o=e.parentThatIsA(StageMorph),t=o.globalBlocks.indexOf(n.definition),-1!==t&&o.globalBlocks.splice(t,1)):(t=e.customBlocks.indexOf(n.definition),-1!==t&&e.customBlocks.splice(t,1)),i=e.parentThatIsA(IDE_Morph),i&&(i.flushPaletteCache(),i.refreshPalette())},this).askYesNo("Delete Custom Block",localize("block deletion dialog text"),n.world(),r.fullImage()))},CustomCommandBlockMorph.prototype.mouseEnter=function(){var t,e;this.isTemplate&&this.definition.comment&&(t=this.definition.comment.fullCopy(),t.contents.parse(),e="",t.contents.lines.forEach(function(t){e=e+"\n"+t}),this.bubbleHelp(e.substr(1),this.definition.comment.color))},CustomCommandBlockMorph.prototype.mouseLeave=function(){this.isTemplate&&this.definition.comment&&this.world().hand.destroyTemporaries()},CustomCommandBlockMorph.prototype.bubbleHelp=function(t,e){var o=this;this.fps=2,this.step=function(){this.bounds.containsPoint(this.world().hand.position())&&o.popUpbubbleHelp(t,e),o.fps=0,delete o.step}},CustomCommandBlockMorph.prototype.popUpbubbleHelp=function(t,e){new SpeechBubbleMorph(t,e,null,1).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))},CustomReporterBlockMorph.prototype=new ReporterBlockMorph,CustomReporterBlockMorph.prototype.constructor=CustomReporterBlockMorph,CustomReporterBlockMorph.uber=ReporterBlockMorph.prototype,CustomReporterBlockMorph.prototype.init=function(t,e,o){this.definition=t,this.isPrototype=o||!1,CustomReporterBlockMorph.uber.init.call(this,e),this.category=t.category,this.selector="evaluateCustomBlock",t&&this.refresh()},CustomReporterBlockMorph.prototype.refresh=function(){CustomCommandBlockMorph.prototype.refresh.call(this),this.isPrototype||(this.isPredicate="predicate"===this.definition.type),this.drawNew()},CustomReporterBlockMorph.prototype.mouseClickLeft=function(){return this.isPrototype?void this.edit():CustomReporterBlockMorph.uber.mouseClickLeft.call(this)},CustomReporterBlockMorph.prototype.placeHolder=CustomCommandBlockMorph.prototype.placeHolder,CustomReporterBlockMorph.prototype.parseSpec=CustomCommandBlockMorph.prototype.parseSpec,CustomReporterBlockMorph.prototype.edit=CustomCommandBlockMorph.prototype.edit,CustomReporterBlockMorph.prototype.labelPart=CustomCommandBlockMorph.prototype.labelPart,CustomReporterBlockMorph.prototype.upvarFragmentNames=CustomCommandBlockMorph.prototype.upvarFragmentNames,CustomReporterBlockMorph.prototype.upvarFragmentName=CustomCommandBlockMorph.prototype.upvarFragmentName,CustomReporterBlockMorph.prototype.inputFragmentNames=CustomCommandBlockMorph.prototype.inputFragmentNames,CustomReporterBlockMorph.prototype.specFromFragments=CustomCommandBlockMorph.prototype.specFromFragments,CustomReporterBlockMorph.prototype.blockSpecFromFragments=CustomCommandBlockMorph.prototype.blockSpecFromFragments,CustomReporterBlockMorph.prototype.declarationsFromFragments=CustomCommandBlockMorph.prototype.declarationsFromFragments,CustomReporterBlockMorph.prototype.refreshPrototype=CustomCommandBlockMorph.prototype.refreshPrototype,CustomReporterBlockMorph.prototype.refreshPrototypeSlotTypes=CustomCommandBlockMorph.prototype.refreshPrototypeSlotTypes,CustomReporterBlockMorph.prototype.restoreInputs=CustomCommandBlockMorph.prototype.restoreInputs,CustomReporterBlockMorph.prototype.refreshDefaults=CustomCommandBlockMorph.prototype.refreshDefaults,CustomReporterBlockMorph.prototype.isInUse=CustomCommandBlockMorph.prototype.isInUse,CustomReporterBlockMorph.prototype.userMenu=CustomCommandBlockMorph.prototype.userMenu,CustomReporterBlockMorph.prototype.deleteBlockDefinition=CustomCommandBlockMorph.prototype.deleteBlockDefinition,CustomReporterBlockMorph.prototype.mouseEnter=CustomCommandBlockMorph.prototype.mouseEnter,CustomReporterBlockMorph.prototype.mouseLeave=CustomCommandBlockMorph.prototype.mouseLeave,CustomReporterBlockMorph.prototype.bubbleHelp=CustomCommandBlockMorph.prototype.bubbleHelp,CustomReporterBlockMorph.prototype.popUpbubbleHelp=CustomCommandBlockMorph.prototype.popUpbubbleHelp,JaggedBlockMorph.prototype=new ReporterBlockMorph,JaggedBlockMorph.prototype.constructor=JaggedBlockMorph,JaggedBlockMorph.uber=ReporterBlockMorph.prototype,JaggedBlockMorph.prototype.jag=5,JaggedBlockMorph.prototype.init=function(t){JaggedBlockMorph.uber.init.call(this),t&&this.setSpec(t),"%cs"===t&&(this.minWidth=25,this.fixLayout())},JaggedBlockMorph.prototype.drawNew=function(){var t;this.cachedClr=this.color.toString(),this.cachedClrBright=this.bright(),this.cachedClrDark=this.dark(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),t.fillStyle=this.cachedClr,this.drawBackground(t),MorphicPreferences.isFlat||this.drawEdges(t),this.eraseHoles(t)},JaggedBlockMorph.prototype.drawBackground=function(t){var e,o,i=this.width(),r=this.height(),n=Math.round(r/this.jag),s=r/n;for(t.fillStyle=this.cachedClr,t.beginPath(),t.moveTo(0,0),t.lineTo(i,0),o=0,e=0;n>e;e+=1)o+=s/2,t.lineTo(i-this.jag/2,o),o+=s/2,t.lineTo(i,o);for(t.lineTo(0,r),o=r,e=0;n>e;e+=1)o-=s/2,t.lineTo(this.jag/2,o),o-=s/2,t.lineTo(0,o);t.closePath(),t.fill()},JaggedBlockMorph.prototype.drawEdges=function(t){var e,o,i,r=this.width(),n=this.height(),s=Math.round(n/this.jag),a=n/s,h=this.edge/2;for(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(h,h),t.lineTo(r-h,h),t.stroke(),i=0,o=0;s>o;o+=1)t.strokeStyle=this.cachedClrDark,t.beginPath(),t.moveTo(r-h,i),i+=a/2,t.lineTo(r-this.jag/2-h,i),t.stroke(),i+=a/2;for(e=t.createLinearGradient(0,n-this.edge,0,n),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(r-h,n-h),t.lineTo(h,n-h),t.stroke(),i=n,o=0;s>o;o+=1)t.strokeStyle=this.cachedClrBright,t.beginPath(),t.moveTo(h,i),i-=a/2,t.lineTo(this.jag/2+h,i),t.stroke(),i-=a/2},BlockDialogMorph.prototype=new DialogBoxMorph,BlockDialogMorph.prototype.constructor=BlockDialogMorph,BlockDialogMorph.uber=DialogBoxMorph.prototype,BlockDialogMorph.prototype.init=function(t,e,o){this.blockType="command",this.category="other",this.isGlobal=!0,this.types=null,this.categories=null,BlockDialogMorph.uber.init.call(this,t,e,o),this.key="makeABlock",this.types=new AlignmentMorph("row",this.padding),this.add(this.types),this.scopes=new AlignmentMorph("row",this.padding),this.add(this.scopes),this.categories=new BoxMorph,this.categories.color=SpriteMorph.prototype.paletteColor.lighter(8),this.categories.borderColor=this.categories.color.lighter(40),this.createCategoryButtons(),this.fixCategoriesLayout(),this.add(this.categories),this.createTypeButtons(),this.createScopeButtons(),this.fixLayout()},BlockDialogMorph.prototype.openForChange=function(t,e,o,i,r,n){var s=SpriteMorph.prototype.blockColor[e];this.key="changeABlock",this.category=e,this.blockType=o,this.categories.children.forEach(function(t){t.refresh()}),this.types.children.forEach(function(t){t.setColor(s),t.refresh()}),this.labelString=t,this.createLabel(),r&&this.setPicture(r),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),n&&(this.types.destroy(),this.types=null),this.scopes.destroy(),this.scopes=null,this.fixLayout(),this.drawNew(),this.popUp(i)},BlockDialogMorph.prototype.createCategoryButtons=function(){var t=this,e=Morph.prototype.trackChanges;Morph.prototype.trackChanges=!1,SpriteMorph.prototype.categories.forEach(function(e){t.addCategoryButton(e)}),Morph.prototype.trackChanges=e},BlockDialogMorph.prototype.addCategoryButton=function(t){var e,o=75,i=this,r=[SpriteMorph.prototype.paletteColor,SpriteMorph.prototype.paletteColor.darker(50),SpriteMorph.prototype.blockColor[t]];return e=new ToggleButtonMorph(r,this,function(){i.category=t,i.categories.children.forEach(function(t){t.refresh()}),i.types&&i.types.children.forEach(function(t){t.setColor(r[2])}),i.edit()},t[0].toUpperCase().concat(t.slice(1)),function(){return i.category===t},null,null,null,o,!0),e.corner=8,e.padding=0,e.labelShadowOffset=new Point(-1,-1),e.labelShadowColor=r[1],e.labelColor=IDE_Morph.prototype.buttonLabelColor,e.contrast=this.buttonContrast,e.fixLayout(),e.refresh(),this.categories.add(e),e},BlockDialogMorph.prototype.fixCategoriesLayout=function(){var t,e,o=this.categories.children[0].width(),i=this.categories.children[0].height(),r=15,n=2,s=10,a=Math.ceil(this.categories.children.length/2),h=this.categories.left(),l=this.categories.top(),p=0,c=Morph.prototype.trackChanges;Morph.prototype.trackChanges=!1,this.categories.children.forEach(function(a){p+=1,t=Math.ceil(p/2),e=2-p%2,a.setPosition(new Point(h+(e*r+(e-1)*o),l+(t*n+(t-1)*i+s)))}),MorphicPreferences.isFlat&&(this.categories.corner=0,this.categories.border=0,this.categories.edge=0),this.categories.setExtent(new Point(3*r+2*o,(a+1)*n+a*i+2*s)),Morph.prototype.trackChanges=c,this.categories.changed()},BlockDialogMorph.prototype.createTypeButtons=function(){var t,e=this,o=SpriteMorph.prototype.blockColor[this.category];t=new CommandBlockMorph,t.setColor(o),t.setSpec(localize("Command")),this.addBlockTypeButton(function(){e.setType("command")},t,function(){return"command"===e.blockType}),t=new ReporterBlockMorph,t.setColor(o),t.setSpec(localize("Reporter")),this.addBlockTypeButton(function(){e.setType("reporter")},t,function(){return"reporter"===e.blockType}),t=new ReporterBlockMorph(!0),t.setColor(o),t.setSpec(localize("Predicate")),this.addBlockTypeButton(function(){e.setType("predicate")},t,function(){return"predicate"===e.blockType})},BlockDialogMorph.prototype.addBlockTypeButton=function(t,e,o){var i=new ToggleElementMorph(this,t,e,o,null,null,"rebuild");return i.refresh(),this.types.add(i),i},BlockDialogMorph.prototype.addTypeButton=function(t,e,o){var i=new ToggleMorph("radiobutton",this,t,e,o);return i.edge=this.buttonEdge/2,i.outline=this.buttonOutline/2,i.outlineColor=this.buttonOutlineColor,i.outlineGradient=this.buttonOutlineGradient,i.contrast=this.buttonContrast,i.drawNew(),i.fixLayout(),this.types.add(i),i},BlockDialogMorph.prototype.setType=function(t){this.blockType=t||this.blockType,this.types.children.forEach(function(t){t.refresh()}),this.edit()},BlockDialogMorph.prototype.createScopeButtons=function(){var t=this;this.addScopeButton(function(){t.setScope("gobal")},"for all sprites",function(){return t.isGlobal}),this.addScopeButton(function(){t.setScope("local")},"for this sprite only",function(){return!t.isGlobal})},BlockDialogMorph.prototype.addScopeButton=function(t,e,o){var i=new ToggleMorph("radiobutton",this,t,e,o);return i.edge=this.buttonEdge/2,i.outline=this.buttonOutline/2,i.outlineColor=this.buttonOutlineColor,i.outlineGradient=this.buttonOutlineGradient,i.contrast=this.buttonContrast,i.drawNew(),i.fixLayout(),this.scopes.add(i),i},BlockDialogMorph.prototype.setScope=function(t){this.isGlobal="gobal"===t,this.scopes.children.forEach(function(t){t.refresh()}),this.edit()},BlockDialogMorph.prototype.getInput=function(){var t,e,o;return this.body instanceof InputFieldMorph&&(t=this.normalizeSpaces(this.body.getValue())),e=new CustomBlockDefinition(t),e.type=this.blockType,e.category=this.category,e.isGlobal=this.isGlobal,("reporter"===e.type||"predicate"===e.type)&&(o=Process.prototype.reify.call(null,SpriteMorph.prototype.blockForSelector("doReport"),new List,!0),o.outerContext=null,e.body=o),e},BlockDialogMorph.prototype.fixLayout=function(){var t=fontHeight(this.titleFontSize)+2*this.titlePadding;this.body?(this.body.setPosition(this.position().add(new Point(this.padding,t+this.padding))),this.silentSetWidth(this.body.width()+2*this.padding),this.silentSetHeight(this.body.height()+2*this.padding+t),this.categories&&(this.categories.setCenter(this.body.center()),this.categories.setTop(this.body.top()),this.body.setTop(this.categories.bottom()+this.padding),this.silentSetHeight(this.height()+this.categories.height()+this.padding))):this.head&&(this.types?(this.types.fixLayout(),this.silentSetWidth(Math.max(this.types.width(),this.head.width())+2*this.padding)):this.silentSetWidth(Math.max(this.categories.width(),this.head.width())+2*this.padding),this.head.setCenter(this.center()),this.head.setTop(t+this.padding),this.silentSetHeight(this.head.height()+2*this.padding+t),this.categories&&(this.categories.setCenter(this.center()),this.categories.setTop(this.head.bottom()+this.padding),this.silentSetHeight(this.height()+this.categories.height()+this.padding))),this.label&&(this.label.setCenter(this.center()),this.label.setTop(this.top()+(t-this.label.height())/2)),this.types&&(this.types.fixLayout(),this.silentSetHeight(this.height()+this.types.height()+this.padding),this.silentSetWidth(Math.max(this.width(),this.types.width()+2*this.padding)),this.types.setCenter(this.center()),this.body?this.types.setTop(this.body.bottom()+this.padding):this.categories&&this.types.setTop(this.categories.bottom()+this.padding)),this.scopes&&(this.scopes.fixLayout(),this.silentSetHeight(this.height()+this.scopes.height()+this.padding/3),this.silentSetWidth(Math.max(this.width(),this.scopes.width()+2*this.padding)),this.scopes.setCenter(this.center()),this.types&&this.scopes.setTop(this.types.bottom()+this.padding/3)),this.buttons&&this.buttons.children.length>0&&(this.buttons.fixLayout(),this.silentSetHeight(this.height()+this.buttons.height()+this.padding),this.buttons.setCenter(this.center()),this.buttons.setBottom(this.bottom()-this.padding))},BlockEditorMorph.prototype=new DialogBoxMorph,BlockEditorMorph.prototype.constructor=BlockEditorMorph,BlockEditorMorph.uber=DialogBoxMorph.prototype,BlockEditorMorph.prototype.init=function(t,e){var o,i,r,n,s,a=this;this.definition=t,this.handle=null,BlockEditorMorph.uber.init.call(this,e,function(){a.updateDefinition()},e),this.key="editBlock"+t.spec,this.labelString="Block Editor",this.createLabel(),o=new ScriptsMorph(e),o.isDraggable=!1,o.color=IDE_Morph.prototype.groupColor,o.texture=IDE_Morph.prototype.scriptsPaneTexture,o.cleanUpMargin=10,i=new PrototypeHatBlockMorph(this.definition),i.setPosition(o.position().add(10)),null!==t.comment&&(s=t.comment.fullCopy(),i.comment=s,s.block=i),null!==t.body&&i.nextBlock(t.body.expression.fullCopy()),o.add(i),i.fixBlockColor(null,!0),this.definition.scripts.forEach(function(t){n=t.fullCopy(),n.setPosition(o.position().add(t.position())),o.add(n),n instanceof BlockMorph&&n.allComments().forEach(function(t){t.align(n)})}),i.allComments().forEach(function(t){t.align(i)}),r=new ScrollFrameMorph(o),r.padding=10,r.growth=50,r.isDraggable=!1,r.acceptsDrops=!1,r.contents.acceptsDrops=!0,o.scrollFrame=r,this.addBody(r),this.addButton("ok","OK"),this.addButton("updateDefinition","Apply"),this.addButton("cancel","Cancel"),this.setExtent(new Point(375,300)),this.fixLayout(),i.children[0].fixLayout(),o.fixMultiArgs()},BlockEditorMorph.prototype.popUp=function(){var t=this.target.world();t&&(BlockEditorMorph.uber.popUp.call(this,t),this.handle=new HandleMorph(this,280,220,this.corner,this.corner))},BlockEditorMorph.prototype.accept=function(){this.action&&("function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call()):this.target.call(this.environment,this.action):"function"==typeof this.action?this.action.call(this.target,this.getInput()):this.target[this.action](this.getInput())),this.close()},BlockEditorMorph.prototype.cancel=function(){this.close()},BlockEditorMorph.prototype.close=function(){var t,e,o=this;return this.definition.isGlobal&&(e=detect(this.body.contents.allChildren(),function(t){return t.definition&&!t.definition.isGlobal}))?(e=e.definition.blockInstance(),e.addShadow(),void(new DialogBoxMorph).inform("Local Block(s) in Global Definition","This global block definition contains one or more\nlocal custom blocks which must be removed first.",o.world(),e.fullImage())):(t=this.target.doubleDefinitionsFor(this.definition),t.length>0?(e=t[0].blockInstance(),e.addShadow(),void new DialogBoxMorph(this,"consolidateDoubles",this).askYesNo("Same Named Blocks","Another custom block with this name exists.\nWould you like to replace it?",o.world(),e.fullImage())):void this.destroy())},BlockEditorMorph.prototype.consolidateDoubles=function(){this.target.replaceDoubleDefinitionsFor(this.definition),this.destroy()},BlockEditorMorph.prototype.refreshAllBlockInstances=function(){var t=this.target.paletteBlockInstance(this.definition);this.target.allBlockInstances(this.definition).forEach(function(t){t.refresh()}),t&&t.refreshDefaults()},BlockEditorMorph.prototype.updateDefinition=function(){var t,e,o,i=this.body.contents.position(),r=this;this.definition.receiver=this.target,this.definition.spec=this.prototypeSpec(),this.definition.declarations=this.prototypeSlots(),this.definition.scripts=[],this.body.contents.children.forEach(function(e){e instanceof PrototypeHatBlockMorph?t=e:(e instanceof BlockMorph||e instanceof CommentMorph&&!e.block)&&(o=e.fullCopy(),o.parent=null,o.setPosition(e.position().subtract(i)),r.definition.scripts.push(o))}),t&&(this.definition.category=t.blockCategory,this.definition.type=t.type,t.comment?(this.definition.comment=t.comment.fullCopy(),this.definition.comment.block=!0):this.definition.comment=null),this.definition.body=this.context(t),this.refreshAllBlockInstances(),e=this.target.parentThatIsA(IDE_Morph),e.flushPaletteCache(),e.refreshPalette()},BlockEditorMorph.prototype.context=function(t){var e,o,i;return e=t||detect(this.body.contents.children,function(t){return t instanceof PrototypeHatBlockMorph}),o=e.nextBlock(),null===o?null:(i=Process.prototype.reify.call(null,o,new List(this.definition.inputNames()),!0),i.outerContext=null,i)},BlockEditorMorph.prototype.prototypeSpec=function(){return detect(this.body.contents.children,function(t){return t instanceof PrototypeHatBlockMorph}).parts()[0].specFromFragments()},BlockEditorMorph.prototype.prototypeSlots=function(){return detect(this.body.contents.children,function(t){return t instanceof PrototypeHatBlockMorph}).parts()[0].declarationsFromFragments()},BlockEditorMorph.prototype.fixLayout=function(){var t=fontHeight(this.titleFontSize)+2*this.titlePadding;this.buttons&&this.buttons.children.length>0&&this.buttons.fixLayout(),this.body&&(this.body.setPosition(this.position().add(new Point(this.padding,t+this.padding))),this.body.setExtent(new Point(this.width()-2*this.padding,this.height()-3*this.padding-t-this.buttons.height()))),this.label&&(this.label.setCenter(this.center()),this.label.setTop(this.top()+(t-this.label.height())/2)),this.buttons&&this.buttons.children.length>0&&(this.buttons.setCenter(this.center()),this.buttons.setBottom(this.bottom()-this.padding))},PrototypeHatBlockMorph.prototype=new HatBlockMorph,PrototypeHatBlockMorph.prototype.constructor=PrototypeHatBlockMorph,PrototypeHatBlockMorph.uber=HatBlockMorph.prototype,PrototypeHatBlockMorph.prototype.init=function(t){var e=t.prototypeInstance();this.definition=t,this.blockCategory=t?t.category:null,this.type=t?t.type:null,HatBlockMorph.uber.init.call(this),this.color=SpriteMorph.prototype.blockColor.control,this.category="control",this.add(e),e.refreshPrototypeSlotTypes(),this.fixLayout()},PrototypeHatBlockMorph.prototype.mouseClickLeft=function(){this.children[0].mouseClickLeft()},PrototypeHatBlockMorph.prototype.userMenu=function(){return this.children[0].userMenu()},PrototypeHatBlockMorph.prototype.fixBlockColor=function(t,e){var o=this.children[0]||t;if(this.zebraContrast||e){if(!this.zebraContrast&&e)return this.forceNormalColoring();o.category===this.category?o.color.eq(this.color)&&this.alternateBlockColor():this.category&&!this.color.eq(SpriteMorph.prototype.blockColor[this.category])&&this.alternateBlockColor(),e&&this.fixChildrensBlockColor(!0)}},BlockLabelFragment.prototype.defSpecFragment=function(){var t=this.type?"%'":"";return this.isDeleted?"":t+this.labelString+(this.type?"'":"")},BlockLabelFragment.prototype.defTemplateSpecFragment=function(){var t="";return this.type?(this.isUpvar()?t=" \u2191":this.isMultipleInput()?t="...":"%cs"===this.type?t=" \u03bb":"%b"===this.type?t=" ?":"%l"===this.type?t=" \ufe19":"%obj"===this.type?t=" %turtleOutline":contains(["%cmdRing","%repRing","%predRing","%anyUE","%boolUE"],this.type)?t=" \u03bb":this.defaultValue&&(t=" = "+this.defaultValue.toString()),this.labelString+t):this.defSpecFragment()},BlockLabelFragment.prototype.blockSpecFragment=function(){return this.isDeleted?"":this.type||this.labelString},BlockLabelFragment.prototype.copy=function(){var t=new BlockLabelFragment(this.labelString);return t.type=this.type,t.defaultValue=this.defaultValue,t.options=this.options,t.isReadOnly=this.isReadOnly,t},BlockLabelFragment.prototype.isSingleInput=function(){return!this.isMultipleInput()&&"%upvar"!==this.type},BlockLabelFragment.prototype.isMultipleInput=function(){return this.type?this.type.indexOf("%mult")>-1:!1},BlockLabelFragment.prototype.isUpvar=function(){return this.type?"%upvar"===this.type:!1},BlockLabelFragment.prototype.setToSingleInput=function(){return this.type?void(this.type="%upvar"===this.type?"%s":this.singleInputType()):null},BlockLabelFragment.prototype.setToMultipleInput=function(){return this.type?("%upvar"===this.type&&(this.type="%s"),void(this.type="%mult".concat(this.singleInputType()))):null},BlockLabelFragment.prototype.setToUpvar=function(){return this.type?void(this.type="%upvar"):null},BlockLabelFragment.prototype.singleInputType=function(){return this.type?this.isMultipleInput()?this.type.substr(5):this.type:null},BlockLabelFragment.prototype.setSingleInputType=function(t){this.type=this.type&&this.isMultipleInput()?"%mult".concat(t):t},BlockLabelFragmentMorph.prototype=new StringMorph,BlockLabelFragmentMorph.prototype.constructor=BlockLabelFragmentMorph,BlockLabelFragmentMorph.uber=StringMorph.prototype,BlockLabelFragmentMorph.prototype.init=function(t){this.fragment=new BlockLabelFragment(t),this.fragment.type=null,this.sO=null,BlockLabelFragmentMorph.uber.init.call(this,t,null,SyntaxElementMorph.prototype.labelFontStyle,null,null,null,null,null,null,SyntaxElementMorph.prototype.labelFontName)},BlockLabelFragmentMorph.prototype.mouseEnter=function(){this.sO=this.shadowOffset,this.shadowOffset=this.sO.neg(),this.drawNew(),this.changed()},BlockLabelFragmentMorph.prototype.mouseLeave=function(){this.shadowOffset=this.sO,this.drawNew(),this.changed()},BlockLabelFragmentMorph.prototype.mouseClickLeft=function(){var t=this.fragment.copy(),e=this,o=this instanceof BlockLabelPlaceHolderMorph,i=this.parent.parseSpec(this.parent.blockSpec).length<2;new InputSlotDialogMorph(t,null,function(){e.updateBlockLabel(t)},this,this.parent.definition.category).open(this instanceof BlockLabelFragmentMorph?"Edit label fragment":o?"Create input name":"Edit input name",t.labelString,this.world(),null,o||i)},BlockLabelFragmentMorph.prototype.updateBlockLabel=function(t){var e=this.parentThatIsA(BlockMorph);this.fragment=t,e&&e.refreshPrototype()},BlockLabelFragmentMorph.prototype.userMenu=function(){var t=this,e=new Color(100,100,130),o=new MenuMorph(function(e){var o=t.text.split("-");t.changed(),o[0]="$"+e,t.text=o.join("-"),t.fragment.labelString=t.text,t.drawNew(),t.changed()},null,this,this.fontSize);return SymbolMorph.prototype.names.forEach(function(t){o.addItem([new SymbolMorph(t,o.fontSize,e),t],t)}),o},BlockLabelPlaceHolderMorph.prototype=new StringMorph,BlockLabelPlaceHolderMorph.prototype.constructor=BlockLabelPlaceHolderMorph,BlockLabelPlaceHolderMorph.uber=StringMorph.prototype,BlockLabelPlaceHolderMorph.prototype.plainLabel=!1,BlockLabelPlaceHolderMorph.prototype.init=function(){this.fragment=new BlockLabelFragment(""),this.fragment.type="%s",this.fragment.isDeleted=!0,this.isHighlighted=!1,this.isProtectedLabel=!0,BlockLabelFragmentMorph.uber.init.call(this,"+")},BlockLabelPlaceHolderMorph.prototype.drawNew=function(){var t,e,o,i,r,n;this.plainLabel&&(this.text=this.isHighlighted?" + ":""),this.image=newCanvas(),t=this.image.getContext("2d"),t.font=this.font(),e=Math.max(t.measureText(this.text).width+Math.abs(this.shadowOffset.x),1),this.bounds.corner=this.bounds.origin.add(new Point(e,fontHeight(this.fontSize)+Math.abs(this.shadowOffset.y))),this.image.width=e,this.image.height=this.height(),this.isHighlighted&&(r=Math.floor(e/2),n=Math.floor(this.height()/2),t.fillStyle=this.color.toString(),t.beginPath(),t.arc(r,1.2*n,Math.min(r,n),radians(0),radians(360),!1),t.closePath(),t.fill()),t.font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.shadowColor&&(o=Math.max(this.shadowOffset.x,0),i=Math.max(this.shadowOffset.y,0),t.fillStyle=this.shadowColor.toString(),t.fillText(this.text,o,fontHeight(this.fontSize)+i)),o=Math.abs(Math.min(this.shadowOffset.x,0)),i=Math.abs(Math.min(this.shadowOffset.y,0)),t.fillStyle=this.isHighlighted?"white":this.color.toString(),t.fillText(this.text,o,fontHeight(this.fontSize)+i),this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},BlockLabelPlaceHolderMorph.prototype.mouseEnter=function(){this.isHighlighted=!0,this.drawNew(),this.changed()},BlockLabelPlaceHolderMorph.prototype.mouseLeave=function(){this.isHighlighted=!1,this.drawNew(),this.changed()},BlockLabelPlaceHolderMorph.prototype.mouseClickLeft=BlockLabelFragmentMorph.prototype.mouseClickLeft,BlockLabelPlaceHolderMorph.prototype.updateBlockLabel=BlockLabelFragmentMorph.prototype.updateBlockLabel,BlockInputFragmentMorph.prototype=new TemplateSlotMorph,BlockInputFragmentMorph.prototype.constructor=BlockInputFragmentMorph,BlockInputFragmentMorph.uber=TemplateSlotMorph.prototype,BlockInputFragmentMorph.prototype.init=function(t){this.fragment=new BlockLabelFragment(t),this.fragment.type="%s",BlockInputFragmentMorph.uber.init.call(this,t)},BlockInputFragmentMorph.prototype.mouseClickLeft=BlockLabelFragmentMorph.prototype.mouseClickLeft,BlockInputFragmentMorph.prototype.updateBlockLabel=BlockLabelFragmentMorph.prototype.updateBlockLabel,InputSlotDialogMorph.prototype=new DialogBoxMorph,InputSlotDialogMorph.prototype.constructor=InputSlotDialogMorph,InputSlotDialogMorph.uber=DialogBoxMorph.prototype,InputSlotDialogMorph.prototype.isLaunchingExpanded=!1,InputSlotDialogMorph.prototype.init=function(t,e,o,i,r){var n=SyntaxElementMorph.prototype.scale,s=fontHeight(10)/1.2*n;
this.fragment=t||new BlockLabelFragment,this.textfield=null,this.types=null,this.slots=null,this.isExpanded=!1,this.category=r||"other",this.cachedRadioButton=null,BlockDialogMorph.uber.init.call(this,e,o,i),this.types=new AlignmentMorph("row",this.padding),this.types.respectHiddens=!0,this.add(this.types),this.slots=new BoxMorph,this.slots.color=new Color(55,55,55),this.slots.borderColor=this.slots.color.lighter(50),this.slots.setExtent(new Point(24*(s+10),10.4*(s+10*n))),this.add(this.slots),this.createSlotTypeButtons(),this.fixSlotsLayout(),this.addSlotsMenu(),this.createTypeButtons(),this.fixLayout()},InputSlotDialogMorph.prototype.createTypeButtons=function(){var t,e,o=this,i=SpriteMorph.prototype.blockColor[this.category];t=new JaggedBlockMorph(localize("Title text")),t.setColor(i),this.addBlockTypeButton(function(){o.setType(null)},t,function(){return null===o.fragment.type}),t=new JaggedBlockMorph("%inputName"),t.setColor(i),this.addBlockTypeButton(function(){o.setType("%s")},t,function(){return null!==o.fragment.type}),e=new ArrowMorph("right",PushButtonMorph.prototype.fontSize+4,2),e.noticesTransparentClick=!0,this.types.add(e),this.types.fixLayout(),e.refresh=function(){null===o.fragment.type?(o.isExpanded=!1,e.hide(),o.drawNew()):(e.show(),e.direction=o.isExpanded?"down":"right",e.drawNew(),e.changed())},e.mouseClickLeft=function(){e.isVisible&&(o.isExpanded=!o.isExpanded,o.types.children.forEach(function(t){t.refresh()}),o.drawNew(),o.edit())},e.refresh()},InputSlotDialogMorph.prototype.addTypeButton=BlockDialogMorph.prototype.addTypeButton,InputSlotDialogMorph.prototype.addBlockTypeButton=BlockDialogMorph.prototype.addBlockTypeButton,InputSlotDialogMorph.prototype.setType=function(t){this.textfield.choices=t?null:this.symbolMenu,this.textfield.drawNew(),this.fragment.type=t||null,this.types.children.forEach(function(t){t.refresh()}),this.slots.children.forEach(function(t){t.refresh()}),this.edit()},InputSlotDialogMorph.prototype.getInput=function(){var t;return this.body instanceof InputFieldMorph&&(t=this.normalizeSpaces(this.body.getValue())),t?(this.fragment.labelString=t,this.fragment.defaultValue=this.slots.defaultInputField.getValue(),t):(this.fragment.isDeleted=!0,null)},InputSlotDialogMorph.prototype.fixLayout=function(){var t,e=this.left(),o=fontHeight(this.titleFontSize)+2*this.titlePadding;return this.isExpanded?(this.slots.show(),t=this.slots.width(),this.body.setPosition(this.position().add(new Point(this.padding+(t-this.body.width())/2,o+this.padding))),this.label.setLeft(e+this.padding+(t-this.label.width())/2),this.label.setTop(this.top()+(o-this.label.height())/2),this.types.fixLayout(),this.types.setTop(this.body.bottom()+this.padding),this.types.setLeft(e+this.padding+(t-this.types.width())/2),this.slots.setPosition(new Point(this.left()+this.padding,this.types.bottom()+this.padding)),this.slots.children.forEach(function(t){t.refresh()}),this.buttons.fixLayout(),this.buttons.setTop(this.slots.bottom()+this.padding),this.buttons.setLeft(e+this.padding+(t-this.buttons.width())/2),this.silentSetHeight(this.buttons.bottom()-this.top()+this.padding),void this.silentSetWidth(this.slots.right()-this.left()+this.padding)):(this.slots&&this.slots.hide(),BlockDialogMorph.prototype.fixLayout.call(this))},InputSlotDialogMorph.prototype.open=function(t,e,o,i,r){var n=new InputFieldMorph(e),s=Morph.prototype.trackChanges;this.fragment.type||(n.choices=this.symbolMenu),Morph.prototype.trackChanges=!1,this.isExpanded=this.isLaunchingExpanded,n.setWidth(250),this.labelString=t,this.createLabel(),i&&this.setPicture(i),this.addBody(n),n.drawNew(),this.textfield=n,this.addButton("ok","OK"),r||this.addButton("deleteFragment","Delete"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.popUp(o),this.add(this.types),Morph.prototype.trackChanges=s,this.changed()},InputSlotDialogMorph.prototype.symbolMenu=function(){var t=[],e=new Color(100,100,130),o=this;return SymbolMorph.prototype.names.forEach(function(i){t.push([[new SymbolMorph(i,o.fontSize,e),i],"$"+i])}),t},InputSlotDialogMorph.prototype.deleteFragment=function(){this.fragment.isDeleted=!0,this.accept()},InputSlotDialogMorph.prototype.createSlotTypeButtons=function(){var t,e,o=this,i=Morph.prototype.trackChanges;Morph.prototype.trackChanges=!1,this.addSlotTypeButton("Object","%obj"),this.addSlotTypeButton("Text","%txt"),this.addSlotTypeButton("List","%l"),this.addSlotTypeButton("Number","%n"),this.addSlotTypeButton("Any type","%s"),this.addSlotTypeButton("Boolean (T/F)","%b"),this.addSlotTypeButton("Command\n(inline)","%cmdRing"),this.addSlotTypeButton("Reporter","%repRing"),this.addSlotTypeButton("Predicate","%predRing"),this.addSlotTypeButton("Command\n(C-shape)","%cs"),this.addSlotTypeButton("Any\n(unevaluated)","%anyUE"),this.addSlotTypeButton("Boolean\n(unevaluated)","%boolUE"),this.slots.radioButtonSingle=this.addSlotArityButton(function(){o.setSlotArity("single")},"Single input.",function(){return o.fragment.isSingleInput()}),this.addSlotArityButton(function(){o.setSlotArity("multiple")},"Multiple inputs (value is list of inputs)",function(){return o.fragment.isMultipleInput()}),this.addSlotArityButton(function(){o.setSlotArity("upvar")},"Upvar - make internal variable visible to caller",function(){return o.fragment.isUpvar()}),t=new StringMorph(localize("Default Value:")),t.fontSize=this.slots.radioButtonSingle.fontSize,t.setColor(new Color(255,255,255)),t.refresh=function(){o.isExpanded&&contains(["%s","%n","%txt","%anyUE"],o.fragment.type)?t.show():t.hide()},this.slots.defaultInputLabel=t,this.slots.add(t),e=new InputFieldMorph(this.fragment.defaultValue),e.contents().fontSize=t.fontSize,e.contrast=90,e.contents().drawNew(),e.setWidth(50),e.refresh=function(){t.isVisible?(e.show(),e.setIsNumeric("%n"===o.fragment.type?!0:!1)):e.hide()},this.slots.defaultInputField=e,this.slots.add(e),e.drawNew(),Morph.prototype.trackChanges=i},InputSlotDialogMorph.prototype.setSlotType=function(t){this.fragment.setSingleInputType(t),this.slots.children.forEach(function(t){t.refresh()}),this.edit()},InputSlotDialogMorph.prototype.setSlotArity=function(t){"single"===t?this.fragment.setToSingleInput():"multiple"===t?this.fragment.setToMultipleInput():"upvar"===t&&this.fragment.setToUpvar(),this.slots.children.forEach(function(t){t.refresh()}),this.edit()},InputSlotDialogMorph.prototype.addSlotTypeButton=function(t,e){var o,i,r=this,n=function(){r.setSlotType(e)},s=new JaggedBlockMorph(e);return o=function(){return r.fragment.singleInputType()===e},s.setCategory(this.category),s.rebuild(),i=new ToggleMorph("radiobutton",this,n,t,o,null,null,this.cachedRadioButton,s.fullImage(),"rebuild"),i.edge=this.buttonEdge/2,i.outline=this.buttonOutline/2,i.outlineColor=this.buttonOutlineColor,i.outlineGradient=this.buttonOutlineGradient,i.drawNew(),i.fixLayout(),i.label.isBold=!1,i.label.setColor(new Color(255,255,255)),this.cachedRadioButton||(this.cachedRadioButton=i),this.slots.add(i),i},InputSlotDialogMorph.prototype.addSlotArityButton=function(t,e,o){var i=new ToggleMorph("radiobutton",this,t,e,o,null,null,this.cachedRadioButton);return i.edge=this.buttonEdge/2,i.outline=this.buttonOutline/2,i.outlineColor=this.buttonOutlineColor,i.outlineGradient=this.buttonOutlineGradient,i.drawNew(),i.fixLayout(),i.label.setColor(new Color(255,255,255)),this.slots.add(i),this.cachedRadioButton||(this.cachedRadioButton=i),i},InputSlotDialogMorph.prototype.fixSlotsLayout=function(){var t,e,o=this.slots,i=SyntaxElementMorph.prototype.scale,r=10*i,n=14*i,s=(fontHeight(10)/1.2+15)*i,a=(fontHeight(10)/1.2+10)*i,h=12,l=[o.left()+r,o.left()+o.width()/3,o.left()+2*o.width()/3],p=[o.top()+n,o.top()+n+s,o.top()+n+2*s,o.top()+n+3*s,o.top()+n+4*s,o.top()+n+5*s,o.top()+n+5*s+a,o.top()+n+5*s+2*a],c=-1,d=Morph.prototype.trackChanges;for(Morph.prototype.trackChanges=!1,t=0;h>t;t+=1)e=t%3,t%3===0&&(c+=1),o.children[t].setPosition(new Point(l[e],p[c]));for(e=0,c=5,t=h;h+3>t;t+=1)o.children[t].setPosition(new Point(l[e],p[c+t-h]));this.slots.defaultInputLabel.setPosition(this.slots.radioButtonSingle.label.topRight().add(new Point(5,0))),this.slots.defaultInputField.setCenter(this.slots.defaultInputLabel.center().add(new Point(this.slots.defaultInputField.width()/2+this.slots.defaultInputLabel.width()/2+5,0))),Morph.prototype.trackChanges=d,this.slots.changed()},InputSlotDialogMorph.prototype.addSlotsMenu=function(){var t=this;this.slots.userMenu=function(){if(contains(["%s","%n","%txt","%anyUE"],t.fragment.type)){var e=new MenuMorph(t),o="\u2611 ",i="\u2610 ";return e.addItem("options...","editSlotOptions"),e.addItem((t.fragment.isReadOnly?o:i)+localize("read-only"),function(){t.fragment.isReadOnly=!t.fragment.isReadOnly}),e}return Morph.prototype.userMenu.call(t)}},InputSlotDialogMorph.prototype.editSlotOptions=function(){var t=this;new DialogBoxMorph(t,function(e){t.fragment.options=e},t).promptCode("Input Slot Options",t.fragment.options,t.world(),null,localize('Enter one option per line.Optionally use "=" as key/value delimiter\ne.g.\n   the answer=42'))},InputSlotDialogMorph.prototype.hide=function(){this.isVisible=!1,this.changed()},InputSlotDialogMorph.prototype.show=function(){this.isVisible=!0,this.changed()},VariableDialogMorph.prototype=new DialogBoxMorph,VariableDialogMorph.prototype.constructor=VariableDialogMorph,VariableDialogMorph.uber=DialogBoxMorph.prototype,VariableDialogMorph.prototype.init=function(t,e,o){this.types=null,this.isGlobal=!0,BlockDialogMorph.uber.init.call(this,t,e,o),this.types=new AlignmentMorph("row",this.padding),this.add(this.types),this.createTypeButtons()},VariableDialogMorph.prototype.createTypeButtons=function(){var t=this;this.addTypeButton(function(){t.setType("gobal")},"for all sprites",function(){return t.isGlobal}),this.addTypeButton(function(){t.setType("local")},"for this sprite only",function(){return!t.isGlobal})},VariableDialogMorph.prototype.addTypeButton=BlockDialogMorph.prototype.addTypeButton,VariableDialogMorph.prototype.setType=function(t){this.isGlobal="gobal"===t,this.types.children.forEach(function(t){t.refresh()}),this.edit()},VariableDialogMorph.prototype.getInput=function(){var t=this.normalizeSpaces(this.body.getValue());return t?[t,this.isGlobal]:null},VariableDialogMorph.prototype.fixLayout=function(){var t=fontHeight(this.titleFontSize)+2*this.titlePadding;this.body&&(this.body.setPosition(this.position().add(new Point(this.padding,t+this.padding))),this.silentSetWidth(this.body.width()+2*this.padding),this.silentSetHeight(this.body.height()+2*this.padding+t)),this.label&&(this.label.setCenter(this.center()),this.label.setTop(this.top()+(t-this.label.height())/2)),this.types&&(this.types.fixLayout(),this.silentSetHeight(this.height()+this.types.height()+this.padding),this.silentSetWidth(Math.max(this.width(),this.types.width()+2*this.padding)),this.types.setCenter(this.center()),this.body?this.types.setTop(this.body.bottom()+this.padding):this.categories&&this.types.setTop(this.categories.bottom()+this.padding)),this.buttons&&this.buttons.children.length>0&&(this.buttons.fixLayout(),this.silentSetHeight(this.height()+this.buttons.height()+this.padding),this.buttons.setCenter(this.center()),this.buttons.setBottom(this.bottom()-this.padding))},BlockExportDialogMorph.prototype=new DialogBoxMorph,BlockExportDialogMorph.prototype.constructor=BlockExportDialogMorph,BlockExportDialogMorph.uber=DialogBoxMorph.prototype,BlockExportDialogMorph.prototype.key="blockExport",BlockExportDialogMorph.prototype.init=function(t,e){var o=this;this.serializer=t,this.blocks=e.slice(0),this.handle=null,BlockExportDialogMorph.uber.init.call(this,null,function(){o.exportBlocks()},null),this.labelString="Export blocks",this.createLabel(),this.buildContents()},BlockExportDialogMorph.prototype.buildContents=function(){var t,e,o,i,r,n,s=this,a=4;t=new ScrollFrameMorph(null,null,SpriteMorph.prototype.sliderColor),t.color=SpriteMorph.prototype.paletteColor,t.padding=a,t.isDraggable=!1,t.acceptsDrops=!1,t.contents.acceptsDrops=!1,e=t.left()+a,o=t.top()+a,SpriteMorph.prototype.categories.forEach(function(h){s.blocks.forEach(function(l){l.category===h&&(n&&h!==n&&(o+=a),n=h,i=l.templateInstance(),r=new ToggleMorph("checkbox",s,function(){var t=s.blocks.indexOf(l);t>-1?s.blocks.splice(t,1):s.blocks.push(l)},null,function(){return contains(s.blocks,l)},null,null,null,i.fullImage()),r.setPosition(new Point(e,o+(r.top()-r.toggleElement.top()))),t.addContents(r),o+=r.fullBounds().height()+a)})}),t.scrollX(a),t.scrollY(a),this.addBody(t),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.setExtent(new Point(220,300)),this.fixLayout()},BlockExportDialogMorph.prototype.popUp=function(t){var e=t||this.target.world();e&&(BlockExportDialogMorph.uber.popUp.call(this,e),this.handle=new HandleMorph(this,200,220,this.corner,this.corner))},BlockExportDialogMorph.prototype.userMenu=function(){var t=new MenuMorph(this,"select");return t.addItem("all","selectAll"),t.addItem("none","selectNone"),t},BlockExportDialogMorph.prototype.selectAll=function(){this.body.contents.children.forEach(function(t){t.state||t.trigger()})},BlockExportDialogMorph.prototype.selectNone=function(){this.blocks=[],this.body.contents.children.forEach(function(t){t.refresh()})},BlockExportDialogMorph.prototype.exportBlocks=function(){var t=this.serializer.serialize(this.blocks);this.blocks.length>0?window.open(encodeURI('data:text/xml,<blocks app="'+this.serializer.app+'" version="'+this.serializer.version+'">'+t+"</blocks>")):(new DialogBoxMorph).inform("Export blocks","no blocks were selected",this.world())},BlockExportDialogMorph.prototype.fixLayout=BlockEditorMorph.prototype.fixLayout,BlockImportDialogMorph.prototype=new DialogBoxMorph,BlockImportDialogMorph.prototype.constructor=BlockImportDialogMorph,BlockImportDialogMorph.uber=DialogBoxMorph.prototype,BlockImportDialogMorph.prototype.key="blockImport",BlockImportDialogMorph.prototype.init=function(t,e,o){var i=this;this.blocks=t.slice(0),this.handle=null,BlockExportDialogMorph.uber.init.call(this,e,function(){i.importBlocks(o)},null),this.labelString=localize("Import blocks")+(o?": ":"")+o||"",this.createLabel(),this.buildContents()},BlockImportDialogMorph.prototype.buildContents=BlockExportDialogMorph.prototype.buildContents,BlockImportDialogMorph.prototype.popUp=BlockExportDialogMorph.prototype.popUp,BlockImportDialogMorph.prototype.userMenu=BlockExportDialogMorph.prototype.userMenu,BlockImportDialogMorph.prototype.selectAll=BlockExportDialogMorph.prototype.selectAll,BlockImportDialogMorph.prototype.selectNone=BlockExportDialogMorph.prototype.selectNone,BlockImportDialogMorph.prototype.importBlocks=function(t){var e=this.target.parentThatIsA(IDE_Morph);e&&(this.blocks.length>0?(this.blocks.forEach(function(t){t.receiver=e.stage,e.stage.globalBlocks.push(t),e.stage.replaceDoubleDefinitionsFor(t)}),e.flushPaletteCache(),e.refreshPalette(),e.showMessage("Imported Blocks Module"+(t?": "+t:"")+".",2)):(new DialogBoxMorph).inform("Import blocks","no blocks were selected",this.world()))},BlockImportDialogMorph.prototype.fixLayout=BlockEditorMorph.prototype.fixLayout,modules.xml="2014-January-09";var ReadStream,XML_Element;ReadStream.prototype.space=/[\s]/,ReadStream.prototype.next=function(t){var e,o;return void 0===t?(e=this.contents[this.index],this.index+=1,e):(o=this.index,this.index+=t,this.contents.slice(o,this.index))},ReadStream.prototype.peek=function(){return this.contents[this.index]},ReadStream.prototype.skip=function(t){this.index+=t||1},ReadStream.prototype.atEnd=function(){return this.index>this.contents.length-1},ReadStream.prototype.upTo=function(t){var e,o;return isString(this.contents)?(e=this.contents.substr(this.index).search(t),-1===e?"":(o=this.index,this.index+=e,this.contents.substring(o,this.index))):""},ReadStream.prototype.peekUpTo=function(t){if(!isString(this.contents))return"";var e=this.contents.substr(this.index).search(t);return-1===e?"":this.contents.substring(this.index,this.index+e)},ReadStream.prototype.skipSpace=function(){if(!isString(this.contents))return"";for(var t=this.peek();this.space.test(t)&&""!==t;)this.skip(),t=this.peek()},ReadStream.prototype.word=function(){var t,e;return isString(this.contents)?(t=this.contents.substr(this.index).search(/[\s\>\/\=]|$/),-1===t?"":(e=this.index,this.index+=t,this.contents.substring(e,this.index))):""},XML_Element.prototype=new Node,XML_Element.prototype.constructor=XML_Element,XML_Element.uber=Node.prototype,XML_Element.prototype.indentation="  ",XML_Element.prototype.init=function(t,e,o){this.tag=t||"unnamed",this.attributes={},this.contents=e||"",XML_Element.uber.init.call(this),o instanceof XML_Element&&o.addChild(this)},XML_Element.prototype.require=function(t){var e=this.childNamed(t);if(!e)throw new Error("Missing required element <"+t+">!");return e},XML_Element.prototype.childNamed=function(t){return detect(this.children,function(e){return e.tag===t})},XML_Element.prototype.childrenNamed=function(t){return this.children.filter(function(e){return e.tag===t})},XML_Element.prototype.parentNamed=function(t){return this.tag===t?this:this.parent?this.parent.parentNamed(t):null},XML_Element.prototype.toString=function(t,e){var o,i,r="",n="",s=e||0;if(t){for(i=0;s>i;i+=1)n+=this.indentation;r+=n}r+="<"+this.tag;for(o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&this.attributes[o]&&(r+=" "+o+'="'+this.attributes[o]+'"');return this.contents.length||this.children.length?(r+=">",r+=this.contents,this.children.forEach(function(e){t&&(r+="\n"),r+=e.toString(t,s+1)}),t&&this.children.length&&(r+="\n"+n),r+="</"+this.tag+">"):r+="/>",r},XML_Element.prototype.escape=function(t,e){var o,i,r=isNil(t)?"":t.toString(),n="";for(o=0;o<r.length;o+=1)switch(i=r[o]){case"'":n+="&apos;";break;case'"':n+=e?i:"&quot;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;case"&":n+="&amp;";break;case"\n":n+="&#xD;";break;case"~":n+="&#126;";break;default:n+=i}return n},XML_Element.prototype.unescape=function(t){function e(t){n+=t,r.upTo(";"),r.skip()}for(var o,i,r=new ReadStream(t),n="";!r.atEnd();)if(o=r.next(),"&"===o)switch(i=r.peekUpTo(";")){case"apos":e("'");break;case"quot":e('"');break;case"lt":e("<");break;case"gt":e(">");break;case"amp":e("&");break;case"#xD":e("\n");break;case"#126":e("~");break;default:n+=o}else n+=o;return n},XML_Element.prototype.parseString=function(t){var e=new ReadStream(t);e.upTo("<"),e.skip(),this.parseStream(e)},XML_Element.prototype.parseStream=function(t){var e,o,i,r;for(this.tag=t.word(),t.skipSpace(),i=t.peek();">"!==i&&"/"!==i;){if(e=t.word(),t.skipSpace(),"="!==t.next())throw new Error('Expected "=" after attribute name');if(t.skipSpace(),i=t.next(),'"'!==i&&"'"!==i)throw new Error("Expected single- or double-quoted attribute value");o=t.upTo(i),t.skip(1),t.skipSpace(),this.attributes[e]=this.unescape(o),i=t.peek()}if("/"!==t.peek()){if(">"!==t.next())throw new Error('Expected ">" after tag name and attributes');for(;!t.atEnd();)if(i=t.next(),"<"===i){if("/"===t.peek()){if(t.skip(),t.word()!==this.tag)throw new Error("Expected to close "+this.tag);return t.upTo(">"),t.skip(),void(this.contents=this.unescape(this.contents))}r=new XML_Element(null,null,this),r.parseStream(t)}else this.contents+=i}else if(t.skip(),">"!==t.next())throw new Error('Expected ">" after "/" in empty tag')},modules.store="2014-February-13",XML_Serializer.prototype.idProperty="serializationID",XML_Serializer.prototype.mediaIdProperty="serializationMediaID",XML_Serializer.prototype.mediaDetectionProperty="isMedia",XML_Serializer.prototype.version=1,XML_Serializer.prototype.serialize=function(t){var e;return this.flush(),this.flushMedia(),e=this.store(t),this.flush(),e},XML_Serializer.prototype.store=function(t,e){return isNil(t)||!t.toXML?"":this.isCollectingMedia&&t[this.mediaDetectionProperty]?(this.addMedia(t,e),this.format('<ref mediaID="@"></ref>',t[this.mediaIdProperty])):t[this.idProperty]?this.format('<ref id="@"></ref>',t[this.idProperty]):(this.add(t),t.toXML(this,e).replace("~",this.format('id="@"',t[this.idProperty])))},XML_Serializer.prototype.mediaXML=function(){var t="<media>",e=this;return this.media.forEach(function(o){var i=o.toXML(e).replace("~",e.format('mediaID="@"',o[e.mediaIdProperty]));t+=i}),t+"</media>"},XML_Serializer.prototype.add=function(t){return t[this.idProperty]?-1:(this.contents.push(t),t[this.idProperty]=this.contents.length,this.contents.length)},XML_Serializer.prototype.addMedia=function(t,e){return t[this.mediaIdProperty]?-1:(this.media.push(t),t[this.mediaIdProperty]=e?e+"_"+t.name:this.media.length,this.media.length)},XML_Serializer.prototype.at=function(t){return this.contents[t-1]},XML_Serializer.prototype.flush=function(){var t=this;this.contents.forEach(function(e){delete e[t.idProperty]}),this.contents=[]},XML_Serializer.prototype.flushMedia=function(){var t=this;this.media instanceof Array&&this.media.forEach(function(e){delete e[t.mediaIdProperty]}),this.media=[]},XML_Serializer.prototype.escape=XML_Element.prototype.escape,XML_Serializer.prototype.unescape=XML_Element.prototype.unescape,XML_Serializer.prototype.format=function(t){var e,o=this,i=-1,r=arguments;return t.replace(/[@$%]([\d]+)?/g,function(t,n){return n=parseInt(n,10),isNaN(n)?(i+=1,e=r[i+1]):e=r[n+1],"@"===t?o.escape(e):"$"===t?o.escape(e,!0):e})},XML_Serializer.prototype.load=function(t){throw nop(t),new Error("loading should be implemented in heir of XML_Serializer")},XML_Serializer.prototype.parse=function(t){var e=new XML_Element;return e.parseString(t),e};var SnapSerializer;SnapSerializer.prototype=new XML_Serializer,SnapSerializer.prototype.constructor=SnapSerializer,SnapSerializer.uber=XML_Serializer.prototype,SnapSerializer.prototype.app="Snap! 4.0, http://snap.berkeley.edu",SnapSerializer.prototype.thumbnailSize=new Point(160,120),SnapSerializer.prototype.watcherLabels={xPosition:"x position",yPosition:"y position",direction:"direction",getScale:"size",getLastAnswer:"answer",getTimer:"timer",getCostumeIdx:"costume #",reportMouseX:"mouse x",reportMouseY:"mouse y"},SnapSerializer.prototype.init=function(){this.project={},this.objects={},this.mediaDict={}},XML_Serializer.prototype.mediaXML=function(t){var e='<media name="'+(t||"untitled")+'" app="'+this.app+'" version="'+this.version+'">',o=this;return this.media.forEach(function(t){var i=t.toXML(o).replace("~",o.format('mediaID="@"',t[o.mediaIdProperty]));e+=i}),e+"</media>"},SnapSerializer.prototype.load=function(t){return this.loadProjectModel(this.parse(t))},SnapSerializer.prototype.loadProjectModel=function(t){var e,o,i=this,r={sprites:{}};if(this.project=r,e={project:t},+t.attributes.version>this.version)throw"Project uses newer version of Serializer";if(this.objects={},r.name=e.project.attributes.name,!r.name){for(o=1;Object.prototype.hasOwnProperty.call(localStorage,"-snap-project-Untitled "+o);)o+=1;r.name="Untitled "+o}return e.notes=e.project.childNamed("notes"),e.notes&&(r.notes=e.notes.contents),e.globalVariables=e.project.childNamed("variables"),r.globalVariables=new VariableFrame,e.stage=e.project.require("stage"),StageMorph.prototype.frameRate=0,r.stage=new StageMorph(r.globalVariables),Object.prototype.hasOwnProperty.call(e.stage.attributes,"id")&&(this.objects[e.stage.attributes.id]=r.stage),e.stage.attributes.name&&(r.stage.name=e.stage.attributes.name),"true"===e.stage.attributes.scheduled&&(r.stage.fps=30,StageMorph.prototype.frameRate=30),e.pentrails=e.stage.childNamed("pentrails"),e.pentrails&&(r.pentrails=new Image,r.pentrails.onload=function(){var t=r.stage.trailsCanvas.getContext("2d");t.drawImage(r.pentrails,0,0),r.stage.changed()},r.pentrails.src=e.pentrails.contents),r.stage.setTempo(e.stage.attributes.tempo),StageMorph.prototype.dimensions=new Point(480,360),e.stage.attributes.width&&(StageMorph.prototype.dimensions.x=Math.max(+e.stage.attributes.width,480)),e.stage.attributes.height&&(StageMorph.prototype.dimensions.y=Math.max(+e.stage.attributes.height,180)),r.stage.setExtent(StageMorph.prototype.dimensions),SpriteMorph.prototype.useFlatLineEnds="flat"===e.stage.attributes.lines,r.stage.isThreadSafe="true"===e.stage.attributes.threadsafe,StageMorph.prototype.enableCodeMapping="true"===e.stage.attributes.codify,e.hiddenPrimitives=e.project.childNamed("hidden"),e.hiddenPrimitives&&e.hiddenPrimitives.contents.split(" ").forEach(function(t){t&&(StageMorph.prototype.hiddenPrimitives[t]=!0)}),e.codeHeaders=e.project.childNamed("headers"),e.codeHeaders&&e.codeHeaders.children.forEach(function(t){StageMorph.prototype.codeHeaders[t.tag]=t.contents}),e.codeMappings=e.project.childNamed("code"),e.codeMappings&&e.codeMappings.children.forEach(function(t){StageMorph.prototype.codeMappings[t.tag]=t.contents}),e.globalBlocks=e.project.childNamed("blocks"),e.globalBlocks&&(this.loadCustomBlocks(r.stage,e.globalBlocks,!0),this.populateCustomBlocks(r.stage,e.globalBlocks,!0)),this.loadObject(r.stage,e.stage),e.sprites=e.stage.require("sprites"),r.sprites[r.stage.name]=r.stage,e.sprites.childrenNamed("sprite").forEach(function(t){i.loadValue(t)}),i.project.stage.children.forEach(function(t){var e;t.nestingInfo&&(e=i.project.sprites[t.nestingInfo.anchor],e&&e.attachPart(t),t.rotatesWithAnchor="true"===t.nestingInfo.synch)}),i.project.stage.children.forEach(function(t){t.nestingInfo&&(t.nestingScale=+(t.nestingInfo.scale||t.scale),delete t.nestingInfo)}),this.objects={},e.globalVariables&&this.loadVariables(r.globalVariables,e.globalVariables),e.sprites.childrenNamed("watcher").forEach(function(t){var e,o,n,s,a,h;o=i.loadColor(t.attributes.color),n=Object.prototype.hasOwnProperty.call(t.attributes,"scope")?r.sprites[t.attributes.scope]:null,s=Object.prototype.hasOwnProperty.call(t.attributes,"hidden")&&"false"!==t.attributes.hidden,e=Object.prototype.hasOwnProperty.call(t.attributes,"var")?new WatcherMorph(t.attributes["var"],o,isNil(n)?r.globalVariables:n.variables,t.attributes["var"],s):new WatcherMorph(localize(i.watcherLabels[t.attributes.s]),o,n,t.attributes.s,s),e.setStyle(t.attributes.style||"normal"),"slider"===e.style&&(e.setSliderMin(t.attributes.min||"1"),e.setSliderMax(t.attributes.max||"100")),e.setPosition(r.stage.topLeft().add(new Point(+t.attributes.x||0,+t.attributes.y||0))),r.stage.add(e),e.update(),e.currentValue instanceof List&&(a=t.attributes.extX,a&&e.cellMorph.contentsMorph.setWidth(+a),h=t.attributes.extY,h&&e.cellMorph.contentsMorph.setHeight(+h),e.cellMorph.contentsMorph.handle.drawNew())}),this.objects={},r},SnapSerializer.prototype.loadBlocks=function(t,e){var o,i=new StageMorph;if(this.project={stage:i,sprites:{},targetStage:e},o=this.parse(t),+o.attributes.version>this.version)throw"Module uses newer version of Serializer";return this.loadCustomBlocks(i,o,!0),this.populateCustomBlocks(i,o,!0),this.objects={},i.globalBlocks.forEach(function(t){t.receiver=null}),this.objects={},this.project={},this.mediaDict={},i.globalBlocks},SnapSerializer.prototype.loadSprites=function(t,e){var o,i,r=this;if(i=this.project={globalVariables:e.globalVariables,stage:e.stage,sprites:{}},i.sprites[i.stage.name]=i.stage,o=this.parse(t),+o.attributes.version>this.version)throw"Module uses newer version of Serializer";o.childrenNamed("sprite").forEach(function(t){var o=new SpriteMorph(i.globalVariables);t.attributes.id&&(r.objects[t.attributes.id]=o),t.attributes.name&&(o.name=t.attributes.name,i.sprites[t.attributes.name]=o),t.attributes.color&&(o.color=r.loadColor(t.attributes.color)),t.attributes.pen&&(o.penPoint=t.attributes.pen),i.stage.add(o),e.sprites.add(o),o.scale=parseFloat(t.attributes.scale||"1"),o.rotationStyle=parseFloat(t.attributes.rotation||"1"),o.isDraggable="false"!==t.attributes.draggable,o.isVisible="true"!==t.attributes.hidden,o.heading=parseFloat(t.attributes.heading)||0,o.drawNew(),o.gotoXY(+t.attributes.x||0,+t.attributes.y||0),r.loadObject(o,t)}),this.objects={},this.project={},this.mediaDict={},e.createCorral(),e.fixLayout()},SnapSerializer.prototype.loadMedia=function(t){return this.loadMediaModel(this.parse(t))},SnapSerializer.prototype.loadMediaModel=function(t){var e=this,o=t;if(this.mediaDict={},+o.attributes.version>this.version)throw"Module uses newer version of Serializer";return o.children.forEach(function(t){e.loadValue(t)}),this.mediaDict},SnapSerializer.prototype.loadObject=function(t,e){var o=e.require("blocks");this.loadNestingInfo(t,e),this.loadCostumes(t,e),this.loadSounds(t,e),this.loadCustomBlocks(t,o),this.populateCustomBlocks(t,o),this.loadVariables(t.variables,e.require("variables")),this.loadScripts(t.scripts,e.require("scripts"))},SnapSerializer.prototype.loadNestingInfo=function(t,e){var o=e.childNamed("nest");o&&(t.nestingInfo=o.attributes)},SnapSerializer.prototype.loadCostumes=function(t,e){var o,i=e.childNamed("costumes");i&&(t.costumes=this.loadValue(i.require("list"))),Object.prototype.hasOwnProperty.call(e.attributes,"costume")&&(o=t.costumes.asArray()[e.attributes.costume-1],o&&(o.loaded?t.wearCostume(o):o.loaded=function(){t.wearCostume(o),this.loaded=!0}))},SnapSerializer.prototype.loadSounds=function(t,e){var o=e.childNamed("sounds");o&&(t.sounds=this.loadValue(o.require("list")))},SnapSerializer.prototype.loadVariables=function(t,e){var o=this;e.children.forEach(function(e){var i;"variable"===e.tag&&(i=e.children[0],t.vars[e.attributes.name]=i?o.loadValue(i):0)})},SnapSerializer.prototype.loadCustomBlocks=function(t,e,o){var i=this;e.children.forEach(function(e){var r,n,s,a,h,l,p;"block-definition"===e.tag&&(r=new CustomBlockDefinition(e.attributes.s||"",t),r.category=e.attributes.category||"other",r.type=e.attributes.type||"command",r.isGlobal=o===!0,r.isGlobal?t.globalBlocks.push(r):t.customBlocks.push(r),n=r.parseSpec(r.spec).filter(function(t){return"%"===t.charAt(0)}).map(function(t){return t.substr(1)}),r.names=n,s=e.childNamed("inputs"),s&&(p=-1,s.children.forEach(function(t){var e=t.childNamed("options");"input"===t.tag&&(p+=1,r.declarations[n[p]]=[t.attributes.type,t.contents,e?e.contents:void 0,"true"===t.attributes.readonly])})),a=e.childNamed("header"),a&&(r.codeHeader=a.contents),h=e.childNamed("code"),h&&(r.codeMapping=h.contents),l=e.childNamed("comment"),l&&(r.comment=i.loadComment(l)))})},SnapSerializer.prototype.populateCustomBlocks=function(t,e,o){var i=this;e.children.forEach(function(e,r){var n,s,a;"block-definition"===e.tag&&(n=o?t.globalBlocks[r]:t.customBlocks[r],s=e.childNamed("script"),s&&(n.body=new Context(null,s?i.loadScript(s):null,null,t),n.body.inputs=n.names.slice(0)),a=e.childNamed("scripts"),a&&(n.scripts=i.loadScriptsArray(a)),delete n.names)})},SnapSerializer.prototype.loadScripts=function(t,e){var o=this,i=SyntaxElementMorph.prototype.scale;t.texture=window.getAsset("scriptsPaneTexture.gif"),e.children.forEach(function(e){var r;if("script"===e.tag){if(r=o.loadScript(e),!r)return;r.setPosition(new Point((+e.attributes.x||0)*i,(+e.attributes.y||0)*i).add(t.topLeft())),t.add(r),r.fixBlockColor(null,!0),r.allComments().forEach(function(t){t.align(r)})}else if("comment"===e.tag){if(r=o.loadComment(e),!r)return;r.setPosition(new Point((+e.attributes.x||0)*i,(+e.attributes.y||0)*i).add(t.topLeft())),t.add(r)}})},SnapSerializer.prototype.loadScriptsArray=function(t){var e=this,o=SyntaxElementMorph.prototype.scale,i=[];return t.children.forEach(function(t){var r;if("script"===t.tag){if(r=e.loadScript(t),!r)return;r.setPosition(new Point((+t.attributes.x||0)*o,(+t.attributes.y||0)*o)),i.push(r),r.fixBlockColor(null,!0)}else if("comment"===t.tag){if(r=e.loadComment(t),!r)return;r.setPosition(new Point((+t.attributes.x||0)*o,(+t.attributes.y||0)*o)),i.push(r)}}),i},SnapSerializer.prototype.loadScript=function(t){var e,o,i,r=this;return t.children.forEach(function(t){i=r.loadBlock(t),i&&(o?o.nextBlock(i):e=i,o=i)}),e},SnapSerializer.prototype.loadComment=function(t){var e=new CommentMorph(t.contents),o=SyntaxElementMorph.prototype.scale;return e.isCollapsed="true"===t.attributes.collapsed,e.setTextWidth(+t.attributes.w*o),e},SnapSerializer.prototype.loadBlock=function(t,e){var o,i,r,n,s,a,h="true";if(Object.prototype.hasOwnProperty.call(t.attributes,"visible")&&(h=t.attributes.visible),"block"===t.tag){if(Object.prototype.hasOwnProperty.call(t.attributes,"var")){var o=SpriteMorph.prototype.variableBlock(t.attributes["var"]);return"true"!==h&&(o.hide(),o.fixLayout()),o}o=SpriteMorph.prototype.blockForSelector(t.attributes.s),"true"!==h&&(o.hide(),o.fixLayout())}else if("custom-block"===t.tag){if(n=t.attributes.scope?!1:!0,a=n?this.project.stage:this.project.sprites[t.attributes.scope],s=t.childNamed("receiver"),s&&s.children[0]&&(a=this.loadValue(t.childNamed("receiver").children[0])),!a)return this.obsoleteBlock(e);if(n?(i=detect(a.globalBlocks,function(e){return e.blockSpec()===t.attributes.s
}),!i&&this.project.targetStage&&(i=detect(this.project.targetStage.globalBlocks,function(e){return e.blockSpec()===t.attributes.s}))):i=detect(a.customBlocks,function(e){return e.blockSpec()===t.attributes.s}),!i)return this.obsoleteBlock(e);o="command"===i.type?new CustomCommandBlockMorph(i,!1):new CustomReporterBlockMorph(i,"predicate"===i.type,!1),"true"!==h&&(o.hide(),o.fixLayout())}return null===o&&(o=this.obsoleteBlock(e)),o.isDraggable=!0,r=o.inputs(),t.children.forEach(function(t,e){"comment"===t.tag?(o.comment=this.loadComment(t),o.comment.block=o):"receiver"===t.tag?nop():this.loadInput(t,r[e],o)},this),o},SnapSerializer.prototype.obsoleteBlock=function(t){var e=t?new ReporterBlockMorph:new CommandBlockMorph;return e.selector="nop",e.color=new Color(200,0,20),e.setSpec("Obsolete!"),e.isDraggable=!0,e},SnapSerializer.prototype.loadInput=function(t,e,o){var i,r,n=this;if("script"===t.tag)i=this.loadScript(t),i&&(e.add(i),e.fixLayout());else if("autolambda"===t.tag&&t.children[0])i=this.loadBlock(t.children[0],!0),i&&(e.silentReplaceInput(e.children[0],i),e.fixLayout());else if("list"===t.tag){for(;e.inputs().length>0;)e.removeInput();t.children.forEach(function(t){e.addInput(),n.loadInput(t,e.children[e.children.length-2],e)}),e.fixLayout()}else"block"===t.tag||"custom-block"===t.tag?o.silentReplaceInput(e,this.loadBlock(t,!0)):"color"===t.tag?e.setColor(this.loadColor(t.contents)):(r=this.loadValue(t),r&&e.setContents(this.loadValue(t)))},SnapSerializer.prototype.loadValue=function(t){function e(){Object.prototype.hasOwnProperty.call(t.attributes,"id")&&(p.objects[t.attributes.id]=o),Object.prototype.hasOwnProperty.call(t.attributes,"mediaID")&&(p.mediaDict[t.attributes.mediaID]=o)}var o,i,r,n,s,a,h,l,p=this;switch(t.tag){case"ref":if(Object.prototype.hasOwnProperty.call(t.attributes,"id"))return this.objects[t.attributes.id];if(Object.prototype.hasOwnProperty.call(t.attributes,"mediaID"))return this.mediaDict[t.attributes.mediaID];throw new Error("expecting a reference id");case"l":return l=t.childNamed("option"),l?[l.contents]:t.contents;case"bool":return"true"===t.contents;case"list":return t.attributes.hasOwnProperty("linked")?(i=t.childrenNamed("item"),0===i.length?(o=new List,e(),o):(i.forEach(function(t){var i=t.children[0];void 0===o?(o=new List,e()):o=o.rest=new List,o.isLinked=!0,o.first=i?p.loadValue(i):0}),o)):(o=new List,e(),o.contents=t.childrenNamed("item").map(function(t){var e=t.children[0];return e?p.loadValue(e):0}),o);case"sprite":return o=new SpriteMorph(p.project.globalVariables),t.attributes.id&&(p.objects[t.attributes.id]=o),t.attributes.name&&(o.name=t.attributes.name,p.project.sprites[t.attributes.name]=o),t.attributes.idx&&(o.idx=+t.attributes.idx),t.attributes.color&&(o.color=p.loadColor(t.attributes.color)),t.attributes.pen&&(o.penPoint=t.attributes.pen),p.project.stage.add(o),o.scale=parseFloat(t.attributes.scale||"1"),o.rotationStyle=parseFloat(t.attributes.rotation||"1"),o.isDraggable="false"!==t.attributes.draggable,o.isVisible="true"!==t.attributes.hidden,o.heading=parseFloat(t.attributes.heading)||0,o.drawNew(),o.gotoXY(+t.attributes.x||0,+t.attributes.y||0),p.loadObject(o,t),o;case"context":return o=new Context(null),e(),r=t.childNamed("script"),r?o.expression=this.loadScript(r):(r=t.childNamed("block")||t.childNamed("custom-block"),r?o.expression=this.loadBlock(r):(r=t.childNamed("l"),r&&(o.expression=new InputSlotMorph(r.contents)))),r=t.childNamed("receiver"),r&&(r=r.childNamed("ref")||r.childNamed("sprite"),r&&(o.receiver=this.loadValue(r))),r=t.childNamed("inputs"),r&&r.children.forEach(function(t){"input"===t.tag&&o.inputs.push(t.contents)}),r=t.childNamed("variables"),r&&this.loadVariables(o.variables,r),r=t.childNamed("context"),r&&(o.outerContext=this.loadValue(r)),o;case"costume":return n=new Point,Object.prototype.hasOwnProperty.call(t.attributes,"center-x")&&(n.x=parseFloat(t.attributes["center-x"])),Object.prototype.hasOwnProperty.call(t.attributes,"center-y")&&(n.y=parseFloat(t.attributes["center-y"])),Object.prototype.hasOwnProperty.call(t.attributes,"name")&&(a=t.attributes.name),Object.prototype.hasOwnProperty.call(t.attributes,"image")&&(s=new Image,0!==t.attributes.image.indexOf("data:image/svg+xml")||MorphicPreferences.rasterizeSVGs?(o=new Costume(null,a,n),s.onload=function(){var t=newCanvas(new Point(s.width,s.height)),e=t.getContext("2d");e.drawImage(s,0,0),o.contents=t,o.version=+new Date,"function"==typeof o.loaded?o.loaded():o.loaded=!0}):(o=new SVG_Costume(null,a,n),s.onload=function(){o.contents=s,o.version=+new Date,"function"==typeof o.loaded?o.loaded():o.loaded=!0}),s.src=t.attributes.image),e(),o;case"sound":return h=new Audio,h.src=t.attributes.sound,o=new Sound(h,t.attributes.name),Object.prototype.hasOwnProperty.call(t.attributes,"mediaID")&&(p.mediaDict[t.attributes.mediaID]=o),o}return void 0},SnapSerializer.prototype.loadColor=function(t){var e=(t||"").split(",");return new Color(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))},SnapSerializer.prototype.openProject=function(t,e){var o,i=e.stage,r=[];t&&t.stage&&(e.projectName=t.name,e.projectNotes=t.notes||"",e.globalVariables&&(e.globalVariables=t.globalVariables),i&&i.destroy(),e.add(t.stage),e.stage=t.stage,r=e.stage.children.filter(function(t){return t instanceof SpriteMorph}),r.sort(function(t,e){return t.idx-e.idx}),e.sprites=new List(r),o=r[0]||t.stage,sizeOf(this.mediaDict)>0?(e.hasChangedMedia=!1,this.mediaDict={}):e.hasChangedMedia=!0,t.stage.drawNew(),e.createCorral(),e.selectSprite(o),e.fixLayout(),e.world().keyboardReceiver=t.stage,world.children.forEach(function(t){t instanceof BlockMorph&&(t.changed(),t.drawNew(),t.changed())}))},Array.prototype.toXML=function(t){return this.reduce(function(e,o){return e+t.store(o)},"")},StageMorph.prototype.toXML=function(t){function e(t){var e="";return Object.keys(StageMorph.prototype[t]).forEach(function(o){e+="<"+o+">"+XML_Element.prototype.escape(StageMorph.prototype[t][o])+"</"+o+">"}),e}var o,i=this.thumbnail(SnapSerializer.prototype.thumbnailSize),r=this.parentThatIsA(IDE_Morph);try{o=i.toDataURL("image/png")}catch(n){o=null}return this.removeAllClones(),t.format('<project name="@" app="@" version="@"><notes>$</notes><thumbnail>$</thumbnail><stage name="@" width="@" height="@" costume="@" tempo="@" threadsafe="@" lines="@" codify="@" scheduled="@" ~><pentrails>$</pentrails><costumes>%</costumes><sounds>%</sounds><variables>%</variables><blocks>%</blocks><scripts>%</scripts><sprites>%</sprites></stage><hidden>$</hidden><headers>%</headers><code>%</code><blocks>%</blocks><variables>%</variables></project>',r&&r.projectName?r.projectName:"Untitled",t.app,t.version,r&&r.projectNotes?r.projectNotes:"",o,this.name,StageMorph.prototype.dimensions.x,StageMorph.prototype.dimensions.y,this.getCostumeIdx(),this.getTempo(),this.isThreadSafe,SpriteMorph.prototype.useFlatLineEnds?"flat":"round",this.enableCodeMapping,0!==StageMorph.prototype.frameRate,this.trailsCanvas.toDataURL("image/png"),t.store(this.costumes,this.name+"_cst"),t.store(this.sounds,this.name+"_snd"),t.store(this.variables),t.store(this.customBlocks),t.store(this.scripts),t.store(this.children),Object.keys(StageMorph.prototype.hiddenPrimitives).reduce(function(t,e){return t+" "+e},""),e("codeHeaders"),e("codeMappings"),t.store(this.globalBlocks),r&&r.globalVariables?t.store(r.globalVariables):"")},SpriteMorph.prototype.toXML=function(t){var e=this.parentThatIsA(StageMorph),o=e?e.parentThatIsA(IDE_Morph):null,i=o?o.sprites.asArray().indexOf(this)+1:0;return t.format('<sprite name="@" idx="@" x="@" y="@" heading="@" scale="@" rotation="@" draggable="@"% costume="@" color="@,@,@" pen="@" ~>%<costumes>%</costumes><sounds>%</sounds><variables>%</variables><blocks>%</blocks><scripts>%</scripts></sprite>',this.name,i,this.xPosition(),this.yPosition(),this.heading,this.scale,this.rotationStyle,this.isDraggable,this.isVisible?"":' hidden="true"',this.getCostumeIdx(),this.color.r,this.color.g,this.color.b,this.penPoint,this.anchor?'<nest anchor="'+this.anchor.name+'" synch="'+this.rotatesWithAnchor+(this.scale===this.nestingScale?"":'" scale="'+this.nestingScale)+'"/>':"",t.store(this.costumes,this.name+"_cst"),t.store(this.sounds,this.name+"_snd"),t.store(this.variables),this.customBlocks?t.store(this.customBlocks):"",t.store(this.scripts))},Costume.prototype[XML_Serializer.prototype.mediaDetectionProperty]=!0,Costume.prototype.toXML=function(t){return t.format('<costume name="@" center-x="@" center-y="@" image="@" ~/>',this.name,this.rotationCenter.x,this.rotationCenter.y,this instanceof SVG_Costume?this.contents.src:this.contents.toDataURL("image/png"))},Sound.prototype[XML_Serializer.prototype.mediaDetectionProperty]=!0,Sound.prototype.toXML=function(t){return t.format('<sound name="@" sound="@" ~/>',this.name,this.toDataURL())},VariableFrame.prototype.toXML=function(t){var e=this;return Object.keys(this.vars).reduce(function(o,i){var r,n=e.vars[i];return r=void 0===n||null===n?t.format('<variable name="@"/>',i):t.format('<variable name="@">%</variable>',i,"object"==typeof n?t.store(n):"boolean"==typeof n?t.format("<bool>$</bool>",n):t.format("<l>$</l>",n)),o+r},"")},WatcherMorph.prototype.toXML=function(t){var e=this.target instanceof VariableFrame,o=this.currentValue instanceof List,i=this.readoutColor,r=this.parent?this.topLeft().subtract(this.parent.topLeft()):this.topLeft();return t.format('<watcher% % style="@"% x="@" y="@" color="@,@,@"%%/>',e&&this.target.owner||!e&&this.target?t.format(' scope="@"',e?this.target.owner.name:this.target.name):"",t.format(e?'var="@"':'s="@"',this.getter),this.style,e&&"slider"===this.style?t.format(' min="@" max="@"',this.sliderMorph.start,this.sliderMorph.stop):"",r.x,r.y,i.r,i.g,i.b,o?t.format(' extX="@" extY="@"',this.cellMorph.contentsMorph.width(),this.cellMorph.contentsMorph.height()):"",this.isVisible?"":' hidden="true"')},ScriptsMorph.prototype.toXML=function(t){return this.children.reduce(function(e,o){return o instanceof BlockMorph?e+o.toScriptXML(t,!0):o instanceof CommentMorph&&!o.block?e+o.toXML(t):e},"")},BlockMorph.prototype.toXML=BlockMorph.prototype.toScriptXML=function(t,e){var o,i,r=SyntaxElementMorph.prototype.scale,n=this;o=this.parent?this.topLeft().subtract(this.parent.topLeft()):this.topLeft(),i=e?t.format('<script x="@" y="@">',o.x/r,o.y/r):"<script>";do i+=n.toBlockXML(t),n=n.nextBlock();while(n);return i+="</script>"},BlockMorph.prototype.toBlockXML=function(t){return t.format('<block s="@" visible="@">%%</block>',this.selector,this.isVisible,t.store(this.inputs()),this.comment?this.comment.toXML(t):"")},ReporterBlockMorph.prototype.toXML=function(t){return"reportGetVar"===this.selector?t.format('<block var="@"/>',this.blockSpec):this.toBlockXML(t)},ReporterBlockMorph.prototype.toScriptXML=function(t,e){var o,i=SyntaxElementMorph.prototype.scale;return o=this.parent?this.topLeft().subtract(this.parent.topLeft()):this.topLeft(),e?t.format('<script x="@" y="@">%</script>',o.x/i,o.y/i,this.toXML(t)):t.format("<script>%</script>",this.toXML(t))},CustomCommandBlockMorph.prototype.toBlockXML=function(t){var e=this.definition.isGlobal?void 0:this.definition.receiver.name;return t.format('<custom-block s="@"%>%%%</custom-block>',this.blockSpec,this.definition.isGlobal?"":t.format(' scope="@"',e),t.store(this.inputs()),this.comment?this.comment.toXML(t):"",e&&!this.definition.receiver[t.idProperty]?"<receiver>"+t.store(this.definition.receiver)+"</receiver>":"")},CustomReporterBlockMorph.prototype.toBlockXML=CustomCommandBlockMorph.prototype.toBlockXML,CustomBlockDefinition.prototype.toXML=function(t){function e(e){return e.reduce(function(e,o){return o instanceof BlockMorph?e+o.toScriptXML(t,!0):o instanceof CommentMorph&&!o.block?e+o.toXML(t):e},"")}var o=this;return t.format('<block-definition s="@" type="@" category="@">%<header>@</header><code>@</code><inputs>%</inputs>%%</block-definition>',this.spec,this.type,this.category||"other",this.comment?this.comment.toXML(t):"",this.codeHeader||"",this.codeMapping||"",Object.keys(this.declarations).reduce(function(e,i){return e+t.format('<input type="@"$>$%</input>',o.declarations[i][0],o.declarations[i][3]?' readonly="true"':"",o.declarations[i][1],o.declarations[i][2]?"<options>"+o.declarations[i][2]+"</options>":"")},""),this.body?t.store(this.body.expression):"",this.scripts.length>0?"<scripts>"+e(this.scripts)+"</scripts>":"")},ArgMorph.prototype.toXML=function(){return"<l/>"},InputSlotMorph.prototype.toXML=function(t){return this.constant?t.format("<l><option>$</option></l>",this.constant):t.format("<l>$</l>",this.contents().text)},TemplateSlotMorph.prototype.toXML=function(t){return t.format("<l>$</l>",this.contents())},CommandSlotMorph.prototype.toXML=function(t){var e=this.children[0];return e instanceof BlockMorph?e instanceof ReporterBlockMorph?t.format("<autolambda>%</autolambda>",t.store(e)):t.store(e):"<script></script>"},FunctionSlotMorph.prototype.toXML=CommandSlotMorph.prototype.toXML,MultiArgMorph.prototype.toXML=function(t){return t.format("<list>%</list>",t.store(this.inputs()))},ArgLabelMorph.prototype.toXML=function(t){return t.format("%",t.store(this.inputs()[0]))},ColorSlotMorph.prototype.toXML=function(t){return t.format("<color>$,$,$,$</color>",this.color.r,this.color.g,this.color.b,this.color.a)},List.prototype.toXML=function(t,e){var o,i;if(this.isLinked){o='<list linked="linked" ~>',i=this;do o+=t.format("<item>%</item>",t.store(i.first)),i=i.rest;while(void 0!==i&&null!==i);return o+"</list>"}return t.format("<list ~>%</list>",this.contents.reduce(function(o,i){return o+t.format("<item>%</item>","object"==typeof i?t.store(i,e):"boolean"==typeof i?t.format("<bool>$</bool>",i):t.format("<l>$</l>",i))},""))},Context.prototype.toXML=function(t){return this.isContinuation?"":t.format("<context% ~><inputs>%</inputs><variables>%</variables>%<receiver>%</receiver>%</context>",this.isLambda?' lambda="lambda"':"",this.inputs.reduce(function(e,o){return e+t.format("<input>$</input>",o)},""),this.variables?t.store(this.variables):"",this.expression?t.store(this.expression):"",this.receiver?t.store(this.receiver):"",this.outerContext?t.store(this.outerContext):"")},CommentMorph.prototype.toXML=function(t){var e,o=SyntaxElementMorph.prototype.scale;return this.block?t.format('<comment w="@" collapsed="@">%</comment>',this.textWidth()/o,this.isCollapsed,t.escape(this.text())):(e=this.parent?this.topLeft().subtract(this.parent.topLeft()):this.topLeft(),t.format('<comment x="@" y="@" w="@" collapsed="@">%</comment>',e.x/o,e.y/o,this.textWidth()/o,this.isCollapsed,t.escape(this.text())))},modules.cloud="2014-January-09";var Cloud,SnapCloud=new Cloud("https://snapcloud.miosoft.com/miocon/app/login?_app=SnapCloud");Cloud.prototype.clear=function(){this.username=null,this.password=null,this.session=null,this.api={}},Cloud.prototype.hasProtocol=function(){return 0===this.url.toLowerCase().indexOf("http")},Cloud.prototype.signup=function(t,e,o,i){var r=new XMLHttpRequest,n=this;try{r.open("GET",(this.hasProtocol()?"":"http://")+this.url+"SignUp&Username="+encodeURIComponent(t)+"&Email="+encodeURIComponent(e),!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.withCredentials=!0,r.onreadystatechange=function(){4===r.readyState&&(r.responseText?0===r.responseText.indexOf("ERROR")?i.call(this,r.responseText,"Signup"):o.call(null,r.responseText,"Signup"):i.call(null,n.url+"SignUp","could not connect to:"))},r.send(null)}catch(s){i.call(this,s.toString(),"Snap!Cloud")}},Cloud.prototype.getPublicProject=function(t,e,o){var i,r=new XMLHttpRequest,n=this;try{r.open("GET",(this.hasProtocol()?"":"http://")+this.url+"Public&"+t,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.withCredentials=!0,r.onreadystatechange=function(){4===r.readyState&&(r.responseText?0===r.responseText.indexOf("ERROR")?o.call(this,r.responseText):(i=n.parseResponse(r.responseText),e.call(null,i[0].SourceCode)):o.call(null,n.url+"Public","could not connect to:"))},r.send(null)}catch(s){o.call(this,s.toString(),"Snap!Cloud")}},Cloud.prototype.resetPassword=function(t,e,o){var i=new XMLHttpRequest,r=this;try{i.open("GET",(this.hasProtocol()?"":"http://")+this.url+"ResetPW&Username="+encodeURIComponent(t),!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.withCredentials=!0,i.onreadystatechange=function(){4===i.readyState&&(i.responseText?0===i.responseText.indexOf("ERROR")?o.call(this,i.responseText,"Reset Password"):e.call(null,i.responseText,"Reset Password"):o.call(null,r.url+"ResetPW","could not connect to:"))},i.send(null)}catch(n){o.call(this,n.toString(),"Snap!Cloud")}},Cloud.prototype.connect=function(t,e){var o=new XMLHttpRequest,i=this;try{o.open("GET",(this.hasProtocol()?"":"http://")+this.url,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.withCredentials=!0,o.onreadystatechange=function(){4===o.readyState&&(o.responseText?(i.api=i.parseAPI(o.responseText),i.session=o.getResponseHeader("MioCracker").split(";")[0],i.api.login?t.call(null,i.api,"Snap!Cloud"):e.call(null,"connection failed")):e.call(null,i.url,"could not connect to:"))},o.send(null)}catch(r){e.call(this,r.toString(),"Snap!Cloud")}},Cloud.prototype.login=function(t,e,o,i){var r=this;this.connect(function(){r.rawLogin(t,e,o,i),r.disconnect()},i)},Cloud.prototype.rawLogin=function(t,e,o,i){var r=this,n=hex_sha512("miosoft%20miocon,"+this.session.split("=")[1]+","+encodeURIComponent(t.toLowerCase())+","+e);this.callService("login",function(n,s){r.api.logout?(r.username=t,r.password=e,o.call(null,n,s)):i.call(null,"Service catalog is not available,\nplease retry","Connection Error:")},i,[t,n])},Cloud.prototype.reconnect=function(t,e){return this.username&&this.password?void this.login(this.username,this.password,t,e):void this.message("You are not logged in")},Cloud.prototype.saveProject=function(t,e,o){var i,r,n=this;t.serializer.isCollectingMedia=!0,i=t.serializer.serialize(t.stage),r=t.hasChangedMedia?t.serializer.mediaXML(t.projectName):null,t.serializer.isCollectingMedia=!1,t.serializer.flushMedia();try{t.serializer.parse(i)}catch(s){throw t.showMessage("Serialization of program data failed:\n"+s),new Error("Serialization of program data failed:\n"+s)}if(null!==r)try{t.serializer.parse(r)}catch(s){throw t.showMessage("Serialization of media failed:\n"+s),new Error("Serialization of media failed:\n"+s)}t.serializer.isCollectingMedia=!1,t.serializer.flushMedia(),n.reconnect(function(){n.callService("saveProject",function(o,i){e.call(null,o,i),n.disconnect(),t.hasChangedMedia=!1},o,[t.projectName,i,r,i.length,r?r.length:0])},o)},Cloud.prototype.getProjectList=function(t,e){var o=this;this.reconnect(function(){o.callService("getProjectList",function(e,i){t.call(null,e,i),o.disconnect()},e)},e)},Cloud.prototype.changePassword=function(t,e,o,i){var r=this;this.reconnect(function(){r.callService("changePassword",function(t,e){o.call(null,t,e),r.disconnect()},i,[t,e])},i)},Cloud.prototype.logout=function(t,e){this.clear(),this.callService("logout",t,e)},Cloud.prototype.disconnect=function(){this.callService("logout",nop,nop)},Cloud.prototype.callURL=function(t,e,o){var i=new XMLHttpRequest,r=this;try{i.open("GET",t,!0),i.withCredentials=!0,i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("MioCracker",this.session),i.onreadystatechange=function(){if(4===i.readyState)if(i.responseText){var n=r.parseResponse(i.responseText);e.call(null,n,t)}else o.call(null,t,"no response from:")},i.send(null)}catch(n){o.call(this,n.toString(),t)}},Cloud.prototype.callService=function(t,e,o,i){var r,n=new XMLHttpRequest,s=this.api[t],a=this;if(!this.session)return void o.call(null,"You are not connected","Cloud");if(!s)return void o.call(null,"service "+t+" is not available","API");i&&i.length>0&&(r={},s.parameters.forEach(function(t,e){r[t]=i[e]}));try{n.open(s.method,s.url,!0),n.withCredentials=!0,n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("MioCracker",this.session),n.onreadystatechange=function(){if(4===n.readyState){var i=[];if(n.responseText&&0===n.responseText.indexOf("ERROR"))return void o.call(this,n.responseText,"Service: "+t);"login"===t&&(a.api=a.parseAPI(n.responseText)),i=a.parseResponse(n.responseText),e.call(null,i,s.url)}},n.send(this.encodeDict(r))}catch(h){o.call(this,h.toString(),s.url)}},Cloud.prototype.parseAPI=function(t){var e,o={};return e=t.split(" "),e.forEach(function(t){var e,i=t.split("&"),r={};i.forEach(function(t){var i=t.split("="),n=decodeURIComponent(i[0]).toLowerCase(),s=decodeURIComponent(i[1]);"service"===n?o[s]=r:"parameters"===n?(e=s.split(","),(1!==e.length||e[0])&&(r.parameters=e)):r[n]=s})}),o},Cloud.prototype.parseResponse=function(t){var e,o=[];return t?(e=t.split(" "),e.forEach(function(t){var e=t.split("&"),i={};e.forEach(function(t){var e=t.split("="),o=decodeURIComponent(e[0]),r=decodeURIComponent(e[1]);i[o]=r}),o.push(i)}),o):o},Cloud.prototype.parseDict=function(t){var e={};return t?(t.split("&").forEach(function(t){var o=t.split("="),i=decodeURIComponent(o[0]),r=decodeURIComponent(o[1]);e[i]=r}),e):e},Cloud.prototype.encodeDict=function(t){var e,o,i="";if(!t)return null;for(o in t)t.hasOwnProperty(o)&&(e=encodeURIComponent(o)+"="+encodeURIComponent(t[o]),i.length>0&&(i+="&"),i+=e);return i},Cloud.prototype.message=function(t){alert(t)};var hex_sha512=function(t){function t(t){return o.SHA512(e(t)).toString(o.enc.Hex)}function e(t){for(var e,o,i="",r=-1;++r<t.length;)e=t.charCodeAt(r),o=r+1<t.length?t.charCodeAt(r+1):0,e>=55296&&56319>=e&&o>=56320&&57343>=o&&(e=65536+((1023&e)<<10)+(1023&o),r++),127>=e?i+=String.fromCharCode(e):2047>=e?i+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?i+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(i+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return i}var o=o||function(t,e){var o={},i=o.lib={},r=i.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var o=new t;return e&&o.mixIn(e),o.$super=this,o},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.$super.extend(this)}}}(),n=i.WordArray=r.extend({init:function(t,o){t=this.words=t||[],this.sigBytes=o!=e?o:4*t.length},toString:function(t){return(t||a).stringify(this)},concat:function(t){var e=this.words,o=t.words,i=this.sigBytes,t=t.sigBytes;if(this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(o[r>>>2]>>>24-8*(r%4)&255)<<24-8*((i+r)%4);else if(65535<o.length)for(r=0;t>r;r+=4)e[i+r>>>2]=o[r>>>2];else e.push.apply(e,o);return this.sigBytes+=t,this},clamp:function(){var e=this.words,o=this.sigBytes;e[o>>>2]&=4294967295<<32-8*(o%4),e.length=t.ceil(o/4)},clone:function(){var t=r.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var o=[],i=0;e>i;i+=4)o.push(4294967296*t.random()|0);return n.create(o,e)}}),s=o.enc={},a=s.Hex={stringify:function(t){for(var e=t.words,t=t.sigBytes,o=[],i=0;t>i;i++){var r=e[i>>>2]>>>24-8*(i%4)&255;o.push((r>>>4).toString(16)),o.push((15&r).toString(16))}return o.join("")},parse:function(t){for(var e=t.length,o=[],i=0;e>i;i+=2)o[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return n.create(o,e/2)}},h=s.Latin1={stringify:function(t){for(var e=t.words,t=t.sigBytes,o=[],i=0;t>i;i++)o.push(String.fromCharCode(e[i>>>2]>>>24-8*(i%4)&255));return o.join("")},parse:function(t){for(var e=t.length,o=[],i=0;e>i;i++)o[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return n.create(o,e)}},l=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(h.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return h.parse(unescape(encodeURIComponent(t)))}},p=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=n.create(),this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var o=this._data,i=o.words,r=o.sigBytes,s=this.blockSize,a=r/(4*s),a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0),e=a*s,r=t.min(4*e,r);if(e){for(var h=0;e>h;h+=s)this._doProcessBlock(i,h);h=i.splice(0,e),o.sigBytes-=r}return n.create(h,r)},clone:function(){var t=r.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=p.extend({init:function(){this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize(),this._hash},clone:function(){var t=p.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:16,_createHelper:function(t){return function(e,o){return t.create(o).finalize(e)}},_createHmacHelper:function(t){return function(e,o){return c.HMAC.create(t,o).finalize(e)}}});var c=o.algo={};return o}(Math);!function(t){var e=o,i=e.lib,r=i.Base,n=i.WordArray,e=e.x64={};e.Word=r.extend({init:function(t,e){this.high=t,this.low=e}}),e.WordArray=r.extend({init:function(e,o){e=this.words=e||[],this.sigBytes=o!=t?o:8*e.length},toX32:function(){for(var t=this.words,e=t.length,o=[],i=0;e>i;i++){var r=t[i];o.push(r.high),o.push(r.low)}return n.create(o,this.sigBytes)},clone:function(){for(var t=r.clone.call(this),e=t.words=this.words.slice(0),o=e.length,i=0;o>i;i++)e[i]=e[i].clone();return t}})}(),function(){function t(){return n.create.apply(n,arguments)}var e=o,i=e.lib.Hasher,r=e.x64,n=r.Word,s=r.WordArray,r=e.algo,a=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],h=[];!function(){for(var e=0;80>e;e++)h[e]=t()}(),r=r.SHA512=i.extend({_doReset:function(){this._hash=s.create([t(1779033703,4089235720),t(3144134277,2227873595),t(1013904242,4271175723),t(2773480762,1595750129),t(1359893119,2917565137),t(2600822924,725511199),t(528734635,4215389547),t(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var o=this._hash.words,i=o[0],r=o[1],n=o[2],s=o[3],l=o[4],p=o[5],c=o[6],o=o[7],d=i.high,u=i.low,f=r.high,g=r.low,m=n.high,y=n.low,M=s.high,b=s.low,w=l.high,S=l.low,C=p.high,v=p.low,x=c.high,k=c.low,B=o.high,P=o.low,T=d,I=u,E=f,L=g,D=m,F=y,A=M,N=b,R=w,O=S,z=C,j=v,H=x,W=k,_=B,V=P,U=0;80>U;U++){var G=h[U];if(16>U)var q=G.high=0|t[e+2*U],X=G.low=0|t[e+2*U+1];else{var q=h[U-15],X=q.high,$=q.low,q=($<<31|X>>>1)^($<<24|X>>>8)^X>>>7,$=(X<<31|$>>>1)^(X<<24|$>>>8)^(X<<25|$>>>7),K=h[U-2],X=K.high,Y=K.low,K=(Y<<13|X>>>19)^(X<<3|Y>>>29)^X>>>6,Y=(X<<13|Y>>>19)^(Y<<3|X>>>29)^(X<<26|Y>>>6),X=h[U-7],J=X.high,Q=h[U-16],Z=Q.high,Q=Q.low,X=$+X.low,q=q+J+($>>>0>X>>>0?1:0),X=X+Y,q=q+K+(Y>>>0>X>>>0?1:0),X=X+Q,q=q+Z+(Q>>>0>X>>>0?1:0);G.high=q,G.low=X}var J=R&z^~R&H,Q=O&j^~O&W,G=T&E^T&D^E&D,te=I&L^I&F^L&F,$=(I<<4|T>>>28)^(T<<30|I>>>2)^(T<<25|I>>>7),K=(T<<4|I>>>28)^(I<<30|T>>>2)^(I<<25|T>>>7),Y=a[U],ee=Y.high,oe=Y.low,Y=V+((R<<18|O>>>14)^(R<<14|O>>>18)^(O<<23|R>>>9)),Z=_+((O<<18|R>>>14)^(O<<14|R>>>18)^(R<<23|O>>>9))+(V>>>0>Y>>>0?1:0),Y=Y+Q,Z=Z+J+(Q>>>0>Y>>>0?1:0),Y=Y+oe,Z=Z+ee+(oe>>>0>Y>>>0?1:0),Y=Y+X,Z=Z+q+(X>>>0>Y>>>0?1:0),X=K+te,G=$+G+(K>>>0>X>>>0?1:0),_=H,V=W,H=z,W=j,z=R,j=O,O=N+Y|0,R=A+Z+(N>>>0>O>>>0?1:0)|0,A=D,N=F,D=E,F=L,E=T,L=I,I=Y+X|0,T=Z+G+(Y>>>0>I>>>0?1:0)|0}u=i.low=u+I|0,i.high=d+T+(I>>>0>u>>>0?1:0)|0,g=r.low=g+L|0,r.high=f+E+(L>>>0>g>>>0?1:0)|0,y=n.low=y+F|0,n.high=m+D+(F>>>0>y>>>0?1:0)|0,b=s.low=b+N|0,s.high=M+A+(N>>>0>b>>>0?1:0)|0,S=l.low=S+O|0,l.high=w+R+(O>>>0>S>>>0?1:0)|0,v=p.low=v+j|0,p.high=C+z+(j>>>0>v>>>0?1:0)|0,k=c.low=k+W|0,c.high=x+H+(W>>>0>k>>>0?1:0)|0,P=o.low=P+V|0,o.high=B+_+(V>>>0>P>>>0?1:0)|0},_doFinalize:function(){var t=this._data,e=t.words,o=8*this._nDataBytes,i=8*t.sigBytes;e[i>>>5]|=128<<24-i%32,e[(i+128>>>10<<5)+31]=o,t.sigBytes=4*e.length,this._process(),this._hash=this._hash.toX32()},blockSize:32}),e.SHA512=i._createHelper(r),e.HmacSHA512=i._createHmacHelper(r)}();return t}({}),world;window.addLoadEvent(function(){world=new WorldMorph(document.getElementById("world"));var t=document.querySelector("#world").dataset;world.role=t.role,world.program_needs_check=void 0!=t.needs_check,world.isDevMode=!1,ide=new IDE_Morph,ide.openIn(world),setTimeout(function(){t.file&&ide.openProjectString(window.getURL(t.file)),setInterval(function(){world.doOneCycle()},30)},400)});